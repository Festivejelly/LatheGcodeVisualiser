<!DOCTYPE html>
<html>

<head>
    <title>G-Code Visualizer</title>
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/ace.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <script type="module" crossorigin>
var lo=Object.defineProperty;var co=(o,e,t)=>e in o?lo(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var x=(o,e,t)=>(co(o,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function t(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(s){if(s.ep)return;s.ep=!0;const c=t(s);fetch(s.href,c)}})();var M=(o=>(o.GCODE="gcode",o.PLANNER="planner",o.QUICKTASKS="quicktasks",o))(M||{});class uo{constructor(e,t,n,s,c,d,B,l,v,b,f,y,I){this.isConnected=e,this.condition=t,this.error=n,this.progress=s,this.currentLine=c,this.feedRate=d,this.z=B,this.x=l,this.y=v,this.feed=b,this.rpm=f,this.version=y,this.lastResponse=I}}const Ge=class Ge{constructor(){x(this,"listeners",[]);x(this,"activeClient",null);x(this,"port",null);x(this,"readTimeout",0);x(this,"reader",null);x(this,"writer",null);x(this,"isOn",!1);x(this,"waitForOkOrError",!1);x(this,"lines",[]);x(this,"lineIndex",0);x(this,"unparsedResponse","");x(this,"remainingResponse","");x(this,"error","");x(this,"statusReceived",!1);x(this,"currentLine","");x(this,"feedRate",0);x(this,"z",0);x(this,"x",0);x(this,"y",0);x(this,"feed",0);x(this,"rpm",0);x(this,"isDisconnecting",!1);x(this,"lastStatus",null);x(this,"version","");x(this,"lastResponse","");x(this,"currentCommandListeners",[]);x(this,"remainingStatus","")}static getInstance(){return Ge.instance||(Ge.instance=new Ge),Ge.instance}setActiveClient(e){this.activeClient=e,console.log(`Active client set to: ${e}`)}clearActiveClient(){this.activeClient=null,console.log("Active client cleared")}getStatus(){return this.lastStatus=new uo(this.port!==null,this.isOn?"run":"idle",this.error,this.lines.length?this.lineIndex/this.lines.length:0,this.currentLine,this.feedRate,this.z,this.x,this.y,this.feed,this.rpm,this.version,this.lastResponse),this.lastStatus}getCurrentCommand(){return this.currentLine}addStatusChangeListener(e,t){this.listeners.push({callback:e,client:t})}notifyStatusChange(){this.listeners.forEach(e=>{e.client===this.activeClient?(console.debug(`Notifying ${e.client} listener`),e.callback()):console.debug(`Skipping ${e.client} listener (not active)`)})}addCurrentCommandListener(e){this.currentCommandListeners.push(e)}notifyCurrentCommand(e){this.currentCommandListeners.forEach(t=>t(e))}setStatus(e){if(e=this.remainingStatus+e,this.remainingStatus="",e.startsWith("<")&&(e=e.substring(1)),e.endsWith(">"))e=e.slice(0,-1);else{this.remainingStatus=e;return}const t=e.split("|");if(t.length>=3){if(this.statusReceived=!0,t[1].startsWith("WPos:")){const n=t[1].substring(5).split(",");this.x=Number(n[0]),this.y=Number(n[1]),this.z=Number(n[2])}if(t[2].startsWith("FS:")){const n=t[2].substring(3).split(",");this.feed=Number(n[0]),this.rpm=Number(n[1])}t[3].startsWith("Id:")&&(this.version=String(t[3].substring(3)))}this.notifyStatusChange(),et(`response: ${e}`),console.log(`response: "${e}"`)}setError(e){this.error=e,et(e),this.notifyStatusChange()}isConnected(){return this.lastStatus!==null&&this.lastStatus.isConnected}async connect(){try{if(this.setActiveClient("gcode"),this.port)this.closePort();else{if(await this.selectPort(),this.write("!"),await this.askForStatus(),!await vn(()=>this.statusReceived)){this.setError("Device is not reponding, is it in GCODE mode?");return}this.isDisconnecting=!1,this.isOn=!1,this.setError(""),this.waitForOkOrError=!1,this.unparsedResponse=""}}catch(e){console.log(e)}this.notifyStatusChange()}async disconnect(){this.isDisconnecting=!0,this.port&&this.closePort()}getDisconnectingStatus(){return this.isDisconnecting}async start(e,t){e&&(this.setActiveClient(t),this.isOn=!0,this.lines=e.split(`
`),this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange())}async sendCommand(e,t){this.setActiveClient(t),this.isOn=!0,this.lines=[e],this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange()}async sendCommands(e,t){this.setActiveClient(t),this.isOn=!0,this.lines=e,this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange()}async getPosition(e){if(this.setActiveClient(e),this.statusReceived=!1,await this.write("?"),!await vn(()=>this.statusReceived))throw new Error("Failed to get position update");return this.notifyStatusChange(),this.getStatus()}async getToolOffsets(e){if(this.setActiveClient(e),this.lastResponse="",await this.sendCommand("#",e),!await mo(()=>this.lastResponse.includes("toolOffsets:")&&this.lastResponse.includes("ok"),50,100))throw new Error("Failed to get tool offsets");return this.stop(),this.lastResponse}async stop(){this.error="",await this.write("!"),this.isOn&&(this.isOn=!1,this.notifyStatusChange(),this.clearActiveClient())}async write(e){if(this.port){if(console.log("command: ",e),!this.port.writable){e!="?"&&this.setError("Port is not writable, try reconnecting the USB and switching to GCODE mode.");return}if(!this.writer)try{const t=new TextEncoderStream;t.readable.pipeTo(this.port.writable),this.writer=t.writable.getWriter()}catch(t){this.setError("Failed to write: "+t);return}await this.writer.write(e)}}async writeCurrentLine(){if(!this.isOn||this.waitForOkOrError)return;if(this.lineIndex>=this.lines.length){this.stop();return}const e=this.lines[this.lineIndex].split(";")[0].trim();if(!e){this.lineIndex++,this.writeCurrentLine();return}this.currentLine=e,this.notifyCurrentCommand(this.currentLine),this.waitForOkOrError=!0,et(`command: ${e}`),await this.write(e+`
`),await this.readFromPort()}async processResponse(e){this.unparsedResponse=(this.remainingResponse+e).trimStart(),this.remainingResponse="";const t=this.unparsedResponse.split(/\r?\n/).map(n=>n.replace(/\r/g,""));for(let n of t){const s=n.match(/(<[^>]+>)/);if(s&&s.length>1){s.shift();for(const c of s)n=n.replace(c,"");this.setStatus(s.pop())}n.startsWith("error:")?(this.remainingResponse+=n,et(`response: ${this.remainingResponse}`),console.log(`response: "${this.remainingResponse}"`),this.setError(n),this.remainingResponse="",this.stop()):n.startsWith("ok")||n.endsWith("ok")?(this.remainingResponse+=n,et(`response: ${this.remainingResponse}`),this.lastResponse=this.remainingResponse,console.log(`response: "${this.remainingResponse}"`),this.remainingResponse="",this.waitForOkOrError=!1,this.lineIndex++,this.notifyStatusChange(),this.isOn&&await this.writeCurrentLine()):this.remainingResponse+=n}this.unparsedResponse=""}async selectPort(){if(this.port&&this.closePort(),navigator.serial?this.port=await navigator.serial.requestPort():(this.error="This browser does not support Serial API, try Chrome or Edge",this.notifyStatusChange()),this.port)try{await this.port.open({baudRate:115200}),this.notifyStatusChange(),this.readSoon()}catch(e){this.setError(`Unable to open port - likely some other app is using it - try closing Arduino IDE.
${e}`),this.closePort()}}async askForStatus(){try{await this.write("?")}catch(e){this.setError(`Device disconnected? ${e}`),this.closePort()}}readSoon(){clearTimeout(this.readTimeout),this.readTimeout=window.setTimeout(()=>this.readFromPort(),200)}async readFromPort(){if(this.port)try{if(!this.port.readable){this.readSoon();return}if(!this.reader){const t=new TextDecoderStream;this.port.readable.pipeTo(t.writable),this.reader=t.readable.getReader()}const{value:e}=await this.reader.read();if(!e){this.readSoon();return}await this.processResponse(e),this.readSoon()}catch(e){this.setError(e.message||String(e)),this.closePort()}}async closePort(){if(this.port){if(clearTimeout(this.readTimeout),this.reader){try{await this.reader.cancel(),this.reader.releaseLock()}catch(e){console.error("Error cancelling reader: ",e)}this.reader=null}if(this.writer){try{await this.writer.close(),this.writer.releaseLock()}catch(e){console.error("Error closing writer: ",e)}this.writer=null}await new Promise(e=>setTimeout(e,500));try{await this.port.close()}catch(e){console.error("Error closing port: ",e)}this.port=null,this.statusReceived=!1,this.z=0,this.x=0,this.feed=0,this.rpm=0}}};x(Ge,"instance",null);let dt=Ge;function et(o){var e=Se.getSession(),t=e.getLength(),n=new Date().toLocaleTimeString(),s=`[${n}] ${o}
`;e.insert({row:t,column:0},s)}function vn(o){return new Promise(e=>{let t=0;function n(){o()?e(!0):t>=10?e(!1):(t++,setTimeout(n,100))}n()})}function mo(o,e=50,t=100){return new Promise(n=>{let s=0;function c(){o()?n(!0):s>=e?n(!1):(s++,setTimeout(c,t))}c()})}const po=[{command:"?",description:"Get position and version info"},{command:"#",description:"Display tool offsets"},{command:"!",description:"Stop running Gcode"},{command:"~",description:"Continue running Gcode"},{command:"M17 Y",description:"Enable Y axis"},{command:"M18 Y",description:"Disable Y axis"},{command:"G90",description:"Set to absolute positioning"},{command:"G91",description:"Set to relative positioning"}];class ho{constructor(){x(this,"sendButton");x(this,"sendSingleCommandButton");x(this,"stopButton");x(this,"senderError");x(this,"runProgress");x(this,"runProgressLabel");x(this,"connectButton");x(this,"gcodeResponseContainer");x(this,"jogButtons");x(this,"toolButtons");x(this,"sender");x(this,"singleCommandSender");x(this,"minimumVersion");x(this,"editTools");x(this,"editToolsModal");x(this,"editToolsClose");x(this,"editToolSaveAll");x(this,"fastFeedrateInput");x(this,"slowFeedrateInput");x(this,"moveDistanceInput");const e=document.getElementById("singleCommandSender");e.placeholder="Type or select G-code command...",e.addEventListener("click",()=>{let l=document.getElementById("gcode-dropdown");if(!l){l=document.createElement("div"),l.id="gcode-dropdown",l.className="gcode-dropdown",po.forEach(({command:b,description:f})=>{const y=document.createElement("div");y.textContent=`${b} - ${f}`,y.className="gcode-option",y.addEventListener("click",()=>{e.value=b,l.remove()}),l.appendChild(y)});const v=e.getBoundingClientRect();l.style.left=v.left+"px",l.style.top=v.bottom+2+"px",l.style.width=v.width+"px",document.body.appendChild(l)}}),document.addEventListener("click",l=>{const v=document.getElementById("gcode-dropdown");v&&!e.contains(l.target)&&!v.contains(l.target)&&v.remove()}),this.minimumVersion="H4V12FJ",this.senderError=document.querySelector(".senderError"),this.runProgress=document.getElementById("senderProgress"),this.runProgressLabel=document.getElementById("senderProgressLabel"),this.connectButton=document.getElementById("connectButton"),this.gcodeResponseContainer=document.getElementById("gcodeResponseContainer"),this.moveDistanceInput=document.getElementById("moveDistance"),this.fastFeedrateInput=document.getElementById("fastFeedrate"),this.slowFeedrateInput=document.getElementById("slowFeedrate"),this.jogButtons=document.querySelectorAll("#latheControls .jog-btn"),this.toolButtons=document.querySelectorAll("#latheControls .tool-btn"),this.sendButton=document.getElementById("gcodeSenderButton"),this.sendSingleCommandButton=document.getElementById("gcodeSendSingleCommandButton"),this.singleCommandSender=document.getElementById("singleCommandSender"),this.sender=dt.getInstance(),this.sender.addStatusChangeListener(()=>this.handleStatusChange(),M.GCODE);let t=localStorage.getItem("fastFeedrate"),n=localStorage.getItem("slowFeedrate"),s=localStorage.getItem("moveDistance");t&&(this.fastFeedrateInput.value=t,localStorage.setItem("fastFeedrate",t)),n&&(this.slowFeedrateInput.value=n,localStorage.setItem("slowFeedrate",n)),s&&(this.moveDistanceInput.value=s,localStorage.setItem("moveDistance",s)),this.fastFeedrateInput.addEventListener("change",()=>{localStorage.setItem("fastFeedrate",this.fastFeedrateInput.value)}),this.slowFeedrateInput.addEventListener("change",()=>{localStorage.setItem("slowFeedrate",this.slowFeedrateInput.value)}),this.moveDistanceInput.addEventListener("change",()=>{localStorage.setItem("moveDistance",this.moveDistanceInput.value)}),this.jogButtons.forEach(l=>{l.addEventListener("click",()=>{var w;if(!((w=this.sender)!=null&&w.isConnected())){alert("Please connect to the controller first.");return}let v="",b="",f="",y=!0;l.id=="fastForward"?(v=this.fastFeedrateInput.value,b="X",f=this.moveDistanceInput.value,y=!0):l.id=="slowForward"?(v=this.slowFeedrateInput.value,b="X",f=this.moveDistanceInput.value,y=!0):l.id=="fastBackward"?(v=this.fastFeedrateInput.value,b="X",f=this.moveDistanceInput.value,y=!1):l.id=="slowBackward"?(v=this.slowFeedrateInput.value,b="X",f=this.moveDistanceInput.value,y=!1):l.id=="fastLeft"?(v=this.fastFeedrateInput.value,b="Z",f=this.moveDistanceInput.value,y=!0):l.id=="slowLeft"?(v=this.slowFeedrateInput.value,b="Z",f=this.moveDistanceInput.value,y=!0):l.id=="fastRight"?(v=this.fastFeedrateInput.value,b="Z",f=this.moveDistanceInput.value,y=!1):l.id=="slowRight"?(v=this.slowFeedrateInput.value,b="Z",f=this.moveDistanceInput.value,y=!1):l.id=="fastUp"?(v=this.fastFeedrateInput.value,b="Y",f=this.moveDistanceInput.value,y=!0):l.id=="slowUp"?(v=this.slowFeedrateInput.value,b="Y",f=this.moveDistanceInput.value,y=!0):l.id=="fastDown"?(v=this.fastFeedrateInput.value,b="Y",f=this.moveDistanceInput.value,y=!1):l.id=="slowDown"&&(v=this.slowFeedrateInput.value,b="Y",f=this.moveDistanceInput.value,y=!1);let L=`G0 ${b}${y===!0?"":"-"}${f} F${v}`;if(this.sender){let k=new Array(3);k[0]="G91",k[1]=L,k[2]="G90",this.sender.sendCommands(k,M.GCODE)}})});const c=document.getElementById("toolChange"),d=document.getElementById("toolSelector");c.addEventListener("click",()=>{var v;if(!((v=this.sender)!=null&&v.isConnected())){alert("Please connect to the controller first.");return}if(this.sender.getStatus().version!=this.minimumVersion){alert(`This feature is only available on firmware version ${this.minimumVersion} or later. Please see help tab for more information.`);return}let l=new Array(1);l[0]=d.value,this.sender&&this.sender.sendCommands(l,M.GCODE)}),this.editTools=document.getElementById("editToolsButton"),this.editToolsModal=document.getElementById("editToolsModal"),this.editToolsClose=document.getElementById("editToolsModalCloseButton"),this.editToolSaveAll=document.getElementById("editToolSaveAll"),this.editTools.addEventListener("click",async()=>{var l;if(!((l=this.sender)!=null&&l.isConnected())){alert("Please connect to the controller first.");return}if(this.editToolsModal.style.display="block",this.sender){const v=document.getElementById("toolOffsetTableBody");v&&(v.innerHTML="");const b=await this.sender.getToolOffsets(M.GCODE);B(b).forEach(y=>{y.tool!=0&&this.addToolRow(y.tool,y.z,y.x,y.w,y.u)}),console.log("Tool Offsets As Response: "+b)}}),this.editToolSaveAll.addEventListener("click",()=>{var f;if(!((f=this.sender)!=null&&f.isConnected())){alert("Please connect to the controller first.");return}const l=document.getElementById("toolOffsetTableBody");if(!l)return;const v=l.children,b=new Array(v.length);for(let y=0;y<v.length;y++){const I=v[y],L=parseInt(I.children[0].children[0].value.replace("T","")),w=parseFloat(I.children[1].children[0].value),k=parseFloat(I.children[2].children[0].value),S=parseFloat(I.children[3].children[0].value),R=parseFloat(I.children[4].children[0].value);b[y]=`G10 P${L} Z${w} X${S} W${k} U${R}`}this.sender&&this.sender.sendCommands(b,M.GCODE)});const B=l=>l.replace("toolOffsets:","").replace("ok","").split("|").map(f=>{const y=f.match(/T(\d+)/),I=y?parseInt(y[1]):0,L=f.match(/Z=(-?\d+\.?\d*)/),w=f.match(/X=(-?\d+\.?\d*)/),k=f.match(/W=(-?\d+\.?\d*)/),S=f.match(/U=(-?\d+\.?\d*)/);return{tool:I,z:L?parseFloat(L[1]):0,x:w?parseFloat(w[1]):0,w:k?parseFloat(k[1]):0,u:S?parseFloat(S[1]):0}}).filter(f=>!isNaN(f.tool));this.editToolsClose.addEventListener("click",()=>{this.editToolsModal.style.display="none"}),this.connectButton.addEventListener("click",()=>{var l;this.gcodeResponseContainer.style.display="block",!((l=this.sender)!=null&&l.isConnected())&&this.sender&&this.sender.connect()}),this.sendButton.addEventListener("click",()=>{var l;if(!((l=this.sender)!=null&&l.isConnected())){alert("Please connect to the controller first.");return}this.sender&&(this.sendButton.disabled=!0,this.sendSingleCommandButton.disabled=!0,this.jogButtons.forEach(v=>{v.disabled=!0}),this.toolButtons.forEach(v=>{v.disabled=!0}),this.sender.start(ee.getValue(),M.GCODE))}),this.sendSingleCommandButton.addEventListener("click",()=>{var l;if(!((l=this.sender)!=null&&l.isConnected())){alert("Please connect to the controller first.");return}this.sender&&(this.sendButton.disabled=!0,this.sendSingleCommandButton.disabled=!0,this.jogButtons.forEach(v=>{v.disabled=!0}),this.toolButtons.forEach(v=>{v.disabled=!0}),this.sender.sendCommand(this.singleCommandSender.value,M.GCODE))}),this.stopButton=document.getElementById("stopButton"),this.stopButton.addEventListener("click",()=>this.sender.stop()),this.stopButton.style.display="none"}addToolRow(e,t,n,s,c){const d=document.getElementById("toolOffsetTableBody");if(!d)return;const B=document.createElement("tr"),l=document.createElement("td");l.className="tool-cell";const v=document.createElement("input");v.type="text",v.value=`T${e}`,v.readOnly=!0,v.className="tool-input",l.appendChild(v);const b=document.createElement("td");b.className="data-cell";const f=document.createElement("input");f.type="number",f.value=t.toString(),f.step="0.001",f.className="input-cell",b.appendChild(f);const y=document.createElement("td");y.className="data-cell";const I=document.createElement("input");I.type="number",I.value=s.toString(),I.step="0.001",I.className="input-cell",y.appendChild(I);const L=document.createElement("td");L.className="data-cell";const w=document.createElement("input");w.type="number",w.value=n.toString(),w.step="0.001",w.className="input-cell",L.appendChild(w);const k=document.createElement("td");k.className="data-cell";const S=document.createElement("input");S.type="number",S.value=c.toString(),S.step="0.001",S.className="input-cell",k.appendChild(S);const R=document.createElement("td");R.className="action-cell";const z=document.createElement("button");z.className="tool-save-button",z.title=`Save Tool T${e} Offsets`,z.innerHTML=`
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="24" height="24">
                <path d="M10 5 L40 5 L45 10 L45 40 L40 45 L10 45 L5 40 L5 10 Z" fill="none" stroke="white" stroke-width="2" />
                <rect x="15" y="5" width="20" height="15" fill="none" stroke="white" stroke-width="2" />
                <circle cx="25" cy="30" r="8" fill="none" stroke="white" stroke-width="2" />
            </svg>
        `,z.addEventListener("click",()=>{const a=w.value,u=f.value,m=I.value,r=S.value,i=`G10 P${e} Z${u} X${a} W${m} U${r}`;this.sender&&this.sender.sendCommand(i,M.GCODE)}),R.appendChild(z),B.append(l,b,y,L,k,R),d.appendChild(B)}handleStatusChange(){if(!this.sender)return;const e=this.sender.getStatus();if(e.isConnected===!1){this.connectButton.innerText="Connect",this.connectButton.disabled=!1,this.connectButton.style.backgroundColor="";return}else this.connectButton.innerText="Connected",this.connectButton.disabled=!0,this.connectButton.style.backgroundColor="green";const t=e.condition==="run";this.runProgress&&(this.runProgress.value=e.progress,this.runProgress.style.display=t?"block":"none",this.runProgressLabel.style.display=t?"block":"none",t?t&&(this.sendButton.style.display="none"):(this.sendButton.disabled=!1,this.sendButton.style.display="inline-block",this.sendSingleCommandButton.disabled=!1,this.jogButtons.forEach(s=>{s.disabled=!1}),this.toolButtons.forEach(s=>{s.disabled=!1}))),this.stopButton&&(this.stopButton.style.display=t?"inline-block":"none");const n=this.sender.getDisconnectingStatus();this.senderError&&!n&&(e.error?(this.senderError.style.display="block",this.senderError.innerText=e.error,this.showError(),this.appendLineToResponseEditor(e.error)):(this.hideError(),this.senderError.innerText=""))}appendLineToResponseEditor(e){var t=Se.getSession(),n=t.getLength(),s=new Date().toLocaleTimeString(),c=`[${s}] ${e}
`;t.insert({row:n,column:0},c)}showError(){this.senderError.style.display="block"}hideError(){this.senderError.style.display="none"}}const go=`; This example shows a boring operation, then an internal grooving operation

G21 ; metric
G18 ; ZX plane
G90 ; absolute positioning
F200
X0 ; zero your tool X on centerline
Z0 ; zero your tool Z at the right edge of the stock
G91 ; relative positioning

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;1mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;2mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;3mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;4mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;5mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;6mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;7mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;8mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;9mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;10mm

Z-10

Z3.25 ; cut
X-5 ; cut

X-1.7 ; cut

X6.7 ; retract
Z-3.25 ; retract
`;function fo(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var vo=function(e,t){return Array.prototype.slice.call(e,t)},ko=typeof setImmediate=="function",sn;ko?sn=function(o){setImmediate(o)}:sn=function(o){setTimeout(o,0)};var yo=sn,bo=yo,To=function(e,t,n){e&&bo(function(){e.apply(n||null,t||[])})},kn=vo,Eo=To,Bo=function(e,t){var n=t||{},s={};return e===void 0&&(e={}),e.on=function(c,d){return s[c]?s[c].push(d):s[c]=[d],e},e.once=function(c,d){return d._once=!0,e.on(c,d),e},e.off=function(c,d){var B=arguments.length;if(B===1)delete s[c];else if(B===0)s={};else{var l=s[c];if(!l)return e;l.splice(l.indexOf(d),1)}return e},e.emit=function(){var c=kn(arguments);return e.emitterSnapshot(c.shift()).apply(this,c)},e.emitterSnapshot=function(c){var d=(s[c]||[]).slice(0);return function(){var B=kn(arguments),l=this||e;if(c==="error"&&n.throws!==!1&&!d.length)throw B.length===1?B[0]:B;return d.forEach(function(b){n.async?Eo(b,B,l):b.apply(l,B),b._once&&e.off(c,b)}),e}},e},zn=window.CustomEvent;function Co(){try{var o=new zn("cat",{detail:{foo:"bar"}});return o.type==="cat"&&o.detail.foo==="bar"}catch{}return!1}var Io=Co()?zn:typeof document<"u"&&typeof document.createEvent=="function"?function(e,t){var n=document.createEvent("CustomEvent");return t?n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail):n.initCustomEvent(e,!1,!1,void 0),n}:function(e,t){var n=document.createEventObject();return n.type=e,t?(n.bubbles=!!t.bubbles,n.cancelable=!!t.cancelable,n.detail=t.detail):(n.bubbles=!1,n.cancelable=!1,n.detail=void 0),n},Hn=[],_t="",So=/^on/;for(_t in window)So.test(_t)&&Hn.push(_t.slice(2));var xo=Hn,wo=Io,Fo=xo,Tt=window.document,Un=Lo,Kn=Do,mt=[];window.addEventListener||(Un=No,Kn=Oo);var Po={add:Un,remove:Kn,fabricate:Xo};function Lo(o,e,t,n){return o.addEventListener(e,t,n)}function No(o,e,t){return o.attachEvent("on"+e,$o(o,e,t))}function Do(o,e,t,n){return o.removeEventListener(e,t,n)}function Oo(o,e,t){var n=Vn(o,e,t);if(n)return o.detachEvent("on"+e,n)}function Xo(o,e,t){var n=Fo.indexOf(e)===-1?c():s();o.dispatchEvent?o.dispatchEvent(n):o.fireEvent("on"+e,n);function s(){var d;return Tt.createEvent?(d=Tt.createEvent("Event"),d.initEvent(e,!0,!0)):Tt.createEventObject&&(d=Tt.createEventObject()),d}function c(){return new wo(e,{detail:t})}}function Mo(o,e,t){return function(s){var c=s||window.event;c.target=c.target||c.srcElement,c.preventDefault=c.preventDefault||function(){c.returnValue=!1},c.stopPropagation=c.stopPropagation||function(){c.cancelBubble=!0},c.which=c.which||c.keyCode,t.call(o,c)}}function $o(o,e,t){var n=Vn(o,e,t)||Mo(o,e,t);return mt.push({wrapper:n,element:o,type:e,fn:t}),n}function Vn(o,e,t){var n=qo(o,e,t);if(n){var s=mt[n].wrapper;return mt.splice(n,1),s}}function qo(o,e,t){var n,s;for(n=0;n<mt.length;n++)if(s=mt[n],s.element===o&&s.type===e&&s.fn===t)return n}var yn={},jo="(?:^|\\s)",Ro="(?:\\s|$)";function Wn(o){var e=yn[o];return e?e.lastIndex=0:yn[o]=e=new RegExp(jo+o+Ro,"g"),e}function Zo(o,e){var t=o.className;t.length?Wn(e).test(t)||(o.className+=" "+e):o.className=e}function Go(o,e){o.className=o.className.replace(Wn(e)," ").trim()}var Ao={add:Zo,rm:Go},_o=Bo,Ue=Po,xe=Ao,We=document,ve=We.documentElement;function Jo(o,e){var t=arguments.length;t===1&&Array.isArray(o)===!1&&(e=o,o=[]);var n,s,c,d,B,l,v,b,f,y,I,L=null,w,k=e||{};k.moves===void 0&&(k.moves=Bn),k.accepts===void 0&&(k.accepts=Bn),k.invalid===void 0&&(k.invalid=$),k.containers===void 0&&(k.containers=o||[]),k.isContainer===void 0&&(k.isContainer=Ho),k.copy===void 0&&(k.copy=!1),k.copySortSource===void 0&&(k.copySortSource=!1),k.revertOnSpill===void 0&&(k.revertOnSpill=!1),k.removeOnSpill===void 0&&(k.removeOnSpill=!1),k.direction===void 0&&(k.direction="vertical"),k.ignoreInputTextSelection===void 0&&(k.ignoreInputTextSelection=!0),k.mirrorContainer===void 0&&(k.mirrorContainer=We.body);var S=_o({containers:k.containers,start:F,end:G,cancel:V,remove:he,destroy:m,canMove:T,dragging:!1});return k.removeOnSpill===!0&&S.on("over",Ne).on("out",kt),z(),S;function R(g){return S.containers.indexOf(g)!==-1||k.isContainer(g)}function z(g){var P=g?"remove":"add";tt(ve,P,"mousedown",i),tt(ve,P,"mouseup",_)}function a(g){var P=g?"remove":"add";tt(ve,P,"mousemove",h)}function u(g){var P=g?"remove":"add";Ue[P](ve,"selectstart",r),Ue[P](ve,"click",r)}function m(){z(!0),_({})}function r(g){w&&g.preventDefault()}function i(g){l=g.clientX,v=g.clientY;var P=bn(g)!==1||g.metaKey||g.ctrlKey;if(!P){var O=g.target,q=p(O);q&&(w=q,a(),g.type==="mousedown"&&(Sn(O)?O.focus():g.preventDefault()))}}function h(g){if(w){if(bn(g)===0){_({});return}if(!(g.clientX!==void 0&&Math.abs(g.clientX-l)<=(k.slideFactorX||0)&&g.clientY!==void 0&&Math.abs(g.clientY-v)<=(k.slideFactorY||0))){if(k.ignoreInputTextSelection){var P=we("clientX",g)||0,O=we("clientY",g)||0,q=We.elementFromPoint(P,O);if(Sn(q))return}var Y=w;a(!0),u(),G(),D(Y);var A=zo(c);d=we("pageX",g)-A.left,B=we("pageY",g)-A.top,xe.add(y||c,"gu-transit"),Zt(),ge(g)}}}function p(g){if(!(S.dragging&&n)&&!R(g)){for(var P=g;re(g)&&R(re(g))===!1;)if(k.invalid(g,P)||(g=re(g),!g))return;var O=re(g);if(O&&!k.invalid(g,P)){var q=k.moves(g,O,P,nt(g));if(q)return{item:g,source:O}}}}function T(g){return!!p(g)}function F(g){var P=p(g);P&&D(P)}function D(g){Gt(g.item,g.source)&&(y=g.item.cloneNode(!0),S.emit("cloned",y,g.item,"copy")),s=g.source,c=g.item,b=f=nt(g.item),S.dragging=!0,S.emit("drag",c,s)}function $(){return!1}function G(){if(S.dragging){var g=y||c;le(g,re(g))}}function j(){w=!1,a(!0),u(!0)}function _(g){if(j(),!!S.dragging){var P=y||c,O=we("clientX",g)||0,q=we("clientY",g)||0,Y=En(n,O,q),A=ce(Y,O,q);A&&(y&&k.copySortSource||!y||A!==s)?le(P,A):k.removeOnSpill?he():V()}}function le(g,P){var O=re(g);y&&k.copySortSource&&P===s&&O.removeChild(c),de(P)?S.emit("cancel",g,s,s):S.emit("drop",g,P,s,f),W()}function he(){if(S.dragging){var g=y||c,P=re(g);P&&P.removeChild(g),S.emit(y?"cancel":"remove",g,P,s),W()}}function V(g){if(S.dragging){var P=arguments.length>0?g:k.revertOnSpill,O=y||c,q=re(O),Y=de(q);Y===!1&&P&&(y?q&&q.removeChild(y):s.insertBefore(O,b)),Y||P?S.emit("cancel",O,s,s):S.emit("drop",O,q,s,f),W()}}function W(){var g=y||c;j(),Qe(),g&&xe.rm(g,"gu-transit"),I&&clearTimeout(I),S.dragging=!1,L&&S.emit("out",g,L,s),S.emit("dragend",g),s=c=y=b=f=I=L=null}function de(g,P){var O;return P!==void 0?O=P:n?O=f:O=nt(y||c),g===s&&O===b}function ce(g,P,O){for(var q=g;q&&!Y();)q=re(q);return q;function Y(){var A=R(q);if(A===!1)return!1;var ke=yt(q,g),U=bt(q,ke,P,O),E=de(q,U);return E?!0:k.accepts(c,q,s,U)}}function ge(g){if(!n)return;g.preventDefault();var P=we("clientX",g)||0,O=we("clientY",g)||0,q=P-d,Y=O-B;n.style.left=q+"px",n.style.top=Y+"px";var A=y||c,ke=En(n,P,O),U=ce(ke,P,O),E=U!==null&&U!==L;(E||U===null)&&(io(),L=U,At());var N=re(A);if(U===s&&y&&!k.copySortSource){N&&N.removeChild(A);return}var X,Z=yt(U,ke);if(Z!==null)X=bt(U,Z,P,O);else if(k.revertOnSpill===!0&&!y)X=b,U=s;else{y&&N&&N.removeChild(A);return}(X===null&&E||X!==A&&X!==nt(A))&&(f=X,U.insertBefore(A,X),S.emit("shadow",A,U,s));function te(ro){S.emit(ro,A,L,s)}function At(){E&&te("over")}function io(){L&&te("out")}}function Ne(g){xe.rm(g,"gu-hide")}function kt(g){S.dragging&&xe.add(g,"gu-hide")}function Zt(){if(!n){var g=c.getBoundingClientRect();n=c.cloneNode(!0),n.style.width=Cn(g)+"px",n.style.height=In(g)+"px",xe.rm(n,"gu-transit"),xe.add(n,"gu-mirror"),k.mirrorContainer.appendChild(n),tt(ve,"add","mousemove",ge),xe.add(k.mirrorContainer,"gu-unselectable"),S.emit("cloned",n,c,"mirror")}}function Qe(){n&&(xe.rm(k.mirrorContainer,"gu-unselectable"),tt(ve,"remove","mousemove",ge),re(n).removeChild(n),n=null)}function yt(g,P){for(var O=P;O!==g&&re(O)!==g;)O=re(O);return O===ve?null:O}function bt(g,P,O,q){var Y=k.direction==="horizontal",A=P!==g?U():ke();return A;function ke(){var N=g.children.length,X,Z,te;for(X=0;X<N;X++)if(Z=g.children[X],te=Z.getBoundingClientRect(),Y&&te.left+te.width/2>O||!Y&&te.top+te.height/2>q)return Z;return null}function U(){var N=P.getBoundingClientRect();return E(Y?O>N.left+Cn(N)/2:q>N.top+In(N)/2)}function E(N){return N?nt(P):P}}function Gt(g,P){return typeof k.copy=="boolean"?k.copy:k.copy(g,P)}}function tt(o,e,t,n){var s={mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"},c={mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"},d={mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"};window.navigator.pointerEnabled?Ue[e](o,c[t],n):window.navigator.msPointerEnabled?Ue[e](o,d[t],n):(Ue[e](o,s[t],n),Ue[e](o,t,n))}function bn(o){if(o.touches!==void 0)return o.touches.length;if(o.which!==void 0&&o.which!==0)return o.which;if(o.buttons!==void 0)return o.buttons;var e=o.button;if(e!==void 0)return e&1?1:e&2?3:e&4?2:0}function zo(o){var e=o.getBoundingClientRect();return{left:e.left+Tn("scrollLeft","pageXOffset"),top:e.top+Tn("scrollTop","pageYOffset")}}function Tn(o,e){return typeof window[e]<"u"?window[e]:ve.clientHeight?ve[o]:We.body[o]}function En(o,e,t){o=o||{};var n=o.className||"",s;return o.className+=" gu-hide",s=We.elementFromPoint(e,t),o.className=n,s}function Ho(){return!1}function Bn(){return!0}function Cn(o){return o.width||o.right-o.left}function In(o){return o.height||o.bottom-o.top}function re(o){return o.parentNode===We?null:o.parentNode}function Sn(o){return o.tagName==="INPUT"||o.tagName==="TEXTAREA"||o.tagName==="SELECT"||Yn(o)}function Yn(o){return!o||o.contentEditable==="false"?!1:o.contentEditable==="true"?!0:Yn(re(o))}function nt(o){return o.nextElementSibling||e();function e(){var t=o;do t=t.nextSibling;while(t&&t.nodeType!==1);return t}}function Uo(o){return o.targetTouches&&o.targetTouches.length?o.targetTouches[0]:o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:o}function we(o,e){var t=Uo(e),n={pageX:"clientX",pageY:"clientY"};return o in n&&!(o in t)&&n[o]in t&&(o=n[o]),t[o]}var Ko=Jo;const xn=fo(Ko);class Qn{static getButtonName(e){const t=this.buttons.find(n=>n.id===e);return t?t.name:""}static createKeyPressEvent(e,t){const n=this.buttons.find(c=>c.id===e);if(!n)throw new Error(`No button found with id: ${e}`);let s=n.number;return s&=127,t&&(s|=128),s}}x(Qn,"buttons",[{name:"arrow_left_alt",id:"B_LEFT",number:57},{name:"arrow_right_alt",id:"B_RIGHT",number:37},{name:"arrow_upward_alt",id:"B_UP",number:47},{name:"arrow_downward_alt",id:"B_DOWN",number:67},{name:"+",id:"B_MINUS",number:5},{name:"-",id:"B_PLUS",number:64},{name:"play_arrow",id:"B_ON",number:17},{name:"crop_square",id:"B_OFF",number:27},{name:"keyboard_tab_rtl",id:"B_STOPL",number:7},{name:"keyboard_tab",id:"B_STOPR",number:15},{name:"vertical_align_top",id:"B_STOPU",number:6},{name:"vertical_align_bottom",id:"B_STOPD",number:16},{name:"rotate_left",id:"B_DISPL",number:14},{name:"signal_cellular_alt",id:"B_STEP",number:24},{name:"settings",id:"B_SETTINGS",number:34},{name:"space_bar",id:"B_MEASURE",number:54},{name:"sync_alt",id:"B_REVERSE",number:44},{name:"1",id:"B_0",number:51},{name:"2",id:"B_1",number:41},{name:"3",id:"B_2",number:61},{name:"4",id:"B_3",number:31},{name:"5",id:"B_4",number:2},{name:"6",id:"B_5",number:21},{name:"7",id:"B_6",number:12},{name:"8",id:"B_7",number:11},{name:"9",id:"B_8",number:22},{name:"10",id:"B_9",number:1},{name:"backspace",id:"B_BACKSPACE",number:32},{name:"manufacturing",id:"B_MODE_GEARS",number:42},{name:"reply",id:"B_MODE_TURN",number:52},{name:"turn_slight_left",id:"B_MODE_FACE",number:62},{name:"arrow_forward_ios",id:"B_MODE_CONE",number:3},{name:"publish",id:"B_MODE_CUT",number:13},{name:"home_improvement_and_tools",id:"B_MODE_THREAD",number:23},{name:"M",id:"B_MODE_OTHER",number:33},{name:"X",id:"B_X",number:53},{name:"Z",id:"B_Z",number:43},{name:"A",id:"B_A",number:4},{name:"B",id:"B_B",number:63}]);let Vo=(o=21)=>crypto.getRandomValues(new Uint8Array(o)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");const ye=document.getElementById("availableTasks"),ne=document.getElementById("tasksToExecute"),Jt=document.getElementById("deleteTasks"),Wo=document.getElementById("addNewTaskButton"),De=document.getElementById("newTaskModal"),Yo=document.getElementById("closeNewTaskModal"),be=document.getElementById("newTaskType"),Je=document.getElementById("gcodeTaskContainer"),ue=document.getElementById("newTaskGcode"),ze=document.getElementById("emulationOuterContainer"),Qo=document.getElementById("saveNewTaskButton"),wn=document.getElementById("newTaskGcodeRepeatable"),ot=document.getElementById("newTaskName"),Fn=document.getElementById("taskTextTitle"),zt=document.getElementById("newTaskDescription");let oe;const He=document.getElementById("connectButton"),es=document.getElementById("plannerContainer");let Pn=null;const ts=document.getElementById("saveAvailableTaskCollection"),ns=document.getElementById("saveAvailableTaskCollectionButtonModal"),os=document.getElementById("loadTaskCollection"),Te=document.getElementById("availableTaskCollections"),me=document.getElementById("collectionToSaveTo"),Ln=document.getElementById("newCollectionNameContainer"),Ht=document.getElementById("newCollectionName"),ss=document.getElementById("deleteTaskCollection"),Ut=document.getElementById("saveCollectionModal"),Fe=document.getElementById("saveCollectionModalToSaveTo"),as=document.getElementById("saveCollectionModalClose"),is=document.getElementById("newCollectionNameModal"),Nn=document.getElementById("newCollectionNameContainerModal"),rs=document.getElementById("importAvailableTasks"),ls=document.getElementById("exportAvailableTasks"),Kt=document.getElementById("saveJobModal"),cs=document.getElementById("saveJobModalClose"),us=document.getElementById("executeJobButton"),ds=document.getElementById("saveJobButton"),ms=document.getElementById("newJobButton"),Et=document.getElementById("saveJobNameInput"),se=document.getElementById("saveJobNameSelect"),Oe=document.getElementById("newJobNameContainer"),ae=document.getElementById("saveProjectNameSelect"),st=document.getElementById("saveProjectNameInput"),Bt=document.getElementById("newProjectNameContainer"),Ct=document.getElementById("saveJobGroupNameInput"),ie=document.getElementById("saveJobGroupNameSelect"),Pe=document.getElementById("newJobGroupNameContainer"),ps=document.getElementById("saveJobSaveButton"),at=document.getElementById("jobLoadSelect"),H=document.getElementById("projectLoadSelect"),Ee=document.getElementById("groupLoadSelect"),hs=document.getElementById("loadJobButton"),gs=document.getElementById("deleteJobButton"),fs=document.getElementById("importJobButton"),vs=document.getElementById("exportJobButton"),Vt=document.getElementById("exportJobModal"),ks=document.getElementById("exportJobModalClose"),ys=document.getElementById("exportJobSaveButton"),Le=document.getElementById("exportJobProjectNameSelect"),Be=document.getElementById("exportJobGroupNameSelect"),Xe=document.getElementById("exportJobNameSelect"),Me=[],Wt=document.getElementById("manualTaskModal"),It=document.getElementById("cncTaskModal"),bs=document.getElementById("cancelManualTask"),St=document.getElementById("completeManualTask"),Ts=document.getElementById("manualTaskInstructions"),Dn=document.getElementById("cncTaskGcode"),Es=document.getElementById("cancelCncTask"),Q=document.getElementById("executeGcode"),pe=document.getElementById("completeCncTask"),Bs=document.getElementById("manualTaskName"),Cs=document.getElementById("cncTaskName"),xt=document.getElementById("cncTaskSenderProgressLabel"),Yt=document.getElementById("cncTaskSenderProgress"),Qt=document.getElementById("jobCancelledModal"),Is=document.getElementById("jobCancelledCloseButton"),On=document.getElementById("completeTaskModal"),Ss=document.getElementById("completeTaskCloseButton"),Xn=document.getElementById("notConnectedModal"),xs=document.getElementById("notConnectedCloseButton"),ws=document.getElementById("currentGcodeLineContainer"),Fs=document.getElementById("currentGcodeLine"),Ps=document.getElementById("currentFeedrateContainer"),Ls=document.getElementById("currentFeedrate"),Ns=document.getElementById("emulationInnerContainer"),Ce=document.getElementById("emulationNewTasks"),en=document.getElementById("emulatedButtonListDelete"),Ds=document.getElementById("emulationTaskModal");document.addEventListener("DOMContentLoaded",()=>{oe=dt.getInstance(),oe.addStatusChangeListener(()=>d(),M.PLANNER),oe.addCurrentCommandListener(c),es.addEventListener("containerVisible",()=>{ne.innerHTML="",s(),y(),f(),z(),e(),n();const a=t();b(a),I()}),Fe.addEventListener("change",()=>{Fe.value==="new"?Nn.style.display="block":Nn.style.display="none"}),me.addEventListener("change",()=>{me.value==="new"?Ln.style.display="block":Ln.style.display="none"}),se.addEventListener("change",()=>{se.value==="new"?Oe.style.display="block":Oe.style.display="none"}),ie.addEventListener("change",()=>{ie.value==="new"?Pe.style.display="block":Pe.style.display="none"}),ae.addEventListener("change",()=>{ae.value==="new"?st.style.display="block":st.style.display="none"}),as.onclick=function(){Ut.style.display="none"},ts.onclick=function(){Ut.style.display="block"},ns.onclick=function(){let a="";if(Fe.value==="new"){if(a=is.value,a===null||a===""){alert("Please enter a name for the collection");return}}else a=Fe.value;const u=localStorage.getItem("selectedTaskCollection");let m;if(u){const i=localStorage.getItem(`taskCollection_${u}`);i&&(m=JSON.parse(i),a!==u&&(m.name=a,localStorage.setItem(`taskCollection_${a}`,JSON.stringify(m))))}const r=document.createElement("option");r.value=a,r.textContent=a,Te.appendChild(r),Ut.style.display="none",alert(`Collection ${a} saved`),s()},os.onclick=function(){const a=Te.value;localStorage.setItem("selectedTaskCollection",a),y()},ss.onclick=function(){const a=Te.value;if(a==="default"){alert("You cannot delete the default collection");return}confirm(`Are you sure you want to delete the collection ${a}?`)&&(localStorage.removeItem(`taskCollection_${a}`),s(),y())},rs.onclick=function(){const a=document.createElement("input");a.type="file",a.accept=".json",a.multiple=!0,a.onchange=async function(u){const m=u.target.files;if(m)for(let r=0;r<m.length;r++){const i=m[r],h=new FileReader;h.onload=function(p){var F;const T=(F=p.target)==null?void 0:F.result;T&&(JSON.parse(T).forEach($=>{const G=$.name;localStorage.getItem(`taskCollection_${G}`)?window.confirm(`Task collection ${G} already exists. Do you want to override it?`)&&localStorage.setItem(`taskCollection_${G}`,JSON.stringify($)):localStorage.setItem(`taskCollection_${G}`,JSON.stringify($))}),s())},h.readAsText(i)}},a.click()},ls.onclick=function(){const a=Object.keys(localStorage).filter(T=>T.includes("taskCollection_")),u=[];a.forEach(T=>{const F=localStorage.getItem(T);F&&u.push(JSON.parse(F))});const m=new Blob([JSON.stringify(u,null,2)],{type:"application/json"}),r=URL.createObjectURL(m),i=document.createElement("a");i.href=r;const p=new Date().toISOString().split("T")[0];i.download=`availableTasks_${p}.json`,i.click(),URL.revokeObjectURL(r)},Ns.addEventListener("click",function(a){const u=a.target;if(u.tagName==="BUTTON"){const m=u.id;o(m)}});function o(a){const u=document.getElementById(a),m=u==null?void 0:u.cloneNode(!0);m.classList.add("emulated-button-list"),m.removeAttribute("id");const r="emulated-"+Date.now();m.setAttribute("data-emulated-id",r),Ce==null||Ce.appendChild(m)}function e(){if(Ee.innerHTML="",!H||!H.value)return;const a=localStorage.getItem(`savedProject_${H.value}`);if(!a)return;const u=JSON.parse(a);u.groups.forEach(r=>{const i=document.createElement("option");i.value=r.name,i.textContent=r.name,Ee.appendChild(i)});const m=localStorage.getItem("selectedGroup");m&&u.groups.some(i=>i.name===m)&&(Ee.value=m)}function t(){const a=H.value,u=Ee.value,m=at.value;if(!a||!u||!m)return null;const r=localStorage.getItem(`savedProject_${a}`);if(!r)return null;const h=JSON.parse(r).groups.find(T=>T.name===u);if(!h)return null;const p=h.jobs.find(T=>T.name===m);return p?(p.groupName||(p.groupName=u),p):null}function n(){if(at.innerHTML="",!H||!H.value)return;const a=localStorage.getItem(`savedProject_${H.value}`);if(!a)return;const u=JSON.parse(a),m=Ee.value,r=u.groups.find(i=>i.name===m);r&&r.jobs.forEach(i=>{const h=document.createElement("option");h.value=i.name,h.textContent=i.name,at.appendChild(h)})}function s(){Te.innerHTML="",me.innerHTML="",Fe.innerHTML="";const a=document.createElement("option");a.value="default",a.textContent="default",Te.appendChild(a),me.appendChild(a.cloneNode(!0)),Fe.appendChild(a.cloneNode(!0)),Object.keys(localStorage).filter(i=>i.includes("taskCollection_")).sort().forEach(i=>{if(i==="taskCollection_default")return;const h=i.replace("taskCollection_",""),p=document.createElement("option");p.value=h,p.textContent=h,Te.appendChild(p),me.appendChild(p.cloneNode(!0)),Fe.appendChild(p.cloneNode(!0))});const m=localStorage.getItem("selectedTaskCollection");m&&(Te.value=m);const r=document.createElement("option");r.value="new",r.textContent="--new collection--",me.appendChild(r.cloneNode(!0)),Fe.appendChild(r.cloneNode(!0))}xs.onclick=function(){Xn.style.display="none"};function c(a){if(!oe)return;const m=oe.getStatus().condition==="run";if(m){if(m){const r=a.match(/F(\d+)/);r&&(Pn=parseInt(r[1],10),Ls.innerText=Pn.toString()),Fs.innerText=a,Ps.style.display="block",ws.style.display="block"}}}function d(){var m;if(!oe)return;const a=oe.getStatus();if(a.isConnected===!1){He.innerText="Connect",He.disabled=!1,He.style.backgroundColor="";return}else He.innerText="Connected",He.disabled=!0,He.style.backgroundColor="green";const u=a.condition==="run";u?u&&(Q.disabled=!0,Q.classList.add("disabled-button"),Q.classList.remove("interaction-ready-button"),pe.classList.remove("interaction-ready-button"),xt.innerText="Task in progress",pe.style.display="none"):(pe.style.display="block",pe.disabled=!1,pe.classList.add("interaction-ready-button"),xt.innerText="Task completed",((m=Q.attributes.getNamedItem("data-repeatable"))==null?void 0:m.value)==="true"?(Q.disabled=!1,Q.classList.remove("disabled-button"),Q.classList.add("interaction-ready-button"),Q.textContent="Execute Again?"):Q.disabled=!0),Yt.value=a.progress,Yt.style.display="block",xt.style.display="block"}xn([Ce,en],{copy:!1,accepts:(a,u)=>u===en||u===Ce,revertOnSpill:!0,removeOnSpill:!1}).on("drop",(a,u)=>{if(u===en){a.remove();const m=a.getAttribute("data-emulated-id"),r=Ce.querySelector(`[data-emulated-id="${m}"]`);r&&r.remove()}});const l=xn([ye,ne,Jt],{copy:(a,u)=>u===ye,accepts:(a,u)=>u===ne||u===Jt,revertOnSpill:!0,removeOnSpill:!1});l.on("dragend",()=>{I(),f(),v("currentJob")});function v(a,u="",m=""){const r=ne.querySelectorAll(".task-to-execute"),i={name:"",projectName:"",groupName:"",tasks:[]};if(r.forEach(h=>{const p=h.getAttribute("data-task-id"),T=h.getAttribute("data-collection-name");i.tasks.push({id:p,collectionName:T})}),i.name=a,i.groupName=u,a==="currentJob")localStorage.setItem(a,JSON.stringify(i));else if(m&&u){let h=localStorage.getItem(`savedProject_${m}`),p;h?p=JSON.parse(h):p={name:m,groups:[]};let T=p.groups.find(D=>D.name===u);T||(T={name:u,jobs:[]},p.groups.push(T));const F=T.jobs.findIndex(D=>D.name===a);F!==-1?T.jobs[F]={name:a,projectName:m,groupName:u,tasks:i.tasks}:T.jobs.push({name:a,projectName:m,groupName:u,tasks:i.tasks}),localStorage.setItem(`savedProject_${m}`,JSON.stringify(p))}}function b(a){let u=a.tasks;const m=[];u=u.filter(r=>localStorage.getItem(`taskCollection_${r.collectionName}`)?!0:(m.push(r),!1)),localStorage.setItem("currentJob",JSON.stringify(u)),ne.innerHTML="",u.forEach(r=>{const i=localStorage.getItem(`taskCollection_${r.collectionName}`);if(i){const p=JSON.parse(i).tasks.find(T=>T.id===r.id);if(p){const T=document.createElement("div");T.classList.add(`task-${p.type}`),T.classList.add("task-to-execute"),T.setAttribute("data-task-id",p.id),T.setAttribute("data-task-name",p.name),T.setAttribute("data-collection-name",r.collectionName),T.textContent=p.name,ne.appendChild(T)}}}),m.length>0&&alert(`The following tasks were removed because their collection does not exist: ${m.map(r=>r.id).join(", ")}`),localStorage.setItem("loadedJob",JSON.stringify({name:a.name,groupName:a.groupName}))}l.on("drop",(a,u,m)=>{const r=a.getAttribute("data-task-id"),i=a.getAttribute("data-task-order");if(u===ne)a.classList.remove("available-task"),a.classList.add("task-to-execute"),f();else if(u===Jt){a.remove();let h=null;if(m===ne)h=ne.querySelector(`[data-task-order="${i}"]`);else if(m===ye&&(h=ye.querySelector(`[data-task-id="${r}"]`),h)){const p=h.getAttribute("data-collection-name"),T=localStorage.getItem(`taskCollection_${p}`);if(T){const F=JSON.parse(T);F.tasks=F.tasks.filter(D=>D.id!==r),localStorage.setItem(`taskCollection_${p}`,JSON.stringify(F))}}h&&h.remove()}});function f(){ne.querySelectorAll(".task-to-execute").forEach(u=>{if(u.querySelector("i")){let m=u.querySelector("i");m&&(m.remove(),m=document.createElement("i"),u.classList.contains("task-manual")?(m.className="fas fa-users-cog icon-tooltip",m.setAttribute("data-tooltip","Manual Task")):u.classList.contains("task-gcode")?(m.className="fas fa-code icon-tooltip",m.setAttribute("data-tooltip","Gcode Task")):u.classList.contains("task-emulation")&&(m.className="far fa-keyboard icon-tooltip",m.setAttribute("data-tooltip","Emulation Task")),u.appendChild(m))}else{const m=document.createElement("i");u.classList.contains("task-manual")?(m.className="fas fa-users-cog icon-tooltip",m.setAttribute("data-tooltip","Manual Task")):u.classList.contains("task-gcode")?(m.className="fas fa-code icon-tooltip",m.setAttribute("data-tooltip","Gcode Task")):u.classList.contains("task-emulation")&&(m.className="far fa-keyboard icon-tooltip",m.setAttribute("data-tooltip","Emulation Task")),u.appendChild(m)}})}function y(){ye.innerHTML="";let a=localStorage.getItem("selectedTaskCollection");(a===null||a==="")&&(a=Te.value,localStorage.setItem("selectedTaskCollection",a));const u=localStorage.getItem(`taskCollection_${a}`);u&&JSON.parse(u).tasks.forEach(r=>{r.id,r.name,r.type,r.description,r.gcode&&r.gcode,r.buttonKeys&&r.buttonKeys;const i=document.createElement("div");i.classList.add(`task-${r.type}`),i.classList.add("available-task"),i.setAttribute("data-task-type",r.type),i.setAttribute("data-task-id",r.id.toString()),i.setAttribute("data-task-name",r.name),i.setAttribute("data-collection-name",a||""),i.textContent=r.name;const h=document.createElement("i");h.classList.add("fas","fa-info-circle","fa-fw","show-info","icon-tooltip"),h.setAttribute("data-tooltip","Click for more info..."),i.appendChild(h),ye.appendChild(i)})}function I(){const a=document.getElementById("tasksToExecute");a&&a.querySelectorAll("div").forEach((m,r)=>{const i=m.getAttribute("data-task-name");m.setAttribute("data-task-order",(r+1).toString()),m.textContent=`Task ${r+1}: ${i}`})}be.addEventListener("change",()=>{be.value==="manual"?(ue.disabled=!0,ue.placeholder="Disabled for manual tasks",ue.value="",Je.style.display="none",ze.style.display="none"):be.value==="emulation"?(ue.disabled=!0,ue.placeholder="Disabled for emulation tasks",ue.value="",Je.style.display="none",ze.style.display="block"):(ze.style.display="none",Je.style.display="block",ue.placeholder="Enter gcode here...",ue.disabled=!1)}),Wo.addEventListener("click",()=>{De.style.display="block",Fn.textContent="Add a new task",ot.value="",zt.value="",ue.value="",Ht.value="",De.removeAttribute("data-task-id"),me.value=""}),Qo.addEventListener("click",()=>{if(me.value===""){alert("Please select a collection.");return}if(me.value==="new"&&Ht.value===""){alert("Please enter a collection name");return}if(ot.value===""||ot.value===null){alert("Please enter a task name");return}const a=ot.value,u=document.createElement("div");u.classList.add(`task-${be.value}`),u.classList.add("available-task");let m;const r=De.getAttribute("data-task-id");r?m=r:m=Vo(),u.setAttribute("data-task-id",m.toString()),u.setAttribute("data-task-name",a),u.textContent=a;const i=document.createElement("i");i.classList.add("fas","fa-info-circle","fa-fw","show-info","icon-tooltip"),i.setAttribute("data-tooltip","Click for more info..."),u.appendChild(i);const h=ye.querySelector(`[data-task-id="${m}"]`);h&&h.remove(),ye.appendChild(u),De.style.display="none";let p="";be.value==="emulation"&&(Ce.querySelectorAll(".emulated-button-list").forEach(D=>{const $=D.getAttribute("data-button-key");p+=$+","}),p.length>0&&(p=p.slice(0,-1)));const T={id:m,name:a,type:be.value,description:zt.value};if(be.value==="gcode"&&(T.gcode=ue.value,T.isRepeatable=wn.checked),be.value==="emulation"&&(T.buttonKeys=p),me.value==="new"){const F=Ht.value,D={name:F,tasks:[]};D.tasks.push(T),localStorage.setItem(`taskCollection_${F}`,JSON.stringify(D));const $=document.createElement("option");$.value=F,$.textContent=F,Te.appendChild($),s()}else{const F=me.value,D=localStorage.getItem(`taskCollection_${F}`);if(D){const $=JSON.parse(D);$.tasks.find(j=>j.id===m)&&($.tasks=$.tasks.filter(j=>j.id!==m)),$.tasks.push(T),localStorage.setItem(`taskCollection_${F}`,JSON.stringify($))}else{const $={name:F,tasks:[]};$.tasks.push(T),localStorage.setItem(`taskCollection_${F}`,JSON.stringify($))}}y()}),ye.addEventListener("click",a=>{const u=a.target;if(u.matches(".show-info")){const r=u.parentNode.getAttribute("data-task-id");let i=null;const h=localStorage.getItem("selectedTaskCollection"),p=localStorage.getItem(`taskCollection_${h}`);if(p){const F=JSON.parse(p).tasks.find(D=>D.id===r);F&&(i=F)}i&&(De.style.display="block",ot.value=i.name,be.value=i.type,zt.value=i.description,ue.value=i.gcode||"",wn.checked=i.isRepeatable||!1,me.value=h||"default",Fn.textContent="Edit Task",i.type==="emulation"?(ze.style.display="block",Je.style.display="none",Ce.innerHTML="",(i.buttonKeys??"").split(",").forEach(F=>{const D=document.createElement("button");D.classList.add("emulated-button-list"),D.classList.add("material-symbols-outlined"),D.setAttribute("data-button-key",F),D.textContent=Qn.getButtonName(F),D.textContent.length===1&&D.classList.add("standard-font"),Ce.appendChild(D)})):i.type==="gcode"?(ze.style.display="none",Je.style.display="block",ue.disabled=!1,ue.placeholder="Enter gcode here..."):(ze.style.display="none",Je.style.display="none"),r&&De.setAttribute("data-task-id",r.toString()))}}),Yo.onclick=function(){De.style.display="none"},Ss.onclick=function(){On.style.display="none"};function L(){if(Me.length===0){On.style.display="block";return}const a=Me.shift();if(a&&a.type==="manual")Bs.textContent=`Task ${a.order}: ${a.name}`,Ts.value=a.description,Wt.style.display="block",Me.length===0?St.innerText="Complete Job":St.innerText="Next Task -->";else if(a&&a.type==="gcode"){Q.disabled=!1,Q.classList.remove("disabled-button"),Q.classList.add("interaction-ready-button"),Q.textContent="Execute Gcode",a.isRepeatable?Q.setAttribute("data-repeatable","true"):Q.removeAttribute("data-repeatable"),Cs.textContent=`Task ${a.order}: ${a.name}`,Dn.value=a.gcode??"",It.style.display="block",Me.length===0?pe.innerText="Complete Job":pe.innerText="Next Task -->";const u=It.querySelector(".task-modal-content");u&&(u.style.backgroundColor=""),pe.disabled=!0,pe.style.display="none",Yt.style.display="none",xt.style.display="none"}else a&&a.type==="emulation"&&(Ds.style.display="block")}bs.onclick=function(){Wt.style.display="none",Me.length=0,Qt.style.display="block"},Es.onclick=function(){It.style.display="none",Me.length=0,Qt.style.display="block",oe==null||oe.stop()},St.onclick=function(){St.innerText="Next Task -->",Wt.style.display="none",L()},pe.onclick=function(){pe.innerText="Next Task -->",It.style.display="none",L()},Q.onclick=function(){oe&&oe.start(Dn.value,M.PLANNER)},Is.onclick=function(){Qt.style.display="none"},us.onclick=function(){if(!(oe!=null&&oe.isConnected())){Xn.style.display="block";return}ne.querySelectorAll(".task-to-execute").forEach(u=>{const m=u.getAttribute("data-task-id"),r=u.getAttribute("data-task-order"),i=u.getAttribute("data-collection-name"),h=localStorage.getItem(`taskCollection_${i}`);let p=null;if(h){const F=JSON.parse(h).tasks.find(D=>D.id===m);F&&(p=F)}p&&(p.order=parseInt(r||"0"),Me.push(p))}),L()},ds.onclick=function(){Kt.style.display="block",ae.innerHTML="",ie.innerHTML="",se.innerHTML="",st.value="",Ct.value="",Et.value="";const a=Object.keys(localStorage).filter(i=>i.startsWith("savedProject_")).sort();if(a.length>0){if(a.forEach(i=>{const h=i.replace("savedProject_",""),p=document.createElement("option");p.value=h,p.textContent=h,ae.appendChild(p)}),ae.selectedIndex>=0){const i=ae.value;w(i)}}else Bt.style.display="block",Pe.style.display="block",Oe.style.display="block";const u=document.createElement("option");u.value="new",u.textContent="--new project--",ae.appendChild(u);const m=document.createElement("option");m.value="new",m.textContent="--new group--",ie.appendChild(m);const r=document.createElement("option");r.value="new",r.textContent="--new job--",se.appendChild(r)};function w(a){ie.innerHTML="",se.innerHTML="";const u=localStorage.getItem(`savedProject_${a}`);if(u){const m=JSON.parse(u);m.groups.forEach(r=>{const i=document.createElement("option");i.value=r.name,i.textContent=r.name,ie.appendChild(i)}),m.groups.length>0&&m.groups[0].jobs.forEach(r=>{const i=document.createElement("option");i.value=r.name,i.textContent=r.name,se.appendChild(i)})}}ae.addEventListener("change",()=>{ae.value==="new"?(Bt.style.display="block",Pe.style.display="block",Oe.style.display="block",ie.innerHTML="",se.innerHTML="",Ct.value="",Et.value=""):(Bt.style.display="none",Pe.style.display="none",Oe.style.display="none",w(ae.value),k(ae.value,ie.value));const a=document.createElement("option");a.value="new",a.textContent="--new group--",ie.appendChild(a);const u=document.createElement("option");u.value="new",u.textContent="--new job--",se.appendChild(u)}),ie.addEventListener("change",()=>{if(ie.value==="new"){Pe.style.display="block",se.innerHTML="",Oe.style.display="block";const a=document.createElement("option");a.value="new",a.textContent="--new job--",se.appendChild(a)}else{Pe.style.display="none";const a=ae.value,u=ie.value;a!=="new"&&k(a,u)}});function k(a,u){se.innerHTML="";const m=localStorage.getItem(`savedProject_${a}`);if(m){const i=JSON.parse(m).groups.find(h=>h.name===u);i&&i.jobs.forEach(h=>{const p=document.createElement("option");p.value=h.name,p.textContent=h.name,se.appendChild(p)})}}ps.onclick=function(){let a=ae.value==="new"?st.value:ae.value,u=ie.value==="new"?Ct.value:ie.value,m=se.value==="new"?Et.value:se.value;if(a===""||a===null){alert("Please enter a name for the project");return}if(u===""||u===null){alert("Please enter a name for the group");return}if(m===""||m===null){alert("Please enter a name for the job");return}let r=!1;const i=localStorage.getItem(`savedProject_${a}`);if(i){const p=JSON.parse(i).groups.find(T=>T.name===u);p&&(r=p.jobs.some(T=>T.name===m))}r&&!confirm("A job with this name already exists in this group. Do you want to overwrite it?")||(v(m,u,a),localStorage.setItem("loadedJob",JSON.stringify({name:m,groupName:u,projectName:a})),localStorage.setItem("selectedProject",a),localStorage.setItem("selectedGroup",u),Kt.style.display="none",Bt.style.display="none",Pe.style.display="none",Oe.style.display="none",st.value="",Ct.value="",Et.value="",z(),e(),n(),alert(`${m} saved`))},ms.onclick=function(){localStorage.setItem("loadedJob",""),localStorage.setItem("currentJob",""),ne.innerHTML=""},cs.onclick=function(){Kt.style.display="none"},ks.onclick=function(){Vt.style.display="none"},Ee.addEventListener("change",()=>{const a=Ee.value;localStorage.setItem("selectedGroup",a),n()}),hs.onclick=function(){ne.innerHTML="";const a=H.value,u=Ee.value,m=at.value;if(!a||!u||!m){alert("Please select a project, group, and job to load");return}const r=localStorage.getItem(`savedProject_${a}`);if(!r)return;const h=JSON.parse(r).groups.find(T=>T.name===u);if(!h)return;const p=h.jobs.find(T=>T.name===m);p&&(b(p),localStorage.setItem("selectedProject",a),localStorage.setItem("selectedGroup",u),localStorage.setItem("loadedJob",JSON.stringify({name:m,groupName:u,projectName:a})),I(),f())},gs.onclick=function(){const a=H.value,u=Ee.value,m=at.value;if(!a||!u||!m){alert("Please select a project, group, and job to delete");return}const r=localStorage.getItem(`savedProject_${a}`);if(!r)return;const i=JSON.parse(r),h=i.groups.findIndex(T=>T.name===u);if(h===-1)return;const p=i.groups[h];p.jobs=p.jobs.filter(T=>T.name!==m),p.jobs.length===0&&i.groups.splice(h,1),i.groups.length===0?(localStorage.removeItem(`savedProject_${a}`),z()):localStorage.setItem(`savedProject_${a}`,JSON.stringify(i)),e(),n(),ne.innerHTML=""},fs.onclick=function(){const a=document.createElement("input");a.type="file",a.accept=".json",a.multiple=!0,a.onchange=function(u){const m=u.target.files;if(m){ne.innerHTML="";const r=Array.from(m).map(i=>new Promise((h,p)=>{const T=new FileReader;T.onload=function(F){var $;const D=($=F.target)==null?void 0:$.result;if(D)try{const G=JSON.parse(D);let j,_,le;G.projectName?(j=G,_=j.projectName,le=j.groupName):(j=G,_="Imported",le=j.groupName||"Legacy",j.projectName=_);let he=localStorage.getItem(`savedProject_${_}`),V;he?V=JSON.parse(he):V={name:_,groups:[]};let W=V.groups.find(ce=>ce.name===le);W||(W={name:le,jobs:[]},V.groups.push(W));const de=W.jobs.findIndex(ce=>ce.name===j.name);if(de!==-1){if(!confirm(`A job with name "${j.name}" already exists in project "${_}", group "${le}". Do you want to overwrite it?`)){h({job:j,projectName:_});return}W.jobs[de]=j}else W.jobs.push(j);localStorage.setItem(`savedProject_${_}`,JSON.stringify(V)),localStorage.setItem("selectedProject",_),localStorage.setItem("selectedGroup",le),localStorage.setItem("loadedJob",JSON.stringify({name:j.name,groupName:le,projectName:_})),h({job:j,projectName:_})}catch{p(new Error("Invalid JSON format"))}else p(new Error("No contents"))},T.readAsText(i)}));Promise.all(r).then(i=>{if(i.length>0){const[h]=i;y(),z(),H&&h&&(H.value=h.projectName),e(),n(),h&&h.job&&(b(h.job),f(),I())}}).catch(i=>{console.error("Error importing job:",i),alert("Error importing job: "+i.message)})}},a.click()},vs.onclick=function(){Be.innerHTML="",Xe.innerHTML="",Le.innerHTML="";const a=Object.keys(localStorage).filter(i=>i.startsWith("savedProject_")).sort();if(a.length>0)a.forEach(i=>{const h=i.replace("savedProject_",""),p=document.createElement("option");p.value=h,p.textContent=h,Le.appendChild(p)});else{alert("No projects found. Please create a project first.");return}const u=localStorage.getItem("selectedProject"),m=localStorage.getItem("selectedGroup"),r=localStorage.getItem("loadedJob");if(u&&(Le.value=u),m){const i=localStorage.getItem(`savedProject_${u}`);i&&JSON.parse(i).groups.forEach(p=>{const T=document.createElement("option");T.value=p.name,T.textContent=p.name,Be.appendChild(T)}),Be.value=m}if(r){const i=JSON.parse(r),h=document.createElement("option");h.value=i.name,h.textContent=i.name,Xe.appendChild(h),Xe.value=i.name}Vt.style.display="block"},Le.addEventListener("change",()=>{const a=Le.value;localStorage.setItem("selectedProject",a),Be.innerHTML="",Xe.innerHTML="",S()}),Be.addEventListener("change",()=>{R()});function S(){const a=Le.value,u=localStorage.getItem(`savedProject_${a}`);if(u){const m=JSON.parse(u);Be.innerHTML="",m.groups.forEach(r=>{const i=document.createElement("option");i.value=r.name,i.textContent=r.name,Be.appendChild(i)})}}function R(){const a=Be.value,u=Le.value,m=localStorage.getItem(`savedProject_${u}`),r=m?JSON.parse(m).groups.find(i=>i.name===a):null;r&&(Xe.innerHTML="",r.jobs.forEach(i=>{const h=document.createElement("option");h.value=i.name,h.textContent=i.name,Xe.appendChild(h)}))}ys.onclick=function(){const a=Le.value,u=Be.value,m=Xe.value,r=localStorage.getItem(`savedProject_${a}`);if(!r)return;const h=JSON.parse(r).groups.find(T=>T.name===u);if(!h)return;const p=h.jobs.find(T=>T.name===m);if(p&&p){const T=p.tasks,F={name:p.name,projectName:a,groupName:u,tasks:[]};T.forEach(j=>{const _=localStorage.getItem(`taskCollection_${j.collectionName}`);if(_){const he=JSON.parse(_).tasks.find(V=>V.id===j.id);he&&F.tasks.push({id:he.id,collectionName:j.collectionName})}});const D=new Blob([JSON.stringify(F,null,2)],{type:"application/json"}),$=URL.createObjectURL(D),G=document.createElement("a");G.href=$,G.download=`${F.name}.json`,G.click(),URL.revokeObjectURL($),Vt.style.display="none"}};function z(){if(!H)return;H.innerHTML="";const a=Object.keys(localStorage).filter(m=>m.startsWith("savedProject_")).sort();a.forEach(m=>{const r=m.replace("savedProject_",""),i=document.createElement("option");i.value=r,i.textContent=r,H.appendChild(i)});const u=localStorage.getItem("selectedProject");u&&a.includes(`savedProject_${u}`)&&(H.value=u)}H&&H.addEventListener("change",()=>{const a=H.value;localStorage.setItem("selectedProject",a),e(),n()})});const J=class J{static createThreadSpec(e,t,n,s){return{name:e,nominalDiameter:t,pitch:n,isCoarse:s,getInternalMinorDiameter(){return Number((this.nominalDiameter-1.082532*this.pitch).toFixed(3))},getMajorDiameter(){return this.nominalDiameter},getThreadDepth(c){return Number(c==="External"?(this.pitch*.61343).toFixed(3):(this.pitch*.54127).toFixed(3))},getMinorDiameter(c){return c==="External"?this.nominalDiameter-2*this.getThreadDepth(c):this.getInternalMinorDiameter()}}}static generateThreadingGcode(e,t,n,s,c){const d=e.getMajorDiameter(),B=e.getMinorDiameter(t);let l,v;return t==="External"?(l=d/2,v=B/2):(l=B/2-.1,v=d/2),l=Math.round(l*1e3)/1e3,v=Math.round(v*1e3)/1e3,`G33 Z${n==="Right"?s:-s} X${-v} P${e.pitch} H${c} R${-l}`}static getThreadSpecByName(e){for(const t of this.threadTypes){const n=t.threads.find(s=>s.name===e);if(n)return n}}static getThreadGroups(){return this.threadTypes.map(e=>e.name)}static getThreadsForGroup(e){const t=this.threadTypes.find(n=>n.name===e);return t?t.threads:[]}};x(J,"threadTypes",[{name:"Metric",threads:[J.createThreadSpec("M3 x 0.35 (Fine)",3,.35,!1),J.createThreadSpec("M3 x 0.5 (Coarse)",3,.5,!0),J.createThreadSpec("M4 x 0.5 (Fine)",4,.5,!1),J.createThreadSpec("M4 x 0.7 (Coarse)",4,.7,!0),J.createThreadSpec("M5 x 0.5 (Fine)",5,.5,!1),J.createThreadSpec("M5 x 0.8 (Coarse)",5,.8,!0),J.createThreadSpec("M6 x 0.75 (Fine)",6,.75,!1),J.createThreadSpec("M6 x 1.0 (Coarse)",6,1,!0),J.createThreadSpec("M8 x 1.0 (Fine)",8,1,!1),J.createThreadSpec("M8 x 1.25 (Coarse)",8,1.25,!0),J.createThreadSpec("M10 x 1.0 (Fine)",10,1,!1),J.createThreadSpec("M10 x 1.5 (Coarse)",10,1.5,!0),J.createThreadSpec("M11 x 1.0 (Fine)",11,1,!1),J.createThreadSpec("M11 x 1.5 (Coarse)",11,1.5,!0),J.createThreadSpec("M12 x 1.25 (Fine)",12,1.25,!1),J.createThreadSpec("M12 x 1.75 (Coarse)",12,1.75,!0)]}]);let Ye=J,C,qt="H4V12FJ";const tn={quickTaskFacing:{openButton:document.getElementById("quickTaskFacingButton"),modal:document.getElementById("quickTaskFacingModal"),closeButton:document.getElementById("quickTaskFacingCloseButton"),executeButton:document.getElementById("quickTaskFacingExecuteButton"),stopButton:document.getElementById("quickTaskFacingStopButton"),progressBar:document.getElementById("quickTaskFacingProgressBar"),taskFunction:no},quickTaskGrooving:{openButton:document.getElementById("quickTaskGroovingButton"),modal:document.getElementById("quickTaskGroovingModal"),closeButton:document.getElementById("quickTaskGroovingCloseButton"),executeButton:document.getElementById("quickTaskGroovingExecuteButton"),stopButton:document.getElementById("quickTaskGroovingStopButton"),progressBar:document.getElementById("quickTaskGroovingProgressBar"),taskFunction:js},quickTaskProfiling:{openButton:document.getElementById("quickTaskProfilingButton"),modal:document.getElementById("quickTaskProfilingModal"),closeButton:document.getElementById("quickTaskProfilingCloseButton"),executeButton:document.getElementById("quickTaskProfilingExecuteButton"),stopButton:document.getElementById("quickTaskProfilingStopButton"),progressBar:document.getElementById("quickTaskProfilingProgressBar"),taskFunction:to},quickTaskDrilling:{openButton:document.getElementById("quickTaskDrillingButton"),modal:document.getElementById("quickTaskDrillingModal"),closeButton:document.getElementById("quickTaskDrillingCloseButton"),executeButton:document.getElementById("quickTaskDrillingExecuteButton"),stopButton:document.getElementById("quickTaskDrillingStopButton"),progressBar:document.getElementById("quickTaskDrillingProgressBar"),taskFunction:oo},quickTaskCone:{openButton:document.getElementById("quickTaskConeButton"),modal:document.getElementById("quickTaskConeModal"),closeButton:document.getElementById("quickTaskConeCloseButton"),executeButton:document.getElementById("quickTaskConeExecuteButton"),stopButton:document.getElementById("quickTaskConeStopButton"),progressBar:document.getElementById("quickTaskConeProgressBar"),taskFunction:Rs},quickTaskBoring:{openButton:document.getElementById("quickTaskBoringButton"),modal:document.getElementById("quickTaskBoringModal"),closeButton:document.getElementById("quickTaskBoringCloseButton"),executeButton:document.getElementById("quickTaskBoringExecuteButton"),stopButton:document.getElementById("quickTaskBoringStopButton"),progressBar:document.getElementById("quickTaskBoringProgressBar"),taskFunction:so},quickTaskThreading:{openButton:document.getElementById("quickTaskThreadingButton"),modal:document.getElementById("quickTaskThreadingModal"),closeButton:document.getElementById("quickTaskThreadingCloseButton"),executeButton:document.getElementById("quickTaskThreadingExecuteButton"),stopButton:document.getElementById("quickTaskThreadingStopButton"),progressBar:document.getElementById("quickTaskThreadingProgressBar"),taskFunction:ao},quickTaskToolOffsets:{openButton:document.getElementById("quickTaskToolOffsetsButton"),modal:document.getElementById("quickTaskToolOffsetsModal"),closeButton:document.getElementById("quickTaskToolOffsetsCloseButton"),executeButton:document.getElementById("quickTaskToolOffsetsExecuteButton"),stopButton:document.getElementById("quickTaskToolOffsetsStopButton"),progressBar:document.getElementById("quickTaskToolOffsetsProgressBar"),taskFunction:Zs}},an=document.getElementById("quickTaskFacingTravelFeedRate"),Pt=document.getElementById("quickTaskFacingEndDiameter"),Lt=document.getElementById("quickTaskFacingFeedrate"),$e=document.getElementById("quickTaskFacingCopyToClipboardButton"),ut=document.getElementById("quickTaskFacingUsePecking"),rn=document.getElementById("quickTaskFacingPeckingDepth"),nn=document.getElementById("quickTaskFacingPeckingDepthContainer"),ln=document.getElementById("quickTaskFacingPeckingRetractionRate"),Mn=document.getElementById("quickTaskFacingCurrentPosition"),Os=document.getElementById("quickTaskFacingRefreshPositionButton"),Rt=document.getElementById("quickTaskProfilingFinalDiameter"),pt=document.getElementById("quickTaskProfilingDepth"),cn=document.getElementById("quickTaskProfilingFeedRate"),un=document.getElementById("quickTaskProfilingRetractFeedRate"),jt=document.getElementById("quickTaskProfilingDepthPerPass"),Ae=document.getElementById("quickTaskProfilingFinishingDepth"),ht=document.getElementById("quickTaskProfilingPasses"),gt=document.getElementById("quickTaskProfilingType"),$n=document.getElementById("quickTaskProfilingFinalDiameterContainer"),qn=document.getElementById("quickTaskProfilingDepthContainer"),qe=document.getElementById("quickTaskProfilingCopyToClipboardButton"),Xs=document.getElementById("quickTaskProfilingRefreshPositionButton"),jn=document.getElementById("quickTaskProfilingCurrentPosition"),dn=document.getElementById("quickTaskDrillingDepth"),Nt=document.getElementById("quickTaskDrillingFeedRate"),Dt=document.getElementById("quickTaskDrillingRetractFeedRate"),mn=document.getElementById("quickTaskDrillingPeckCheckbox"),Rn=document.getElementById("quickTaskDrillingPeckingDepthContainer"),Ms=document.getElementById("quickTaskDrillingPeckingDepth"),je=document.getElementById("quickTaskDrillingCopyToClipboardButton"),Zn=document.getElementById("quickTaskThreadingType"),Ie=document.getElementById("quickTaskThreadingSize"),$s=document.getElementById("quickTaskThreadingDirection"),eo=document.getElementById("quickTaskThreadingExternalOrInternal"),pn=document.getElementById("quickTaskThreadingLength"),Ot=document.getElementById("quickTaskThreadingPasses"),Re=document.getElementById("quickTaskThreadingCopyToClipboardButton"),hn=document.getElementById("quickTaskBoringDepth"),ft=document.getElementById("quickTaskBoringDepthOfCut"),Xt=document.getElementById("quickTaskBoringFeedRate"),Mt=document.getElementById("quickTaskBoringRetractFeedRate"),Ke=document.getElementById("quickTaskBoringType"),Gn=document.getElementById("quickTaskBoringFinalDiameterContainer"),An=document.getElementById("quickTaskBoringDepthOfCutContainer"),Ve=document.getElementById("quickTaskBoringFinalDiameter"),fn=document.getElementById("quickTaskBoringDepthPerPass"),_e=document.getElementById("quickTaskBoringFinishingDepth"),vt=document.getElementById("quickTaskBoringPasses"),Ze=document.getElementById("quickTaskBoringCopyToClipboardButton"),qs=document.getElementById("quickTaskBoringRefreshPositionButton"),_n=document.getElementById("quickTaskBoringCurrentPosition"),gn=document.getElementById("quickTaskToolOffsetsProbeDiameter"),$t=document.getElementById("quickTaskToolOffsetsToolNumber"),Jn=document.getElementById("quickTaskToolOffsetsToolType"),wt=document.getElementById("quickTaskToolOffsetsOffsetX"),Ft=document.getElementById("quickTaskToolOffsetsOffsetZ");document.addEventListener("DOMContentLoaded",()=>{let o;C=dt.getInstance(),C.addStatusChangeListener(()=>m(),M.QUICKTASKS);const e=document.getElementById("connectButton"),t=r=>r.replace("toolOffsets:","").replace("ok","").split("|").map(p=>{const T=p.match(/T(\d+)/),F=T?parseInt(T[1]):0,D=p.match(/Z=(-?\d+\.?\d*)/),$=p.match(/X=(-?\d+\.?\d*)/),G=p.match(/W=(-?\d+\.?\d*)/),j=p.match(/U=(-?\d+\.?\d*)/);return{tool:F,z:D?parseFloat(D[1]):0,x:$?parseFloat($[1]):0,w:G?parseFloat(G[1]):0,u:j?parseFloat(j[1]):0}}).filter(p=>!isNaN(p.tool));Object.keys(tn).forEach(r=>{const i=tn[r];tn[r].openButton.addEventListener("click",async()=>{if(!(C!=null&&C.isConnected()))alert("Please connect to the machine first");else{if(o=i,r==="quickTaskCone"||r==="quickTaskGrooving"?alert("Not Yet Implemented, coming soon!"):i.modal.style.display="block",r==="quickTaskProfiling"){const p=await(C==null?void 0:C.getPosition(M.QUICKTASKS)),T=p==null?void 0:p.x,F=p==null?void 0:p.z;jn.value=`X: ${T.toFixed(3)} Z: ${F.toFixed(3)}`}if(r==="quickTaskFacing"){const p=await(C==null?void 0:C.getPosition(M.QUICKTASKS)),T=p==null?void 0:p.x,F=p==null?void 0:p.z;Mn.value=`X: ${T.toFixed(3)} Z: ${F.toFixed(3)}`}if(r==="quickTaskBoring"){const p=await(C==null?void 0:C.getPosition(M.QUICKTASKS)),T=p==null?void 0:p.x,F=p==null?void 0:p.z;_n.value=`X: ${T.toFixed(3)} Z: ${F.toFixed(3)}`}if(r==="quickTaskToolOffsets"){const p=await C.getToolOffsets(M.GCODE),T=t(p);if($t.innerHTML="",T.length>0){for(let F=1;F<=T.length-1;F++){const D=document.createElement("option");D.value=`T${F}`,D.textContent=`T${F}`,$t.appendChild(D)}$t.value="T1"}}}}),i.executeButton.addEventListener("click",()=>{i.taskFunction()}),i.stopButton.addEventListener("click",()=>{C==null||C.stop()}),i.closeButton.addEventListener("click",()=>{i.modal.style.display="none"})});const n=()=>{(pt.value||Ve)&&cn.value&&un.value&&ht.value&&jt.value&&Ae.value?(o.executeButton.disabled=!1,o.executeButton.classList.remove("disabled-button"),o.executeButton.classList.add("interaction-ready-button"),qe.disabled=!1,qe.classList.remove("disabled-button"),qe.classList.add("interaction-ready-button")):(o.executeButton.disabled=!0,o.executeButton.classList.add("disabled-button"),o.executeButton.classList.remove("interaction-ready-button"),qe.disabled=!0,qe.classList.add("disabled-button"),qe.classList.remove("interaction-ready-button"))};Xs.addEventListener("click",async()=>{const r=await(C==null?void 0:C.getPosition(M.QUICKTASKS)),i=r==null?void 0:r.x,h=r==null?void 0:r.z;jn.value=`X: ${i.toFixed(3)} Z: ${h.toFixed(3)}`}),gt.addEventListener("change",()=>{gt.value==="Absolute"?(qn.style.display="none",$n.style.display="block"):(qn.style.display="block",$n.style.display="none"),it(),rt(),n()}),Rt.addEventListener("input",()=>{it(),rt(),n()}),pt.addEventListener("input",()=>{it(),rt(),n()}),ht.addEventListener("input",()=>{rt(),n()}),jt.addEventListener("input",()=>{it(),n()}),Ae.addEventListener("input",()=>{it(),rt(),n()}),qe.addEventListener("click",()=>to(!0));const s=()=>{Pt.value&&Number(Lt.value)>0?(o.executeButton.disabled=!1,o.executeButton.classList.remove("disabled-button"),o.executeButton.classList.add("interaction-ready-button"),$e.disabled=!1,$e.classList.remove("disabled-button"),$e.classList.add("interaction-ready-button")):(o.executeButton.disabled=!0,o.executeButton.classList.add("disabled-button"),o.executeButton.classList.remove("interaction-ready-button"),$e.disabled=!0,$e.classList.add("disabled-button"),$e.classList.remove("interaction-ready-button"))};Os.addEventListener("click",async()=>{const r=await(C==null?void 0:C.getPosition(M.QUICKTASKS)),i=r==null?void 0:r.x,h=r==null?void 0:r.z;Mn.value=`X: ${i.toFixed(3)} Z: ${h.toFixed(3)}`}),Pt.addEventListener("input",s),Lt.addEventListener("input",s),an.addEventListener("input",s),$e.addEventListener("click",()=>no(!0)),rn.addEventListener("input",s),ln.addEventListener("input",s),ut.addEventListener("change",()=>{ut.checked?nn.style.display="block":nn.style.display="none"});const c=localStorage.getItem("facingFeedrate");c!==null&&(Lt.value=c);const d=localStorage.getItem("facingEndDiameter");d!==null&&(Pt.value=d);const B=localStorage.getItem("facingTravelFeedRate");B!==null&&(an.value=B);const l=localStorage.getItem("facingPeckingDepth");l!==null&&(rn.value=l);const v=localStorage.getItem("facingPeckingRetractionRate");v!==null&&(ln.value=v);const b=localStorage.getItem("facingUsePecking");b!==null&&(ut.checked=b==="true",nn.style.display=ut.checked?"block":"none");const f=()=>{const r=Ke.value,i=hn.value&&Xt.value&&Mt.value&&vt.value&&_e.value;let h=!1;r==="Absolute"?h=!!Ve.value:h=!!ft.value,i&&h?(o.executeButton.disabled=!1,o.executeButton.classList.remove("disabled-button"),o.executeButton.classList.add("interaction-ready-button"),Ze.disabled=!1,Ze.classList.remove("disabled-button"),Ze.classList.add("interaction-ready-button")):(o.executeButton.disabled=!0,o.executeButton.classList.add("disabled-button"),o.executeButton.classList.remove("interaction-ready-button"),Ze.disabled=!0,Ze.classList.add("disabled-button"),Ze.classList.remove("interaction-ready-button"))};hn.addEventListener("input",f),Xt.addEventListener("input",f),Mt.addEventListener("input",f),qs.addEventListener("click",async()=>{const r=await(C==null?void 0:C.getPosition(M.QUICKTASKS)),i=r==null?void 0:r.x,h=r==null?void 0:r.z;_n.value=`X: ${i.toFixed(3)} Z: ${h.toFixed(3)}`}),Ke.addEventListener("change",()=>{Ke.value==="Absolute"?(Gn.style.display="block",An.style.display="none"):(Gn.style.display="none",An.style.display="block"),lt(),ct(),f()}),Ve.addEventListener("input",()=>{lt(),ct(),f()}),ft.addEventListener("input",()=>{lt(),ct(),f()}),vt.addEventListener("input",()=>{ct(),f()}),fn.addEventListener("input",()=>{lt(),f()}),_e.addEventListener("input",()=>{lt(),ct(),f()}),Ze.addEventListener("click",()=>so(!0)),mn.addEventListener("change",()=>{mn.checked?Rn.style.display="block":Rn.style.display="none"});const y=()=>{dn.value&&Nt.value&&Dt.value?(o.executeButton.disabled=!1,o.executeButton.classList.remove("disabled-button"),o.executeButton.classList.add("interaction-ready-button"),je.disabled=!1,je.classList.remove("disabled-button"),je.classList.add("interaction-ready-button")):(o.executeButton.disabled=!0,o.executeButton.classList.add("disabled-button"),o.executeButton.classList.remove("interaction-ready-button"),je.disabled=!0,je.classList.add("disabled-button"),je.classList.remove("interaction-ready-button"))};dn.addEventListener("input",y),Nt.addEventListener("input",y),Dt.addEventListener("input",y),je.addEventListener("click",()=>oo(!0)),Ie.addEventListener("change",()=>{const r=Ye.getThreadSpecByName(Ie.value),i=eo.value,h=r.getThreadDepth(i),p=Math.ceil(h/.1)+1;Ot.value=p.toString()});const I=()=>{const r=Zn.value,i=Ye.getThreadsForGroup(r);Ie.innerHTML='<option value="">Select Thread Size</option>',i.length>0?(i.sort((h,p)=>h.nominalDiameter!==p.nominalDiameter?h.nominalDiameter-p.nominalDiameter:h.pitch-p.pitch).forEach(h=>{const p=document.createElement("option");p.value=h.name,p.textContent=h.name,Ie.appendChild(p)}),Ie.disabled=!1):Ie.disabled=!0},L=()=>{Ie.value&&pn.value&&Ot.value?(o.executeButton.disabled=!1,o.executeButton.classList.remove("disabled-button"),o.executeButton.classList.add("interaction-ready-button"),Re.disabled=!1,Re.classList.remove("disabled-button"),Re.classList.add("interaction-ready-button")):(Re.disabled=!0,Re.classList.add("disabled-button"),Re.classList.remove("interaction-ready-button"),o.executeButton.disabled=!0,o.executeButton.classList.add("disabled-button"),o.executeButton.classList.remove("interaction-ready-button"))};Ie.addEventListener("change",L),pn.addEventListener("input",L),Ot.addEventListener("input",L),Zn.addEventListener("change",I),Re.addEventListener("click",()=>ao(!0)),I();const w=localStorage.getItem("probeDiameter");w!==null&&(gn.value=w);const k=localStorage.getItem("drillingRetractFeedRate");k!==null&&(Dt.value=k);const S=localStorage.getItem("boringRetractFeedrate");S!==null&&(Mt.value=S);const R=localStorage.getItem("profilingRetractFeedrate");R!==null&&(un.value=R);const z=localStorage.getItem("drillingFeedRate");z!==null&&(Nt.value=z);const a=localStorage.getItem("boringFeedRate");a!==null&&(Xt.value=a);const u=localStorage.getItem("profilingFeedRate");u!==null&&(cn.value=u);function m(){if(!C)return;const r=C.getStatus();if(r.isConnected===!1){e.innerText="Connect",e.disabled=!1,e.style.backgroundColor="";return}else e.innerText="Connected",e.disabled=!0,e.style.backgroundColor="green";const i=r.condition==="run";if(!i)o.executeButton.style.display="flex",o.stopButton.style.display="none",o.progressBar.value=0,o.progressBar.parentElement.style.display="none";else if(i){o.executeButton.style.display="none",o.stopButton.style.display="inline-block",o.progressBar.parentElement.style.display="block";const h=r.progress;o.progressBar.value=h}}});async function to(o=!1){const e=await(C==null?void 0:C.getPosition(M.QUICKTASKS)),t=e==null?void 0:e.x,n=Number(parseFloat(document.getElementById("quickTaskProfilingLength").value).toFixed(3)),s=parseInt(ht.value,10),c=Number(parseFloat(cn.value).toFixed(3)),d=Number(parseFloat(un.value).toFixed(3)),B=gt.value;localStorage.setItem("profilingRetractFeedrate",d.toString()),localStorage.setItem("profilingFeedRate",c.toString());const l=[];l.push("G91");let v=0,b=0;B==="Absolute"?(v=-Number(parseFloat(Rt.value).toFixed(3))/2,b=Math.abs(v-t),b=Number(b.toFixed(3))):b=Number(parseFloat(pt.value).toFixed(3));let f=Number(parseFloat(Ae.value).toFixed(3));f>b&&(f=b);const y=Number((b-f).toFixed(3));let I=0;s>1?(f>0?I=y/(s-1):I=y/s,I=Number(I.toFixed(3))):s===1&&(I=y);let L=0,w=0;s>1&&f>0?w=s-1:w=s;for(let S=0;S<w;S++){let R=I;l.push(`G1 X${R} F${c} ; roughing cut ${S+1}`),l.push(`G1 Z${n} F${c} ; cut`),l.push(`G1 X-0.2 F${d} ; retract`),l.push(`G1 Z-${n} F${d} ; retract`),l.push(`G1 X0.2 F${d} ; travel`),L+=R,L=Number(L.toFixed(3))}let k=0;if(B==="Absolute"){const S=Number((t+L).toFixed(3));k=Number(Math.abs(v-S).toFixed(3))}else k=f;if(k>.001&&(l.push(`G1 X${k} F${c} ; finishing cut`),l.push(`G1 Z${n} F${c} ; cut`),l.push(`G1 X-0.2 F${d} ; retract`),l.push(`G1 Z-${n} F${d} ; retract`)),l.push("G90"),l.push(`G0 X${t} F${d} ; move to final position`),l.push("G91"),o){navigator.clipboard.writeText(l.join(`
`)).then(()=>{alert("G-code copied to clipboard")}).catch(()=>{alert("Failed to copy G-code to clipboard")});return}C==null||C.sendCommands(l,M.QUICKTASKS)}async function it(){const o=await(C==null?void 0:C.getPosition(M.QUICKTASKS)),e=o==null?void 0:o.x;let t=0,n;if(gt.value==="Absolute"){const l=-Number(parseFloat(Rt.value).toFixed(3))/2;n=Math.abs(l-e),n=Number(n.toFixed(3))}else n=Number(parseFloat(pt.value).toFixed(3));t=Number(parseFloat(jt.value).toFixed(3));let s=Number(parseFloat(Ae.value).toFixed(3));s>n&&(s=n,Ae.value=s.toFixed(3));const c=Number((n-s).toFixed(3));let d=1;t>0&&(d=Math.ceil(c/t)+1),ht.value=d.toString()}async function rt(){const o=await(C==null?void 0:C.getPosition(M.QUICKTASKS)),e=o==null?void 0:o.x;let t;if(gt.value==="Absolute"){const l=-Number(parseFloat(Rt.value).toFixed(3))/2;t=Math.abs(l-e),t=Number(t.toFixed(3))}else t=Number(parseFloat(pt.value).toFixed(3));const n=parseInt(ht.value,10);let s=Number(parseFloat(Ae.value).toFixed(3));s>t&&(s=t,Ae.value=s.toFixed(3));const c=Number((t-s).toFixed(3));let d=0;n>1?(s>0?d=c/(n-1):d=c/n,d=Number(d.toFixed(3))):d=t,jt.value=d.toFixed(3)}async function no(o=!1){let e=[];const t=await(C==null?void 0:C.getPosition(M.QUICKTASKS)),n=t==null?void 0:t.x,s=Math.abs(n)*2,c=Number(parseFloat(Pt.value).toFixed(3)),d=Number(parseFloat(Lt.value).toFixed(3)),B=Number(parseFloat(an.value).toFixed(3)),l=ut.checked,v=Number(parseFloat(rn.value).toFixed(3)),b=Number(parseFloat(ln.value).toFixed(3));localStorage.setItem("facingFeedrate",d.toString()),localStorage.setItem("facingPeckingDepth",v.toString()),localStorage.setItem("facingEndDiameter",c.toString()),localStorage.setItem("facingTravelFeedRate",B.toString()),localStorage.setItem("facingPeckingRetractionRate",b.toString()),localStorage.setItem("facingUsePecking",l.toString()),e.push("G91");const f=s/2,y=c/2,I=Math.abs(f-y);if(l){const L=Math.ceil(I/v),w=I/L;let k=0;for(let S=0;S<L;S++){if(e.push(`G0 X${w} F${d} ; cut`),k+=w,k=Number(k.toFixed(3)),k>=I){e.push(`G1 X-${k} F${B} ; retract to start position`);break}(S+1)%b===0?(e.push(`G1 X-${k} F${B} ; retract to start position`),e.push(`G1 X${k} F${B} ; travel back to cut position`)):(e.push(`G1 X-${w} F${B} ; retract short distance`),e.push(`G1 X${w} F${d} ; travel back to surface`))}}else e.push(`G1 X${I} F${d} ; cut`),e.push(`G1 X-${I} F${B} ; retract to start position`);if(o){navigator.clipboard.writeText(e.join(`
`)).then(()=>{alert("G-code copied to clipboard")}).catch(()=>{alert("Failed to copy G-code to clipboard")});return}C==null||C.sendCommands(e,M.QUICKTASKS)}function oo(o=!1){const e=parseFloat(dn.value),t=parseFloat(Nt.value),n=mn.checked;let s=parseFloat(Ms.value);const c=parseFloat(Dt.value),d=50,B=3,l=3;let v=!1,b=0;localStorage.setItem("drillingRetractFeedRate",c.toString()),localStorage.setItem("drillingFeedRate",t.toString());let f=[];if(f.push("G90"),f.push("G0 X0"),f.push("G91"),n){let y=!1,I=0;for(;!y;){if(f.push(`G1 Z${s} F${t}`),b++,I+=s,b===B?(f.push(`G1 Z-${I+l} F${c}`),v=!0,b=0):f.push(`G1 Z-${I} F${c}`),I>=e){y=!0;break}else I+s>e&&(s=e-I);v?(f.push(`G1 Z${I+l-.2} F${c}`),f.push(`G1 Z${.2} F${d}`),v=!1):(f.push(`G1 Z${I-.2} F${c}`),f.push(`G1 Z${.2} F${d}`))}}else f.push(`G1 Z${e} F${t}`),f.push(`G1 Z-${e} F${c}`);if(f.push("G90"),o){navigator.clipboard.writeText(f.join(`
`)).then(()=>{alert("G-code copied to clipboard")}).catch(()=>{alert("Failed to copy G-code to clipboard")});return}C==null||C.sendCommands(f,M.QUICKTASKS)}function js(){alert("Not Yet Implemented")}function Rs(){alert("Not Yet Implemented")}async function so(o=!1){const e=await(C==null?void 0:C.getPosition(M.QUICKTASKS)),t=e==null?void 0:e.x,n=Number(parseFloat(hn.value).toFixed(3)),s=Number(parseFloat(Xt.value).toFixed(3)),c=Ke.value,d=parseInt(vt.value,10),B=Number(parseFloat(Mt.value).toFixed(3));localStorage.setItem("boringRetractFeedrate",B.toString()),localStorage.setItem("boringFeedRate",s.toString());const l=[];l.push("G91");let v=0,b=0;c==="Absolute"?(v=-Number(parseFloat(Ve.value).toFixed(3))/2,b=Math.abs(t-v),b=Number(b.toFixed(3))):b=Number(parseFloat(ft.value).toFixed(3));let f=Number(parseFloat(_e.value).toFixed(3));f>b&&(f=b);const y=Number((b-f).toFixed(3));let I=0;d>1?(f>0?I=y/(d-1):I=y/d,I=Number(I.toFixed(3))):d===1&&(I=y);let L=0,w=0;d>1&&f>0?w=d-1:w=d;for(let S=0;S<w;S++){let R=I;l.push(`G1 X-${R} F${s} ; roughing cut ${S+1}`),l.push(`G1 Z${n} F${s} ; cut`),l.push(`G0 X0.2 F${B} ; retract`),l.push(`G0 Z-${n} F${B} ; retract`),l.push(`G0 X-0.2 F${B} ; travel`),L+=R,L=Number(L.toFixed(3))}let k=0;if(c==="Absolute"){const S=Number((t-L).toFixed(3));k=Number(Math.abs(S-v).toFixed(3))}else k=f;if(k>.001&&(l.push(`G1 X-${k} F${s} ; finishing cut`),l.push(`G1 Z${n} F${s} ; cut`),l.push(`G0 X0.2 F${B} ; retract`),l.push(`G0 Z-${n} F${B} ; retract`)),l.push("G90"),o){navigator.clipboard.writeText(l.join(`
`)).then(()=>{alert("G-code copied to clipboard")}).catch(()=>{alert("Failed to copy G-code to clipboard")});return}C==null||C.sendCommands(l,M.QUICKTASKS)}async function lt(){const o=await(C==null?void 0:C.getPosition(M.QUICKTASKS)),e=o==null?void 0:o.x;let t;if(Ke.value==="Absolute"){const l=-Number(parseFloat(Ve.value).toFixed(3))/2;t=Math.abs(e-l),t=Number(t.toFixed(3))}else t=Number(parseFloat(ft.value).toFixed(3));const n=Number(parseFloat(fn.value).toFixed(3));let s=Number(parseFloat(_e.value).toFixed(3));s>t&&(s=t,_e.value=s.toFixed(3));const c=Number((t-s).toFixed(3));let d=1;n>0&&(d=Math.ceil(c/n)+1),vt.value=d.toString()}async function ct(){const o=await(C==null?void 0:C.getPosition(M.QUICKTASKS)),e=o==null?void 0:o.x;let t;if(Ke.value==="Absolute"){const l=-Number(parseFloat(Ve.value).toFixed(3))/2;t=Math.abs(e-l),t=Number(t.toFixed(3))}else t=Number(parseFloat(ft.value).toFixed(3));const n=parseInt(vt.value,10);let s=Number(parseFloat(_e.value).toFixed(3));s>t&&(s=t,_e.value=s.toFixed(3));const c=Number((t-s).toFixed(3));let d=0;n>1?(s>0?d=c/(n-1):d=c/n,d=Number(d.toFixed(3))):d=t,fn.value=d.toFixed(3)}function ao(o=!1){const e=C==null?void 0:C.getStatus();if(!e||!e.isConnected){alert("Please connect to the machine first");return}else if(e.version!==qt){alert(`Threading is only supported on ${qt} controllers. Please see the help page for more information.`);return}else{const t=Ie.value;if(t===""){alert("Please select a thread size");return}const n=$s.value,s=eo.value,c=parseFloat(pn.value),d=parseInt(Ot.value,10),B=Ye.getThreadSpecByName(t),l=Ye.generateThreadingGcode(B,s,n,c,d);if(o){navigator.clipboard.writeText(l).then(()=>{alert("G-code copied to clipboard")}).catch(()=>{alert("Failed to copy G-code to clipboard")});return}const v=[];v.push("G90"),v.push(l),C==null||C.sendCommands(v,M.QUICKTASKS)}}function Zs(){const o=C==null?void 0:C.getStatus();if(!o||!o.isConnected){alert("Please connect to the machine first");return}else if(o.version!==qt){alert(`Tool offsets is only supported on ${qt} controllers. Please see the help page for more information.`);return}let e=$t.value;if(e===""){alert("Please enter a tool number");return}if(e[0]==="T"&&(e=e.substring(1)),parseInt(e,10)===0){alert("T0 is the primary tool and cannot be modified");return}let t="XZ";if(wt.value===""&&(t=t.replace("X","")),Ft.value===""&&(t=t.replace("Z","")),t===""){alert("Please enter X and/or Z values");return}localStorage.setItem("probeDiameter",gn.value);let n=[];const s=parseFloat(gn.value)/2;if(Jn.value.startsWith("External")){const c={x:parseFloat(wt.value),z:parseFloat(Ft.value),radius:s,toolType:"External"},d=on(c);t==="X"?n.push(`G10 P${e} X${d.x}`):t==="Z"?n.push(`G10 P${e} Z${d.z}`):n.push(`G10 P${e} X${d.x} Z${d.z}`)}else if(Jn.value.startsWith("Internal")){const c={x:parseFloat(wt.value),z:parseFloat(Ft.value),radius:s,toolType:"Internal"},d=on(c);t==="X"?n.push(`G10 P${e} X${d.x}`):t==="Z"?n.push(`G10 P${e} Z${d.z}`):n.push(`G10 P${e} X${d.x} Z${d.z}`)}else{const c={x:parseFloat(wt.value),z:parseFloat(Ft.value),radius:s,toolType:"Drill"},d=on(c);t==="X"?n.push(`G10 P${e} X${d.x}`):t==="Z"?n.push(`G10 P${e} Z${d.z}`):n.push(`G10 P${e} X${d.x} Z${d.z}`)}C==null||C.sendCommands(n,M.QUICKTASKS),alert(`Tool offsets for T${e} have been set`)}function on(o){let e;switch(o.toolType){case"Drill":e=-o.x;break;case"Internal":e=-(o.x-o.radius);break;case"External":e=-(o.x- -o.radius);break}const t=-o.z,n=s=>Math.round(s*1e3)/1e3;return{x:n(e),z:n(t)}}const Gs="#DC143C",As="#6B8E23",_s="#FFA500",Js="#242424",fe=5;class zs{constructor(){x(this,"currentX",0);x(this,"currentZ",0);x(this,"absX",0);x(this,"absZ",0);x(this,"previousCanvasX",0);x(this,"previousCanvasZ",0);x(this,"canvasX",0);x(this,"canvasZ",0);x(this,"ctx",null);x(this,"stockDiameterInMM",0)}parseGCode(e){let t=!1;const n=[],s={z:0,x:0};let c=0,d=!1;return e.split(`
`).forEach((l,v)=>{const b=this.determineMovementType(l),f={isRelative:t,movementType:b},y=l.match(/([GXYZF])([0-9.-]+)/g);if(!d&&l.includes(";")){const L=l.substring(l.indexOf(";")),w=[/stock\s+d(?:iameter)?\s*[=:]?\s*(\d+\.?\d*)(?:mm)?/i,/stock\s+(?:diameter|dia|diam)?\s*[=:]?\s*(\d+\.?\d*)(?:mm)?/i,/diameter\s*[=:]?\s*(\d+\.?\d*)(?:mm)?/i,/dia\s*[=:]?\s*(\d+\.?\d*)(?:mm)?/i];for(const k of w){const S=L.match(k);if(S&&S[1]){c=parseFloat(S[1]),d=!0,this.stockDiameterInMM=c;break}}}y==null||y.forEach(L=>{const w=parseFloat(L.slice(1));switch(L[0]){case"G":w===90&&(f.isRelative=!1,t=!1),w===91&&(f.isRelative=!0,t=!0);break;case"X":f.x=parseFloat(w.toFixed(3)),t?s.x=parseFloat((s.x+w).toFixed(3)):(s.x=parseFloat(w.toFixed(3)),d||(c=Math.abs(s.x)*2,this.stockDiameterInMM=c,d=!0));break;case"Z":f.z=parseFloat(w.toFixed(3)),t?s.z=parseFloat((s.z+w).toFixed(3)):s.z=parseFloat(w.toFixed(3));break}});const I={...f,lineNumber:v+1,originalLine:l,absolutePosition:{...s}};(f.z!==void 0||f.x!==void 0)&&n.push(I)}),n}determineMovementType(e){const t=e.toLowerCase(),n=t.includes(";")?t.substring(t.indexOf(";")).trim():"";return n.includes("cut")||n.includes("rough")||n.includes("finish")||n.includes("facing")||n.includes("turn")?0:n.includes("retract")||n.includes("return")||n.includes("safe")?2:1}calculateDynamicScaleFactor(e,t){let n=0,s=0,c=e.find(k=>!k.isRelative),d=c&&c.x?c.x:0,B=c&&c.z?c.z:0;const l=5;e.forEach(k=>{k.x!==void 0&&(k.isRelative?(d+=k.x,d<s&&(s=d)):k.x<s&&(s=k.x)),k.z!==void 0&&(k.isRelative?(B+=k.z,B>n&&(n=B)):k.z>n&&(n=k.z))});const v=Math.abs(s),b=Math.abs(n),f=t.height/2-l,y=t.width-l-fe,I=f/v,L=y/b;return Math.min(I,L)}draw(e,t,n,s,c=!0,d=!0){if(this.ctx=e.getContext("2d"),!this.ctx)return;this.ctx.clearRect(0,0,e.width,e.height),this.currentX=0,this.currentZ=0,this.absX=0,this.absZ=0,this.previousCanvasX=e.height/2,this.previousCanvasZ=e.width-fe;let B=this.stockDiameterInMM;const l=document.createElement("canvas");l.width=e.width,l.height=e.height,this.drawStockOnCanvas(l,B,n);const v=s!==void 0?Math.min(s+1,t.length):t.length;for(let b=0;b<v;b++)t[b].isRelative?(this.currentX+=t[b].x??0,this.currentZ+=t[b].z??0):(this.currentX=t[b].x??this.absX,this.currentZ=t[b].z??this.absZ,this.absX=this.currentX,this.absZ=this.currentZ),this.canvasX=e.height/2-this.currentX*n,this.canvasZ=e.width-this.currentZ*n-fe,t[b].movementType===0&&c&&this.removeStockMaterial(l,n),this.previousCanvasX=this.canvasX,this.previousCanvasZ=this.canvasZ;this.ctx.drawImage(l,0,0),this.currentX=0,this.currentZ=0,this.absX=0,this.absZ=0,this.previousCanvasX=e.height/2,this.previousCanvasZ=e.width-fe,this.drawReferenceLines(e);for(let b=0;b<v;b++)this.drawLinesCommand(e,t[b],n,b===(s??-1),c,d)}drawStockOnCanvas(e,t,n){const s=e.getContext("2d");if(!s)return;s.lineWidth=2;let c=t*n/2;const d=0,B=e.height/2-c,l=t*n,v=e.width;s.beginPath(),s.rect(d,B,v,l),s.fillStyle="lightgrey",s.fill(),s.strokeStyle="#666666",s.stroke()}drawReferenceLines(e){const t=e.getContext("2d");t&&(t.beginPath(),t.moveTo(0,e.height/2),t.lineTo(e.width,e.height/2),t.strokeStyle="blue",t.setLineDash([5,5]),t.stroke(),t.beginPath(),t.moveTo(e.width-fe,0),t.lineTo(e.width-fe,e.height),t.strokeStyle="#888888",t.setLineDash([5,5]),t.stroke(),t.setLineDash([]))}removeStockMaterial(e,t){const n=e.getContext("2d");if(!n)return;const s=()=>{const d=2*t,B=this.canvasZ-this.previousCanvasZ,l=this.canvasX-this.previousCanvasX,v=Math.sqrt(B*B+l*l);n.globalCompositeOperation="destination-out",n.fillStyle="black",v<.001||Math.abs(B)<.001?(n.beginPath(),n.rect(this.canvasZ,this.canvasX,d,e.height-this.canvasX),n.fill()):(n.beginPath(),n.moveTo(this.previousCanvasZ,this.previousCanvasX),n.lineTo(this.canvasZ,this.canvasX),n.lineTo(this.canvasZ+d,this.canvasX),n.lineTo(this.previousCanvasZ+d,this.previousCanvasX),n.closePath(),n.fill(),n.beginPath(),n.moveTo(this.previousCanvasZ,this.previousCanvasX),n.lineTo(this.canvasZ,this.canvasX),n.lineTo(this.canvasZ,e.height),n.lineTo(this.previousCanvasZ,e.height),n.closePath(),n.fill(),n.beginPath(),n.moveTo(this.canvasZ+d,this.canvasX),n.lineTo(this.previousCanvasZ+d,this.previousCanvasX),n.lineTo(this.previousCanvasZ+d,e.height),n.lineTo(this.canvasZ+d,e.height),n.closePath(),n.fill()),n.globalCompositeOperation="source-over"};s(),n.save(),n.scale(1,-1),n.translate(0,-e.height),s(),n.restore()}drawLinesCommand(e,t,n,s,c,d){if(this.ctx=e.getContext("2d"),!this.ctx)return;this.ctx.lineWidth=2,t.isRelative?(this.currentX+=t.x??0,this.currentZ+=t.z??0):(this.currentX=t.x??this.absX,this.currentZ=t.z??this.absZ,this.absX=this.currentX,this.absZ=this.currentZ),this.canvasX=e.height/2-this.currentX*n,this.canvasZ=e.width-this.currentZ*n-fe;let B="";if((t.movementType==0&&c||t.movementType==1&&d||t.movementType==2&&d)&&(this.ctx.beginPath(),B=t.movementType==0?Gs:t.movementType==1?As:_s,this.ctx.moveTo(this.previousCanvasZ,this.previousCanvasX),this.ctx.lineTo(this.canvasZ,this.canvasX),s?(this.ctx.strokeStyle=B,this.ctx.setLineDash([5,5]),this.ctx.lineDashOffset=0,this.ctx.stroke(),this.ctx.strokeStyle=Js,this.ctx.setLineDash([5,5]),this.ctx.lineDashOffset=-5,this.ctx.stroke()):(this.ctx.strokeStyle=B,this.ctx.setLineDash([]),this.ctx.stroke()),s)){let l=this.canvasZ-this.previousCanvasZ,v=this.canvasX-this.previousCanvasX,b=Math.atan2(v,l);this.ctx.save(),this.ctx.translate(this.previousCanvasZ,this.previousCanvasX),this.ctx.rotate(b+Math.PI/2),this.ctx.beginPath(),this.ctx.moveTo(0,-5),this.ctx.lineTo(-5,5),this.ctx.lineTo(5,5),this.ctx.closePath(),this.ctx.fillStyle="green",this.ctx.fill(),this.ctx.restore(),this.ctx.beginPath(),this.ctx.rect(this.canvasZ-3,this.canvasX-3,6,6),this.ctx.fillStyle="red",this.ctx.fill()}this.previousCanvasX=this.canvasX,this.previousCanvasZ=this.canvasZ}drawStock(e,t,n){if(this.ctx=e.getContext("2d"),!this.ctx)return;this.ctx.lineWidth=2;let s=t*n/2;const c=e.width-fe-e.width,d=e.height/2-s,B=t*n,l=e.width;this.ctx.beginPath(),this.ctx.rect(c,d,l,B),this.ctx.fillStyle="lightgrey",this.ctx.fill(),this.ctx.strokeStyle="#666666",this.ctx.setLineDash([]),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(0,e.height/2),this.ctx.lineTo(e.width,e.height/2),this.ctx.strokeStyle="blue",this.ctx.setLineDash([5,5]),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e.width-fe,0),this.ctx.lineTo(e.width-fe,e.height),this.ctx.strokeStyle="#888888",this.ctx.setLineDash([5,5]),this.ctx.stroke(),this.ctx.setLineDash([])}}const K=ace.edit("gcodeEditor"),Se=ace.edit("gcodeResponseEditor"),ee=ace.edit("gcodeSenderEditor");document.addEventListener("DOMContentLoaded",()=>{new ho;const o=new zs;let e=[];const t=document.getElementById("gcodeCanvas"),n=document.getElementById("zoomCanvas"),s=document.getElementById("fileInput"),c=document.getElementById("simulateButton"),d=document.getElementById("showCuts"),B=document.getElementById("showNonCuts"),l=document.getElementById("showCutsZoom"),v=document.getElementById("showNonCutsZoom"),b=document.getElementById("sliderLabel"),f=document.getElementById("zoomSliderLabel"),y=document.getElementById("progressSlider"),I=document.getElementById("zoomProgressSlider"),L=document.getElementById("sliderContainer"),w=document.getElementById("displayOptionsContainer"),k=document.getElementById("clearButton"),S=document.querySelector(".saveGCodeNameInput"),R=document.querySelector(".loadGCodeSelect"),z=document.querySelector(".loadGCodeButton"),a=document.querySelector(".saveGCodeButton"),u=document.querySelector(".deleteGCodeButton"),m=document.getElementById("gcodeSenderContainer"),r=document.getElementById("exampleCode"),i=document.getElementById("helpModal"),h=document.getElementById("helpButton"),p=document.getElementById("closeHelpModal"),T=document.getElementById("zoomModal"),F=document.getElementById("zoomButton"),D=document.getElementById("closeZoomModal"),$=document.getElementById("zoomCloseButton"),G=document.getElementById("simulationTab"),j=document.getElementById("controlTab"),_=document.getElementById("quickTasksTab"),le=document.getElementById("plannerTab"),he=document.getElementById("helpTab"),V=document.getElementById("connectionContainer"),W=document.getElementById("simulationContainer"),de=document.getElementById("controlsContainer"),ce=document.getElementById("quickTasksContainer"),ge=document.getElementById("plannerContainer"),Ne=document.getElementById("helpContainer"),kt=document.querySelectorAll("#latheControls .increment-btn"),Zt=document.getElementById("moveDistance");localStorage.getItem("helpModalShown")||(i.style.display="block",localStorage.setItem("helpModalShown","true")),kt.forEach(function(E){E.addEventListener("click",function(){kt.forEach(function(X){X.classList.remove("active")}),this.classList.add("active");var N=this.dataset.increment;Zt.value=N,localStorage.setItem("moveDistance",N)})}),G.addEventListener("click",()=>{W.style.display="flex",de.style.display="none",ce.style.display="none",ge.style.display="none",V.style.display="none",Ne.style.display="none"}),j.addEventListener("click",()=>{W.style.display="none",de.style.display="flex",ce.style.display="none",ge.style.display="none",V.style.display="block",Ne.style.display="none"}),_.addEventListener("click",()=>{W.style.display="none",de.style.display="none",ce.style.display="flex",ge.style.display="none",V.style.display="block",Ne.style.display="none"}),le.addEventListener("click",()=>{W.style.display="none",de.style.display="none",ce.style.display="none",ge.style.display="flex",V.style.display="block",Ne.style.display="none";const E=new Event("containerVisible");ge.dispatchEvent(E)}),he.addEventListener("click",()=>{W.style.display="none",de.style.display="none",ce.style.display="none",ge.style.display="none",V.style.display="none",Ne.style.display="flex"}),n.width=window.visualViewport.width-100,n.height=window.visualViewport.height-150,window.addEventListener("resize",function(){n.width=window.visualViewport.width-100,n.height=window.visualViewport.height-150,I.value=I.min,Qe(n)}),F.onclick=function(){T.style.display="block",Qe(n)},D.onclick=function(){T.style.display="none"},$.onclick=function(){T.style.display="none"},h.onclick=function(){i.style.display="block"},p.onclick=function(){i.style.display="none"},window.onclick=function(E){E.target==i&&(i.style.display="none"),E.target==T&&(T.style.display="none")},a.addEventListener("click",()=>yt()),z.addEventListener("click",()=>bt()),u.addEventListener("click",()=>Gt()),g(),K.setTheme("ace/theme/github_dark"),K.session.setMode("ace/mode/plain_text"),K.setShowPrintMargin(!1),ee.setTheme("ace/theme/github_dark"),ee.session.setMode("ace/mode/plain_text"),ee.setShowPrintMargin(!1),r.addEventListener("click",()=>U()),Se.setTheme("ace/theme/monokai"),Se.session.setMode("ace/mode/text"),Se.setReadOnly(!0),Se.setShowPrintMargin(!1),Se.getSession().on("change",()=>{setTimeout(()=>{var E=Se.getSession().getLength();Se.scrollToLine(E,!0,!0,function(){})},0)}),ee.on("focus",()=>{ee.getValue()==="Paste your gcode here or click choose file to upload"&&ee.setValue("")}),P(),y.oninput=()=>{const E=Math.floor(parseInt(y.value));if(E<e.length){const N=e[E];let X=o.calculateDynamicScaleFactor(e,t);o.draw(t,e,X,E,d.checked,B.checked),O(N)}},I.oninput=()=>{const E=Math.floor(parseInt(I.value));if(E<e.length){const N=e[E];let X=o.calculateDynamicScaleFactor(e,n);o.draw(n,e,X,E,l.checked,v.checked),q(N)}},k.addEventListener("click",()=>{ee.setValue(""),K.setValue(""),P();const E=t.getContext("2d");E&&(E.clearRect(0,0,t.width,t.height),s.value="",y.value="0",I.value="0",L.style.display="none",w.style.display="none")}),s.addEventListener("change",E=>{if(E.target instanceof HTMLInputElement&&E.target.files&&E.target.files.length>0){const N=E.target.files[0];N&&Y(N)}}),c.addEventListener("click",()=>{Qe(t)});function Qe(E){if(!E)return;const N=K.getValue();if(N){e=o.parseGCode(N);let X=o.calculateDynamicScaleFactor(e,E);o.draw(E,e,X,void 0,d.checked,B.checked),L.style.display="block",w.style.display="block",d.addEventListener("change",A),B.addEventListener("change",A),l.addEventListener("change",ke),v.addEventListener("change",ke),y.max=(e.length-1).toString(),y.value=y.min,I.max=(e.length-1).toString(),I.value=I.min,m.style.display="block"}}function yt(){const E=S.value.trim();if(!E)return;const N=`gCode-${E}`;localStorage.setItem(N,K.getValue()),g(N),S.value=""}function bt(){const E=R.value,N=localStorage.getItem(E);N&&(K.setValue(N),ee.setValue(N))}function Gt(){const E=R.value;localStorage.removeItem(E),g()}function g(E){R.innerHTML="";let N=!1;for(let X=0;X<localStorage.length;X++){const Z=localStorage.key(X);if(Z&&Z!=="latheCode"&&Z.startsWith("gCode-")){N=!0;const te=document.createElement("option"),At=Z.replace("gCode-","");te.value=Z,te.textContent=At,R.appendChild(te),Z===E&&(te.selected=!0)}}if(N){const X=Array.from(R.options).sort((Z,te)=>Z.text.localeCompare(te.text));R.innerHTML="",X.forEach(Z=>{R.appendChild(Z)})}else{const X=document.createElement("option");X.textContent="No items saved",X.disabled=!0,R.appendChild(X)}}function P(){const E=K.getValue(),N=ee.getValue();E===""&&(K.setValue("Paste your gcode here or click choose file to upload"),K.gotoLine(1,0),K.on("focus",function(){K.getValue()==="Paste your gcode here or click choose file to upload"&&K.setValue("")})),N===""&&(ee.setValue("Paste your gcode here or click choose file to upload"),ee.gotoLine(1,0),ee.on("focus",function(){ee.getValue()==="Paste your gcode here or click choose file to upload"&&ee.setValue("")}))}function O(E){var N,X,Z;(E==null?void 0:E.lineNumber)!==void 0?(K.gotoLine(E.lineNumber,0,!0),b.innerHTML=`Line:${E.lineNumber}<br>${E==null?void 0:E.originalLine}<br>Abs: X${((N=E.absolutePosition)==null?void 0:N.x)??0} &lpar;Dia: ${(((X=E.absolutePosition)==null?void 0:X.x)??0)*2}&rpar; Z${(Z=E.absolutePosition)==null?void 0:Z.z}`||""):b.innerHTML=""}function q(E){var N,X,Z;(E==null?void 0:E.lineNumber)!==void 0?(K.gotoLine(E.lineNumber,0,!0),f.innerHTML=`Line:${E.lineNumber}<br>${E==null?void 0:E.originalLine}<br>Abs: X${(N=E.absolutePosition)==null?void 0:N.x} &lpar;Dia: ${(((X=E.absolutePosition)==null?void 0:X.x)??0)*2}&rpar; Z${(Z=E.absolutePosition)==null?void 0:Z.z}`||""):f.innerHTML=""}function Y(E){const N=new FileReader;N.onload=X=>{const Z=X.target.result;K.setValue(Z),ee.setValue(Z)},N.readAsText(E)}function A(){l.checked=d.checked,v.checked=B.checked,y.value="0";const E=o.calculateDynamicScaleFactor(e,t);o.draw(t,e,E,void 0,d.checked,B.checked)}function ke(){d.checked=l.checked,B.checked=v.checked,I.value="0";const E=o.calculateDynamicScaleFactor(e,n);o.draw(n,e,E,void 0,l.checked,v.checked)}function U(){K.setValue(go)}});

</script>
  <style>
:root{font-family:Inter,system-ui,Avenir,Helvetica,Arial,sans-serif;line-height:1.5;font-weight:400;color-scheme:light dark;color:#ffffffde;background-color:#202124;font-synthesis:none;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}a{font-weight:500;color:#646cff;text-decoration:inherit}a:hover{color:#535bf2}h1{font-size:3.2em;line-height:1.1}table{width:100%;display:flex;flex-direction:column}thead,tr{display:flex;width:100%}th:first-child,td:first-child{flex:0 0 60px}th:last-child,td:last-child{flex:0 0 60px}th:not(:first-child):not(:last-child),td:not(:first-child):not(:last-child){flex:1}hr{width:100%;border:none;border-top:1px solid #ffffff;margin:10px 0}#app{max-width:1280px;margin:0 auto;padding:2rem;text-align:center}.logo{height:6em;padding:1.5em;will-change:filter;transition:filter .3s}.logo:hover{filter:drop-shadow(0 0 2em #646cffaa)}.logo.vanilla:hover{filter:drop-shadow(0 0 2em #3178c6aa)}.card{padding:2em}.read-the-docs{color:#888}button{border-radius:3px;padding:.6em 1.2em;font-size:1em;font-weight:500;font-family:inherit;background-color:#1a1a1a;cursor:pointer;transition:background-color .25s;border:2px solid white;color:#fff}button:hover{background-color:#646cff}button:focus,button:focus-visible{outline:4px auto -webkit-focus-ring-color}input[readonly]{cursor:not-allowed;background-color:#2f4f4f;border-color:#767676}.disabled-button{background-color:red;cursor:not-allowed}.interaction-ready-button{background-color:green}.interaction-ready-warn-button{background-color:red}.icon-container{width:60px;height:50px;padding:5px 10px}.icon-container svg{width:100%;height:100%}#simulationContainer{display:flex;flex-direction:column;width:800px;max-width:1280px;text-align:center}.main-container{display:flex;width:100%}#interactiveComponentsContainer,#controlsContainer,#quickTasksContainer{display:flex;flex-direction:column;width:800px;max-width:1280px;text-align:center}button.quick-tasks-innercontainer{display:flex;align-items:center;cursor:pointer;background:none;border:none;padding:0;margin:5px 0;border:1px solid #ccc;border-radius:5px;background-color:#333;flex-direction:column;justify-content:center;width:100%;box-sizing:border-box}button.quick-tasks-innercontainer:hover{background-color:#6c5ce7}button.execute{padding:0 10px;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;margin:0 auto}input.quick-task-summary{width:auto;box-sizing:border-box}.tooltip-icon{display:inline-flex;margin-left:5px;cursor:help;color:#fff;font-weight:700;font-size:16px;position:relative;width:18px;height:18px;border:2px solid #ffffff;border-radius:50%;align-items:center;justify-content:center;text-align:center;vertical-align:middle}.tooltip-icon:hover:after{content:attr(data-tooltip);position:absolute;background-color:#333;color:#fff;padding:5px;border-radius:5px;white-space:nowrap;z-index:10;top:100%;left:50%;transform:translate(-50%)}.quick-tasks-subinnercontainer{display:flex;flex-direction:row}.controls-container,.connection-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;border:1px solid #ccc}.canvas-container{display:flex;flex-direction:column;align-items:center;margin:5px;border:1px solid #ccc}.canvas-wrapper{display:flex;flex-direction:column;align-items:center}.innerContainer{margin:5px;align-items:center;width:auto}.modal-pad{padding-top:10px}.modal-pad-bottom{padding-bottom:10px}.modal-pad-bottom-flex{padding-bottom:10px;flex:1;display:flex;flex-direction:column}.emulation-modal-pad-border{padding:10px;border:2px dashed green;min-height:40px}.innerContainer.toolbar{display:flex;align-items:center;gap:5px;padding:2px}.saveGCodeNameInput,.loadGCodeSelect{flex-grow:1}#gcodeCanvas{border-bottom:1px solid #ccc;background-color:#242424}#gcodeInput{position:relative;background:transparent;width:100%;height:240px;font-family:monospace;font-size:13px;line-height:1.5;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}#gcodeContainer{position:relative;width:100%}#gcodeSenderContainer{display:block}.save-group,.load-group,.import-export-group{display:flex;flex-direction:row;align-items:center;gap:10px}.toolbar input[type=text],.toolbar select{max-width:200px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem;font-size:1rem;line-height:1.5}input[type=file]::file-selector-button{border:2px solid #6c5ce7;padding:.2em .4em;border-radius:.2em;background-color:#1a1a1a;transition:.25s}input[type=file]::-ms-browse:hover{background-color:#646cff}input[type=file]::-webkit-file-upload-button:hover{background-color:#646cff}input[type=file]::file-selector-button:hover{background-color:#646cff}.bottom-container{margin:5px}#gcodeResponseContainer{border:1px solid #ccc;width:100%;display:flex;flex-direction:column;align-items:center;margin-top:5px}.senderError{display:none;color:#fff;background-color:red;padding:10px;border-radius:5px;animation:flashError 1s infinite}@keyframes flashError{0%,to{opacity:1}50%{opacity:0}}#helpText li{margin-bottom:10px}#helpText a{color:#f95959}.help-modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.help-modal-content{position:relative;background-color:#242424;margin:15% auto;padding:20px;border:2px solid #6c5ce7;width:30%}.zoom-modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#242424}.zoom-modal-content{display:flex;flex-direction:column;align-items:center;margin:10px auto;padding:20px;border:1px solid #888}.close-modal{position:absolute;top:0;right:0;padding-right:10px;cursor:pointer;font-size:35px}#sliderAndButtonContainer{display:flex;justify-content:center;align-items:center;gap:10px;flex-direction:column}.text-red{color:#dc143c}.text-green{color:#6b8e23}.text-orange{color:orange}.line{display:inline-block;vertical-align:middle;width:20px;height:2px;margin-right:5px}.red-line{border-top:2px solid #DC143C}.green-line{border-top:2px solid #6B8E23}.orange-line{border-top:2px solid #FFA500}#latheControls #jogControls{display:grid;grid-template-columns:repeat(12,60px);grid-template-rows:repeat(6,60px);justify-content:center;align-items:center;place-items:center}#latheControls .jog-btn{width:50px;height:50px;border-radius:5px;cursor:pointer;background-color:#f0ad4e;display:flex;justify-content:center;align-items:center;text-align:center;line-height:50px;font-size:24px;padding:0}#latheControls .tool-btn{width:50px;height:50px;border-radius:5px;cursor:pointer;background-color:#379126;display:flex;justify-content:center;align-items:center;text-align:center;line-height:20px;font-size:12px;padding:0}#latheControls .tool-btn:hover{background-color:#6c5ce7}#latheControls .tool{background-color:#f0ad4e;border:none}#latheControls .tool-selected{background-color:#6c5ce7;border:2px solid white}#latheControls .fast{background-color:#2196f3}#latheControls .slow{background-color:#4caf50}#latheControls .jog-btn:hover{background-color:#6c5ce7}.jog-btn,.jog-labels{grid-column:var(--col);grid-row:var(--row)}.tool-label{grid-column:var(--col) / span 2;grid-row:var(--row);font-size:18px;align-self:end}.tool-select{width:100px;height:50px;border-radius:5px;cursor:pointer;background-color:#004b8b;text-align:center;font-size:20px;padding:0 16px 0 0;appearance:none;-webkit-appearance:none;-moz-appearance:none;border:none;display:flex;justify-content:center;align-items:center;border:2px solid white;grid-column:var(--col) / span 2;grid-row:var(--row);background-image:url("data:image/svg+xml;utf8,<svg fill='white' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");background-repeat:no-repeat;background-position:right -8px center;background-size:30px}.tool-select:after{content:"▼";position:absolute;right:5px;top:50%;transform:translateY(-50%);font-size:12px;pointer-events:none}.tool-select option{background-color:#202124;color:#ffffffde;text-align:center}.tool-select:focus{outline:none;box-shadow:0 0 3px #f0ad4e}.tool-edit{width:100px;height:50px;border-radius:5px;cursor:pointer;background-color:#004b8b;text-align:center;font-size:18px;appearance:none;-webkit-appearance:none;-moz-appearance:none;border:none;display:flex;justify-content:center;align-items:center;border:2px solid white;grid-column:var(--col) / span 2;grid-row:var(--row)}.tool-btn{grid-column:var(--col);grid-row:var(--row)}.tool-save-button{padding:0;border:none;background:none;cursor:pointer;display:flex;align-items:center;justify-content:center;width:100%}.tool-save-button:hover{background-color:#0000001a;border-radius:3px}.tool-cell{flex:0 0 60px;padding:4px;border-bottom:1px solid #444}.data-cell{flex:1;padding:4px;border-bottom:1px solid #444}.action-cell{flex:0 0 60px;padding:4px;border-bottom:1px solid #444}.tool-cell input{width:100%;padding:4px;text-align:center;background-color:#333;border:1px solid #444}.data-cell input{width:100%;padding:4px;text-align:right;border:1px solid #444}.menu ul{list-style-type:none;padding:0}.menu li{cursor:pointer;padding:10px;background-color:#242424;border-bottom:1px solid #6c5ce7}.menu li:hover{background-color:#6c5ce7}.content{margin-left:200px;padding:20px}#senderProgressContainer{display:flex;justify-content:center;align-items:center}#senderProgressLabel{margin-right:10px}.innerContentCentre{display:flex;justify-content:center;align-items:center;margin:10px}#gcodeSenderContainer{position:relative;width:100%}#latheControls #incrementControls{display:flex;justify-content:center;gap:10px;margin:20px 0}#latheControls .increment-btn{padding:5px 10px;border:1px solid #ccc;background-color:#3a3d3d;border-radius:5px;cursor:pointer;transition:background-color .3s}#latheControls .increment-btn:hover,#latheControls .increment-btn.active{background-color:#6c5ce7}.control-inputs input[type=text]{max-width:200px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem}.control-inputs label{display:block;margin-right:5px}.sender-inputs input[type=text]{max-width:350px;min-width:350px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem}.gcode-dropdown{position:absolute;max-height:200px;overflow-y:auto;border:1px solid #ccc;background:var(--background-color, #fff);z-index:1000;border-radius:4px;box-shadow:0 2px 4px #0000001a}.gcode-option{padding:8px 12px;cursor:pointer;color:inherit;background-color:#202124}.gcode-option:hover{filter:brightness(1.2)}#latheControls label{white-space:nowrap;margin-right:10px;display:inline-block;min-width:120px}#plannerContainer{display:flex;flex-direction:column;width:800px;max-width:1280px;text-align:center}.planner-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;border:1px solid #ccc}.planner-container h1{margin:10px 0}.planner-guidance{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:10px;text-align:center}.planner-guidance span{display:block;margin:10px 0;text-align:left}#taskContainer{display:flex;justify-content:space-between;align-items:start;padding:20px}.container-wrapper{padding:10px}.container-wrapper-inner{padding:5px 0}.container-wrapper-outer{border:1px solid #ccc;border-radius:5px;margin:10px;background-color:#333}.container-wrapper-delete{min-height:50px;display:flex;justify-content:center;align-items:center;border:2px dashed red}#availableTasks{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;align-items:start;min-width:450px}#availableTasks .span-2-rows{grid-row:span 3;height:100%}#availableTasks div{box-sizing:border-box;padding:5px}#tasksToExecute{min-height:50px;padding:5px;border:2px dashed green}#tasksToExecute div{margin:5px}.task-to-execute{text-align:left}.task-to-execute i{text-align:left;margin-left:5px;cursor:help}.available-task{width:150px;-webkit-user-select:none;user-select:none}.available-task i{margin-left:5px;cursor:help}.task-manual{background-color:#4c956c}.task-gcode{background-color:#386e97}.task-emulation{background-color:#e74c3c}.emulate-noselect{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#emulationInnerContainer{display:flex;flex-direction:row;justify-content:center;align-items:center;height:100%}#emulationNewTasksMovement{display:grid;grid-template-columns:repeat(9,40px);grid-template-rows:repeat(3,40px);gap:3px;align-items:center;justify-items:center}#emulationNewTasksNumbers,#emulationNewTasksOther{display:grid;grid-template-columns:repeat(2,40px);grid-template-rows:repeat(6,40px);gap:3px;align-items:center;justify-items:center}#emulationNewTasksMode{display:grid;grid-template-columns:repeat(8,40px);grid-template-rows:repeat(1,40px);gap:3px;align-items:center;justify-items:center}#movementContainer,#modeContainer{width:100%;display:flex;justify-content:center;align-items:center;margin:5px;padding:5px}#emulateKeyUp{grid-area:1 / 2}#emulateKeyDown{grid-area:3 / 2}#emulateKeyLeft{grid-area:2 / 1}#emulateKeyRight{grid-area:2 / 3}#emulateKeyPlay{grid-area:1 / 5}#emulateKeyStop{grid-area:3 / 5}#emulateKeyStopUp{grid-area:1 / 8}#emulateKeyStopDown{grid-area:3 / 8}#emulateKeyStopLeft{grid-area:2 / 7}#emulateKeyStopRight{grid-area:2 / 9}#emulationNewTasksMode button.material-symbols-outlined{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksMode button:hover{background-color:#18a79b}#emulationNewTasksMode button:focus,#emulationNewTasksMode button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksMovement button.material-symbols-outlined{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksMovement button:hover{background-color:#18a79b}#emulationNewTasksMovement button:focus,#emulationNewTasksMovement button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksNumbers button{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700;font-family:monospace}#emulationNewTasksNumbers button:hover{background-color:#18a79b}#emulationNewTasksNumbers button:focus,#emulationNewTasksNumbers button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksOther button{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksOther button:hover{background-color:#18a79b}#emulationNewTasksOther button:focus,#emulationNewTasksOther button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}.emulated-button-list{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700!important}.standard-font{font-family:monospace!important}#emulationNewTasks{list-style-type:none;display:grid;grid-template-columns:repeat(11,1fr);grid-auto-rows:auto;gap:10px;padding:0;margin:0}#emulateKeySteps{transform:scaleX(-1)}.flexCol{display:flex;flex-direction:column;align-items:center;justify-content:center}.outerCol{padding-top:15px}.middleCol{align-self:flex-start}.task-container{margin:5px}.task-container>div,.gu-mirror{transition:opacity .4s ease-in-out}.task-container>div{padding:5px;cursor:move;cursor:grab;cursor:-moz-grab;cursor:-webkit-grab;display:flex;align-items:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.gu-mirror{padding:5px;text-align:center;cursor:grabbing;cursor:-moz-grabbing;cursor:-webkit-grabbing}.task-container .ex-moved{background-color:#e74c3c}.task-container.ex-over{background-color:#ffffff4d}.planner-save-text{max-width:none!important}.planner-save-button{flex:auto}.planner-load-select{max-width:none!important}.planner-load-delete-buttons{width:50%}.planner-saving-label{text-wrap:nowrap}.no-marge{margin:0}.task-modal{z-index:9999;display:none;position:fixed;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.task-modal-content{position:relative;background-color:#242424;margin:15% auto;padding:20px;border:2px solid #6c5ce7;max-width:600px;min-width:600px;display:flex;flex-direction:column}.full-width-textarea{width:100%;box-sizing:border-box;resize:vertical}.center-modal{text-align:center}.left-modal{text-align:left!important;display:block}.icon-tooltip{position:relative;cursor:pointer}.icon-tooltip:after{content:attr(data-tooltip);position:absolute;bottom:100%;left:50%;transform:translate(-50%);white-space:nowrap;z-index:1;background-color:#000;color:#fff;padding:5px;border-radius:4px;opacity:0;visibility:hidden;transition:opacity .2s,visibility .2s}.icon-tooltip:hover:after{opacity:1;visibility:visible}.threading-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;width:800px;max-width:1280px;text-align:center;border:1px solid #ccc}.gu-mirror{position:fixed!important;margin:0!important;z-index:9999!important;opacity:.8}.gu-hide{display:none!important}.gu-unselectable{-webkit-user-select:none!important;-moz-user-select:none!important;-ms-user-select:none!important;user-select:none!important}.gu-transit{opacity:.2}

</style>
</head>

<body>

    <div id="mainContainer" class="main-container">
        <div class="menu">
            <ul>
                <li id="simulationTab">Simulation</li>
                <li id="controlTab">Control</li>
                <li id="quickTasksTab">Quick Tasks</li>
                <li id="plannerTab">Planner</li>
                <li id="helpTab">Help</li>
            </ul>
        </div>

        <div id="simulationContainer" class="main-container">
            <div id="simulationContent" class="controls-container">
                <div id="gcodeContainer" style="position: relative;">
                    <div id="gcodeEditor" style="height: 200px; width: 100%;"></div>
                </div>
                <div class="innerContainer">
                    <input type="file" id="fileInput" accept=".txt,.gcode">
                </div>
                <div class="innerContainer">
                    <button id="simulateButton">Simulate</button>
                    <button id="clearButton">Clear</button>
                    <button id="helpButton">How to use</button>
                </div>


                <div class="innerContainer" id="loadAndSave">


                    <hr>
                    <div class="innerContainer toolbar">
                        <input type="text" class="saveGCodeNameInput" placeholder="name of save"></input>
                        <button class="saveGCodeButton" title="Save GCode to local browser storage">Save local</button>
                    </div>
                    <div class="innerContainer toolbar">
                        <select class="loadGCodeSelect"></select>
                        <button class="loadGCodeButton" title="Load GCode from local browser storage">Load</button>
                        <button class="deleteGCodeButton" title="Delete GCode from local browser storage">Delete</button>
                    </div>
                    <hr>
                </div>
            </div>

            <div class="canvas-container">
                <canvas id="gcodeCanvas" width="785" height="600"></canvas>
                <div id="sliderContainer" class="innerContainer" style="display: none; width: 400px;">
                    <input type="range" id="progressSlider" min="0" max="100" value="0" style="width: 100%;">
                    <div id="sliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                </div>
                <div id="displayOptionsContainer" class="innerContainer" style="display: none;">
                    <label>
                        <input type="checkbox" id="showStock" checked> Show Stock
                    </label>
                    <label>
                        <input type="checkbox" id="showCuts" checked> Show Cut Moves
                    </label>
                    <label>
                        <input type="checkbox" id="showNonCuts" checked>
                        Show Non-Cut Moves
                    </label>
                </div>
                <div id="sliderContainer" class="innerContainer" style="display: none; width: 400px;">
                    <input type="range" id="progressSlider" min="0" max="100" value="0" style="width: 100%;">
                    <div id="sliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                </div>
                <div class="innerContainer"><button id="zoomButton" title="Zoom in">Zoom In</button></div>
            </div>

        </div>

        <div id="interactiveComponentsContainer" class="main-container">
            <div id="connectionContainer" class="connection-container" style="display: none;">
                <div class="innerContainer">
                    <button id="connectButton" title="Connect to Nano ELS H4">Connect</button>
                </div>
            </div>
            <div id="controlsContainer" class="main-container" style="display: none;">
                <div id="controlsContent" class="controls-container">

                    <div id="latheControls">
                        <div id="jogControls">

                            <span id="toolText" class="tool-label" style="--col: 1; --row: 1">Current Tool</span>

                            <!-- Tools -->
                            <select class="tool-select" style="--col: 1; --row: 2" id="toolSelector">
                                <option value="T0">T0</option>
                                <option value="T1">T1</option>
                                <option value="T2">T2</option>
                                <option value="T3">T3</option>
                                <option value="T4">T4</option>
                                <option value="T5">T5</option>
                                <option value="T6">T6</option>
                                <option value="T7">T7</option>
                                <option value="T8">T8</option>
                                <option value="T9">T9</option>
                                <option value="T10">T10</option>
                                <option value="T11">T11</option>
                                <option value="T12">T12</option>
                                <option value="T13">T13</option>
                                <option value="T14">T14</option>
                                <option value="T15">T15</option>
                                <option value="T16">T16</option>
                                <option value="T17">T17</option>
                                <option value="T18">T18</option>
                                <option value="T19">T19</option>
                                <option value="T20">T20</option>
                                <option value="T21">T21</option>
                                <option value="T22">T22</option>
                                <option value="T23">T23</option>
                                <option value="T24">T24</option>
                                <option value="T25">T25</option>
                                <option value="T26">T26</option>
                                <option value="T27">T27</option>
                                <option value="T28">T28</option>
                                <option value="T29">T29</option>
                            </select>

                            <button class="tool-edit" style="--col: 1; --row: 3;" id="editToolsButton">Edit
                                Tools</button>

                            <button class="tool-btn change-tool" style="--col: 3; --row: 2;" id="toolChange">Change
                                Tool</button>

                            <span id="jogText" class="jog-labels" style="--col: 7; --row: 1">X</span>
                            <span id="fastText" class="jog-labels" style="--col: 6; --row: 2">Fast</span>
                            <span id="slowText" class="jog-labels" style="--col: 6; --row: 3">Slow</span>
                            <button class="arrow fast jog-btn" style="--col: 7; --row: 2" id="fastForward">
                                <i class="fas fa-arrow-up"></i></button>
                            <button class="arrow fast jog-btn" style="--col: 7; --row: 6" id="fastBackward">
                                <i class="fas fa-arrow-down"></i></button>
                            <span id="jogText" class="jog-labels" style="--col: 4; --row: 4">Z</span>
                            <button class="arrow fast jog-btn" style="--col: 5; --row: 4" id="fastLeft">
                                <i class="fas fa-arrow-left"></i></button>
                            <button class="arrow fast jog-btn" style="--col: 9; --row: 4" id="fastRight">
                                <i class="fas fa-arrow-right"></i></button>
                            <button class="arrow slow jog-btn" style="--col: 7; --row: 3" id="slowForward">
                                <i class="fas fa-arrow-up"></i></button>
                            <button class="arrow slow jog-btn" style="--col: 7; --row: 5" id="slowBackward">
                                <i class="fas fa-arrow-down"></i></button>
                            <button class="arrow slow jog-btn" style="--col: 6; --row: 4" id="slowLeft">
                                <i class="fas fa-arrow-left"></i></button>
                            <button class="arrow slow jog-btn" style="--col: 8; --row: 4" id="slowRight">
                                <i class="fas fa-arrow-right"></i></button>
                            <span id="jogText" class="jog-labels" style="--col: 11; --row: 1">Y</span>
                            <button class="arrow fast jog-btn" style="--col: 11; --row: 2" id="fastUp">
                                <i class="fas fa-arrow-up"></i></button>
                            <button class="arrow fast jog-btn" style="--col: 11; --row: 6" id="fastDown">
                                <i class="fas fa-arrow-down"></i></button>
                            <button class="arrow slow jog-btn" style="--col: 11; --row: 3" id="slowUp">
                                <i class="fas fa-arrow-up"></i></button>
                            <button class="arrow slow jog-btn" style="--col: 11; --row: 5" id="slowDown">
                                <i class="fas fa-arrow-down"></i></button>


                        </div>
                        <div id="incrementControls">
                            <button class="increment-btn" data-increment="0.01">0.01</button>
                            <button class="increment-btn" data-increment="0.1">0.1</button>
                            <button class="increment-btn active" data-increment="1">1</button>
                            <button class="increment-btn" data-increment="10">10</button>
                        </div>
                        <div id="feedrateControls" class="innerContentCentre control-inputs">
                            <label for="fastFeedrate">Fast Feedrate:</label>
                            <input type="text" id="fastFeedrate" name="fastFeedrate" value="200">
                            <label for="slowFeedrate">Slow Feedrate:</label>
                            <input type="text" id="slowFeedrate" name="slowFeedrate" value="50">
                        </div>
                        <div id="distanceControl" class="innerContentCentre control-inputs">
                            <label for="moveDistance">Move Distance (mm):</label>
                            <input type="text" id="moveDistance" name="moveDistance" value="1">
                        </div>
                    </div>

                    <div id="gcodeResponseContainer" style="display: none;">
                        <div id="gcodeResponseHeader">GCode Responses</div>
                        <div id="gcodeResponseEditor" style="height: 200px; width: 100%;"></div>
                        <div class="senderError" style="display: none;"></div>
                        <div id="senderProgressContainer">
                            <span id="senderProgressLabel" style="display: none;">Progress...</span>
                            <progress id="senderProgress" max="1" style="display: none;"></progress>
                        </div>
                    </div>
                </div>
                <div class="controls-container">
                    <div class="innerContainer control-inputs">
                        <div class="innerContentCentre control-inputs">
                            <span>Send single command</span>
                        </div>
                        <div class="innerContentCentre sender-inputs">
                            <input id="singleCommandSender" type="text" name="singleCommandSender" autocomplete="off"></input>
                            <div class="innerContentCentre control-inputs">
                                <button id="gcodeSendSingleCommandButton" title="Send GCode to CNC">Send</button>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="controls-container">
                    <div id="gcodeSenderContainer" style="position: relative;">
                        <span>Send multi line commands</span>
                        <div id="gcodeSenderEditor" style="height: 200px; width: 100%;"></div>
                    </div>
                    <div class="innerContainer">
                        <button id="gcodeSenderButton" title="Send GCode to CNC">Send</button>
                        <button id="stopButton" style="display: none;">Stop</button>
                    </div>
                </div>
            </div>
            <div id="quickTasksContainer" class="main-container" style="display: none;">
                <div id="quickTasksContent" class="controls-container">
                    <div class="innerContainer">
                        <h1>Quick Tasks</h1>
                        <button id="quickTaskFacingButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- L-shape -->
                                        <path d="M5 45 L35 45 L35 5" fill="none" stroke="white" stroke-width="3" />

                                        <!-- Arrow stem -->
                                        <line x1="50" y1="45" x2="50" y2="10" stroke="white" stroke-width="3" />

                                        <!-- Arrow head -->
                                        <path d="M42 17 L50 5 L58 17 Z" fill="white" />
                                    </svg>
                                </div>
                                <p>Facing / Parting</p>
                            </div>
                        </button>
                        <button id="quickTaskProfilingButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Rotated L-shape -->
                                        <path d="M55 5 L5 5 L5 35" fill="none" stroke="white" stroke-width="3" />

                                        <!-- Arrow stem -->
                                        <line x1="22" y1="30" x2="50" y2="30" stroke="white" stroke-width="3" />

                                        <!-- Arrow head (filled) -->
                                        <path d="M22 22 L10 30 L22 38 Z" fill="white" />
                                    </svg>
                                </div>
                                <p>Profiling</p>
                            </div>
                        </button>
                        <button id="quickTaskDrillingButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Top and bottom horizontal lines -->
                                        <line x1="5" y1="18" x2="50" y2="18" stroke="white" stroke-width="2"></line>
                                        <line x1="5" y1="32" x2="50" y2="32" stroke="white" stroke-width="2"></line>
                                        
                                        <!-- Pointed tip at left -->
                                        <line x1="5" y1="18" x2="0" y2="25" stroke="white" stroke-width="2"></line>
                                        <line x1="5" y1="32" x2="0" y2="25" stroke="white" stroke-width="2"></line>
                                        
                                        <!-- Diagonal flute lines -->
                                        <line x1="10" y1="18" x2="15" y2="32" stroke="white" stroke-width="2"></line>
                                        <line x1="20" y1="18" x2="25" y2="32" stroke="white" stroke-width="2"></line>
                                        <line x1="30" y1="18" x2="35" y2="32" stroke="white" stroke-width="2"></line>
                                        <line x1="40" y1="18" x2="45" y2="32" stroke="white" stroke-width="2"></line>
                                    </svg>
                                </div>
                                <p>Drilling</p>
                            </div>
                        </button>
                        <button id="quickTaskBoringButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Correctly rotated squared U-shape (90° clockwise) -->
                                        <path d="M55 5 L5 5 L5 45 L55 45" fill="none" stroke="white" stroke-width="3" />

                                        <!-- Arrow stem -->
                                        <line x1="22" y1="25" x2="42" y2="25" stroke="white" stroke-width="3" />

                                        <!-- Arrow head (filled) -->
                                        <path d="M22 17 L10 25 L22 33 Z" fill="white" />
                                    </svg>
                                </div>
                                <p>Boring</p>
                            </div>
                        </button>
                        <button id="quickTaskGroovingButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 60">
                                        <!-- U-shape rotated correctly (facing up) -->
                                        <path d="M5 55 L5 5 L45 5 L45 55" fill="none" stroke="white" stroke-width="3" />

                                        <!-- Arrow stem -->
                                        <line x1="25" y1="45" x2="25" y2="15" stroke="white" stroke-width="3" />

                                        <!-- Arrow head (filled) -->
                                        <path d="M17 22 L25 10 L33 22 Z" fill="white" />
                                    </svg>
                                </div>
                                <p>Grooving</p>
                            </div>
                        </button>

                        <button id="quickTaskConeButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Sideways trapezoid -->
                                        <path d="M10 5 L50 15 L50 35 L10 45 Z" fill="none" stroke="white"
                                            stroke-width="3" />
                                    </svg>
                                </div>
                                <p>Cone</p>
                            </div>
                        </button>

                        <button id="quickTaskThreadingButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Background rectangle -->
                                        <!--<rect x="0" y="7.5" width="60" height="35" fill="#e0e0e0"></rect> -->

                                        <!-- Thread lines -->
                                        <line x1="6" y1="41.7" x2="18" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <line x1="15" y1="41.7" x2="27" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <line x1="24" y1="41.7" x2="36" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <line x1="33" y1="41.7" x2="45" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <line x1="42" y1="41.7" x2="54" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <!-- Corrected start of thread -->
                                        <line x1="-3" y1="41.7" x2="9" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <!-- Corrected end of thread -->
                                        <line x1="51" y1="41.7" x2="63" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                    </svg>
                                </div>
                                <p>Threading</p>
                            </div>
                        </button>
                        <button id="quickTaskToolOffsetsButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Left arrow (pointing up) - thicker shaft -->
                                        <line x1="7.5" y1="45" x2="7.5" y2="10" stroke="white" stroke-width="3" />
                                        <path d="M4 13 L7.5 7.5 L11 13 Z" fill="white" />

                                        <!-- Bottom arrow (pointing right) - thicker shaft -->
                                        <line x1="6" y1="44" x2="50" y2="44" stroke="white" stroke-width="3" />
                                        <path d="M48 40.5 L53.5 44 L48 47.5 Z" fill="white" />

                                        <!-- Gear shifted up 1 unit -->
                                        <path
                                            d="M28 9 L31 9 L32.5 13 L35 14.5 L39 11.5 L40.5 14 L38 18 L39.5 20.5 L43.5 22 L43.5 25 L39.5 26.5 L38 29 L40.5 33 L39 35.5 L35 32.5 L32.5 34 L31 38 L28 38 L26.5 34 L24 32.5 L20 35.5 L18.5 33 L21 29 L19.5 26.5 L15.5 25 L15.5 22 L19.5 20.5 L21 18 L18.5 14 L20 11.5 L24 14.5 L26.5 13 L28 9 M29.5 18 A5 5 0 0 0 29.5 29 A5 5 0 0 0 29.5 18"
                                            fill="white" />
                                    </svg>
                                </div>
                                <p>Tool Offsets</p>
                            </div>
                        </button>
                    </div>
                </div>
            </div>

            <div id="plannerContainer" class="main-container" style="display: none;">
                <div id="plannerContent" class="planner-container">
                    <div class="innerContainer">
                        <h1>Planner</h1>
                        <div class="planner-guidance">
                            <span>Use this tool to create a job of tasks to execute. This can be manual, gcode, button
                                press
                                emulation or a
                                combination
                                of them.
                                When you click execute the job wizard will execute the tasks one after another. Each
                                task
                                with require confirmation to start.</span>
                        </div>
                    </div>
                    <div id="taskContainer">
                        <div class="container-wrapper-outer">
                            <div class="container-wrapper">
                                <h2>Current Job</h2>
                                <span>Drag an available task to below</span>
                                <div id="tasksToExecute" class="task-container">
                                </div>
                            </div>
                            <div class="container-wrapper">
                                <button id="executeJobButton">Execute Job</button>
                            </div>
                            <hr>
                            <div class="container-wrapper">
                                <div class="innerContainer" id="loadAndSaveJob">
                                    <div class="innerContainer toolbar">
                                        <button id="saveJobButton" class="planner-save-button" title="Save Job to local browser storage">Save
                                            Job</button>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <button id="newJobButton" class="planner-save-button" title="Create a new job">New
                                            Job</button>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <button id="loadJobButton" class="planner-load-delete-buttons" title="Load Job from local browser storage">Load</button>
                                        <button id="deleteJobButton" class="planner-load-delete-buttons" title="Delete Job from local browser storage">Delete</button>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <span class="planner-saving-label">Project:</span>
                                        <select id="projectLoadSelect" class="planner-load-select">
                                        </select>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <span class="planner-saving-label">Group:</span>
                                        <select id="groupLoadSelect" class="planner-load-select">
                                        </select>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <span class="planner-saving-label">Job:</span>
                                        <select id="jobLoadSelect" class="planner-load-select">
                                        </select>
                                    </div>
                                    <div class="container-wrapper-inner">
                                        <hr>
                                    </div>
                                    <span class="planner-saving-label">Import and export Job to JSON</span>
                                    <div class="innerContainer toolbar">
                                        <button id="importJobButton" class="planner-load-delete-buttons" title="Import Job from JSON file">Import</button>
                                        <button id="exportJobButton" class="planner-load-delete-buttons" title="Export Job to JSON">Export</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="container-wrapper-outer">
                            <div class="container-wrapper">
                                <h2>Available Tasks</h2>
                                <div id="availableTasks" class="task-container">
                                </div>
                            </div>
                            <div class="container-wrapper">
                                <div class="container-wrapper-inner">
                                    <span>Drag here to delete</span>
                                </div>
                                <div id="deleteTasks" class="container-wrapper-delete">
                                </div>
                            </div>
                            <div class="container-wrapper">
                                <button id="addNewTaskButton">Add New Task</button>
                            </div>
                            <div class="container-wrapper-inner">
                                <hr class="no-marge">
                            </div>
                            <div class="container-wrapper">
                                <div class="innerContainer" id="loadAndSaveAvailableTasks">
                                    <div><span>Task Collections</span></div>
                                    <div class="innerContainer toolbar">
                                        <button id='saveAvailableTaskCollection' class="planner-save-button" title="Save Task to local browser storage">Save tasks to a collection
                                            <i class="far fa-save show-info icon-tooltip"
                                                data-tooltip="Save to local machine"></i>
                                        </button>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <select id="availableTaskCollections" class="planner-load-select">
                                            <option value="" disabled>Select your option</option>
                                        </select>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <button id="loadTaskCollection" class="planner-load-delete-buttons" title="Load selected collection">Load collection</button>
                                        <button id="deleteTaskCollection" class="planner-load-delete-buttons" title="Delete selected collection">Delete collection</button>
                                    </div>
                                    <div class="container-wrapper-inner">
                                        <hr>
                                    </div>
                                    <span class="planner-saving-label">Import and export tasks via JSON</span>
                                    <div class="innerContainer toolbar">
                                        <button id="importAvailableTasks" class="planner-load-delete-buttons" title="Import tasks from JSON file">Import</button>
                                        <button id="exportAvailableTasks" class="planner-load-delete-buttons" title="Export tasks to JSON">Export</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="helpContainer" class="main-container" style="display: none;">
                <div id="helpContent" class="controls-container">
                    <div class="innerContainer">
                        <h1>Help Page</h1>
                        <p>Some functionality offered by this tool is not present on the Nano ELS h4/h5 controller by default such as gcode threading and tool offsets. Please see my custom firmware page to download my fork of the firmware: </p>
                        <p><a href="https://github.com/Festivejelly/nanoels/blob/main/h4/h4.ino" target="_blank">Github
                                Repo</a></p>
                    </div>
                </div>
            </div>

        </div>

        <!-------------------------------- Modals------------------------------->
        <!-- Edit Tool Modal -->
        <div id="editToolsModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Edit Tools</h2>
                <div class="modal-pad-bottom-flex">
                    <div class="modal-pad-bottom-flex">
                        <table class="table-auto flex-1">
                            <thead>
                                <tr class="flex w-full">
                                    <th class="flex-none w-16 p-1 text-left border-b">
                                        Tool
                                    </th>
                                    <th class="flex-1 p-1 text-left border-b">
                                        <div class="leading-tight">
                                            Z Position<br>Offset
                                        </div>
                                    </th>
                                    <th class="flex-1 p-1 text-left border-b">
                                        <div class="leading-tight">
                                            Z Cut<br>Compensation
                                        </div>
                                    </th>
                                    <th class="flex-1 p-1 text-left border-b">
                                        <div class="leading-tight">
                                            X Position<br>Offset
                                        </div>
                                    </th>
                                    <th class="flex-1 p-1 text-left border-b">
                                        <div class="leading-tight">
                                            X Cut<br>Compensation
                                        </div>
                                    </th>
                                    <th class="flex-none w-16 p-1 text-left border-b">
                                        Action
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="toolOffsetTableBody">
                                <!-- Rows will be dynamically inserted here -->
                            </tbody>
                        </table>
                    </div>
                    <div class="modal-pad-bottom-flex">
                        <button id="editToolSaveAll" class="execute" title="Save Offsets for tool">
                            <div class="icon-container">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50">
                                    <!-- Outer disk shape -->
                                    <path d="M10 5 L40 5 L45 10 L45 40 L40 45 L10 45 L5 40 L5 10 Z" fill="none"
                                        stroke="white" stroke-width="2" />

                                    <!-- Inner rectangle (disk label) -->
                                    <rect x="15" y="5" width="20" height="15" fill="none" stroke="white"
                                        stroke-width="2" />

                                    <!-- Center circle (represents disk hole) -->
                                    <circle cx="25" cy="30" r="8" fill="none" stroke="white" stroke-width="2" />
                                </svg>
                            </div>
                            <Span>Save All</Span>
                        </button>
                    </div>
                </div>
                <div class="modal-pad">
                    <button id="editToolsModalCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Facing Modal-->
        <div id="quickTaskFacingModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Facing / Parting</h2>
                <div class="modal-pad-bottom">
                    <span id="quickTaskFacingDescription" class="left-modal">This task will perform a facing or parting operation based off of your current position to the centreline</span>
                </div>
                <div class="modal-pad-bottom">
                    <!-- Current position -->
                    <label for="quickTaskFacingCurrentPosition">Current Position</label>
                    <input type="text" id="quickTaskFacingCurrentPosition" name="quickTaskFacingCurrentPosition" placeholder="0" readonly>
                    <button id="quickTaskFacingRefreshPositionButton" title="Refresh current position">Refresh</button>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskFacingFeedrate">Feed Rate (mm/m)</label>
                    <input type="text" id="quickTaskFacingFeedrate" name="quickTaskFacingFeedrate" placeholder="10" value="10">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskFacingTravelFeedRate">Travel/Retract Feed Rate (mm/m)</label>
                    <input type="text" id="quickTaskFacingTravelFeedRate" name="quickTaskFacingTravelFeedRate" placeholder="200" value="200">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskFacingUsePecking">Use pecking?</label>
                    <input type="checkbox" id="quickTaskFacingUsePecking" name="quickTaskFacingUsePecking" checked>
                </div>
                <div id="quickTaskFacingPeckingDepthContainer">
                    <div class="modal-pad-bottom">
                        <label for="quickTaskFacingPeckingDepth">Depth per peck (mm)</label>
                        <input type="text" id="quickTaskFacingPeckingDepth" name="quickTaskFacingPeckingDepth" placeholder="0.5" value="0.5">
                    </div>
                    <div class="modal-pad-bottom">
                        <label for="quickTaskFacingPeckingRetractionRate">Fully retract tool after this many cuts</label>
                        <input type="number" id="quickTaskFacingPeckingRetractionRate" name="quickTaskFacingPeckingRetractionRate" placeholder="3" value="3" min="1" step="1" oninput="this.value = this.value.replace(/[^0-9]/g, ''); if(this.value === '') this.value = '1';">
                    </div>
                </div>
                <div class="modal-pad-bottom">
                    <hr>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskFacingEndDiameter">End Diameter (mm)
                          <span class="tooltip-icon"
                            data-tooltip="Default is centreline which is 0">?</span>
                    </label>
                    <input type="text" id="quickTaskFacingEndDiameter" name="quickTaskFacingEndDiameter" placeholder="0" value="0">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskFacingExecuteButton" class="execute interaction-ready-button" title="Execute facing command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="white" />
                        </svg>
                    </button>
                    <button id="quickTaskFacingStopButton" class="execute interaction-ready-warn-button" title="Stop facing command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="white" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskFacingCopyToClipboardButton" class="interaction-ready-button" title="Copy command to clipboard">
                        Copy command<br>to clipboard
                    </button>
                </div>
                <div class="modal-pad-bottom" style="display: none;">
                    <span id="quickTaskFacingLabel">Execution in progress...</span>
                    <progress id="quickTaskFacingProgressBar" max="1"></progress>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskFacingCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Profiling Modal-->
        <div id="quickTaskProfilingModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Profiling Quick Task</h2>
                <div class="modal-pad-bottom">
                    <!-- Current position -->
                    <label for="quickTaskProfilingCurrentPosition">Current Position</label>
                    <input type="text" id="quickTaskProfilingCurrentPosition" name="quickTaskProfilingCurrentPosition" placeholder="0" readonly>
                    <button id="quickTaskProfilingRefreshPositionButton" title="Refresh current position">Refresh</button>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingLength">Length to profile (mm)</label>
                    <input type="text" id="quickTaskProfilingLength" name="quickTaskProfilingLength" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingFeedRate">Cutting Feed rate</label>
                    <input type="text" id="quickTaskProfilingFeedRate" name="quickTaskProfilingFeedRate" placeholder="100">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingRetractFeedRate">Retract Feed rate</label>
                    <input type="text" id="quickTaskProfilingRetractFeedRate" name="quickTaskProfilingRetractFeedRate" placeholder="200" value="200">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingType">Profiling Type
                        <span class="tooltip-icon"
                            data-tooltip="Absolute cuts to a specified diameter. Relative cuts to a specified depth.">?</span>
                    </label>
                    <select id="quickTaskProfilingType" name="quickTaskProfilingType">
                        <option value="Absolute" selected>Absolute</option>
                        <option value="Relative">Relative</option>
                    </select>
                </div>
                <div class="modal-pad-bottom" id="quickTaskProfilingFinalDiameterContainer">
                    <label for="quickTaskProfilingFinalDiameter">Final Diameter</label>
                    <input type="number" id="quickTaskProfilingFinalDiameter" name="quickTaskProfilingFinalDiameter" placeholder="1">
                </div>
                <div class="modal-pad-bottom" id="quickTaskProfilingDepthContainer" style="display: none;">
                    <label for="quickTaskProfilingDepth">Depth of cut (mm)</label>
                    <input type="number" id="quickTaskProfilingDepth" name="quickTaskProfilingDepth" placeholder="1">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingPasses">Passes
                        <span class="tooltip-icon" data-tooltip="This value is calculated">?</span>
                    </label>
                    <input type="number" id="quickTaskProfilingPasses" name="quickTaskProfilingPasses" placeholder="4" value="4" min="1" step="1">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingDepthPerPass">Depth Per Pass (mm)
                        <span class="tooltip-icon"
                            data-tooltip="This value might get adjusted if the depth isnt devisible exactly by this value">?</span>
                    </label>
                    <input type="number" id="quickTaskProfilingDepthPerPass" name="quickTaskProfilingDepthPerPass" placeholder="0.2" value="0.2">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingFinishingDepth">Depth of finishing pass (mm)
                    </label>
                    <input type="number" id="quickTaskProfilingFinishingDepth" name="quickTaskProfilingFinishingDepth" placeholder="0.1" value="0.1">
                </div>
                <div class="modal-pad-bottom">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskProfilingExecuteButton" class="execute disabled-button" title="Execute profiling command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="white" />
                        </svg>
                    </button>
                    <button id="quickTaskProfilingStopButton" class="execute interaction-ready-warn-button" title="Stop profiling command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="white" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskProfilingCopyToClipboardButton" class="disabled-button" title="Copy command to clipboard" disabled>
                        Copy command<br>to clipboard
                    </button>
                </div>
                <div class="modal-pad-bottom" style="display: none;">
                    <span id="quickTaskProfilingLabel">Execution in progress...</span>
                    <progress id="quickTaskProfilingProgressBar" max="1"></progress>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskProfilingCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Drilling Modal-->
        <div id="quickTaskDrillingModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Drilling Task</h2>
                <div class="modal-pad-bottom">
                    <label for="quickTaskDrillingDepth">Drilling Depth (mm)</label>
                    <input type="text" id="quickTaskDrillingDepth" name="quickTaskDrillingDepth" placeholder="10">
                </div>

                <div class="modal-pad-bottom">
                    <label for="quickTaskDrillingFeedRate">Drilling Feed Rate</label>
                    <input type="text" id="quickTaskDrillingFeedRate" name="quickTaskDrillingFeedRate" placeholder="50" value="50">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskDrillingRetractFeedRate">Retract Feed Rate</label>
                    <input type="text" id="quickTaskDrillingRetractFeedRate" name="quickTaskDrillingRetractFeedRate" placeholder="200" value="200">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskDrillingPeckCheckbox">Peck Drilling</label>
                    <input type="checkbox" id="quickTaskDrillingPeckCheckbox" name="quickTaskDrillingPeckCheckbox" value="Pecking">
                </div>

                <div class="modal-pad-bottom" id="quickTaskDrillingPeckingDepthContainer" style="display: none;">
                    <label for="quickTaskDrillingPeckingDepth">Pecking Depth (mm)</label>
                    <input type="text" id="quickTaskDrillingPeckingDepth" name="quickTaskDrillingPeckingDepth" placeholder="2" value="2">
                </div>

                <div class="modal-pad-bottom">
                    <button id="quickTaskDrillingExecuteButton" class="execute disabled-button" title="Execute drilling command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="white" />
                        </svg>
                    </button>
                    <button id="quickTaskDrillingStopButton" class="execute interaction-ready-warn-button" title="Stop drilling command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="white" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskDrillingCopyToClipboardButton" class="disabled-button" title="Copy command to clipboard" disabled>
                        Copy command<br>to clipboard
                    </button>
                </div>
                <div class="modal-pad-bottom" style="display: none;">
                    <span id="quickTaskDrillingLabel">Execution in progress...</span>
                    <progress id="quickTaskDrillingProgressBar" max="1"></progress>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskDrillingCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Boring Modal-->
        <div id="quickTaskBoringModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Boring Quick Task</h2>
                <div class="modal-pad-bottom">
                    <!-- Current position -->
                    <label for="quickTaskBoringCurrentPosition">Current Position</label>
                    <input type="text" id="quickTaskBoringCurrentPosition" name="quickTasBoringCurrentPosition" placeholder="0" readonly>
                    <button id="quickTaskBoringRefreshPositionButton" title="Refresh current position">Refresh</button>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskBoringDepth">Boring Hole Depth (mm)</label>
                    <input type="text" id="quickTaskBoringDepth" name="quickTaskBoringDepth" placeholder="50">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskBoringFeedRate">Cut Feed Rate</label>
                    <input type="text" id="quickTaskBoringFeedRate" name="quickTaskBoringFeedRate" placeholder="100">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskBoringRetractFeedRate">Retract Feed Rate</label>
                    <input type="text" id="quickTaskBoringRetractFeedRate" name="quickTaskBoringRetractFeedRate" placeholder="200" value="200">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskBoringType">Boring Type
                        <span class="tooltip-icon"
                            data-tooltip="Absolute cuts to a specified diameter. Relative cuts to a specified depth.">?</span>
                    </label>
                    <select id="quickTaskBoringType" name="quickTaskBoringType">
                        <option value="Absolute" selected>Absolute</option>
                        <option value="Relative">Relative</option>
                    </select>
                </div>
                <div class="modal-pad-bottom" id="quickTaskBoringFinalDiameterContainer">
                    <label for="quickTaskBoringFinalDiameter">Final Diameter</label>
                    <input type="number" id="quickTaskBoringFinalDiameter" name="quickTaskBoringFinalDiameter" placeholder="1">
                </div>
                <div class="modal-pad-bottom" id="quickTaskBoringDepthOfCutContainer" style="display: none;">
                    <label for="quickTaskBoringDepthOfCut">Depth of cut (mm)</label>
                    <input type="number" id="quickTaskBoringDepthOfCut" name="quickTaskBoringDepthOfCut" placeholder="1">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskBoringPasses">Passes
                        <span class="tooltip-icon" data-tooltip="This value is calculated">?</span>
                    </label>
                    <input type="number" id="quickTaskBoringPasses" name="quickTaskBoringPasses" placeholder="1" value="4" min="1" step="1">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskBoringDepthPerPass">Max Depth Per Pass (mm)
                        <span class="tooltip-icon"
                            data-tooltip="This value might get adjusted if the depth isnt devisible exactly by this value">?</span>
                    </label>
                    <input type="number" id="quickTaskBoringDepthPerPass" name="quickTaskBoringDepthPerPass" placeholder="0.2" value="0.2">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskBoringFinishingDepth">Depth of finishing pass (mm)
                    </label>
                    <input type="number" id="quickTaskBoringFinishingDepth" name="quickTaskBoringFinishingDepth" placeholder="0.1" value="0.1">
                </div>
                <div class="modal-pad-bottom">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskBoringExecuteButton" class="execute disabled-button" title="Execute Boring command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="white" />
                        </svg>
                    </button>
                    <button id="quickTaskBoringStopButton" class="execute interaction-ready-warn-button" title="Stop boring command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="white" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskBoringCopyToClipboardButton" class="disabled-button" title="Copy command to clipboard" disabled>
                        Copy command<br>to clipboard
                    </button>
                </div>
                <div class="modal-pad-bottom" style="display: none;">
                    <span id="quickTaskBoringProgressBarLabel">Execution in progress...</span>
                    <progress id="quickTaskBoringProgressBar" max="1"></progress>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskBoringCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Grooving Modal-->
        <div id="quickTaskGroovingModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Grooving Modal</h2>
                <div class="modal-pad-bottom">
                    <label for="quickTaskGroovingDepth">Depth of groove in mm:</label>
                    <input type="text" id="quickTaskGroovingDepth" name="quickTaskGroovingDepth" placeholder="50">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskGroovingWidth">Width of groove in mm:</label>
                    <input type="text" id="quickTaskGroovingWidth" name="quickTaskGroovingWidth" placeholder="50">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskGroovingFeedRate">Cut Feed rate</label>
                    <input type="text" id="quickTaskGroovingFeedRate" name="quickTaskGroovingFeedRate" placeholder="200" value="200">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskGroovingRetractFeedRate">Retract Feed rate</label>
                    <input type="text" id="quickTaskGroovingRetractFeedRate" name="quickTaskGroovingRetractFeedRate" placeholder="200" value="200">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskGroovingExecuteButton" class="execute" title="Execute grooving command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="green" />
                        </svg>
                    </button>
                    <button id="quickTaskGroovingStopButton" class="execute interaction-ready-warn-button" title="Stop grooving command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="red" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskGroovingCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Cone Modal-->
        <div id="quickTaskConeModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Quick Task: Cone</h2>
                <div class="modal-pad-bottom">
                    <label for="coneStartingDepth">Starting Depth (radius mm)</label>
                    <input type="text" id="coneStartingDepth" name="coneStartingDepth" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <label for="coneEndingDepth">Ending Depth (radius mm)</label>
                    <input type="text" id="coneEndingDepth" name="coneEndingDepth" placeholder="0.2">
                </div>
                <div class="modal-pad-bottom">
                    <label for="coneInternalExternal">External or Internal</label>
                    <select id="coneInternalExternal" name="coneInternalExternal">
                        <option value="External">External</option>
                        <option value="Internal">Internal</option>
                    </select>
                </div>
                <div class="modal-pad-bottom">
                    <label for="coneLength">Length</label>
                    <input type="text" id="coneLength" name="coneLength" placeholder="1">
                </div>
                <div class="modal-pad-bottom">
                    <label for="conePasses">Passes</label>
                    <input type="text" id="conePasses" name="conePasses" placeholder="1">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskConeExecuteButton" class="execute" title="Execute cone command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="green" />
                        </svg>
                    </button>
                    <button id="quickTaskConeStopButton" class="execute interaction-ready-warn-button" title="Stop cone command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="red" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskConeCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Threading Modal-->
        <div id="quickTaskThreadingModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Threading Quick Task</h2>

                <div class="modal-pad-bottom">
                    <span id="quickTaskThreadingDescription">The threading task will automatically cut a thread based on the outer diameter spec of the thread.<br>
                        The beginning of the thread length will start from your current position</span>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskThreadingExternalOrInternal">External or Internal</label>
                    <select id="quickTaskThreadingExternalOrInternal" name="quickTaskThreadingExternalOrInternal">
                        <option value="External" selected>External</option>
                        <option value="Internal">Internal</option>
                    </select>
                </div>

                <div class="modal-pad-bottom">
                    <label for="quickTaskThreadingType">Threading Type</label>
                    <select id="quickTaskThreadingType" name="quickTaskThreadingType">
                        <option value="Metric" selected>Metric</option>
                        <option value="UNC">UNC</option>
                        <option value="Custom" disabled>Custom</option>
                    </select>
                </div>

                <div class="modal-pad-bottom">
                    <label for="quickTaskThreadingSize">Thread Size</label>
                    <select id="quickTaskThreadingSize" name="quickTaskThreadingSize" disabled>
                        <option value="">Select Thread Size</option>
                    </select>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskThreadingDirection">Thread Direction</label>
                    <select id="quickTaskThreadingDirection" name="quickTaskThreadingDirection">
                        <option value="Right" selected>Right handed thread</option>
                        <option value="Left">Left handed thread</option>
                    </select>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskThreadingLength">Thread Length (mm)</label>
                    <input type="text" id="quickTaskThreadingLength" name="quickTaskThreadingLength" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskThreadingPasses">Number of passes
                        <span class="tooltip-icon"
                        data-tooltip="Automatically calculated based on 0.1mm per pass. But you can set your own passes.">?</span>
                    </label>
                    <input type="text" id="quickTaskThreadingPasses" name="quickTaskThreadingPasses" placeholder="5">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskThreadingExecuteButton" class="execute disabled-button" title="Execute threading command" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="white" />
                        </svg>
                    </button>
                    <button id="quickTaskThreadingStopButton" class="execute interaction-ready-warn-button" title="Stop threading command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="white" />
                        </svg>
                    </button>
                    <div class="modal-pad">
                        <button id="quickTaskThreadingCopyToClipboardButton" class="disabled-button" title="Copy command to clipboard" disabled>
                            Copy command<br>to clipboard
                        </button>
                    </div>
                    <div class="modal-pad-bottom" style="display: none;">
                        <span id="quickTaskThreadingProgressBarLabel">Execution in progress...</span>
                        <progress id="quickTaskThreadingProgressBar" max="1"></progress>
                    </div>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskThreadingCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Tool offsets Modal-->
        <div id="quickTaskToolOffsetsModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Tool offsets wizard</h2>

                <div class="modal-pad-bottom">
                    <p>Before setting offsets be sure your primary tool (T0 which should be a grooving tool) has been zero'ed on your centre line and Z reference. See this video guide: link</p>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskToolOffsetsToolNumber">Tool Number (eg T1)</label>
                    <select type="text" id="quickTaskToolOffsetsToolNumber" name="quickTaskToolOffsetsToolNumber" placeholder="T1">
                    </select>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskToolOffsetsToolType">Tool Type
                        <span class="tooltip-icon"
                            data-tooltip="External tools touch off on front of probe, Internal on the rear.">?</span>
                    </label>
                    <select id="quickTaskToolOffsetsToolType" name="toolOffsetsToolType">
                        <option value="External-Profiling" selected>External: Profiling</option>
                        <option value="External-Facing">External: Facing</option>
                        <option value="External-Grooving">External: Grooving</option>
                        <option value="External-Threading">External: Threading</option>
                        <option value="External-Other">External: Other</option>
                        <option value="Internal-Boring">Internal: Boring</option>
                        <option value="Internal-Grooving">Internal: Grooving</option>
                        <option value="Internal-Threading">Internal: Threading</option>S
                        <option value="Internal-Other">Internal: Other</option>
                        <option value="Drill">Drill</option>
                    </select>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskToolOffsetsOffsetX">X Value</label>
                    <input type="text" id="quickTaskToolOffsetsOffsetX" name="quickTaskToolOffsetsOffsetX" placeholder="0">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskToolOffsetsOffsetZ">Z Value</label>
                    <input type="text" id="quickTaskToolOffsetsOffsetZ" name="quickTaskToolOffsetsOffsetZ" placeholder="0">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskToolOffsetsProbeDiameter">Probe diameter</label>
                    <input type="text" id="quickTaskToolOffsetsProbeDiameter" name="quickTaskToolOffsetsProbeDiameter" placeholder="5">
                </div>
                <div class="modal-pad-bottom">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskToolOffsetsExecuteButton" class="execute" title="Set tool offset">
                        <Span>Set Tool Offset</Span>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="green" />
                        </svg>
                    </button>
                    <button id="quickTaskToolOffsetsStopButton" class="execute interaction-ready-warn-button" title="Stop gcode" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="red" />
                        </svg>
                    </button>
                    <div class="modal-pad-bottom" style="display: none;">
                        <span id="quickTaskToolOffsetsLabel">Execution in progress...</span>
                        <progress id="quickTaskToolOffsetsProgressBar" max="1"></progress>
                    </div>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskToolOffsetsCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Not Connected warning -->
        <div id="notConnectedModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Not Connected</h2>
                <div class="modal-pad-bottom">
                    <span>Please connect to the controller before executing jobs</span>
                </div>
                <div class="modal-pad">
                    <button id="notConnectedCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Manual Task Modal -->
        <div id="manualTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>Manual Task Instructions</h2>
                <hr>
                <div>
                    <span id="manualTaskName"></span>
                </div>
                <div class="modal-pad">
                    <textarea id="manualTaskInstructions" name="manualTaskInstructions" class="full-width-textarea" rows="4" cols="50" disabled></textarea>
                </div>
                <div class="modal-pad">
                    <button id="cancelManualTask">Cancel</button>
                    <button id="completeManualTask" class="interaction-ready-button">Next Task --></button>
                </div>
            </div>
        </div>
        <!-- Gcode Task Modal -->
        <div id="cncTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>CNC Task Gcode</h2>
                <hr>
                <div>
                    <span id="cncTaskName"></span>
                </div>
                <div class="modal-pad">
                    <textarea id="cncTaskGcode" name="cncTaskGcode" class="full-width-textarea" rows="4" cols="50" disabled></textarea>
                </div>
                <div class="modal-pad">
                    <button id="cancelCncTask">Cancel</button>
                    <button id="executeGcode">Execute Gcode</button>
                </div>
                <div class="modal-pad">
                    <button id="completeCncTask" disabled>Next Task --></button>
                </div>
                <div id="currentGcodeLineContainer" class="modal-pad">
                    <span id="currentGcodeLineLabel">Current Gcode Line:</span>
                    <span id="currentGcodeLine"></span>
                </div>
                <div id="currentFeedrateContainer" class="modal-pad">
                    <span id="currentFeedrateLabel">Current Feedrate:</span>
                    <span id="currentFeedrate"></span>
                </div>
                <div id="cncTaskSenderProgressContainer" class="modal-pad">
                    <span id="cncTaskSenderProgressLabel">Execution in progress...</span>
                    <progress id="cncTaskSenderProgress" max="1"></progress>
                </div>
            </div>
        </div>
        <!-- key Emulation Task Modal -->
        <div id="emulationTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>Key Emulation Task</h2>
                <hr>
                <div>
                    <span id="emulationTaskName"></span>
                </div>
                <div class="modal-pad">
                    <ul id="emulationExecutionTasks">
                        <!-- List items will be added here -->
                    </ul>
                    <div class="modal-pad">
                        <button id="completeEmulationTask" disabled>Mark Complete</button>
                    </div>
                    <div id="emulationTaskSenderProgressContainer" class="modal-pad">
                        <span id="emulationTaskSenderProgressLabel">Execution in progress...</span>
                        <progress id="emulationTaskSenderProgress" max="1"></progress>
                    </div>
                </div>
            </div>
        </div>
        <!-- All tasks Complete Modal -->
        <div id="completeTaskModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>All Tasks Complete</h2>
                <div class="modal-pad">
                    <button id="completeTaskCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Job Cancelled Modal -->
        <div id="jobCancelledModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Job Cancelled</h2>
                <div>
                    <button id="jobCancelledCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Save Job Modal -->
        <div id="saveJobModal" class="task-modal">
            <div class="task-modal-content">
                <span id="saveJobModalClose" class="close-modal">&times;</span>
                <h2>Save Job</h2>
                <hr>
                <div class="modal-pad">Project:</div>
                <div>
                    <select id="saveProjectNameSelect">
                    </select>
                </div>
                <div id="newProjectNameContainer" style="display: none;">
                    <div class="modal-pad">New project name:</div>
                    <div>
                        <input id="saveProjectNameInput" type="text" class="planner-save-text" placeholder="Name of Project"></input>
                    </div>
                </div>
                <div class="modal-pad">Group name:</div>
                <div>
                    <select id="saveJobGroupNameSelect">
                    </select>
                </div>
                <div id="newJobGroupNameContainer" style="display: none;">
                    <div class="modal-pad">New group name:</div>
                    <div>
                        <input id="saveJobGroupNameInput" type="text" class="planner-save-text" placeholder="Name of Group"></input>
                    </div>
                </div>
                <div class="modal-pad">Name of Job:</div>
                <div>
                    <select id="saveJobNameSelect">
                    </select>
                </div>
                <div id="newJobNameContainer" style="display: none;">
                    <div class="modal-pad">New Job name:</div>
                    <div>
                        <input id="saveJobNameInput" type="text" class="planner-save-text" placeholder="Name of Job"></input>
                    </div>
                </div>
                <div class="modal-pad">
                    <button id="saveJobSaveButton">Save</button>
                </div>
            </div>
        </div>
        <!-- export Job Modal -->
        <div id="exportJobModal" class="task-modal">
            <div class="task-modal-content">
                <span id="exportJobModalClose" class="close-modal">&times;</span>
                <h2>Export Job</h2>
                <hr>
                <div class="modal-pad">Project:</div>
                <div>
                    <select id="exportJobProjectNameSelect">
                    </select>
                </div>
                <div class="modal-pad">Group:</div>
                <div>
                    <select id="exportJobGroupNameSelect">
                    </select>
                </div>
                <div class="modal-pad">Job:</div>
                <div>
                    <select id="exportJobNameSelect">
                    </select>
                </div>
                <div class="modal-pad">
                    <button id="exportJobSaveButton">Save</button>
                </div>
            </div>
        </div>
        <!-- Save Collection -->
        <div id="saveCollectionModal" class="task-modal">
            <div class="task-modal-content">
                <span id="saveCollectionModalClose" class="close-modal">&times;</span>
                <div>
                    <div>Which collection would you like to save the tasks to?</div>
                    <div class="modal-pad">
                        <select id="saveCollectionModalToSaveTo" name="collectionToSaveToModal">
                        </select>
                    </div>
                    <div id="newCollectionNameContainerModal" style="display: none;">
                        <div class="modal-pad">New Collection Name:</div>
                        <div>
                            <input type="text" id="newCollectionNameModal" name="newCollectionNameModal" placeholder="Enter collection name...">
                        </div>
                    </div>

                    <div class="modal-pad">
                        <button id="saveAvailableTaskCollectionButtonModal">Save</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- new task modal-->
        <div id="newTaskModal" class="task-modal">
            <div class="task-modal-content">
                <span id="closeNewTaskModal" class="close-modal">&times;</span>
                <div id="newTaskHelpText">
                    <h2 id="taskTextTitle">Add a new task</h2>
                    <hr>
                    <div class="modal-pad">Task Name:</div>
                    <div>
                        <input type="text" id="newTaskName" name="newTaskName" placeholder="Enter task name...">
                    </div>
                    <div class="modal-pad">Task Type:</div>
                    <div>
                        <select id="newTaskType" name="newTaskType">
                            <option value="manual">Manual</option>
                            <option value="gcode">GCode</option>
                            <option value="emulation" disabled>Key Emulation</option>
                        </select>
                    </div>
                    <div class="modal-pad">Task Description:</div>
                    <div>
                        <textarea id="newTaskDescription" name="newTaskDescription" class="full-width-textarea" rows="4" cols="50" placeholder="Enter Description..."></textarea>
                    </div>
                    <div id="gcodeTaskContainer" style="display:none">
                        <div class="modal-pad">Task GCode:</div>
                        <div>
                            <textarea id="newTaskGcode" name="newTaskGcode" class="full-width-textarea" rows="4" cols="50" placeholder="Disabled for manual tasks" disabled></textarea>
                        </div>

                        <div class="modal-pad">

                            <label for="newTaskGcodeRepeatable">
                                <input type="checkbox" id="newTaskGcodeRepeatable" name="newTaskGcodeRepeatable">
                                Check to make task repeatable
                            </label>
                        </div>
                    </div>
                    <hr>
                    <div id="emulationOuterContainer" class="emulate-noselect" style="display:none">
                        <div>
                            <span>Use built in controller functions by emulating button presses
                                Simply click the buttons you want to emulate to build up a sequence which will be
                                displayed at the bottom. Each emulated press will have a 500ms delay between them.
                                <br>
                                <br>
                                <i>Tip: Hover over the buttons for a description.</i>
                            </span>
                        </div>
                        <div id="emulationInnerContainer">
                            <div class="flexCol outerCol">
                                <div id="numberContainer">
                                    <div id="emulationNewTasksNumbers">
                                        <button id="emulateKey9" data-button-key="B_9" class="standard-font material-symbols-outlined">
                                            9
                                        </button>
                                        <button id="emulateKey8" data-button-key="B_8" class="standard-font material-symbols-outlined">
                                            8
                                        </button>
                                        <button id="emulateKey7" data-button-key="B_7" class="standard-font material-symbols-outlined">
                                            7
                                        </button>
                                        <button id="emulateKey6" data-button-key="B_6" class="standard-font material-symbols-outlined">
                                            6
                                        </button>
                                        <button id="emulateKey5" data-button-key="B_5" class="standard-font material-symbols-outlined">
                                            5
                                        </button>
                                        <button id="emulateKey4" data-button-key="B_4" class="standard-font material-symbols-outlined">
                                            4
                                        </button>
                                        <button id="emulateKey3" data-button-key="B_3" class="standard-font material-symbols-outlined">
                                            3
                                        </button>
                                        <button id="emulateKey2" data-button-key="B_2" class="standard-font material-symbols-outlined">
                                            2
                                        </button>
                                        <button id="emulateKey1" data-button-key="B_1" class="standard-font material-symbols-outlined">
                                            1
                                        </button>
                                        <button id="emulateKey0" data-button-key="B_0" class="standard-font material-symbols-outlined">
                                            0
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="flexCol middleCol">
                                <div id="modeContainer">
                                    <div id="emulationNewTasksMode">
                                        <button id="emulateKeyBack" data-button-key="B_BACKSPACE" class="material-symbols-outlined">
                                            backspace
                                        </button>
                                        <button id="emulateKeyGearbox" data-button-key="B_MODE_GEARS" class="material-symbols-outlined">
                                            manufacturing
                                        </button>
                                        <button id="emulateKeyTurning" data-button-key="B_MODE_TURN" class="material-symbols-outlined">
                                            reply
                                        </button>
                                        <button id="emulateKeyFacing" data-button-key="B_MODE_FACE" class="material-symbols-outlined">
                                            turn_slight_left
                                        </button>
                                        <button id="emulateKeyCone" data-button-key="B_MODE_CONE" class="material-symbols-outlined">
                                            arrow_forward_ios
                                        </button>
                                        <button id="emulateKeyParting" data-button-key="B_MODE_CUT" class="material-symbols-outlined">
                                            publish
                                        </button>
                                        <button id="emulateKeyThreading" data-button-key="B_MODE_THREAD" class="material-symbols-outlined">
                                            home_improvement_and_tools
                                        </button>
                                        <button id="emulateKeyMode" data-button-key="B_MODE_OTHER" class="standard-font material-symbols-outlined">
                                            M
                                        </button>
                                    </div>
                                </div>
                                <div id="movementContainer">
                                    <div id="emulationNewTasksMovement">
                                        <button id="emulateKeyLeft" data-button-key="B_LEFT" class="material-symbols-outlined">
                                            arrow_left_alt
                                        </button>
                                        <button id="emulateKeyRight" data-button-key="B_RIGHT" class="material-symbols-outlined">
                                            arrow_right_alt
                                        </button>
                                        <button id="emulateKeyUp" data-button-key="B_UP" class="material-symbols-outlined">
                                            arrow_upward_alt
                                        </button>
                                        <button id="emulateKeyDown" data-button-key="B_DOWN" class="material-symbols-outlined">
                                            arrow_downward_alt
                                        </button>
                                        <button id="emulateKeyPlay" data-button-key="B_ON" class="material-symbols-outlined">
                                            play_arrow
                                        </button>
                                        <button id="emulateKeyStop" data-button-key="B_OFF" class="material-symbols-outlined">
                                            crop_square
                                        </button>
                                        <button id="emulateKeyStopLeft" data-button-key="B_STOPL" class="material-symbols-outlined">
                                            keyboard_tab_rtl
                                        </button>
                                        <button id="emulateKeyStopRight" data-button-key="B_STOPR" class="material-symbols-outlined">
                                            keyboard_tab
                                        </button>
                                        <button id="emulateKeyStopUp" data-button-key="B_STOPU" class="material-symbols-outlined">
                                            vertical_align_top
                                        </button>
                                        <button id="emulateKeyStopDown" data-button-key="B_STOPD" class="material-symbols-outlined">
                                            vertical_align_bottom
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="flexCol outerCol">
                                <div id="otherContainer">
                                    <div id="emulationNewTasksOther">
                                        <button id="emulateKeyZ" data-button-key="B_Z" class="standard-font material-symbols-outlined">
                                            Z
                                        </button>
                                        <button id="emulateKeyX" data-button-key="B_X" class="standard-font material-symbols-outlined">
                                            X
                                        </button>
                                        <button id="emulateKeyB" data-button-key="B_B" class="standard-font material-symbols-outlined">
                                            B
                                        </button>
                                        <button id="emulateKeyA" data-button-key="B_A" class="standard-font material-symbols-outlined">
                                            A
                                        </button>
                                        <button id="emulateKeyAngle" data-button-key="B_DISPL" class="material-symbols-outlined" title="Angle/Taco">
                                            rotate_left
                                        </button>
                                        <button id="emulateKeySteps" data-button-key="B_STEPZ" class="material-symbols-outlined">
                                            signal_cellular_alt
                                        </button>
                                        <button id="emulateKeySettings" data-button-key="B_SETTINGS" class="material-symbols-outlined">
                                            settings
                                        </button>
                                        <button id="emulateKeyReverse" data-button-key="B_REVERSE" class="material-symbols-outlined">
                                            sync_alt
                                        </button>
                                        <button id="emulateKeyMeasure" data-button-key="B_MEASURE" class="material-symbols-outlined">
                                            space_bar
                                        </button>
                                        <button id="emulateKeyPlus" data-button-key="B_PLUS" class="standard-font material-symbols-outlined">
                                            +
                                        </button>
                                        <button id="emulateKeyMinus" data-button-key="B_MINUS" class="standard-font material-symbols-outlined">
                                            -
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <span>
                                Emulated sequence: <i>Tip: Drag to reorder or delete</i>
                            </span>
                        </div>
                        <div class="emulation-modal-pad-border">
                            <div id="emulationNewTasks">
                            </div>
                        </div>
                        <div class="modal-pad-bottom">
                            <div id="emulatedTasksDelete" class="container-wrapper-inner">
                                <span>
                                    Drag here to delete
                                </span>
                            </div>
                            <div id="emulatedButtonListDelete" class="container-wrapper-delete">

                            </div>
                        </div>
                    </div>
                    <div class="modal-pad">Collection to save to:</div>
                    <div>
                        <select id="collectionToSaveTo" name="collectionToSaveTo">
                        </select>
                    </div>
                    <div id="newCollectionNameContainer" style="display: none;">
                        <div class="modal-pad">New Collection Name:</div>
                        <div>
                            <input type="text" id="newCollectionName" name="newCollectionName" placeholder="Enter collection name...">
                        </div>
                    </div>
                    <div class="modal-pad">
                        <button id="saveNewTaskButton">Save</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="helpModal" class="help-modal">
            <div class="help-modal-content">
                <span id="closeHelpModal" class="close-modal">&times;</span>
                <div id="helpText">
                    <div>This tool is designed to be used in conjunction with LatheCode:</div>
                    <div><a href="https://kachurovskiy.github.io/lathecode/" target="_blank">https://kachurovskiy.github.io/lathecode/</a></div>
                    <div><strong>Please note that this tool is to be used at your own risk and I cannot gaurentee that
                            it will work. This tool targets my custom fork of the H4 firmware which you can find
                            here:</strong> <a href="https://github.com/Festivejelly/nanoels" target="_blank">https://github.com/Festivejelly/nanoels</a></div>
                    <hr>
                    <div>How to use:</div>
                    <ul style="list-style-type: disc; padding-left: 20px;">
                        <li>Use LatheCode to generate the G-code, then paste it into this tool.</li>
                        <li>You can also write the G-code by hand for simple operations such as boring or grooving.
                            <a href="#" id="exampleCode">Click here</a> to load an example.
                        </li>
                        <li>Click"Simulate" to plot the moves onto the canvas.</li>
                        <li>movement lines marked with"; cut" will show in <span class="line red-line"></span><span class="text-red">red</span>.</li>
                        <li>movement lines marked with"; travel" will show in <span class="line green-line"></span><span class="text-green">green</span>.</li>
                        <li>movement lines marked with"; retract" will show in <span class="line orange-line"></span><span class="text-orange">orange</span>.</li>
                        <li>movement lines not marked will default to <span class="line green-line"></span><span class="text-green">green</span>.</li>
                        <li>All other moves will be considered travel moves and will show in green.</li>
                        <li>Any G-code you paste or write can be saved into the browser's local storage. This is useful for saving common operations.</li>
                        <li>When you're ready, you can send the G-code to the Nano ELS H4 by clicking"Send."
                        </li>
                        <li>More functionality to come soon! Version 0.2</li>
                        <li>Please provide feedback, raise issues or make suggestions here: <a href="https://github.com/Festivejelly/LatheGcodeVisualiser" target="_blank">https://github.com/Festivejelly/LatheGcodeVisualiser</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="zoomModal" class="zoom-modal">
            <div class="zoom-modal-content" style="background-color: #242424;">
                <span id="closeZoomModal" class="close-modal">&times;</span>
                <canvas id="zoomCanvas" width="1600" height="1200"></canvas>
                <div id="sliderAndButtonContainer">
                    <div id="zoomSliderContainer" class="innerContainer" style="width: 400px;">
                        <input type="range" id="zoomProgressSlider" min="0" max="100" value="0" style="width: 100%;">
                        <div id="zoomSliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                    </div>
                    <div id="displayOptionsContainerZoom" class="innerContainer">
                        <label>
                            <input type="checkbox" id="showCutsZoom" checked> Show Cut Moves
                        </label>
                        <label>
                            <input type="checkbox" id="showNonCutsZoom" checked>
                            Show Non-Cut Moves
                        </label>
                    </div>
                    <button id="zoomCloseButton">Close</button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>