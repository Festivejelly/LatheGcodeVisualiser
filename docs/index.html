<!DOCTYPE html>
<html>

<head>
    <title>G-Code Visualizer</title>
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/ace.js"></script>
  <script type="module" crossorigin>
(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))C(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const g of s.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&C(g)}).observe(document,{childList:!0,subtree:!0});function E(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function C(t){if(t.ep)return;t.ep=!0;const s=E(t);fetch(t.href,s)}})();const _="#DC143C",$="#6B8E23";document.addEventListener("DOMContentLoaded",()=>{const r=document.getElementById("gcodeCanvas"),o=r.getContext("2d"),E=document.getElementById("fileInput"),C=document.getElementById("simulateButton"),t=document.getElementById("showCuts"),s=document.getElementById("showNonCuts"),g=document.getElementById("sliderLabel"),d=document.getElementById("progressSlider"),w=document.getElementById("sliderContainer"),X=document.getElementById("displayOptionsContainer"),F=document.getElementById("clearButton"),l=ace.edit("gcodeEditor");l.setTheme("ace/theme/github_dark"),l.session.setMode("ace/mode/plain_text"),l.setShowPrintMargin(!1),N();let x=0,B=0,I=0,M=0,S=0,R=0,z=1,k=0,O=0,v=20,u=[],b=[];F.addEventListener("click",()=>{l.setValue(""),N(),o&&o.clearRect(0,0,r.width,r.height),E.value="",d.value="0",w.style.display="none",X.style.display="none"}),E.addEventListener("change",e=>{if(e.target instanceof HTMLInputElement&&e.target.files&&e.target.files.length>0){const n=e.target.files[0];n&&T(n)}}),C.addEventListener("click",()=>{const e=l.getValue();e&&(b=D(e),Z(b,u),w.style.display="block",X.style.display="block",d.max=u.length.toString(),d.value=d.min,t.addEventListener("change",P),s.addEventListener("change",P),d.oninput=()=>{if(!o)return;const n=Math.floor(parseInt(d.value));if(n<u.length){const a=u[n];Z(b,u,n),V(a)}})});function N(){l.getValue()===""&&(l.setValue("Paste your gcode here or click choose file to upload"),l.gotoLine(1,0),l.on("focus",function(){l.getValue()==="Paste your gcode here or click choose file to upload"&&l.setValue("")}))}function V(e){(e==null?void 0:e.lineNumber)!==void 0?(l.gotoLine(e.lineNumber,0,!0),g.innerHTML=`Line:${e.lineNumber}<br>${e==null?void 0:e.originalLine}`||""):g.innerHTML=""}function T(e){const n=new FileReader;n.onload=a=>{const f=a.target.result;l.setValue(f)},n.readAsText(e)}function D(e){const n=[];let a=!1;return u=[],e.split(`
`).forEach((i,y)=>{const c={isRelative:a,isCut:i.includes("; cut")},m=i.match(/([GXYZF])([0-9.-]+)/g);if(m==null||m.forEach(h=>{const p=parseFloat(h.slice(1));switch(h[0]){case"G":p===90&&(c.isRelative=!1),p===91&&(c.isRelative=!0);break;case"X":c.x=p;break;case"Z":c.z=p;break}}),c.x!==void 0||c.z!==void 0){const h={...c,lineNumber:y+1,originalLine:i};n.push(h),c.isRelative&&u.push(h)}a=c.isRelative}),v=G(u,r.width,r.height),n}function P(){d.value="0",Z(b,u,u.length)}function G(e,n,a){let f=0,i=0,y=0,c=0;e.forEach(L=>{L.isRelative&&(L.x!==void 0&&(f+=L.x),L.z!==void 0&&(i+=L.z)),y=Math.max(y,Math.abs(f)),c=Math.max(c,Math.abs(i))});const m=y,h=c;let p=40;const j=n/m,A=a/h;return Math.min(j,A,p)}function Z(e,n,a){if(!o)return;o.clearRect(0,0,r.width,r.height),x=0,B=0;for(const i of e)if(!i.isRelative)i.x!==void 0&&(S=i.x*v),i.z!==void 0&&(R=i.z*v);else if(i.isRelative)break;I=r.height/2-S,M=r.width-R-z;const f=a!==void 0?Math.min(a+1,n.length):n.length;for(let i=0;i<f;i++)H(n[i])}function H(e){o&&(o.lineWidth=2,e.isRelative&&(x+=e.x??0,B+=e.z??0),k=r.height/2-S-x*v,O=r.width-R-B*v-z,(e.isCut&&t.checked||!e.isCut&&s.checked)&&(o.beginPath(),o.strokeStyle=e.isCut?_:$,o.moveTo(M,I),o.lineTo(O,k),o.stroke()),I=k,M=O)}});

</script>
  <style>
:root{font-family:Inter,system-ui,Avenir,Helvetica,Arial,sans-serif;line-height:1.5;font-weight:400;color-scheme:light dark;color:#ffffffde;background-color:#242424;font-synthesis:none;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}a{font-weight:500;color:#646cff;text-decoration:inherit}a:hover{color:#535bf2}body{place-items:center;display:grid}h1{font-size:3.2em;line-height:1.1}#app{max-width:1280px;margin:0 auto;padding:2rem;text-align:center}.logo{height:6em;padding:1.5em;will-change:filter;transition:filter .3s}.logo:hover{filter:drop-shadow(0 0 2em #646cffaa)}.logo.vanilla:hover{filter:drop-shadow(0 0 2em #3178c6aa)}.card{padding:2em}.read-the-docs{color:#888}button{border-radius:3px;border:1px solid transparent;padding:.6em 1.2em;font-size:1em;font-weight:500;font-family:inherit;background-color:#1a1a1a;cursor:pointer;transition:background-color .25s}button:hover{background-color:#646cff}button:focus,button:focus-visible{outline:4px auto -webkit-focus-ring-color}@media (prefers-color-scheme: light){:root{color:#213547;background-color:#fff}a:hover{color:#747bff}button{background-color:#f9f9f9}}.innerContainer{margin:5px;align-items:center;width:auto}#controlsContainer{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:0 auto;width:800px;max-width:1280px;text-align:center}#gcodeCanvas{border:0px}#gcodeInput{position:relative;background:transparent;width:100%;height:240px;font-family:monospace;font-size:13px;line-height:1.5;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}#gcodeContainer{position:relative;width:100%;margin:5px}input[type=file]::file-selector-button{border:2px solid #6c5ce7;padding:.2em .4em;border-radius:.2em;background-color:#1a1a1a;transition:.25s}input[type=file]::-ms-browse:hover{background-color:#646cff}input[type=file]::-webkit-file-upload-button:hover{background-color:#646cff}input[type=file]::file-selector-button:hover{background-color:#646cff}

</style>
</head>

<body>
    <canvas id="gcodeCanvas" width="800" height="600" style="background-color: #242424;"></canvas>
    <br />

    <div id="controlsContainer">
        <div id="gcodeContainer" style="position: relative;">
            <div id="gcodeEditor" style="height: 200px; width: 100%;"></div>
        </div>
        <div class="innerContainer">
            <input type="file" id="fileInput" accept=".txt,.gcode">
        </div>
        <div class="innerContainer">
            <button id="simulateButton">Simulate</button>
            <button id="clearButton">Clear</button>
        </div>
        <div id="sliderContainer" class="innerContainer" style="display: none; width: 400px;">
            <input type="range" id="progressSlider" min="0" max="100" value="0" style="width: 100%;">
            <div id="sliderLabel" style="text-align: center;"></div>
        </div>
        <div id="displayOptionsContainer" class="innerContainer" style="display: none;">
            <input type="checkbox" id="showCuts" checked> Show Cut Moves
            </label>
            <label>
                <input type="checkbox" id="showNonCuts" checked>
                Show Non-Cut Moves
            </label>
        </div>
    </div>
</body>

</html>