<!DOCTYPE html>
<html>

<head>
    <title>G-Code Visualizer</title>
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/ace.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <script type="module" crossorigin>
var ln=Object.defineProperty;var rn=(o,e,n)=>e in o?ln(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n;var S=(o,e,n)=>(rn(o,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const d of i)if(d.type==="childList")for(const b of d.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&a(b)}).observe(document,{childList:!0,subtree:!0});function n(i){const d={};return i.integrity&&(d.integrity=i.integrity),i.referrerPolicy&&(d.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?d.credentials="include":i.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function a(i){if(i.ep)return;i.ep=!0;const d=n(i);fetch(i.href,d)}})();var le=(o=>(o.GCODE="gcode",o.PLANNER="planner",o.QUICKTASKS="quicktasks",o))(le||{});class cn{constructor(e,n,a,i,d,b,L,T,P,x){this.isConnected=e,this.condition=n,this.error=a,this.progress=i,this.currentLine=d,this.feedRate=b,this.z=L,this.x=T,this.feed=P,this.rpm=x}}const De=class De{constructor(){S(this,"listeners",[]);S(this,"activeClient",null);S(this,"port",null);S(this,"readTimeout",0);S(this,"reader",null);S(this,"writer",null);S(this,"isOn",!1);S(this,"waitForOkOrError",!1);S(this,"lines",[]);S(this,"lineIndex",0);S(this,"unparsedResponse","");S(this,"error","");S(this,"statusReceived",!1);S(this,"currentLine","");S(this,"feedRate",0);S(this,"z",0);S(this,"x",0);S(this,"feed",0);S(this,"rpm",0);S(this,"isDisconnecting",!1);S(this,"lastStatus",null);S(this,"currentCommandListeners",[]);S(this,"remainingStatus","");S(this,"remainingResponse","")}static getInstance(){return De.instance||(De.instance=new De),De.instance}setActiveClient(e){this.activeClient=e,console.log(`Active client set to: ${e}`)}clearActiveClient(){this.activeClient=null,console.log("Active client cleared")}getStatus(){return this.lastStatus=new cn(this.port!==null,this.isOn?"run":"idle",this.error,this.lines.length?this.lineIndex/this.lines.length:0,this.currentLine,this.feedRate,this.z,this.x,this.feed,this.rpm),this.lastStatus}getCurrentCommand(){return this.currentLine}addStatusChangeListener(e,n){this.listeners.push({callback:e,client:n})}notifyStatusChange(){this.listeners.forEach(e=>{e.client===this.activeClient?(console.debug(`Notifying ${e.client} listener`),e.callback()):console.debug(`Skipping ${e.client} listener (not active)`)})}addCurrentCommandListener(e){this.currentCommandListeners.push(e)}notifyCurrentCommand(e){this.currentCommandListeners.forEach(n=>n(e))}setStatus(e){if(e=this.remainingStatus+e,this.remainingStatus="",e.startsWith("<")&&(e=e.substring(1)),e.endsWith(">"))e=e.slice(0,-1);else{this.remainingStatus=e;return}const n=e.split("|");if(n.length>=3){if(this.statusReceived=!0,n[1].startsWith("WPos:")){const a=n[1].substring(5).split(",");this.z=Number(a[2]),this.x=Number(a[0])}if(n[2].startsWith("FS:")){const a=n[2].substring(3).split(",");this.feed=Number(a[0]),this.rpm=Number(a[1])}}this.notifyStatusChange(),Ye(`response: ${e}`),console.log(`response: "${e}"`)}setError(e){this.error=e,Ye(e),this.notifyStatusChange()}isConnected(){return this.lastStatus!==null&&this.lastStatus.isConnected}async connect(){try{if(this.setActiveClient("gcode"),this.port)this.closePort();else{if(await this.selectPort(),this.write("!"),await this.askForStatus(),!await un(()=>this.statusReceived)){this.setError("Device is not reponding, is it in GCODE mode?");return}this.isDisconnecting=!1,this.isOn=!1,this.setError(""),this.waitForOkOrError=!1,this.unparsedResponse=""}}catch(e){console.log(e)}this.notifyStatusChange()}async disconnect(){this.isDisconnecting=!0,this.port&&this.closePort()}getDisconnectingStatus(){return this.isDisconnecting}async start(e,n){e&&(this.setActiveClient(n),this.isOn=!0,this.lines=e.split(`
`),this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange())}async sendCommand(e,n){this.setActiveClient(n),this.isOn=!0,this.lines=[e],this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange()}async sendCommands(e,n){this.setActiveClient(n),this.isOn=!0,this.lines=e,this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange()}async stop(){await this.write("!"),this.isOn&&(this.isOn=!1,this.notifyStatusChange(),this.clearActiveClient())}async write(e){if(this.port){if(console.log("command: ",e),!this.port.writable){e!="?"&&this.setError("Port is not writable, try reconnecting the USB and switching to GCODE mode.");return}if(!this.writer)try{const n=new TextEncoderStream;n.readable.pipeTo(this.port.writable),this.writer=n.writable.getWriter()}catch(n){this.setError("Failed to write: "+n);return}await this.writer.write(e)}}async writeCurrentLine(){if(!this.isOn||this.waitForOkOrError)return;if(this.lineIndex>=this.lines.length){this.stop();return}const e=this.lines[this.lineIndex].split(";")[0].trim();if(!e){this.lineIndex++,this.writeCurrentLine();return}this.currentLine=e,this.notifyCurrentCommand(this.currentLine),this.waitForOkOrError=!0,console.log(`command: "${e}"`),Ye(`command: ${e}`),await this.write(e+`
`),await this.readFromPort()}async processResponse(e){this.unparsedResponse=(this.remainingResponse+e).trimStart(),this.remainingResponse="";const n=this.unparsedResponse.split(`
`);for(let a of n){const i=a.match(/(<[^>]+>)/);if(i&&i.length>1){i.shift();for(const d of i)a=a.replace(d,"");this.setStatus(i.pop())}a.startsWith("error:")?(this.remainingResponse+=a,Ye(`response: ${this.remainingResponse}`),console.log(`response: "${this.remainingResponse}"`),this.setError(a),this.remainingResponse="",this.stop()):a.startsWith("ok")?(this.remainingResponse+=a,Ye(`response: ${this.remainingResponse}`),console.log(`response: "${this.remainingResponse}"`),this.remainingResponse="",this.waitForOkOrError=!1,this.lineIndex++,this.notifyStatusChange(),this.isOn&&await this.writeCurrentLine()):this.remainingResponse+=a}this.unparsedResponse=""}async selectPort(){if(this.port&&this.closePort(),navigator.serial?this.port=await navigator.serial.requestPort():(this.error="This browser does not support Serial API, try Chrome or Edge",this.notifyStatusChange()),this.port)try{await this.port.open({baudRate:115200}),this.notifyStatusChange(),this.readSoon()}catch(e){this.setError(`Unable to open port - likely some other app is using it - try closing Arduino IDE.
${e}`),this.closePort()}}async askForStatus(){try{await this.write("?")}catch(e){this.setError(`Device disconnected? ${e}`),this.closePort()}}readSoon(){clearTimeout(this.readTimeout),this.readTimeout=window.setTimeout(()=>this.readFromPort(),200)}async readFromPort(){if(this.port)try{if(!this.port.readable){this.readSoon();return}if(!this.reader){const n=new TextDecoderStream;this.port.readable.pipeTo(n.writable),this.reader=n.readable.getReader()}const{value:e}=await this.reader.read();if(!e){this.readSoon();return}await this.processResponse(e),this.readSoon()}catch(e){this.setError(e.message||String(e)),this.closePort()}}async closePort(){if(this.port){if(clearTimeout(this.readTimeout),this.reader){try{await this.reader.cancel(),this.reader.releaseLock()}catch(e){console.error("Error cancelling reader: ",e)}this.reader=null}if(this.writer){try{await this.writer.close(),this.writer.releaseLock()}catch(e){console.error("Error closing writer: ",e)}this.writer=null}await new Promise(e=>setTimeout(e,500));try{await this.port.close()}catch(e){console.error("Error closing port: ",e)}this.port=null,this.statusReceived=!1,this.z=0,this.x=0,this.feed=0,this.rpm=0}}};S(De,"instance",null);let st=De;function Ye(o){var e=ge.getSession(),n=e.getLength(),a=new Date().toLocaleTimeString(),i=`[${a}] ${o}
`;e.insert({row:n,column:0},i)}function un(o){return new Promise(e=>{let n=0;function a(){o()?e(!0):n>=10?e(!1):(n++,setTimeout(a,100))}a()})}class dn{constructor(){S(this,"sendButton");S(this,"sendSingleCommandButton");S(this,"stopButton");S(this,"senderError");S(this,"runProgress");S(this,"runProgressLabel");S(this,"connectButton");S(this,"gcodeResponseContainer");S(this,"jogButtons");S(this,"toolButtons");S(this,"sender");S(this,"singleCommandSender");let e,n,a;this.senderError=document.querySelector(".senderError"),this.runProgress=document.getElementById("senderProgress"),this.runProgressLabel=document.getElementById("senderProgressLabel"),this.connectButton=document.getElementById("connectButton"),this.gcodeResponseContainer=document.getElementById("gcodeResponseContainer"),a=document.getElementById("moveDistance"),e=document.getElementById("fastFeedrate"),n=document.getElementById("slowFeedrate"),this.jogButtons=document.querySelectorAll("#latheControls .jog-btn"),this.toolButtons=document.querySelectorAll("#latheControls .tool-btn"),this.sendButton=document.getElementById("gcodeSenderButton"),this.sendSingleCommandButton=document.getElementById("gcodeSendSingleCommandButton"),this.singleCommandSender=document.getElementById("singleCommandSender"),this.sender=st.getInstance(),this.sender.addStatusChangeListener(()=>this.handleStatusChange(),le.GCODE),this.jogButtons.forEach(i=>{i.addEventListener("click",()=>{var O;if(!((O=this.sender)!=null&&O.isConnected())){alert("Please connect to the controller first.");return}let d="",b="",L="",T=!0;i.id=="fastForward"?(d=e.value,b="X",L=a.value,T=!0):i.id=="slowForward"?(d=n.value,b="X",L=a.value,T=!0):i.id=="fastBackward"?(d=e.value,b="X",L=a.value,T=!1):i.id=="slowBackward"?(d=n.value,b="X",L=a.value,T=!1):i.id=="fastLeft"?(d=e.value,b="Z",L=a.value,T=!0):i.id=="slowLeft"?(d=n.value,b="Z",L=a.value,T=!0):i.id=="fastRight"?(d=e.value,b="Z",L=a.value,T=!1):i.id=="slowRight"&&(d=n.value,b="Z",L=a.value,T=!1);let x=`${b}${T===!0?"":"-"}${L} F${d}`;if(this.sender){let C=new Array(3);C[0]="G91",C[1]=x,C[2]="G90",this.sender.sendCommands(C,le.GCODE)}})}),this.toolButtons.forEach(i=>{i.addEventListener("click",()=>{var P;if(!((P=this.sender)!=null&&P.isConnected())){alert("Please connect to the controller first.");return}let d=i.id,b=d.replace("tool","T");document.querySelectorAll("#latheControls .tool-btn").forEach(function(x){x.id!=d?x.classList.remove("tool-selected"):x.classList.add("tool-selected")});let T=new Array(1);T[0]=b,this.sender&&this.sender.sendCommands(T,le.GCODE)})}),this.connectButton.addEventListener("click",()=>{var i;this.gcodeResponseContainer.style.display="block",!((i=this.sender)!=null&&i.isConnected())&&this.sender&&this.sender.connect()}),this.sendButton.addEventListener("click",()=>{var i;if(!((i=this.sender)!=null&&i.isConnected())){alert("Please connect to the controller first.");return}this.sender&&(this.sendButton.disabled=!0,this.sendSingleCommandButton.disabled=!0,this.jogButtons.forEach(d=>{d.disabled=!0}),this.toolButtons.forEach(d=>{d.disabled=!0}),this.sender.start(R.getValue(),le.GCODE))}),this.sendSingleCommandButton.addEventListener("click",()=>{var i;if(!((i=this.sender)!=null&&i.isConnected())){alert("Please connect to the controller first.");return}this.sender&&(this.sendButton.disabled=!0,this.sendSingleCommandButton.disabled=!0,this.jogButtons.forEach(d=>{d.disabled=!0}),this.toolButtons.forEach(d=>{d.disabled=!0}),this.sender.sendCommand(this.singleCommandSender.value,le.GCODE))}),this.stopButton=document.getElementById("stopButton"),this.stopButton.addEventListener("click",()=>this.sender.stop()),this.stopButton.style.display="none"}hide(){}handleStatusChange(){if(!this.sender)return;const e=this.sender.getStatus();if(e.isConnected===!1){this.connectButton.innerText="Connect",this.connectButton.disabled=!1,this.connectButton.style.backgroundColor="";return}else this.connectButton.innerText="Connected",this.connectButton.disabled=!0,this.connectButton.style.backgroundColor="green";const n=e.condition==="run";this.runProgress&&(this.runProgress.value=e.progress,this.runProgress.style.display=n?"block":"none",this.runProgressLabel.style.display=n?"block":"none",n?n&&(this.sendButton.style.display="none"):(this.sendButton.disabled=!1,this.sendButton.style.display="inline-block",this.sendSingleCommandButton.disabled=!1,this.jogButtons.forEach(i=>{i.disabled=!1}),this.toolButtons.forEach(i=>{i.disabled=!1}))),this.stopButton&&(this.stopButton.style.display=n?"inline-block":"none");const a=this.sender.getDisconnectingStatus();this.senderError&&!a&&(e.error?(this.senderError.style.display="block",this.senderError.innerText=e.error,this.showError(),this.appendLineToResponseEditor(e.error)):(this.hideError(),this.senderError.innerText=""))}appendLineToResponseEditor(e){var n=ge.getSession(),a=n.getLength(),i=new Date().toLocaleTimeString(),d=`[${i}] ${e}
`;n.insert({row:a,column:0},d)}showError(){this.senderError.style.display="block"}hideError(){this.senderError.style.display="none"}}const mn=`; This example shows a boring operation, then an internal grooving operation

G21 ; metric
G18 ; ZX plane
G90 ; absolute positioning
F200
X0 ; zero your tool X on centerline
Z0 ; zero your tool Z at the right edge of the stock
G91 ; relative positioning

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;1mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;2mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;3mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;4mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;5mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;6mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;7mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;8mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;9mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;10mm

Z-10

Z3.25 ; cut
X-5 ; cut

X-1.7 ; cut

X6.7 ; retract
Z-3.25 ; retract
`;function fn(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var pn=function(e,n){return Array.prototype.slice.call(e,n)},gn=typeof setImmediate=="function",xt;gn?xt=function(o){setImmediate(o)}:xt=function(o){setTimeout(o,0)};var hn=xt,vn=hn,yn=function(e,n,a){e&&vn(function(){e.apply(a||null,n||[])})},Ot=pn,kn=yn,bn=function(e,n){var a=n||{},i={};return e===void 0&&(e={}),e.on=function(d,b){return i[d]?i[d].push(b):i[d]=[b],e},e.once=function(d,b){return b._once=!0,e.on(d,b),e},e.off=function(d,b){var L=arguments.length;if(L===1)delete i[d];else if(L===0)i={};else{var T=i[d];if(!T)return e;T.splice(T.indexOf(b),1)}return e},e.emit=function(){var d=Ot(arguments);return e.emitterSnapshot(d.shift()).apply(this,d)},e.emitterSnapshot=function(d){var b=(i[d]||[]).slice(0);return function(){var L=Ot(arguments),T=this||e;if(d==="error"&&a.throws!==!1&&!b.length)throw L.length===1?L[0]:L;return b.forEach(function(x){a.async?kn(x,L,T):x.apply(T,L),x._once&&e.off(d,x)}),e}},e},Vt=window.CustomEvent;function Cn(){try{var o=new Vt("cat",{detail:{foo:"bar"}});return o.type==="cat"&&o.detail.foo==="bar"}catch{}return!1}var En=Cn()?Vt:typeof document<"u"&&typeof document.createEvent=="function"?function(e,n){var a=document.createEvent("CustomEvent");return n?a.initCustomEvent(e,n.bubbles,n.cancelable,n.detail):a.initCustomEvent(e,!1,!1,void 0),a}:function(e,n){var a=document.createEventObject();return a.type=e,n?(a.bubbles=!!n.bubbles,a.cancelable=!!n.cancelable,a.detail=n.detail):(a.bubbles=!1,a.cancelable=!1,a.detail=void 0),a},Ut=[],ht="",Bn=/^on/;for(ht in window)Bn.test(ht)&&Ut.push(ht.slice(2));var Sn=Ut,Tn=En,wn=Sn,dt=window.document,Kt=Nn,Yt=xn,at=[];window.addEventListener||(Kt=Ln,Yt=On);var In={add:Kt,remove:Yt,fabricate:_n};function Nn(o,e,n,a){return o.addEventListener(e,n,a)}function Ln(o,e,n){return o.attachEvent("on"+e,Xn(o,e,n))}function xn(o,e,n,a){return o.removeEventListener(e,n,a)}function On(o,e,n){var a=Wt(o,e,n);if(a)return o.detachEvent("on"+e,a)}function _n(o,e,n){var a=wn.indexOf(e)===-1?d():i();o.dispatchEvent?o.dispatchEvent(a):o.fireEvent("on"+e,a);function i(){var b;return dt.createEvent?(b=dt.createEvent("Event"),b.initEvent(e,!0,!0)):dt.createEventObject&&(b=dt.createEventObject()),b}function d(){return new Tn(e,{detail:n})}}function Mn(o,e,n){return function(i){var d=i||window.event;d.target=d.target||d.srcElement,d.preventDefault=d.preventDefault||function(){d.returnValue=!1},d.stopPropagation=d.stopPropagation||function(){d.cancelBubble=!0},d.which=d.which||d.keyCode,n.call(o,d)}}function Xn(o,e,n){var a=Wt(o,e,n)||Mn(o,e,n);return at.push({wrapper:a,element:o,type:e,fn:n}),a}function Wt(o,e,n){var a=Jn(o,e,n);if(a){var i=at[a].wrapper;return at.splice(a,1),i}}function Jn(o,e,n){var a,i;for(a=0;a<at.length;a++)if(i=at[a],i.element===o&&i.type===e&&i.fn===n)return a}var _t={},Pn="(?:^|\\s)",Dn="(?:\\s|$)";function Qt(o){var e=_t[o];return e?e.lastIndex=0:_t[o]=e=new RegExp(Pn+o+Dn,"g"),e}function An(o,e){var n=o.className;n.length?Qt(e).test(n)||(o.className+=" "+e):o.className=e}function $n(o,e){o.className=o.className.replace(Qt(e)," ").trim()}var Rn={add:An,rm:$n},Gn=bn,je=In,be=Rn,qe=document,ie=qe.documentElement;function Fn(o,e){var n=arguments.length;n===1&&Array.isArray(o)===!1&&(e=o,o=[]);var a,i,d,b,L,T,P,x,O,C,G,A=null,Y,t=e||{};t.moves===void 0&&(t.moves=Pt),t.accepts===void 0&&(t.accepts=Pt),t.invalid===void 0&&(t.invalid=it),t.containers===void 0&&(t.containers=o||[]),t.isContainer===void 0&&(t.isContainer=jn),t.copy===void 0&&(t.copy=!1),t.copySortSource===void 0&&(t.copySortSource=!1),t.revertOnSpill===void 0&&(t.revertOnSpill=!1),t.removeOnSpill===void 0&&(t.removeOnSpill=!1),t.direction===void 0&&(t.direction="vertical"),t.ignoreInputTextSelection===void 0&&(t.ignoreInputTextSelection=!0),t.mirrorContainer===void 0&&(t.mirrorContainer=qe.body);var s=Gn({containers:t.containers,start:V,end:we,cancel:Le,remove:Ne,destroy:g,canMove:X,dragging:!1});return t.removeOnSpill===!0&&s.on("over",xe).on("out",Oe),l(),s;function r(c){return s.containers.indexOf(c)!==-1||t.isContainer(c)}function l(c){var h=c?"remove":"add";We(ie,h,"mousedown",k),We(ie,h,"mouseup",ze)}function u(c){var h=c?"remove":"add";We(ie,h,"mousemove",E)}function f(c){var h=c?"remove":"add";je[h](ie,"selectstart",y),je[h](ie,"click",y)}function g(){l(!0),ze({})}function y(c){Y&&c.preventDefault()}function k(c){T=c.clientX,P=c.clientY;var h=Mt(c)!==1||c.metaKey||c.ctrlKey;if(!h){var p=c.target,I=w(p);I&&(Y=I,u(),c.type==="mousedown"&&($t(p)?p.focus():c.preventDefault()))}}function E(c){if(Y){if(Mt(c)===0){ze({});return}if(!(c.clientX!==void 0&&Math.abs(c.clientX-T)<=(t.slideFactorX||0)&&c.clientY!==void 0&&Math.abs(c.clientY-P)<=(t.slideFactorY||0))){if(t.ignoreInputTextSelection){var h=Ce("clientX",c)||0,p=Ce("clientY",c)||0,I=qe.elementFromPoint(h,p);if($t(I))return}var $=Y;u(!0),f(),we(),U($);var M=Zn(d);b=Ce("pageX",c)-M.left,L=Ce("pageY",c)-M.top,be.add(C||d,"gu-transit"),ve(),Ve(c)}}}function w(c){if(!(s.dragging&&a)&&!r(c)){for(var h=c;H(c)&&r(H(c))===!1;)if(t.invalid(c,h)||(c=H(c),!c))return;var p=H(c);if(p&&!t.invalid(c,h)){var I=t.moves(c,p,h,Qe(c));if(I)return{item:c,source:p}}}}function X(c){return!!w(c)}function V(c){var h=w(c);h&&U(h)}function U(c){Ue(c.item,c.source)&&(C=c.item.cloneNode(!0),s.emit("cloned",C,c.item,"copy")),i=c.source,d=c.item,x=O=Qe(c.item),s.dragging=!0,s.emit("drag",d,i)}function it(){return!1}function we(){if(s.dragging){var c=C||d;Ie(c,H(c))}}function lt(){Y=!1,u(!0),f(!0)}function ze(c){if(lt(),!!s.dragging){var h=C||d,p=Ce("clientX",c)||0,I=Ce("clientY",c)||0,$=Jt(a,p,I),M=He($,p,I);M&&(C&&t.copySortSource||!C||M!==i)?Ie(h,M):t.removeOnSpill?Ne():Le()}}function Ie(c,h){var p=H(c);C&&t.copySortSource&&h===i&&p.removeChild(d),re(h)?s.emit("cancel",c,i,i):s.emit("drop",c,h,i,O),he()}function Ne(){if(s.dragging){var c=C||d,h=H(c);h&&h.removeChild(c),s.emit(C?"cancel":"remove",c,h,i),he()}}function Le(c){if(s.dragging){var h=arguments.length>0?c:t.revertOnSpill,p=C||d,I=H(p),$=re(I);$===!1&&h&&(C?I&&I.removeChild(C):i.insertBefore(p,x)),$||h?s.emit("cancel",p,i,i):s.emit("drop",p,I,i,O),he()}}function he(){var c=C||d;lt(),ye(),c&&be.rm(c,"gu-transit"),G&&clearTimeout(G),s.dragging=!1,A&&s.emit("out",c,A,i),s.emit("dragend",c),i=d=C=x=O=G=A=null}function re(c,h){var p;return h!==void 0?p=h:a?p=O:p=Qe(C||d),c===i&&p===x}function He(c,h,p){for(var I=c;I&&!$();)I=H(I);return I;function $(){var M=r(I);if(M===!1)return!1;var ke=Ae(I,c),J=$e(I,ke,h,p),te=re(I,J);return te?!0:t.accepts(d,I,i,J)}}function Ve(c){if(!a)return;c.preventDefault();var h=Ce("clientX",c)||0,p=Ce("clientY",c)||0,I=h-b,$=p-L;a.style.left=I+"px",a.style.top=$+"px";var M=C||d,ke=Jt(a,h,p),J=He(ke,h,p),te=J!==null&&J!==A;(te||J===null)&&(ct(),A=J,rt());var F=H(M);if(J===i&&C&&!t.copySortSource){F&&F.removeChild(M);return}var z,ce=Ae(J,ke);if(ce!==null)z=$e(J,ce,h,p);else if(t.revertOnSpill===!0&&!C)z=x,J=i;else{C&&F&&F.removeChild(M);return}(z===null&&te||z!==M&&z!==Qe(M))&&(O=z,J.insertBefore(M,z),s.emit("shadow",M,J,i));function ne(_e){s.emit(_e,M,A,i)}function rt(){te&&ne("over")}function ct(){A&&ne("out")}}function xe(c){be.rm(c,"gu-hide")}function Oe(c){s.dragging&&be.add(c,"gu-hide")}function ve(){if(!a){var c=d.getBoundingClientRect();a=d.cloneNode(!0),a.style.width=Dt(c)+"px",a.style.height=At(c)+"px",be.rm(a,"gu-transit"),be.add(a,"gu-mirror"),t.mirrorContainer.appendChild(a),We(ie,"add","mousemove",Ve),be.add(t.mirrorContainer,"gu-unselectable"),s.emit("cloned",a,d,"mirror")}}function ye(){a&&(be.rm(t.mirrorContainer,"gu-unselectable"),We(ie,"remove","mousemove",Ve),H(a).removeChild(a),a=null)}function Ae(c,h){for(var p=h;p!==c&&H(p)!==c;)p=H(p);return p===ie?null:p}function $e(c,h,p,I){var $=t.direction==="horizontal",M=h!==c?J():ke();return M;function ke(){var F=c.children.length,z,ce,ne;for(z=0;z<F;z++)if(ce=c.children[z],ne=ce.getBoundingClientRect(),$&&ne.left+ne.width/2>p||!$&&ne.top+ne.height/2>I)return ce;return null}function J(){var F=h.getBoundingClientRect();return te($?p>F.left+Dt(F)/2:I>F.top+At(F)/2)}function te(F){return F?Qe(h):h}}function Ue(c,h){return typeof t.copy=="boolean"?t.copy:t.copy(c,h)}}function We(o,e,n,a){var i={mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"},d={mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"},b={mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"};window.navigator.pointerEnabled?je[e](o,d[n],a):window.navigator.msPointerEnabled?je[e](o,b[n],a):(je[e](o,i[n],a),je[e](o,n,a))}function Mt(o){if(o.touches!==void 0)return o.touches.length;if(o.which!==void 0&&o.which!==0)return o.which;if(o.buttons!==void 0)return o.buttons;var e=o.button;if(e!==void 0)return e&1?1:e&2?3:e&4?2:0}function Zn(o){var e=o.getBoundingClientRect();return{left:e.left+Xt("scrollLeft","pageXOffset"),top:e.top+Xt("scrollTop","pageYOffset")}}function Xt(o,e){return typeof window[e]<"u"?window[e]:ie.clientHeight?ie[o]:qe.body[o]}function Jt(o,e,n){o=o||{};var a=o.className||"",i;return o.className+=" gu-hide",i=qe.elementFromPoint(e,n),o.className=a,i}function jn(){return!1}function Pt(){return!0}function Dt(o){return o.width||o.right-o.left}function At(o){return o.height||o.bottom-o.top}function H(o){return o.parentNode===qe?null:o.parentNode}function $t(o){return o.tagName==="INPUT"||o.tagName==="TEXTAREA"||o.tagName==="SELECT"||en(o)}function en(o){return!o||o.contentEditable==="false"?!1:o.contentEditable==="true"?!0:en(H(o))}function Qe(o){return o.nextElementSibling||e();function e(){var n=o;do n=n.nextSibling;while(n&&n.nodeType!==1);return n}}function qn(o){return o.targetTouches&&o.targetTouches.length?o.targetTouches[0]:o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:o}function Ce(o,e){var n=qn(e),a={pageX:"clientX",pageY:"clientY"};return o in a&&!(o in n)&&a[o]in n&&(o=a[o]),n[o]}var zn=Fn;const Rt=fn(zn);class tn{static getButtonName(e){const n=this.buttons.find(a=>a.id===e);return n?n.name:""}static createKeyPressEvent(e,n){const a=this.buttons.find(d=>d.id===e);if(!a)throw new Error(`No button found with id: ${e}`);let i=a.number;return i&=127,n&&(i|=128),i}}S(tn,"buttons",[{name:"arrow_left_alt",id:"B_LEFT",number:57},{name:"arrow_right_alt",id:"B_RIGHT",number:37},{name:"arrow_upward_alt",id:"B_UP",number:47},{name:"arrow_downward_alt",id:"B_DOWN",number:67},{name:"+",id:"B_MINUS",number:5},{name:"-",id:"B_PLUS",number:64},{name:"play_arrow",id:"B_ON",number:17},{name:"crop_square",id:"B_OFF",number:27},{name:"keyboard_tab_rtl",id:"B_STOPL",number:7},{name:"keyboard_tab",id:"B_STOPR",number:15},{name:"vertical_align_top",id:"B_STOPU",number:6},{name:"vertical_align_bottom",id:"B_STOPD",number:16},{name:"rotate_left",id:"B_DISPL",number:14},{name:"signal_cellular_alt",id:"B_STEP",number:24},{name:"settings",id:"B_SETTINGS",number:34},{name:"space_bar",id:"B_MEASURE",number:54},{name:"sync_alt",id:"B_REVERSE",number:44},{name:"1",id:"B_0",number:51},{name:"2",id:"B_1",number:41},{name:"3",id:"B_2",number:61},{name:"4",id:"B_3",number:31},{name:"5",id:"B_4",number:2},{name:"6",id:"B_5",number:21},{name:"7",id:"B_6",number:12},{name:"8",id:"B_7",number:11},{name:"9",id:"B_8",number:22},{name:"10",id:"B_9",number:1},{name:"backspace",id:"B_BACKSPACE",number:32},{name:"manufacturing",id:"B_MODE_GEARS",number:42},{name:"reply",id:"B_MODE_TURN",number:52},{name:"turn_slight_left",id:"B_MODE_FACE",number:62},{name:"arrow_forward_ios",id:"B_MODE_CONE",number:3},{name:"publish",id:"B_MODE_CUT",number:13},{name:"home_improvement_and_tools",id:"B_MODE_THREAD",number:23},{name:"M",id:"B_MODE_OTHER",number:33},{name:"X",id:"B_X",number:53},{name:"Z",id:"B_Z",number:43},{name:"A",id:"B_A",number:4},{name:"B",id:"B_B",number:63}]);let Hn=(o=21)=>crypto.getRandomValues(new Uint8Array(o)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),"");const de=document.getElementById("availableTasks"),j=document.getElementById("tasksToExecute"),vt=document.getElementById("deleteTasks"),Vn=document.getElementById("addNewTaskButton"),Xe=document.getElementById("newTaskModal"),Un=document.getElementById("closeNewTaskModal"),me=document.getElementById("newTaskType"),Ge=document.getElementById("gcodeTaskContainer"),K=document.getElementById("newTaskGcode"),Fe=document.getElementById("emulationOuterContainer"),Kn=document.getElementById("saveNewTaskButton"),et=document.getElementById("newTaskName"),Gt=document.getElementById("taskTextTitle"),yt=document.getElementById("newTaskDescription");let q;const Ze=document.getElementById("connectButton"),Yn=document.getElementById("plannerContainer");let Ft=null;const Wn=document.getElementById("saveAvailableTaskCollection"),Qn=document.getElementById("saveAvailableTaskCollectionButtonModal"),eo=document.getElementById("loadTaskCollection"),fe=document.getElementById("availableTaskCollections"),ee=document.getElementById("collectionToSaveTo"),Zt=document.getElementById("newCollectionNameContainer"),kt=document.getElementById("newCollectionName"),to=document.getElementById("deleteTaskCollection"),bt=document.getElementById("saveCollectionModal"),Ee=document.getElementById("saveCollectionModalToSaveTo"),no=document.getElementById("saveCollectionModalClose"),oo=document.getElementById("newCollectionNameModal"),jt=document.getElementById("newCollectionNameContainerModal"),so=document.getElementById("importAvailableTasks"),ao=document.getElementById("exportAvailableTasks"),Ct=document.getElementById("saveJobModal"),io=document.getElementById("saveJobModalClose"),lo=document.getElementById("executeJobButton"),ro=document.getElementById("saveJobButton"),co=document.getElementById("newJobButton"),Et=document.getElementById("saveJobNameInput"),Be=document.getElementById("saveJobNameSelect"),mt=document.getElementById("newJobNameContainer"),Bt=document.getElementById("saveJobGroupNameInput"),Se=document.getElementById("saveJobGroupNameSelect"),ft=document.getElementById("newJobGroupNameContainer"),uo=document.getElementById("saveJobSaveButton"),tt=document.getElementById("jobLoadSelect"),se=document.getElementById("groupLoadSelect"),mo=document.getElementById("loadJobButton"),fo=document.getElementById("deleteJobButton"),po=document.getElementById("importJobButton"),go=document.getElementById("exportJobButton"),St=document.getElementById("exportJobModal"),ho=document.getElementById("exportJobModalClose"),vo=document.getElementById("exportJobSaveButton"),nt=document.getElementById("exportJobGroupNameSelect"),Tt=document.getElementById("exportJobNameSelect"),ot=[],wt=document.getElementById("manualTaskModal"),pt=document.getElementById("cncTaskModal"),yo=document.getElementById("cancelManualTask"),ko=document.getElementById("completeManualTask"),bo=document.getElementById("manualTaskInstructions"),qt=document.getElementById("cncTaskGcode"),Co=document.getElementById("cancelCncTask"),Je=document.getElementById("executeGcode"),Te=document.getElementById("completeCncTask"),Eo=document.getElementById("manualTaskName"),Bo=document.getElementById("cncTaskName"),gt=document.getElementById("cncTaskSenderProgressLabel"),It=document.getElementById("cncTaskSenderProgress"),Nt=document.getElementById("jobCancelledModal"),So=document.getElementById("jobCancelledCloseButton"),zt=document.getElementById("completeTaskModal"),To=document.getElementById("completeTaskCloseButton"),Ht=document.getElementById("notConnectedModal"),wo=document.getElementById("notConnectedCloseButton"),Io=document.getElementById("currentGcodeLineContainer"),No=document.getElementById("currentGcodeLine"),Lo=document.getElementById("currentFeedrateContainer"),xo=document.getElementById("currentFeedrate"),Oo=document.getElementById("emulationInnerContainer"),pe=document.getElementById("emulationNewTasks"),Lt=document.getElementById("emulatedButtonListDelete"),_o=document.getElementById("emulationTaskModal");document.addEventListener("DOMContentLoaded",()=>{q=st.getInstance(),q.addStatusChangeListener(()=>b(),le.PLANNER),q.addCurrentCommandListener(d),Yn.addEventListener("containerVisible",()=>{j.innerHTML="",i(),C(),O(),e(),a();const t=n();x(t),G()}),Ee.addEventListener("change",()=>{Ee.value==="new"?jt.style.display="block":jt.style.display="none"}),ee.addEventListener("change",()=>{ee.value==="new"?Zt.style.display="block":Zt.style.display="none"}),Be.addEventListener("change",()=>{Be.value==="new"?mt.style.display="block":mt.style.display="none"}),Se.addEventListener("change",()=>{Se.value==="new"?ft.style.display="block":ft.style.display="none"}),no.onclick=function(){bt.style.display="none"},Wn.onclick=function(){bt.style.display="block"},Qn.onclick=function(){let t="";if(Ee.value==="new"){if(t=oo.value,t===null||t===""){alert("Please enter a name for the collection");return}}else t=Ee.value;const s=localStorage.getItem("selectedTaskCollection");let r;if(s){const u=localStorage.getItem(`taskCollection_${s}`);u&&(r=JSON.parse(u),t!==s&&(r.name=t,localStorage.setItem(`taskCollection_${t}`,JSON.stringify(r))))}const l=document.createElement("option");l.value=t,l.textContent=t,fe.appendChild(l),bt.style.display="none",alert(`Collection ${t} saved`),i()},eo.onclick=function(){const t=fe.value;localStorage.setItem("selectedTaskCollection",t),C()},to.onclick=function(){const t=fe.value;if(t==="default"){alert("You cannot delete the default collection");return}confirm(`Are you sure you want to delete the collection ${t}?`)&&(localStorage.removeItem(`taskCollection_${t}`),i(),C())},so.onclick=function(){const t=document.createElement("input");t.type="file",t.accept=".json",t.multiple=!0,t.onchange=async function(s){const r=s.target.files;if(r)for(let l=0;l<r.length;l++){const u=r[l],f=new FileReader;f.onload=function(g){var k;const y=(k=g.target)==null?void 0:k.result;y&&(JSON.parse(y).forEach(w=>{const X=w.name;localStorage.getItem(`taskCollection_${X}`)?window.confirm(`Task collection ${X} already exists. Do you want to override it?`)&&localStorage.setItem(`taskCollection_${X}`,JSON.stringify(w)):localStorage.setItem(`taskCollection_${X}`,JSON.stringify(w))}),i())},f.readAsText(u)}},t.click()},ao.onclick=function(){const t=Object.keys(localStorage).filter(y=>y.includes("taskCollection_")),s=[];t.forEach(y=>{const k=localStorage.getItem(y);k&&s.push(JSON.parse(k))});const r=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),l=URL.createObjectURL(r),u=document.createElement("a");u.href=l;const g=new Date().toISOString().split("T")[0];u.download=`availableTasks_${g}.json`,u.click(),URL.revokeObjectURL(l)},Oo.addEventListener("click",function(t){const s=t.target;if(s.tagName==="BUTTON"){const r=s.id;o(r)}});function o(t){const s=document.getElementById(t),r=s==null?void 0:s.cloneNode(!0);r.classList.add("emulated-button-list"),r.removeAttribute("id");const l="emulated-"+Date.now();r.setAttribute("data-emulated-id",l),pe==null||pe.appendChild(r)}function e(){se.innerHTML="",Object.keys(localStorage).filter(r=>r.includes("savedGroup_")).sort().forEach(r=>{const l=r.replace("savedGroup_",""),u=document.createElement("option");u.value=l,u.textContent=l,se.appendChild(u)});const s=localStorage.getItem("selectedGroup");s&&(se.value=s)}function n(){const t=se.value,s=tt.value,r=localStorage.getItem(`savedGroup_${t}`);if(r){const u=JSON.parse(r).jobs.find(f=>f.name===s);return u?(u.groupName||(u.groupName=t),u):(console.warn(`Job with name ${s} not found.`),null)}return null}function a(){tt.innerHTML="";const t=se.value,s=localStorage.getItem(`savedGroup_${t}`);let r=[];s&&(r=JSON.parse(s).jobs.map(u=>u.name)),r.forEach(l=>{const u=document.createElement("option");u.value=l,u.textContent=l,tt.appendChild(u)})}function i(){fe.innerHTML="",ee.innerHTML="",Ee.innerHTML="";const t=document.createElement("option");t.value="default",t.textContent="default",fe.appendChild(t),ee.appendChild(t.cloneNode(!0)),Ee.appendChild(t.cloneNode(!0)),Object.keys(localStorage).filter(u=>u.includes("taskCollection_")).sort().forEach(u=>{if(u==="taskCollection_default")return;const f=u.replace("taskCollection_",""),g=document.createElement("option");g.value=f,g.textContent=f,fe.appendChild(g),ee.appendChild(g.cloneNode(!0)),Ee.appendChild(g.cloneNode(!0))});const r=localStorage.getItem("selectedTaskCollection");r&&(fe.value=r);const l=document.createElement("option");l.value="new",l.textContent="--new collection--",ee.appendChild(l.cloneNode(!0)),Ee.appendChild(l.cloneNode(!0))}wo.onclick=function(){Ht.style.display="none"};function d(t){if(!q)return;const r=q.getStatus().condition==="run";if(r){if(r){const l=t.match(/F(\d+)/);l&&(Ft=parseInt(l[1],10),xo.innerText=Ft.toString()),No.innerText=t,Lo.style.display="block",Io.style.display="block"}}}function b(){if(!q)return;const t=q.getStatus();if(t.isConnected===!1){Ze.innerText="Connect",Ze.disabled=!1,Ze.style.backgroundColor="";return}else Ze.innerText="Connected",Ze.disabled=!0,Ze.style.backgroundColor="green";const s=t.condition==="run";s?s&&(Je.disabled=!0,Je.classList.add("disabled-button"),Je.classList.remove("interaction-ready-button"),Te.classList.remove("interaction-ready-button"),gt.innerText="Task in progress",Te.style.display="none"):(Te.style.display="block",Te.disabled=!1,Te.classList.add("interaction-ready-button"),gt.innerText="Task completed"),It.value=t.progress,It.style.display="block",gt.style.display="block"}Rt([pe,Lt],{copy:!1,accepts:(t,s)=>s===Lt||s===pe,revertOnSpill:!0,removeOnSpill:!1}).on("drop",(t,s)=>{if(s===Lt){t.remove();const r=t.getAttribute("data-emulated-id"),l=pe.querySelector(`[data-emulated-id="${r}"]`);l&&l.remove()}});const T=Rt([de,j,vt],{copy:(t,s)=>s===de,accepts:(t,s)=>s===j||s===vt,revertOnSpill:!0,removeOnSpill:!1});T.on("dragend",()=>{G(),O(),P("currentJob")});function P(t,s=""){const r=j.querySelectorAll(".task-to-execute"),l={name:"",groupName:"",tasks:[]};if(r.forEach(u=>{const f=u.getAttribute("data-task-id"),g=u.getAttribute("data-collection-name");l.tasks.push({id:f,collectionName:g})}),l.name=t,l.groupName=s,t==="currentJob")localStorage.setItem(t,JSON.stringify(l));else if(s){let u=localStorage.getItem(`savedGroup_${s}`);if(u||(localStorage.setItem(`savedGroup_${s}`,JSON.stringify({jobs:[]})),u=localStorage.getItem(`savedGroup_${s}`)),u){let f=u?JSON.parse(u):null;f.jobs.push({name:t,tasks:l.tasks}),localStorage.setItem(`savedGroup_${s}`,JSON.stringify(f))}}}function x(t){let s=t.tasks;const r=[];s=s.filter(l=>localStorage.getItem(`taskCollection_${l.collectionName}`)?!0:(r.push(l),!1)),localStorage.setItem("currentJob",JSON.stringify(s)),j.innerHTML="",s.forEach(l=>{const u=localStorage.getItem(`taskCollection_${l.collectionName}`);if(u){const g=JSON.parse(u).tasks.find(y=>y.id===l.id);if(g){const y=document.createElement("div");y.classList.add(`task-${g.type}`),y.classList.add("task-to-execute"),y.setAttribute("data-task-id",g.id),y.setAttribute("data-task-name",g.name),y.setAttribute("data-collection-name",l.collectionName),y.textContent=g.name,j.appendChild(y)}}}),r.length>0&&alert(`The following tasks were removed because their collection does not exist: ${r.map(l=>l.id).join(", ")}`),localStorage.setItem("loadedJob",JSON.stringify({name:t.name,groupName:t.groupName}))}T.on("drop",(t,s,r)=>{const l=t.getAttribute("data-task-id"),u=t.getAttribute("data-task-order");if(s===j)t.classList.remove("available-task"),t.classList.add("task-to-execute"),O();else if(s===vt){t.remove();let f=null;if(r===j)f=j.querySelector(`[data-task-order="${u}"]`);else if(r===de&&(f=de.querySelector(`[data-task-id="${l}"]`),f)){const g=f.getAttribute("data-collection-name"),y=localStorage.getItem(`taskCollection_${g}`);if(y){const k=JSON.parse(y);k.tasks=k.tasks.filter(E=>E.id!==l),localStorage.setItem(`taskCollection_${g}`,JSON.stringify(k))}}f&&f.remove()}});function O(){j.querySelectorAll(".task-to-execute").forEach(s=>{if(s.querySelector("i")){let r=s.querySelector("i");r&&(r.remove(),r=document.createElement("i"),s.classList.contains("task-manual")?(r.className="fas fa-users-cog icon-tooltip",r.setAttribute("data-tooltip","Manual Task")):s.classList.contains("task-gcode")?(r.className="fas fa-code icon-tooltip",r.setAttribute("data-tooltip","Gcode Task")):s.classList.contains("task-emulation")&&(r.className="far fa-keyboard icon-tooltip",r.setAttribute("data-tooltip","Emulation Task")),s.appendChild(r))}else{const r=document.createElement("i");s.classList.contains("task-manual")?(r.className="fas fa-users-cog icon-tooltip",r.setAttribute("data-tooltip","Manual Task")):s.classList.contains("task-gcode")?(r.className="fas fa-code icon-tooltip",r.setAttribute("data-tooltip","Gcode Task")):s.classList.contains("task-emulation")&&(r.className="far fa-keyboard icon-tooltip",r.setAttribute("data-tooltip","Emulation Task")),s.appendChild(r)}})}function C(){de.innerHTML="";let t=localStorage.getItem("selectedTaskCollection");(t===null||t==="")&&(t=fe.value,localStorage.setItem("selectedTaskCollection",t));const s=localStorage.getItem(`taskCollection_${t}`);s&&JSON.parse(s).tasks.forEach(l=>{l.id,l.name,l.type,l.description,l.gcode&&l.gcode,l.buttonKeys&&l.buttonKeys;const u=document.createElement("div");u.classList.add(`task-${l.type}`),u.classList.add("available-task"),u.setAttribute("data-task-id",l.id.toString()),u.setAttribute("data-task-name",l.name),u.setAttribute("data-collection-name",t||""),u.textContent=l.name;const f=document.createElement("i");f.classList.add("fas","fa-info-circle","fa-fw","show-info","icon-tooltip"),f.setAttribute("data-tooltip","Click for more info..."),u.appendChild(f),de.appendChild(u)})}function G(){const t=document.getElementById("tasksToExecute");t&&t.querySelectorAll("div").forEach((r,l)=>{const u=r.getAttribute("data-task-name");r.setAttribute("data-task-order",(l+1).toString()),r.textContent=`Task ${l+1}: ${u}`})}me.addEventListener("change",()=>{me.value==="manual"?(K.disabled=!0,K.placeholder="Disabled for manual tasks",K.value="",Ge.style.display="none",Fe.style.display="none"):me.value==="emulation"?(K.disabled=!0,K.placeholder="Disabled for emulation tasks",K.value="",Ge.style.display="none",Fe.style.display="block"):(Fe.style.display="none",Ge.style.display="block",K.placeholder="Enter gcode here...",K.disabled=!1)}),Vn.addEventListener("click",()=>{Xe.style.display="block",Gt.textContent="Add a new task",et.value="",yt.value="",K.value="",kt.value="",Xe.removeAttribute("data-task-id"),ee.value=""}),Kn.addEventListener("click",()=>{if(ee.value===""){alert("Please select a collection.");return}if(ee.value==="new"&&kt.value===""){alert("Please enter a collection name");return}if(et.value===""||et.value===null){alert("Please enter a task name");return}const t=et.value,s=document.createElement("div");s.classList.add(`task-${me.value}`),s.classList.add("available-task");let r;const l=Xe.getAttribute("data-task-id");l?r=l:r=Hn(),s.setAttribute("data-task-id",r.toString()),s.setAttribute("data-task-name",t),s.textContent=t;const u=document.createElement("i");u.classList.add("fas","fa-info-circle","fa-fw","show-info","icon-tooltip"),u.setAttribute("data-tooltip","Click for more info..."),s.appendChild(u);const f=de.querySelector(`[data-task-id="${r}"]`);f&&f.remove(),de.appendChild(s),Xe.style.display="none";let g="";me.value==="emulation"&&(pe.querySelectorAll(".emulated-button-list").forEach(E=>{const w=E.getAttribute("data-button-key");g+=w+","}),g.length>0&&(g=g.slice(0,-1)));const y={id:r,name:t,type:me.value,description:yt.value};if(me.value==="gcode"&&(y.gcode=K.value),me.value==="emulation"&&(y.buttonKeys=g),ee.value==="new"){const k=kt.value,E={name:k,tasks:[]};E.tasks.push(y),localStorage.setItem(`taskCollection_${k}`,JSON.stringify(E));const w=document.createElement("option");w.value=k,w.textContent=k,fe.appendChild(w),i()}else{const k=ee.value,E=localStorage.getItem(`taskCollection_${k}`);if(E){const w=JSON.parse(E);w.tasks.find(V=>V.id===r)&&(w.tasks=w.tasks.filter(V=>V.id!==r)),w.tasks.push(y),localStorage.setItem(`taskCollection_${k}`,JSON.stringify(w))}else{const w={name:k,tasks:[]};w.tasks.push(y),localStorage.setItem(`taskCollection_${k}`,JSON.stringify(w))}}C()}),de.addEventListener("click",t=>{const s=t.target;if(s.matches(".show-info")){const l=s.parentNode.getAttribute("data-task-id");let u=null;const f=localStorage.getItem("selectedTaskCollection"),g=localStorage.getItem(`taskCollection_${f}`);if(g){const k=JSON.parse(g).tasks.find(E=>E.id===l);k&&(u=k)}u&&(Xe.style.display="block",et.value=u.name,me.value=u.type,yt.value=u.description,K.value=u.gcode||"",ee.value=f||"default",Gt.textContent="Edit Task",u.type==="emulation"?(Fe.style.display="block",Ge.style.display="none",pe.innerHTML="",(u.buttonKeys??"").split(",").forEach(k=>{const E=document.createElement("button");E.classList.add("emulated-button-list"),E.classList.add("material-symbols-outlined"),E.setAttribute("data-button-key",k),E.textContent=tn.getButtonName(k),E.textContent.length===1&&E.classList.add("standard-font"),pe.appendChild(E)})):u.type==="gcode"?(Fe.style.display="none",Ge.style.display="block",K.disabled=!1,K.placeholder="Enter gcode here..."):(Fe.style.display="none",Ge.style.display="none"),l&&Xe.setAttribute("data-task-id",l.toString()))}}),Un.onclick=function(){Xe.style.display="none"},To.onclick=function(){zt.style.display="none"};function A(){if(ot.length===0){zt.style.display="block";return}const t=ot.shift();if(t&&t.type==="manual")Eo.textContent=`Task ${t.order}: ${t.name}`,bo.value=t.description,wt.style.display="block";else if(t&&t.type==="gcode"){Je.disabled=!1,Je.classList.remove("disabled-button"),Je.classList.add("interaction-ready-button"),Bo.textContent=`Task ${t.order}: ${t.name}`,qt.value=t.gcode??"",pt.style.display="block";const s=pt.querySelector(".task-modal-content");s&&(s.style.backgroundColor=""),Te.disabled=!0,Te.style.display="none",It.style.display="none",gt.style.display="none"}else t&&t.type==="emulation"&&(_o.style.display="block")}yo.onclick=function(){wt.style.display="none",ot.length=0,Nt.style.display="block"},Co.onclick=function(){pt.style.display="none",ot.length=0,Nt.style.display="block",q==null||q.stop()},ko.onclick=function(){wt.style.display="none",A()},Te.onclick=function(){pt.style.display="none",A()},Je.onclick=function(){q&&q.start(qt.value,le.PLANNER)},So.onclick=function(){Nt.style.display="none"},lo.onclick=function(){if(!(q!=null&&q.isConnected())){Ht.style.display="block";return}j.querySelectorAll(".task-to-execute").forEach(s=>{const r=s.getAttribute("data-task-id"),l=s.getAttribute("data-task-order"),u=s.getAttribute("data-collection-name"),f=localStorage.getItem(`taskCollection_${u}`);let g=null;if(f){const k=JSON.parse(f).tasks.find(E=>E.id===r);k&&(g=k)}g&&(g.order=parseInt(l||"0"),ot.push(g))}),A()},ro.onclick=function(){Ct.style.display="block",Se.innerHTML="",Be.innerHTML="",Bt.value="",Et.value="";const t=localStorage.getItem("loadedJob");if(t){const l=JSON.parse(t).name,u=JSON.parse(t).groupName,f=document.createElement("option");f.value=u,f.textContent=u,Se.appendChild(f);const g=document.createElement("option");g.value=l,g.textContent=l,Be.appendChild(g)}else{const l=Object.keys(localStorage).filter(u=>u.startsWith("savedGroup_")).sort();if(l.length>0){l.forEach(g=>{const y=g.replace("savedGroup_",""),k=document.createElement("option");k.value=y,k.textContent=y,Se.appendChild(k)});const u=l[0],f=localStorage.getItem(u);f&&JSON.parse(f).jobs.forEach(y=>{const k=document.createElement("option");k.value=y.name,k.textContent=y.name,Be.appendChild(k)})}else ft.style.display="block",mt.style.display="block"}const s=document.createElement("option");s.value="new",s.textContent="--new group--",Se.appendChild(s);const r=document.createElement("option");r.value="new",r.textContent="--new job--",Be.appendChild(r)},co.onclick=function(){localStorage.setItem("loadedJob",""),localStorage.setItem("currentJob",""),j.innerHTML=""},uo.onclick=function(){let t=Se.value==="new"?Bt.value:Se.value,s=Be.value==="new"?Et.value:Be.value;if(t===""||t===null){alert("Please enter a name for the group");return}if(s===""||s===null){alert("Please enter a name for the job");return}const r=localStorage.getItem(`savedGroup_${t}`);r&&JSON.parse(r).jobs.find(f=>f.name===s)&&!confirm("A job with this name in this group already exists. Do you want to overwrite it?")||(P(s,t),localStorage.setItem("loadedJob",JSON.stringify({name:s,groupName:t})),Ct.style.display="none",ft.style.display="none",mt.style.display="none",Et.value="",Bt.value="",e(),a(),alert(`${s} saved`))},io.onclick=function(){Ct.style.display="none"},ho.onclick=function(){St.style.display="none"},se.addEventListener("change",()=>{const t=se.value;localStorage.setItem("selectedGroup",t),a()}),mo.onclick=function(){j.innerHTML="";const t=se.value,s=tt.value,r=localStorage.getItem(`savedGroup_${t}`),l=r?JSON.parse(r).jobs.find(u=>u.name===s):null;l&&(l.tasks.forEach(f=>{const g=localStorage.getItem(`taskCollection_${f.collectionName}`);if(g){const k=JSON.parse(g).tasks.find(E=>E.id===f.id);if(k){const E=document.createElement("div");E.classList.add(`task-${k.type}`),E.classList.add("task-to-execute"),E.setAttribute("data-task-id",k.id.toString()),E.setAttribute("data-task-name",k.name),E.setAttribute("data-collection-name",f.collectionName),E.textContent=k.name,j.appendChild(E)}}}),localStorage.setItem("currentJob",JSON.stringify(l.tasks))),localStorage.setItem("loadedJob",JSON.stringify({name:s,groupName:t})),G(),O()},fo.onclick=function(){const t=tt.value,s=se.value,r=localStorage.getItem(`savedGroup_${s}`);if(r){const l=JSON.parse(r);l.jobs=l.jobs.filter(u=>u.name!==t),l.jobs.length===0?(localStorage.removeItem(`savedGroup_${s}`),e(),se.selectedIndex=0):(localStorage.setItem(`savedGroup_${s}`,JSON.stringify(l)),e())}a(),O(),G()},po.onclick=function(){const t=document.createElement("input");t.type="file",t.accept=".json",t.multiple=!0,t.onchange=function(s){const r=s.target.files;if(r){j.innerHTML="";const l=Array.from(r).map(u=>new Promise((f,g)=>{const y=new FileReader;y.onload=function(k){var w;const E=(w=k.target)==null?void 0:w.result;if(E){const X=JSON.parse(E);localStorage.setItem("loadedJob",JSON.stringify({name:X.name,groupName:X.groupName}));let V=localStorage.getItem(`savedGroup_${X.groupName}`),U=JSON.parse(V);if(U){if(U.jobs.find(we=>we.name===X.name)&&!confirm("A job with this name in this group already exists. Do you want to overwrite it?"))return}else U={jobs:[]};U.jobs.push({name:X.name,tasks:X.tasks}),localStorage.setItem(`savedGroup_${X.groupName}`,JSON.stringify(U)),f({job:X})}else g(new Error("No contents"))},y.readAsText(u)}));Promise.all(l).then(u=>{const[f]=u;C(),e(),a(),x(f.job),O(),G()}).catch(u=>{console.error("Error reading files:",u)})}},t.click()},go.onclick=function(){nt.innerHTML="",Object.keys(localStorage).filter(s=>s.includes("savedGroup_")).sort().forEach(s=>{const r=s.replace("savedGroup_",""),l=document.createElement("option");l.value=r,l.textContent=r,nt.appendChild(l)}),Y(),St.style.display="block"},nt.addEventListener("change",()=>{Y()});function Y(){const t=nt.value,s=localStorage.getItem(`savedGroup_${t}`);if(s){const r=JSON.parse(s);Tt.innerHTML="",r.jobs.forEach(l=>{const u=document.createElement("option");u.value=l.name,u.textContent=l.name,Tt.appendChild(u)})}}vo.onclick=function(){const t=nt.value,s=Tt.value,r=localStorage.getItem(`savedGroup_${t}`),l=r?JSON.parse(r).jobs.find(u=>u.name===s):null;if(l){const u=l.tasks,f={name:l.name,groupName:t,tasks:[]};u.forEach(E=>{const w=localStorage.getItem(`taskCollection_${E.collectionName}`);if(w){const V=JSON.parse(w).tasks.find(U=>U.id===E.id);V&&f.tasks.push({id:V.id,collectionName:E.collectionName})}});const g=new Blob([JSON.stringify(f,null,2)],{type:"application/json"}),y=URL.createObjectURL(g),k=document.createElement("a");k.href=y,k.download=`${f.name}.json`,k.click(),URL.revokeObjectURL(y),St.style.display="none"}}});let ae;document.addEventListener("DOMContentLoaded",()=>{ae=st.getInstance(),ae.addStatusChangeListener(()=>f(),le.QUICKTASKS);const o=document.getElementById("connectButton"),e=document.getElementById("facingButton"),n=document.getElementById("groovingButton"),a=document.getElementById("profilingButton"),i=document.getElementById("coneButton"),d=document.getElementById("boringButton"),b=document.getElementById("threadingButton"),L=document.getElementsByClassName("execute"),T=document.getElementById("quickTaskFacingModal"),P=document.getElementById("quickTaskGroovingModal"),x=document.getElementById("quickTaskProfilingModal"),O=document.getElementById("quickTaskConeModal"),C=document.getElementById("quickTaskBoringModal"),G=document.getElementById("quickTaskThreadingModal"),A=document.getElementById("quickTaskFacingCloseButton"),Y=document.getElementById("quickTaskGroovingCloseButton"),t=document.getElementById("quickTaskProfilingCloseButton"),s=document.getElementById("quickTaskConeCloseButton"),r=document.getElementById("quickTaskBoringCloseButton"),l=document.getElementById("quickTaskThreadingCloseButton");let u;Array.from(L).forEach(g=>{g.addEventListener("click",()=>{ae!=null&&ae.isConnected()?(u=g,ae==null||ae.start("#",le.QUICKTASKS)):alert("Please connect to the machine first")})}),e.addEventListener("click",()=>{T.style.display="block"}),n.addEventListener("click",()=>{P.style.display="block"}),a.addEventListener("click",()=>{x.style.display="block"}),i.addEventListener("click",()=>{O.style.display="block"}),d.addEventListener("click",()=>{C.style.display="block"}),b.addEventListener("click",()=>{G.style.display="block"}),A.addEventListener("click",()=>{T.style.display="none"}),Y.addEventListener("click",()=>{P.style.display="none"}),t.addEventListener("click",()=>{x.style.display="none"}),s.addEventListener("click",()=>{O.style.display="none"}),r.addEventListener("click",()=>{C.style.display="none"}),l.addEventListener("click",()=>{G.style.display="none"});function f(){if(!ae)return;const g=ae.getStatus();if(g.isConnected===!1){o.innerText="Connect",o.disabled=!1,o.style.backgroundColor="";return}else o.innerText="Connected",o.disabled=!0,o.style.backgroundColor="green";const y=g.condition==="run";y?y&&(u.disabled=!0):u.disabled=!1}});const D=ace.edit("gcodeEditor"),ge=ace.edit("gcodeResponseEditor"),R=ace.edit("gcodeSenderEditor");let Pe={z:0,x:0};const Mo="#DC143C",Xo="#6B8E23",Jo="#FFA500",Po="#242424";document.addEventListener("DOMContentLoaded",()=>{new dn;const o=document.getElementById("gcodeCanvas"),e=document.getElementById("zoomCanvas");let n=null;const a=document.getElementById("fileInput"),i=document.getElementById("simulateButton"),d=document.getElementById("showCuts"),b=document.getElementById("showNonCuts"),L=document.getElementById("showCutsZoom"),T=document.getElementById("showNonCutsZoom"),P=document.getElementById("sliderLabel"),x=document.getElementById("zoomSliderLabel"),O=document.getElementById("progressSlider"),C=document.getElementById("zoomProgressSlider"),G=document.getElementById("sliderContainer"),A=document.getElementById("displayOptionsContainer"),Y=document.getElementById("clearButton"),t=document.querySelector(".saveGCodeNameInput"),s=document.querySelector(".loadGCodeSelect"),r=document.querySelector(".loadGCodeButton"),l=document.querySelector(".saveGCodeButton"),u=document.querySelector(".deleteGCodeButton"),f=document.getElementById("gcodeSenderContainer"),g=document.getElementById("exampleCode"),y=document.getElementById("helpModal"),k=document.getElementById("helpButton"),E=document.getElementById("closeHelpModal"),w=document.getElementById("zoomModal"),X=document.getElementById("zoomButton"),V=document.getElementById("closeZoomModal"),U=document.getElementById("zoomCloseButton"),it=document.getElementById("simulationTab"),we=document.getElementById("controlTab"),lt=document.getElementById("quickTasksTab"),ze=document.getElementById("plannerTab"),Ie=document.getElementById("connectionContainer"),Ne=document.getElementById("simulationContainer"),Le=document.getElementById("controlsContainer"),he=document.getElementById("quickTasksContainer"),re=document.getElementById("plannerContainer"),He=document.querySelectorAll("#latheControls .increment-btn"),Ve=document.getElementById("moveDistance");localStorage.getItem("helpModalShown")||(y.style.display="block",localStorage.setItem("helpModalShown","true")),He.forEach(function(m){m.addEventListener("click",function(){He.forEach(function(B){B.classList.remove("active")}),this.classList.add("active");var v=this.dataset.increment;Ve.value=v,console.log("Jog increment set to:",v)})}),it.addEventListener("click",()=>{Ne.style.display="flex",Le.style.display="none",he.style.display="none",re.style.display="none",Ie.style.display="none"}),we.addEventListener("click",()=>{Ne.style.display="none",Le.style.display="flex",he.style.display="none",re.style.display="none",Ie.style.display="block"}),lt.addEventListener("click",()=>{Ne.style.display="none",Le.style.display="none",he.style.display="flex",re.style.display="none",Ie.style.display="block"}),ze.addEventListener("click",()=>{Ne.style.display="none",Le.style.display="none",he.style.display="none",re.style.display="flex",Ie.style.display="block";const m=new Event("containerVisible");re.dispatchEvent(m)}),e.width=window.visualViewport.width-100,e.height=window.visualViewport.height-150,window.addEventListener("resize",function(){e.width=window.visualViewport.width-100,e.height=window.visualViewport.height-150,C.value=C.min,I(e)}),X.onclick=function(){w.style.display="block",I(e)},V.onclick=function(){w.style.display="none"},U.onclick=function(){w.style.display="none"},k.onclick=function(){y.style.display="block"},E.onclick=function(){y.style.display="none"},window.onclick=function(m){m.target==y&&(y.style.display="none"),m.target==w&&(w.style.display="none")},l.addEventListener("click",()=>$()),r.addEventListener("click",()=>M()),u.addEventListener("click",()=>ke()),J(),D.setTheme("ace/theme/github_dark"),D.session.setMode("ace/mode/plain_text"),D.setShowPrintMargin(!1),R.setTheme("ace/theme/github_dark"),R.session.setMode("ace/mode/plain_text"),R.setShowPrintMargin(!1),g.addEventListener("click",()=>on()),ge.setTheme("ace/theme/monokai"),ge.session.setMode("ace/mode/text"),ge.setReadOnly(!0),ge.setShowPrintMargin(!1),ge.getSession().on("change",()=>{setTimeout(()=>{var m=ge.getSession().getLength();ge.scrollToLine(m,!0,!0,function(){})},0)}),R.on("focus",()=>{R.getValue()==="Paste your gcode here or click choose file to upload"&&R.setValue("")}),te();let xe=0,Oe=0,ve=0,ye=0,Ae=0,$e=0,Ue=5,c=0,h=0,p=[];O.oninput=()=>{const m=Math.floor(parseInt(O.value));if(m<p.length){const v=p[m];let B=_e(p,o);Ke(o,p,B,m),F(v)}},C.oninput=()=>{const m=Math.floor(parseInt(C.value));if(m<p.length){const v=p[m];let B=_e(p,e);Ke(e,p,B,m),z(v)}},Y.addEventListener("click",()=>{R.setValue(""),D.setValue(""),te();const m=o.getContext("2d");m&&(m.clearRect(0,0,o.width,o.height),a.value="",O.value="0",C.value="0",G.style.display="none",A.style.display="none")}),a.addEventListener("change",m=>{if(m.target instanceof HTMLInputElement&&m.target.files&&m.target.files.length>0){const v=m.target.files[0];v&&ce(v)}}),i.addEventListener("click",()=>{I(o)});function I(m){if(!m)return;const v=D.getValue();if(v){ne(v);let B=_e(p,m);Ke(m,p,B),G.style.display="block",A.style.display="block",d.addEventListener("change",rt),b.addEventListener("change",rt),L.addEventListener("change",ct),T.addEventListener("change",ct),O.max=(p.length-1).toString(),O.value=O.min,C.max=(p.length-1).toString(),C.value=C.min,f.style.display="block"}}function $(){const m=t.value.trim();if(!m)return;const v=`gCode-${m}`;localStorage.setItem(v,D.getValue()),J(v),t.value=""}function M(){const m=s.value,v=localStorage.getItem(m);v&&(D.setValue(v),R.setValue(v))}function ke(){const m=s.value;localStorage.removeItem(m),J()}function J(m){s.innerHTML="";let v=!1;for(let B=0;B<localStorage.length;B++){const N=localStorage.key(B);if(N&&N!=="latheCode"&&N.startsWith("gCode-")){v=!0;const _=document.createElement("option"),Z=N.replace("gCode-","");_.value=N,_.textContent=Z,s.appendChild(_),N===m&&(_.selected=!0)}}if(v){const B=Array.from(s.options).sort((N,_)=>N.text.localeCompare(_.text));s.innerHTML="",B.forEach(N=>{s.appendChild(N)})}else{const B=document.createElement("option");B.textContent="No items saved",B.disabled=!0,s.appendChild(B)}}function te(){const m=D.getValue(),v=R.getValue();m===""&&(D.setValue("Paste your gcode here or click choose file to upload"),D.gotoLine(1,0),D.on("focus",function(){D.getValue()==="Paste your gcode here or click choose file to upload"&&D.setValue("")})),v===""&&(R.setValue("Paste your gcode here or click choose file to upload"),R.gotoLine(1,0),R.on("focus",function(){R.getValue()==="Paste your gcode here or click choose file to upload"&&R.setValue("")}))}function F(m){var v,B,N;(m==null?void 0:m.lineNumber)!==void 0?(D.gotoLine(m.lineNumber,0,!0),P.innerHTML=`Line:${m.lineNumber}<br>${m==null?void 0:m.originalLine}<br>Abs: X${((v=m.absolutePosition)==null?void 0:v.x)??0} &lpar;Dia: ${(((B=m.absolutePosition)==null?void 0:B.x)??0)*2}&rpar; Z${(N=m.absolutePosition)==null?void 0:N.z}`||""):P.innerHTML=""}function z(m){var v,B,N;(m==null?void 0:m.lineNumber)!==void 0?(D.gotoLine(m.lineNumber,0,!0),x.innerHTML=`Line:${m.lineNumber}<br>${m==null?void 0:m.originalLine}<br>Abs: X${(v=m.absolutePosition)==null?void 0:v.x} &lpar;Dia: ${(((B=m.absolutePosition)==null?void 0:B.x)??0)*2}&rpar; Z${(N=m.absolutePosition)==null?void 0:N.z}`||""):x.innerHTML=""}function ce(m){const v=new FileReader;v.onload=B=>{const N=B.target.result;D.setValue(N),R.setValue(N)},v.readAsText(m)}function ne(m){const v=[];let B=!1;return p=[],m.split(`
`).forEach((_,Z)=>{const ue=_.includes("; cut")?0:_.includes("; retract")?2:1,W={isRelative:B,movementType:ue},Me=_.match(/([GXYZF])([0-9.-]+)/g);Me==null||Me.forEach(ut=>{const oe=parseFloat(ut.slice(1));switch(ut[0]){case"G":oe===90&&(W.isRelative=!1,B=!1),oe===91&&(W.isRelative=!0,B=!0);break;case"X":W.x=parseFloat(oe.toFixed(3)),B?Pe.x=parseFloat((Pe.x+oe).toFixed(3)):Pe.x=parseFloat(oe.toFixed(3));break;case"Z":W.z=parseFloat(oe.toFixed(3)),B?Pe.z=parseFloat((Pe.z+oe).toFixed(3)):Pe.z=parseFloat(oe.toFixed(3));break}});const Re={...W,lineNumber:Z+1,originalLine:_,absolutePosition:{...Pe}};(W.z!==void 0||W.x!==void 0)&&p.push(Re),v.push(Re)}),v}function rt(){L.checked=d.checked,T.checked=b.checked,O.value="0";const m=_e(p,o);Ke(o,p,m,p.length)}function ct(){d.checked=L.checked,b.checked=T.checked,C.value="0";const m=_e(p,e);Ke(e,p,m,p.length)}function _e(m,v){let B=0,N=0,_=m.find(Q=>!Q.isRelative),Z=_&&_.x?_.x:0,ue=_&&_.z?_.z:0;const W=5;m.forEach(Q=>{Q.x!==void 0&&(Q.isRelative?(Z+=Q.x,Z<N&&(N=Z)):Q.x<N&&(N=Q.x)),Q.z!==void 0&&(Q.isRelative?(ue+=Q.z,ue>B&&(B=ue)):Q.z>B&&(B=Q.z))});const Me=Math.abs(N),Re=Math.abs(B),ut=v.height/2-W,oe=v.width-W-Ue,sn=ut/Me,an=oe/Re;return Math.min(sn,an)}function Ke(m,v,B,N){if(n=m.getContext("2d"),!n)return;n.clearRect(0,0,m.width,m.height),xe=0,Oe=0,Ae=0,$e=0,ve=0,ye=0,ve=m.height/2,ye=m.width-Ue;const _=N!==void 0?Math.min(N+1,v.length):v.length;for(let Z=0;Z<_;Z++)nn(m,v[Z],B,Z===N)}function nn(m,v,B,N){if(n=m.getContext("2d"),!n)return;let _=d.checked||L.checked,Z=b.checked||T.checked;n.lineWidth=2,v.isRelative?(xe+=v.x??0,Oe+=v.z??0):(xe=v.x??Ae,Oe=v.z??$e,Ae=xe,$e=Oe),c=m.height/2-xe*B,h=m.width-Oe*B-Ue;let ue="";if((v.movementType==0&&_||v.movementType==1&&Z||v.movementType==2&&Z)&&(n.beginPath(),ue=v.movementType==0?Mo:v.movementType==1?Xo:Jo,n.moveTo(ye,ve),n.lineTo(h,c),N?(n.strokeStyle=ue,n.setLineDash([5,5]),n.lineDashOffset=0,n.stroke(),n.strokeStyle=Po,n.setLineDash([5,5]),n.lineDashOffset=-5,n.stroke()):(n.strokeStyle=ue,n.setLineDash([]),n.stroke()),N)){let W=h-ye,Me=c-ve,Re=Math.atan2(Me,W);n.save(),n.translate(ye,ve),n.rotate(Re+Math.PI/2),n.beginPath(),n.moveTo(0,-5),n.lineTo(-5,5),n.lineTo(5,5),n.closePath(),n.fillStyle="green",n.fill(),n.restore(),n.beginPath(),n.rect(h-3,c-3,6,6),n.fillStyle="red",n.fill()}ve=c,ye=h}function on(){D.setValue(mn)}});

</script>
  <style>
:root{font-family:Inter,system-ui,Avenir,Helvetica,Arial,sans-serif;line-height:1.5;font-weight:400;color-scheme:light dark;color:#ffffffde;background-color:#202124;font-synthesis:none;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}a{font-weight:500;color:#646cff;text-decoration:inherit}a:hover{color:#535bf2}h1{font-size:3.2em;line-height:1.1}#app{max-width:1280px;margin:0 auto;padding:2rem;text-align:center}.logo{height:6em;padding:1.5em;will-change:filter;transition:filter .3s}.logo:hover{filter:drop-shadow(0 0 2em #646cffaa)}.logo.vanilla:hover{filter:drop-shadow(0 0 2em #3178c6aa)}.card{padding:2em}.read-the-docs{color:#888}button{border-radius:3px;padding:.6em 1.2em;font-size:1em;font-weight:500;font-family:inherit;background-color:#1a1a1a;cursor:pointer;transition:background-color .25s;border:2px solid white;color:#fff}button:hover{background-color:#646cff}button:focus,button:focus-visible{outline:4px auto -webkit-focus-ring-color}.disabled-button{background-color:red;cursor:not-allowed}.interaction-ready-button{background-color:green}.icon-container{width:60px;height:50px;padding:5px 10px}.icon-container svg{width:100%;height:100%}#simulationContainer{display:flex;flex-direction:column;width:800px;max-width:1280px;text-align:center}.main-container{display:flex;width:100%}#interactiveComponentsContainer,#controlsContainer,#quickTasksContainer{display:flex;flex-direction:column;width:800px;max-width:1280px;text-align:center}button.quick-tasks-innercontainer{display:flex;align-items:center;cursor:pointer;background:none;border:none;padding:0;margin:5px 0;border:1px solid #ccc;border-radius:5px;background-color:#333;flex-direction:column;justify-content:center;width:100%;box-sizing:border-box}button.quick-tasks-innercontainer:hover{background-color:#6c5ce7}button.execute{padding:0 10px}input.quick-task-summary{width:auto;box-sizing:border-box}.quick-tasks-subinnercontainer{display:flex;flex-direction:row}.controls-container,.connection-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;border:1px solid #ccc}.canvas-container{display:flex;flex-direction:column;align-items:center;margin:5px;border:1px solid #ccc}.canvas-wrapper{display:flex;flex-direction:column;align-items:center}.innerContainer{margin:5px;align-items:center;width:auto}.modal-pad{padding-top:10px}.modal-pad-bottom{padding-bottom:10px}.emulation-modal-pad-border{padding:10px;border:2px dashed green;min-height:40px}.innerContainer.toolbar{display:flex;align-items:center;gap:5px;padding:2px}.saveGCodeNameInput,.loadGCodeSelect{flex-grow:1}#gcodeCanvas{border-bottom:1px solid #ccc;background-color:#242424}#gcodeInput{position:relative;background:transparent;width:100%;height:240px;font-family:monospace;font-size:13px;line-height:1.5;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}#gcodeContainer{position:relative;width:100%}#gcodeSenderContainer{display:block}.save-group,.load-group,.import-export-group{display:flex;flex-direction:row;align-items:center;gap:10px}.toolbar input[type=text],.toolbar select{max-width:200px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem;font-size:1rem;line-height:1.5}input[type=file]::file-selector-button{border:2px solid #6c5ce7;padding:.2em .4em;border-radius:.2em;background-color:#1a1a1a;transition:.25s}input[type=file]::-ms-browse:hover{background-color:#646cff}input[type=file]::-webkit-file-upload-button:hover{background-color:#646cff}input[type=file]::file-selector-button:hover{background-color:#646cff}.bottom-container{margin:5px}#gcodeResponseContainer{border:1px solid #ccc;width:100%;display:flex;flex-direction:column;align-items:center;margin-top:5px}.senderError{display:none;color:#fff;background-color:red;padding:10px;border-radius:5px;animation:flashError 1s infinite}@keyframes flashError{0%,to{opacity:1}50%{opacity:0}}#helpText li{margin-bottom:10px}#helpText a{color:#f95959}.help-modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.help-modal-content{position:relative;background-color:#242424;margin:15% auto;padding:20px;border:2px solid #6c5ce7;width:30%}.zoom-modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#242424}.zoom-modal-content{display:flex;flex-direction:column;align-items:center;margin:10px auto;padding:20px;border:1px solid #888}.close-modal{position:absolute;top:0;right:0;padding-right:10px;cursor:pointer;font-size:35px}#sliderAndButtonContainer{display:flex;justify-content:center;align-items:center;gap:10px;flex-direction:column}.text-red{color:#dc143c}.text-green{color:#6b8e23}.text-orange{color:orange}.line{display:inline-block;vertical-align:middle;width:20px;height:2px;margin-right:5px}.red-line{border-top:2px solid #DC143C}.green-line{border-top:2px solid #6B8E23}.orange-line{border-top:2px solid #FFA500}#latheControls #jogControls{display:grid;grid-template-columns:repeat(10,60px);grid-template-rows:repeat(6,60px);justify-content:center;align-items:center;place-items:center}#latheControls .jog-btn,#latheControls .tool-btn{width:50px;height:50px;border-radius:5px;cursor:pointer;background-color:#f0ad4e;display:flex;justify-content:center;align-items:center;text-align:center;line-height:50px;font-size:24px;padding:0}#latheControls .tool{background-color:#f0ad4e;border:none}#latheControls .tool-selected{background-color:#6c5ce7;border:2px solid white}#latheControls .fast{background-color:#f0ad4e}#latheControls .slow{background-color:#5bc0de}#latheControls .jog-btn:hover{background-color:#6c5ce7}#jogText{grid-column:6;grid-row:1}#fastForward{grid-column:6;grid-row:2}#fastText{grid-column:5;grid-row:2}#slowText{grid-column:5;grid-row:3}#fastLeft{grid-column:4;grid-row:4}#fastBackward{grid-column:6;grid-row:6}#fastRight{grid-column:8;grid-row:4}#slowForward{grid-column:6;grid-row:3}#slowLeft{grid-column:5;grid-row:4}#slowBackward{grid-column:6;grid-row:5}#slowRight{grid-column:7;grid-row:4}#toolText{grid-column:1;grid-row:1}#tool0{grid-column:1;grid-row:2}#tool1{grid-column:1;grid-row:3}#tool2{grid-column:1;grid-row:4}#tool3{grid-column:1;grid-row:5}#tool4{grid-column:1;grid-row:6}#tool5{grid-column:2;grid-row:2}#tool6{grid-column:2;grid-row:3}#tool7{grid-column:2;grid-row:4}#tool8{grid-column:2;grid-row:5}#tool9{grid-column:2;grid-row:6}.menu ul{list-style-type:none;padding:0}.menu li{cursor:pointer;padding:10px;background-color:#242424;border-bottom:1px solid #6c5ce7}.menu li:hover{background-color:#6c5ce7}.content{margin-left:200px;padding:20px}#senderProgressContainer{display:flex;justify-content:center;align-items:center}#senderProgressLabel{margin-right:10px}.innerContentCentre{display:flex;justify-content:center;align-items:center;margin:10px}#gcodeSenderContainer{position:relative;width:100%}#latheControls #incrementControls{display:flex;justify-content:center;gap:10px;margin:20px 0}#latheControls .increment-btn{padding:5px 10px;border:1px solid #ccc;background-color:#f0ad4e;border-radius:5px;cursor:pointer;transition:background-color .3s}#latheControls .increment-btn:hover,#latheControls .increment-btn.active{background-color:#6c5ce7}.control-inputs input[type=text]{max-width:200px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem}.control-inputs label{display:block;margin-right:5px}.sender-inputs input[type=text]{max-width:350px;min-width:350px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem}#latheControls label{white-space:nowrap;margin-right:10px;display:inline-block;min-width:120px}#plannerContainer{display:flex;flex-direction:column;width:800px;max-width:1280px;text-align:center}.planner-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;border:1px solid #ccc}.planner-container h1{margin:10px 0}.planner-guidance{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:10px;text-align:center}.planner-guidance span{display:block;margin:10px 0;text-align:left}#taskContainer{display:flex;justify-content:space-between;align-items:start;padding:20px}.container-wrapper{padding:10px}.container-wrapper-inner{padding:5px 0}.container-wrapper-outer{border:1px solid #ccc;border-radius:5px;margin:10px;background-color:#333}.container-wrapper-delete{min-height:50px;display:flex;justify-content:center;align-items:center;border:2px dashed red}#availableTasks{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;align-items:start;min-width:450px}#availableTasks .span-2-rows{grid-row:span 3;height:100%}#availableTasks div{box-sizing:border-box;padding:5px}#tasksToExecute{min-height:50px;padding:5px;border:2px dashed green}#tasksToExecute div{margin:5px}.task-to-execute{text-align:left}.task-to-execute i{text-align:left;margin-left:5px;cursor:help}.available-task{width:150px;-webkit-user-select:none;user-select:none}.available-task i{margin-left:5px;cursor:help}.task-manual{background-color:#4c956c}.task-gcode{background-color:#386e97}.task-emulation{background-color:#e74c3c}.emulate-noselect{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#emulationInnerContainer{display:flex;flex-direction:row;justify-content:center;align-items:center;height:100%}#emulationNewTasksMovement{display:grid;grid-template-columns:repeat(9,40px);grid-template-rows:repeat(3,40px);gap:3px;align-items:center;justify-items:center}#emulationNewTasksNumbers,#emulationNewTasksOther{display:grid;grid-template-columns:repeat(2,40px);grid-template-rows:repeat(6,40px);gap:3px;align-items:center;justify-items:center}#emulationNewTasksMode{display:grid;grid-template-columns:repeat(8,40px);grid-template-rows:repeat(1,40px);gap:3px;align-items:center;justify-items:center}#movementContainer,#modeContainer{width:100%;display:flex;justify-content:center;align-items:center;margin:5px;padding:5px}#emulateKeyUp{grid-area:1 / 2}#emulateKeyDown{grid-area:3 / 2}#emulateKeyLeft{grid-area:2 / 1}#emulateKeyRight{grid-area:2 / 3}#emulateKeyPlay{grid-area:1 / 5}#emulateKeyStop{grid-area:3 / 5}#emulateKeyStopUp{grid-area:1 / 8}#emulateKeyStopDown{grid-area:3 / 8}#emulateKeyStopLeft{grid-area:2 / 7}#emulateKeyStopRight{grid-area:2 / 9}#emulationNewTasksMode button.material-symbols-outlined{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksMode button:hover{background-color:#18a79b}#emulationNewTasksMode button:focus,#emulationNewTasksMode button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksMovement button.material-symbols-outlined{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksMovement button:hover{background-color:#18a79b}#emulationNewTasksMovement button:focus,#emulationNewTasksMovement button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksNumbers button{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700;font-family:monospace}#emulationNewTasksNumbers button:hover{background-color:#18a79b}#emulationNewTasksNumbers button:focus,#emulationNewTasksNumbers button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksOther button{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksOther button:hover{background-color:#18a79b}#emulationNewTasksOther button:focus,#emulationNewTasksOther button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}.emulated-button-list{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700!important}.standard-font{font-family:monospace!important}#emulationNewTasks{list-style-type:none;display:grid;grid-template-columns:repeat(11,1fr);grid-auto-rows:auto;gap:10px;padding:0;margin:0}#emulateKeySteps{transform:scaleX(-1)}.flexCol{display:flex;flex-direction:column;align-items:center;justify-content:center}.outerCol{padding-top:15px}.middleCol{align-self:flex-start}.task-container{margin:5px}.task-container>div,.gu-mirror{transition:opacity .4s ease-in-out}.task-container>div{padding:5px;cursor:move;cursor:grab;cursor:-moz-grab;cursor:-webkit-grab;display:flex;align-items:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.gu-mirror{padding:5px;text-align:center;cursor:grabbing;cursor:-moz-grabbing;cursor:-webkit-grabbing}.task-container .ex-moved{background-color:#e74c3c}.task-container.ex-over{background-color:#ffffff4d}.planner-save-text{max-width:none!important}.planner-save-button{flex:auto}.planner-load-select{max-width:none!important}.planner-load-delete-buttons{width:50%}.planner-saving-label{text-wrap:nowrap}.no-marge{margin:0}.task-modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.task-modal-content{position:relative;background-color:#242424;margin:15% auto;padding:20px;border:2px solid #6c5ce7;max-width:600px;min-width:600px}.center-modal{text-align:center}.icon-tooltip{position:relative;cursor:pointer}.icon-tooltip:after{content:attr(data-tooltip);position:absolute;bottom:100%;left:50%;transform:translate(-50%);white-space:nowrap;z-index:1;background-color:#000;color:#fff;padding:5px;border-radius:4px;opacity:0;visibility:hidden;transition:opacity .2s,visibility .2s}.icon-tooltip:hover:after{opacity:1;visibility:visible}.threading-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;width:800px;max-width:1280px;text-align:center;border:1px solid #ccc}.gu-mirror{position:fixed!important;margin:0!important;z-index:9999!important;opacity:.8}.gu-hide{display:none!important}.gu-unselectable{-webkit-user-select:none!important;-moz-user-select:none!important;-ms-user-select:none!important;user-select:none!important}.gu-transit{opacity:.2}

</style>
</head>

<body>

    <div id="mainContainer" class="main-container">
        <div class="menu">
            <ul>
                <li id="simulationTab">Simulation</li>
                <li id="controlTab">Control</li>
                <li id="quickTasksTab">Quick Tasks</li>
                <li id="plannerTab">Planner</li>
            </ul>
        </div>

        <div id="simulationContainer" class="main-container">
            <div id="simulationContent" class="controls-container">
                <div id="gcodeContainer" style="position: relative;">
                    <div id="gcodeEditor" style="height: 200px; width: 100%;"></div>
                </div>
                <div class="innerContainer">
                    <input type="file" id="fileInput" accept=".txt,.gcode">
                </div>
                <div class="innerContainer">
                    <button id="simulateButton">Simulate</button>
                    <button id="clearButton">Clear</button>
                    <button id="helpButton">How to use</button>
                </div>


                <div class="innerContainer" id="loadAndSave">


                    <hr>
                    <div class="innerContainer toolbar">
                        <input type="text" class="saveGCodeNameInput" placeholder="name of save"></input>
                        <button class="saveGCodeButton" title="Save GCode to local browser storage">Save local</button>
                    </div>
                    <div class="innerContainer toolbar">
                        <select class="loadGCodeSelect"></select>
                        <button class="loadGCodeButton" title="Load GCode from local browser storage">Load</button>
                        <button class="deleteGCodeButton" title="Delete GCode from local browser storage">Delete</button>
                    </div>
                    <hr>
                </div>
            </div>

            <div class="canvas-container">
                <canvas id="gcodeCanvas" width="785" height="600"></canvas>
                <div id="sliderContainer" class="innerContainer" style="display: none; width: 400px;">
                    <input type="range" id="progressSlider" min="0" max="100" value="0" style="width: 100%;">
                    <div id="sliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                </div>
                <div id="displayOptionsContainer" class="innerContainer" style="display: none;">
                    <input type="checkbox" id="showCuts" checked> Show Cut Moves
                    </label>
                    <label>
                        <input type="checkbox" id="showNonCuts" checked>
                        Show Non-Cut Moves
                    </label>
                </div>
                <div id="sliderContainer" class="innerContainer" style="display: none; width: 400px;">
                    <input type="range" id="progressSlider" min="0" max="100" value="0" style="width: 100%;">
                    <div id="sliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                </div>
                <div class="innerContainer"><button id="zoomButton" title="Zoom in">Zoom In</button></div>
            </div>

        </div>

        <div id="interactiveComponentsContainer" class="main-container">
            <div id="connectionContainer" class="connection-container" style="display: none;">
                <div class="innerContainer">
                    <button id="connectButton" title="Connect to Nano ELS H4">Connect</button>
                </div>
            </div>
            <div id="controlsContainer" class="main-container" style="display: none;">
                <div id="controlsContent" class="controls-container">

                    <div id="latheControls">
                        <div id="jogControls">
                            <span id="fastText">Fast</span>
                            <span id="slowText">Slow</span>
                            <span id="toolText">Tool</span>

                            <!-- Tools -->
                            <button class="tool-btn tool-selected" id="tool0">T0</button>
                            <button class="tool-btn" id="tool1">T1</button>
                            <button class="tool-btn" id="tool2">T2</button>
                            <button class="tool-btn" id="tool3">T3</button>
                            <button class="tool-btn" id="tool4">T4</button>
                            <button class="tool-btn" id="tool5">T5</button>
                            <button class="tool-btn" id="tool6">T6</button>
                            <button class="tool-btn" id="tool7">T7</button>
                            <button class="tool-btn" id="tool8">T8</button>
                            <button class="tool-btn" id="tool9">T9</button>

                            <span id="jogText">Move</span>
                            <!-- Fast arrows -->
                            <button class="arrow fast jog-btn" id="fastForward"><i class="fas fa-arrow-up"></i></button>
                            <button class="arrow fast jog-btn" id="fastBackward"><i
                                    class="fas fa-arrow-down"></i></button>
                            <button class="arrow fast jog-btn" id="fastLeft"><i class="fas fa-arrow-left"></i></button>
                            <button class="arrow fast jog-btn" id="fastRight"><i
                                    class="fas fa-arrow-right"></i></button>
                            <!-- Slow arrows -->
                            <button class="arrow slow jog-btn" id="slowForward"><i class="fas fa-arrow-up"></i></button>
                            <button class="arrow slow jog-btn" id="slowBackward"><i
                                    class="fas fa-arrow-down"></i></button>
                            <button class="arrow slow jog-btn" id="slowLeft"><i class="fas fa-arrow-left"></i></button>
                            <button class="arrow slow jog-btn" id="slowRight"><i
                                    class="fas fa-arrow-right"></i></button>
                        </div>
                        <div id="incrementControls">
                            <button class="increment-btn" data-increment="0.01">0.01</button>
                            <button class="increment-btn" data-increment="0.1">0.1</button>
                            <button class="increment-btn active" data-increment="1">1</button>
                            <button class="increment-btn" data-increment="10">10</button>
                        </div>
                        <div id="feedrateControls" class="innerContentCentre control-inputs">
                            <label for="fastFeedrate">Fast Feedrate:</label>
                            <input type="text" id="fastFeedrate" name="fastFeedrate" value="200">
                            <label for="slowFeedrate">Slow Feedrate:</label>
                            <input type="text" id="slowFeedrate" name="slowFeedrate" value="50">
                        </div>
                        <div id="distanceControl" class="innerContentCentre control-inputs">
                            <label for="moveDistance">Move Distance (mm):</label>
                            <input type="text" id="moveDistance" name="moveDistance" value="1">
                        </div>
                    </div>

                    <div id="gcodeResponseContainer" style="display: none;">
                        <div id="gcodeResponseHeader">GCode Responses</div>
                        <div id="gcodeResponseEditor" style="height: 200px; width: 100%;"></div>
                        <div class="senderError" style="display: none;"></div>
                        <div id="senderProgressContainer">
                            <span id="senderProgressLabel" style="display: none;">Progress...</span>
                            <progress id="senderProgress" max="1" style="display: none;"></progress>
                        </div>
                    </div>
                </div>
                <div class="controls-container">
                    <div class="innerContainer control-inputs">
                        <div class="innerContentCentre control-inputs">
                            <span>Send single command</span>
                        </div>
                        <div class="innerContentCentre sender-inputs">
                            <input id="singleCommandSender" type="text" name="singleCommandSender"></input>
                        </div>
                        <div class="innerContentCentre control-inputs">
                            <button id="gcodeSendSingleCommandButton" title="Send GCode to CNC">Send</button>
                        </div>
                    </div>
                </div>
                <div class="controls-container">
                    <div id="gcodeSenderContainer" style="position: relative;">
                        <span>Send multi line commands</span>
                        <div id="gcodeSenderEditor" style="height: 200px; width: 100%;"></div>
                    </div>
                    <div class="innerContainer">
                        <button id="gcodeSenderButton" title="Send GCode to CNC">Send</button>
                        <button id="stopButton" style="display: none;">Stop</button>
                    </div>
                </div>
            </div>
            <div id="quickTasksContainer" class="main-container" style="display: none;">
                <div id="quickTasksContent" class="controls-container">
                    <div class="innerContainer">
                        <h1>Quick Tasks</h1>
                        <button id="facingButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- L-shape -->
                                        <path d="M5 45 L35 45 L35 5" fill="none" stroke="white" stroke-width="3" />

                                        <!-- Arrow stem -->
                                        <line x1="50" y1="45" x2="50" y2="10" stroke="white" stroke-width="3" />

                                        <!-- Arrow head -->
                                        <path d="M42 17 L50 5 L58 17 Z" fill="white" />
                                    </svg>
                                </div>
                                <p>Facing</p>
                            </div>

                        </button>
                        <button id="groovingButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 60">
                                        <!-- U-shape rotated correctly (facing up) -->
                                        <path d="M5 55 L5 5 L45 5 L45 55" fill="none" stroke="white" stroke-width="3" />

                                        <!-- Arrow stem -->
                                        <line x1="25" y1="45" x2="25" y2="15" stroke="white" stroke-width="3" />

                                        <!-- Arrow head (filled) -->
                                        <path d="M17 22 L25 10 L33 22 Z" fill="white" />
                                    </svg>
                                </div>
                                <p>Grooving</p>
                            </div>
                        </button>
                        <button id="profilingButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Rotated L-shape -->
                                        <path d="M55 5 L5 5 L5 35" fill="none" stroke="white" stroke-width="3" />

                                        <!-- Arrow stem -->
                                        <line x1="22" y1="30" x2="50" y2="30" stroke="white" stroke-width="3" />

                                        <!-- Arrow head (filled) -->
                                        <path d="M22 22 L10 30 L22 38 Z" fill="white" />
                                    </svg>
                                </div>
                                <p>Profiling</p>
                            </div>
                        </button>
                        <button id="coneButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Sideways trapezoid -->
                                        <path
                                            d="M10 5 L50 15 L50 35 L10 45 Z"
                                            fill="none"
                                            stroke="white"
                                            stroke-width="3"
                                        />
                                    </svg>
                                </div>
                                <p>Cone</p>
                            </div>
                        </button>
                        <button id="boringButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Correctly rotated squared U-shape (90 clockwise) -->
                                        <path d="M55 5 L5 5 L5 45 L55 45" fill="none" stroke="white" stroke-width="3" />

                                        <!-- Arrow stem -->
                                        <line x1="22" y1="25" x2="42" y2="25" stroke="white" stroke-width="3" />

                                        <!-- Arrow head (filled) -->
                                        <path d="M22 17 L10 25 L22 33 Z" fill="white" />
                                    </svg>
                                </div>
                                <p>Boring</p>
                            </div>
                        </button>
                        <button id="threadingButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Background rectangle -->
                                        <!--<rect x="0" y="7.5" width="60" height="35" fill="#e0e0e0"></rect> -->

                                        <!-- Thread lines -->
                                        <line x1="6" y1="41.7" x2="18" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <line x1="15" y1="41.7" x2="27" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <line x1="24" y1="41.7" x2="36" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <line x1="33" y1="41.7" x2="45" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <line x1="42" y1="41.7" x2="54" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <!-- Corrected start of thread -->
                                        <line x1="-3" y1="41.7" x2="9" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <!-- Corrected end of thread -->
                                        <line x1="51" y1="41.7" x2="63" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                    </svg>
                                </div>
                                <p>Threading</p>
                            </div>
                        </button>
                    </div>
                </div>
            </div>

            <div id="plannerContainer" class="main-container" style="display: none;">
                <div id="plannerContent" class="planner-container">
                    <div class="innerContainer">
                        <h1>Planner</h1>
                        <div class="planner-guidance">
                            <span>Use this tool to create a job of tasks to execute. This can be manual, gcode, button
                                press
                                emulation or a
                                combination
                                of them.
                                When you click execute the job wizard will execute the tasks one after another. Each
                                task
                                with require confirmation to start.</span>
                        </div>
                    </div>
                    <div id="taskContainer">
                        <div class="container-wrapper-outer">
                            <div class="container-wrapper">
                                <h2>Current Job</h2>
                                <span>Drag an available task to below</span>
                                <div id="tasksToExecute" class="task-container">
                                </div>
                            </div>
                            <div class="container-wrapper">
                                <button id="executeJobButton">Execute Job</button>
                            </div>
                            <hr>
                            <div class="container-wrapper">
                                <div class="innerContainer" id="loadAndSaveJob">
                                    <div class="innerContainer toolbar">
                                        <button id="saveJobButton" class="planner-save-button" title="Save Job to local browser storage">Save
                                            Job</button>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <button id="newJobButton" class="planner-save-button" title="Create a new job">New
                                            Job</button>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <button id="loadJobButton" class="planner-load-delete-buttons" title="Load Job from local browser storage">Load</button>
                                        <button id="deleteJobButton" class="planner-load-delete-buttons" title="Delete Job from local browser storage">Delete</button>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <span class="planner-saving-label">Group:</span>
                                        <select id="groupLoadSelect" class="planner-load-select">
                                        </select>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <span class="planner-saving-label">Job:</span>
                                        <select id="jobLoadSelect" class="planner-load-select">
                                        </select>
                                    </div>
                                    <div class="container-wrapper-inner">
                                        <hr>
                                    </div>
                                    <span class="planner-saving-label">Import and export Job to JSON</span>
                                    <div class="innerContainer toolbar">
                                        <button id="importJobButton" class="planner-load-delete-buttons" title="Import Job from JSON file">Import</button>
                                        <button id="exportJobButton" class="planner-load-delete-buttons" title="Export Job to JSON">Export</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="container-wrapper-outer">
                            <div class="container-wrapper">
                                <h2>Available Tasks</h2>
                                <div id="availableTasks" class="task-container">
                                </div>
                            </div>
                            <div class="container-wrapper">
                                <div class="container-wrapper-inner">
                                    <span>Drag here to delete</span>
                                </div>
                                <div id="deleteTasks" class="container-wrapper-delete">
                                </div>
                            </div>
                            <div class="container-wrapper">
                                <button id="addNewTaskButton">Add New Task</button>
                            </div>
                            <div class="container-wrapper-inner">
                                <hr class="no-marge">
                            </div>
                            <div class="container-wrapper">
                                <div class="innerContainer" id="loadAndSaveAvailableTasks">
                                    <div><span>Task Collections</span></div>
                                    <div class="innerContainer toolbar">
                                        <button id='saveAvailableTaskCollection' class="planner-save-button" title="Save Task to local browser storage">Save tasks to a collection
                                            <i class="far fa-save show-info icon-tooltip"
                                                data-tooltip="Save to local machine"></i>
                                        </button>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <select id="availableTaskCollections" class="planner-load-select">
                                            <option value="" disabled>Select your option</option>
                                        </select>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <button id="loadTaskCollection" class="planner-load-delete-buttons" title="Load selected collection">Load collection</button>
                                        <button id="deleteTaskCollection" class="planner-load-delete-buttons" title="Delete selected collection">Delete collection</button>
                                    </div>
                                    <div class="container-wrapper-inner">
                                        <hr>
                                    </div>
                                    <span class="planner-saving-label">Import and export tasks via JSON</span>
                                    <div class="innerContainer toolbar">
                                        <button id="importAvailableTasks" class="planner-load-delete-buttons" title="Import tasks from JSON file">Import</button>
                                        <button id="exportAvailableTasks" class="planner-load-delete-buttons" title="Export tasks to JSON">Export</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Quick Task Facing Modal-->
        <div id="quickTaskFacingModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Facing Modal</h2>
                <div class="modal-pad-bottom">
                    <label for="facingFeedRate">Facing Feed Rate (mm per minute):</label>
                    <input type="text" id="facingFeedRate" name="facingFeedRate" placeholder="50">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskFacingExecuteButton" class="execute" title="Execute facing command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="green" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskFacingCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Grooving Modal-->
        <div id="quickTaskGroovingModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Grooving Modal</h2>
                <div class="modal-pad-bottom">
                    <label for="groovingDepth">Depth of groove in mm:</label>
                    <input type="text" id="groovingDepth" name="groovingDepth" placeholder="50">
                </div>
                <div class="modal-pad-bottom">
                    <label for="groovingWidth">Width of groove in mm:</label>
                    <input type="text" id="groovingWidth" name="groovingWidth" placeholder="50">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskGroovingExecuteButton" class="execute" title="Execute grooving command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="green" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskGroovingCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Profiling Modal-->
        <div id="quickTaskProfilingModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Profiling Modal</h2>
                <div class="modal-pad-bottom">
                    <label for="profilingLength">Length to profile (mm)</label>
                    <input type="text" id="profilingLength" name="profilingLength" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <label for="profilingDepth">Depth (mm)</label>
                    <input type="text" id="profilingDepth" name="profilingDepth" placeholder="0.2">
                </div>
                <div class="modal-pad-bottom">
                    <label for="profilingPasses">Passes</label>
                    <input type="text" id="profilingPasses" name="profilingPasses" placeholder="1">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskProfilingExecuteButton" class="execute" title="Execute profiling command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="green" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskProfilingCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Cone Modal-->
        <div id="quickTaskConeModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Quick Task: Cone</h2>
                <div class="modal-pad-bottom">
                    <label for="coneStartingDepth">Starting Depth (radius mm)</label>
                    <input type="text" id="coneStartingDepth" name="coneStartingDepth" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <label for="coneEndingDepth">Ending Depth (radius mm)</label>
                    <input type="text" id="coneEndingDepth" name="coneEndingDepth" placeholder="0.2">
                </div>
                <div class="modal-pad-bottom">
                    <label for="coneInternalExternal">External or Internal</label>
                    <select id="coneInternalExternal" name="coneInternalExternal">
                        <option value="External">External</option>
                        <option value="Internal">Internal</option>
                    </select>
                </div>
                <div class="modal-pad-bottom">
                    <label for="coneLength">Length</label>
                    <input type="text" id="coneLength" name="coneLength" placeholder="1">
                </div>
                <div class="modal-pad-bottom">
                    <label for="conePasses">Passes</label>
                    <input type="text" id="conePasses" name="conePasses" placeholder="1">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskConeExecuteButton" class="execute" title="Execute cone command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="green" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskConeCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Boring Modal-->
        <div id="quickTaskBoringModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Boring Modal</h2>
                <div class="modal-pad-bottom">
                    <label for="boringDepth">Boring Depth (mm)</label>
                    <input type="text" id="boringDepth" name="boringDepth" placeholder="50">
                </div>
                <div class="modal-pad-bottom">
                    <label for="peckingDepth">Pecking Depth (mm)</label>
                    <input type="text" id="peckingDepth" name="peckingDepth" placeholder="50">
                </div>
                <div class="modal-pad-bottom">
                    <span>Quick Task Summary</span>
                </div>
                <div class="modal-pad-bottom">
                    <input type="text" id="boringQuickTaskSummary" class="quick-task-summary" name="boringQuickTaskSummary" placeholder="" disabled>
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskBoringExecuteButton" class="execute" title="Execute Boring command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="green" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskBoringCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Threading Modal-->
        <div id="quickTaskThreadingModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Threading Modal</h2>

                <div class="modal-pad-bottom">
                    <label for="threadPitchType">Thread Pitch Type</label>
                    <select id="threadPitchType" name="threadPitchType" placeholder="10">
                        <option value="coarse">Coarse</option>
                        <option value="fine">Fine</option>
                    </select>
                </div>
                <div class="modal-pad-bottom">
                    <label for="threadSize">Thread Size</label>
                    <select id="threadSize" name="threadSize" placeholder="10"></select>
                </div>
                <div class="modal-pad-bottom">
                    <label for="threadLength">Thread Length (mm)</label>
                    <input type="text" id="threadLength" name="threadLength" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskThreadingExecuteButton" class="execute" title="Execute threading command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="green" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskThreadingCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Not Connected warning -->
        <div id="notConnectedModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Not Connected</h2>
                <div class="modal-pad-bottom">
                    <span>Please connect to the controller before executing jobs</span>
                </div>
                <div class="modal-pad">
                    <button id="notConnectedCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Manual Task Modal -->
        <div id="manualTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>Manual Task Instructions</h2>
                <hr>
                <div>
                    <span id="manualTaskName"></span>
                </div>
                <div class="modal-pad">
                    <textarea id="manualTaskInstructions" name="manualTaskInstructions" rows="4" cols="50" disabled></textarea>
                </div>
                <div class="modal-pad">
                    <button id="cancelManualTask">Cancel</button>
                    <button id="completeManualTask" class="interaction-ready-button">Next Task --></button>
                </div>
            </div>
        </div>
        <!-- Gcode Task Modal -->
        <div id="cncTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>CNC Task Gcode</h2>
                <hr>
                <div>
                    <span id="cncTaskName"></span>
                </div>
                <div class="modal-pad">
                    <textarea id="cncTaskGcode" name="cncTaskGcode" rows="4" cols="50" disabled></textarea>
                </div>
                <div class="modal-pad">
                    <button id="cancelCncTask">Cancel</button>
                    <button id="executeGcode">Execute Gcode</button>
                </div>
                <div class="modal-pad">
                    <button id="completeCncTask" disabled>Next Task --></button>
                </div>
                <div id="currentGcodeLineContainer" class="modal-pad">
                    <span id="currentGcodeLineLabel">Current Gcode Line:</span>
                    <span id="currentGcodeLine"></span>
                </div>
                <div id="currentFeedrateContainer" class="modal-pad">
                    <span id="currentFeedrateLabel">Current Feedrate:</span>
                    <span id="currentFeedrate"></span>
                </div>
                <div id="cncTaskSenderProgressContainer" class="modal-pad">
                    <span id="cncTaskSenderProgressLabel">Execution in progress...</span>
                    <progress id="cncTaskSenderProgress" max="1"></progress>
                </div>
            </div>
        </div>
        <!-- key Emulation Task Modal -->
        <div id="emulationTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>Key Emulation Task</h2>
                <hr>
                <div>
                    <span id="emulationTaskName"></span>
                </div>
                <div class="modal-pad">
                    <ul id="emulationExecutionTasks">
                        <!-- List items will be added here -->
                    </ul>
                    <div class="modal-pad">
                        <button id="completeEmulationTask" disabled>Mark Complete</button>
                    </div>
                    <div id="emulationTaskSenderProgressContainer" class="modal-pad">
                        <span id="emulationTaskSenderProgressLabel">Execution in progress...</span>
                        <progress id="emulationTaskSenderProgress" max="1"></progress>
                    </div>
                </div>
            </div>
        </div>
        <!-- All tasks Complete Modal -->
        <div id="completeTaskModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>All Tasks Complete</h2>
                <div class="modal-pad">
                    <button id="completeTaskCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Job Cancelled Modal -->
        <div id="jobCancelledModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Job Cancelled</h2>
                <div>
                    <button id="jobCancelledCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Save Job Modal -->
        <div id="saveJobModal" class="task-modal">
            <div class="task-modal-content">
                <span id="saveJobModalClose" class="close-modal">&times;</span>
                <h2>Save Job</h2>
                <hr>
                <div class="modal-pad">Job Group Name:</div>
                <div>
                    <select id="saveJobGroupNameSelect">
                    </select>
                </div>
                <div id="newJobGroupNameContainer" style="display: none;">
                    <div class="modal-pad">New Job Group name:</div>
                    <div>
                        <input id="saveJobGroupNameInput" type="text" class="planner-save-text" placeholder="Name of Group"></input>
                    </div>
                </div>
                <div class="modal-pad">Name of Job:</div>
                <div>
                    <select id="saveJobNameSelect">
                    </select>
                </div>
                <div id="newJobNameContainer" style="display: none;">
                    <div class="modal-pad">New Job name:</div>
                    <div>
                        <input id="saveJobNameInput" type="text" class="planner-save-text" placeholder="Name of Job"></input>
                    </div>
                </div>
                <div class="modal-pad">
                    <button id="saveJobSaveButton">Save</button>
                </div>
            </div>
        </div>
        <!-- export Job Modal -->
        <div id="exportJobModal" class="task-modal">
            <div class="task-modal-content">
                <span id="exportJobModalClose" class="close-modal">&times;</span>
                <h2>Export Job</h2>
                <hr>
                <div class="modal-pad">Job Group:</div>
                <div>
                    <select id="exportJobGroupNameSelect">
                    </select>
                </div>
                <div class="modal-pad">Job:</div>
                <div>
                    <select id="exportJobNameSelect">
                    </select>
                </div>
                <div class="modal-pad">
                    <button id="exportJobSaveButton">Save</button>
                </div>
            </div>
        </div>
        <!-- Save Collection -->
        <div id="saveCollectionModal" class="task-modal">
            <div class="task-modal-content">
                <span id="saveCollectionModalClose" class="close-modal">&times;</span>
                <div>
                    <div>Which collection would you like to save the tasks to?</div>
                    <div class="modal-pad">
                        <select id="saveCollectionModalToSaveTo" name="collectionToSaveToModal">
                        </select>
                    </div>
                    <div id="newCollectionNameContainerModal" style="display: none;">
                        <div class="modal-pad">New Collection Name:</div>
                        <div>
                            <input type="text" id="newCollectionNameModal" name="newCollectionNameModal" placeholder="Enter collection name...">
                        </div>
                    </div>

                    <div class="modal-pad">
                        <button id="saveAvailableTaskCollectionButtonModal">Save</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- new task modal-->
        <div id="newTaskModal" class="task-modal">
            <div class="task-modal-content">
                <span id="closeNewTaskModal" class="close-modal">&times;</span>
                <div id="newTaskHelpText">
                    <h2 id="taskTextTitle">Add a new task</h2>
                    <hr>
                    <div class="modal-pad">Task Name:</div>
                    <div>
                        <input type="text" id="newTaskName" name="newTaskName" placeholder="Enter task name...">
                    </div>
                    <div class="modal-pad">Task Type:</div>
                    <div>
                        <select id="newTaskType" name="newTaskType">
                            <option value="manual">Manual</option>
                            <option value="gcode">GCode</option>
                            <option value="emulation" disabled>Key Emulation</option>
                        </select>
                    </div>
                    <div class="modal-pad">Task Description:</div>
                    <div>
                        <textarea id="newTaskDescription" name="newTaskDescription" rows="4" cols="50" placeholder="Enter Description..."></textarea>
                    </div>
                    <div id="gcodeTaskContainer" style="display:none">
                        <div class="modal-pad">Task GCode:</div>
                        <div>
                            <textarea id="newTaskGcode" name="newTaskGcode" rows="4" cols="50" placeholder="Disabled for manual tasks" disabled></textarea>
                        </div>
                    </div>
                    <div id="emulationOuterContainer" class="emulate-noselect" style="display:none">
                        <div>
                            <span>Use built in controller functions by emulating button presses
                                Simply click the buttons you want to emulate to build up a sequence which will be
                                displayed at the bottom. Each emulated press will have a 500ms delay between them.
                                <br>
                                <br>
                                <i>Tip: Hover over the buttons for a description.</i>
                            </span>
                        </div>
                        <div id="emulationInnerContainer">
                            <div class="flexCol outerCol">
                                <div id="numberContainer">
                                    <div id="emulationNewTasksNumbers">
                                        <button id="emulateKey9" data-button-key="B_9" class="standard-font material-symbols-outlined">
                                            9
                                        </button>
                                        <button id="emulateKey8" data-button-key="B_8" class="standard-font material-symbols-outlined">
                                            8
                                        </button>
                                        <button id="emulateKey7" data-button-key="B_7" class="standard-font material-symbols-outlined">
                                            7
                                        </button>
                                        <button id="emulateKey6" data-button-key="B_6" class="standard-font material-symbols-outlined">
                                            6
                                        </button>
                                        <button id="emulateKey5" data-button-key="B_5" class="standard-font material-symbols-outlined">
                                            5
                                        </button>
                                        <button id="emulateKey4" data-button-key="B_4" class="standard-font material-symbols-outlined">
                                            4
                                        </button>
                                        <button id="emulateKey3" data-button-key="B_3" class="standard-font material-symbols-outlined">
                                            3
                                        </button>
                                        <button id="emulateKey2" data-button-key="B_2" class="standard-font material-symbols-outlined">
                                            2
                                        </button>
                                        <button id="emulateKey1" data-button-key="B_1" class="standard-font material-symbols-outlined">
                                            1
                                        </button>
                                        <button id="emulateKey0" data-button-key="B_0" class="standard-font material-symbols-outlined">
                                            0
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="flexCol middleCol">
                                <div id="modeContainer">
                                    <div id="emulationNewTasksMode">
                                        <button id="emulateKeyBack" data-button-key="B_BACKSPACE" class="material-symbols-outlined">
                                            backspace
                                        </button>
                                        <button id="emulateKeyGearbox" data-button-key="B_MODE_GEARS" class="material-symbols-outlined">
                                            manufacturing
                                        </button>
                                        <button id="emulateKeyTurning" data-button-key="B_MODE_TURN" class="material-symbols-outlined">
                                            reply
                                        </button>
                                        <button id="emulateKeyFacing" data-button-key="B_MODE_FACE" class="material-symbols-outlined">
                                            turn_slight_left
                                        </button>
                                        <button id="emulateKeyCone" data-button-key="B_MODE_CONE" class="material-symbols-outlined">
                                            arrow_forward_ios
                                        </button>
                                        <button id="emulateKeyParting" data-button-key="B_MODE_CUT" class="material-symbols-outlined">
                                            publish
                                        </button>
                                        <button id="emulateKeyThreading" data-button-key="B_MODE_THREAD" class="material-symbols-outlined">
                                            home_improvement_and_tools
                                        </button>
                                        <button id="emulateKeyMode" data-button-key="B_MODE_OTHER" class="standard-font material-symbols-outlined">
                                            M
                                        </button>
                                    </div>
                                </div>
                                <div id="movementContainer">
                                    <div id="emulationNewTasksMovement">
                                        <button id="emulateKeyLeft" data-button-key="B_LEFT" class="material-symbols-outlined">
                                            arrow_left_alt
                                        </button>
                                        <button id="emulateKeyRight" data-button-key="B_RIGHT" class="material-symbols-outlined">
                                            arrow_right_alt
                                        </button>
                                        <button id="emulateKeyUp" data-button-key="B_UP" class="material-symbols-outlined">
                                            arrow_upward_alt
                                        </button>
                                        <button id="emulateKeyDown" data-button-key="B_DOWN" class="material-symbols-outlined">
                                            arrow_downward_alt
                                        </button>
                                        <button id="emulateKeyPlay" data-button-key="B_ON" class="material-symbols-outlined">
                                            play_arrow
                                        </button>
                                        <button id="emulateKeyStop" data-button-key="B_OFF" class="material-symbols-outlined">
                                            crop_square
                                        </button>
                                        <button id="emulateKeyStopLeft" data-button-key="B_STOPL" class="material-symbols-outlined">
                                            keyboard_tab_rtl
                                        </button>
                                        <button id="emulateKeyStopRight" data-button-key="B_STOPR" class="material-symbols-outlined">
                                            keyboard_tab
                                        </button>
                                        <button id="emulateKeyStopUp" data-button-key="B_STOPU" class="material-symbols-outlined">
                                            vertical_align_top
                                        </button>
                                        <button id="emulateKeyStopDown" data-button-key="B_STOPD" class="material-symbols-outlined">
                                            vertical_align_bottom
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="flexCol outerCol">
                                <div id="otherContainer">
                                    <div id="emulationNewTasksOther">
                                        <button id="emulateKeyZ" data-button-key="B_Z" class="standard-font material-symbols-outlined">
                                            Z
                                        </button>
                                        <button id="emulateKeyX" data-button-key="B_X" class="standard-font material-symbols-outlined">
                                            X
                                        </button>
                                        <button id="emulateKeyB" data-button-key="B_B" class="standard-font material-symbols-outlined">
                                            B
                                        </button>
                                        <button id="emulateKeyA" data-button-key="B_A" class="standard-font material-symbols-outlined">
                                            A
                                        </button>
                                        <button id="emulateKeyAngle" data-button-key="B_DISPL" class="material-symbols-outlined" title="Angle/Taco">
                                            rotate_left
                                        </button>
                                        <button id="emulateKeySteps" data-button-key="B_STEPZ" class="material-symbols-outlined">
                                            signal_cellular_alt
                                        </button>
                                        <button id="emulateKeySettings" data-button-key="B_SETTINGS" class="material-symbols-outlined">
                                            settings
                                        </button>
                                        <button id="emulateKeyReverse" data-button-key="B_REVERSE" class="material-symbols-outlined">
                                            sync_alt
                                        </button>
                                        <button id="emulateKeyMeasure" data-button-key="B_MEASURE" class="material-symbols-outlined">
                                            space_bar
                                        </button>
                                        <button id="emulateKeyPlus" data-button-key="B_PLUS" class="standard-font material-symbols-outlined">
                                            +
                                        </button>
                                        <button id="emulateKeyMinus" data-button-key="B_MINUS" class="standard-font material-symbols-outlined">
                                            -
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <span>
                                Emulated sequence: <i>Tip: Drag to reorder or delete</i>
                            </span>
                        </div>
                        <div class="emulation-modal-pad-border">
                            <div id="emulationNewTasks">
                            </div>
                        </div>
                        <div class="modal-pad-bottom">
                            <div id="emulatedTasksDelete" class="container-wrapper-inner">
                                <span>
                                    Drag here to delete
                                </span>
                            </div>
                            <div id="emulatedButtonListDelete" class="container-wrapper-delete">

                            </div>
                        </div>
                    </div>
                    <div class="modal-pad">Collection to save to:</div>
                    <div>
                        <select id="collectionToSaveTo" name="collectionToSaveTo">
                        </select>
                    </div>
                    <div id="newCollectionNameContainer" style="display: none;">
                        <div class="modal-pad">New Collection Name:</div>
                        <div>
                            <input type="text" id="newCollectionName" name="newCollectionName" placeholder="Enter collection name...">
                        </div>
                    </div>
                    <div class="modal-pad">
                        <button id="saveNewTaskButton">Save</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="helpModal" class="help-modal">
            <div class="help-modal-content">
                <span id="closeHelpModal" class="close-modal">&times;</span>
                <div id="helpText">
                    <div>This tool is designed to be used in conjunction with LatheCode:</div>
                    <div><a href="https://kachurovskiy.github.io/lathecode/ " target="_blank ">https://kachurovskiy.github.io/lathecode/</a></div>
                    <div><strong>Please note that this tool is to be used at your own risk and I cannot gaurentee that
                            it will work. This tool targets my custom fork of the H4 firmware which you can find
                            here:</strong> <a href="https://github.com/Festivejelly/nanoels" target="_blank ">https://github.com/Festivejelly/nanoels</a></div>
                    <hr>
                    <div>How to use:</div>
                    <ul style="list-style-type: disc; padding-left: 20px; ">
                        <li>Use LatheCode to generate the G-code, then paste it into this tool.</li>
                        <li>You can also write the G-code by hand for simple operations such as boring or grooving.
                            <a href="# " id="exampleCode">Click here</a> to load an example.
                        </li>
                        <li>Click "Simulate" to plot the moves onto the canvas.</li>
                        <li>movement lines marked with "; cut" will show in <span class="line red-line"></span><span class="text-red">red</span>.</li>
                        <li>movement lines marked with "; travel" will show in <span class="line green-line"></span><span class="text-green">green</span>.</li>
                        <li>movement lines marked with "; retract" will show in <span class="line orange-line"></span><span class="text-orange">orange</span>.</li>
                        <li>movement lines not marked will default to <span class="line green-line"></span><span class="text-green">green</span>.</li>
                        <li>All other moves will be considered travel moves and will show in green.</li>
                        <li>Any G-code you paste or write can be saved into the browser's local storage. This is useful for saving common operations.</li>
                        <li>When you're ready, you can send the G-code to the Nano ELS H4 by clicking "Send."
                        </li>
                        <li>More functionality to come soon! Version 0.2</li>
                        <li>Please provide feedback, raise issues or make suggestions here: <a href="https://github.com/Festivejelly/LatheGcodeVisualiser " target="_blank ">https://github.com/Festivejelly/LatheGcodeVisualiser</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="zoomModal" class="zoom-modal">
            <div class="zoom-modal-content" style="background-color: #242424;">
                <span id="closeZoomModal" class="close-modal">&times;</span>
                <canvas id="zoomCanvas" width="1600 " height="1200 "></canvas>
                <div id="sliderAndButtonContainer">
                    <div id="zoomSliderContainer" class="innerContainer" style="width: 400px;">
                        <input type="range" id="zoomProgressSlider" min="0" max="100" value="0" style="width: 100%;">
                        <div id="zoomSliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                    </div>
                    <div id="displayOptionsContainerZoom" class="innerContainer">
                        <input type="checkbox" id="showCutsZoom" checked> Show Cut Moves
                        </label>
                        <label>
                            <input type="checkbox" id="showNonCutsZoom" checked>
                            Show Non-Cut Moves
                        </label>
                    </div>
                    <button id="zoomCloseButton">Close</button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>