<!DOCTYPE html>
<html>

<head>
    <title>G-Code Visualizer</title>
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/ace.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <script type="module" crossorigin>
var at=Object.defineProperty;var ct=(t,e,n)=>e in t?at(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var p=(t,e,n)=>(ct(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();class lt{constructor(e,n,r,o,a,d,v,g){this.isConnected=e,this.condition=n,this.error=r,this.progress=o,this.z=a,this.x=d,this.feed=v,this.rpm=g}}class ut{constructor(e){p(this,"port",null);p(this,"readTimeout",0);p(this,"reader",null);p(this,"writer",null);p(this,"isOn",!1);p(this,"waitForOkOrError",!1);p(this,"lines",[]);p(this,"lineIndex",0);p(this,"unparsedResponse","");p(this,"error","");p(this,"statusReceived",!1);p(this,"z",0);p(this,"x",0);p(this,"feed",0);p(this,"rpm",0);p(this,"isDisconnecting",!1);p(this,"lastStatus",null);this.statusChangeCallback=e}getStatus(){return this.lastStatus=new lt(this.port!==null,this.isOn?"run":"idle",this.error,this.lines.length?this.lineIndex/this.lines.length:0,this.z,this.x,this.feed,this.rpm),this.lastStatus}setStatus(e){e.startsWith("<")&&(e=e.substring(1)),e.endsWith(">")&&(e=e.slice(0,-1));const n=e.split("|");if(n.length>=3){if(this.statusReceived=!0,n[1].startsWith("WPos:")){const r=n[1].substring(5).split(",");this.z=Number(r[2]),this.x=Number(r[0])}if(n[2].startsWith("FS:")){const r=n[2].substring(3).split(",");this.feed=Number(r[0]),this.rpm=Number(r[1])}}this.statusChangeCallback()}setError(e){this.error=e,Re(e),this.statusChangeCallback()}isConnected(){return this.lastStatus!==null&&this.lastStatus.isConnected}async connect(){try{if(this.port)this.closePort();else{if(await this.selectPort(),await this.askForStatus(),!await dt(()=>this.statusReceived)){this.setError("Device is not reponding, is it in GCODE mode?");return}this.isDisconnecting=!1,this.isOn=!1,this.setError(""),this.waitForOkOrError=!1,this.unparsedResponse=""}}catch(e){console.log(e)}this.statusChangeCallback()}async disconnect(){this.isDisconnecting=!0,this.port&&this.closePort()}getDisconnectingStatus(){return this.isDisconnecting}async start(e){e&&(this.isOn=!0,this.lines=e.split(`
`),this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.statusChangeCallback())}async sendCommand(e){this.isOn=!0;let n=new Array(3);n[0]="G91",n[1]=e,n[2]="G90",this.lines=n,this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.statusChangeCallback()}async sendCommands(e){this.isOn=!0,this.lines=e,this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.statusChangeCallback()}async stop(){await this.write("!"),this.isOn&&(this.isOn=!1,this.askForStatus(),this.statusChangeCallback())}async write(e){if(this.port){if(Re(`command: ${e}`),console.log("command: ",e),!this.port.writable){e!="?"&&this.setError("Port is not writable, try reconnecting the USB and switching to GCODE mode.");return}if(!this.writer)try{const n=new TextEncoderStream;n.readable.pipeTo(this.port.writable),this.writer=n.writable.getWriter()}catch(n){this.setError("Failed to write: "+n);return}await this.writer.write(e)}}async writeCurrentLine(){if(!this.isOn||this.waitForOkOrError)return;if(this.lineIndex>=this.lines.length){this.stop();return}const e=this.lines[this.lineIndex].split(";")[0].trim();if(!e){this.lineIndex++,this.writeCurrentLine();return}this.waitForOkOrError=!0,await this.write(e+`
`),await this.readFromPort()}async processResponse(e){this.unparsedResponse=(this.unparsedResponse+e).trimStart(),Re(`command: ${e}`),console.log(`response: "${e}"`);const n=this.unparsedResponse.match(/(<[^>]+>)/);if(n&&n.length>1){n.shift();for(const r of n)this.unparsedResponse=this.unparsedResponse.replace(r,"");this.setStatus(n.pop())}this.unparsedResponse.startsWith("error:")?(this.setError(this.unparsedResponse),this.unparsedResponse="",this.stop()):this.unparsedResponse.startsWith("ok")&&(this.unparsedResponse="",this.waitForOkOrError=!1,this.lineIndex++,this.statusChangeCallback(),this.isOn&&await this.writeCurrentLine())}async selectPort(){if(this.port&&this.closePort(),navigator.serial?this.port=await navigator.serial.requestPort():(this.error="This browser does not support Serial API, try Chrome or Edge",this.statusChangeCallback()),this.port)try{await this.port.open({baudRate:115200}),this.statusChangeCallback(),this.readSoon()}catch(e){this.setError(`Unable to open port - likely some other app is using it - try closing Arduino IDE.
${e}`),this.closePort()}}async askForStatus(){try{await this.write("?")}catch(e){this.setError(`Device disconnected? ${e}`),this.closePort()}}readSoon(){clearTimeout(this.readTimeout),this.readTimeout=window.setTimeout(()=>this.readFromPort(),200)}async readFromPort(){if(this.port)try{if(!this.port.readable){this.readSoon();return}if(!this.reader){const n=new TextDecoderStream;this.port.readable.pipeTo(n.writable),this.reader=n.readable.getReader()}const{value:e}=await this.reader.read();if(!e){this.readSoon();return}await this.processResponse(e),this.readSoon()}catch(e){this.setError(e.message||String(e)),this.closePort()}}async closePort(){if(this.port){if(clearTimeout(this.readTimeout),this.reader){try{await this.reader.cancel(),this.reader.releaseLock()}catch(e){console.error("Error cancelling reader: ",e)}this.reader=null}if(this.writer){try{await this.writer.close(),this.writer.releaseLock()}catch(e){console.error("Error closing writer: ",e)}this.writer=null}await new Promise(e=>setTimeout(e,500));try{await this.port.close()}catch(e){console.error("Error closing port: ",e)}this.port=null,this.statusReceived=!1,this.z=0,this.x=0,this.feed=0,this.rpm=0}}}function Re(t){var e=A.getSession(),n=e.getLength(),r=new Date().toLocaleTimeString(),o=`[${r}] ${t}
`;e.insert({row:n,column:0},o)}function dt(t){return new Promise(e=>{let n=0;function r(){t()?e(!0):n>=10?e(!1):(n++,setTimeout(r,100))}r()})}class ft{constructor(){p(this,"sendButton");p(this,"stopButton");p(this,"senderError");p(this,"runProgress");p(this,"runProgressLabel");p(this,"connectButton");p(this,"isConnected",!1);p(this,"gcodeResponseContainer");p(this,"jogButtons");p(this,"toolButtons");p(this,"sender");let e,n,r;this.senderError=document.querySelector(".senderError"),this.runProgress=document.getElementById("senderProgress"),this.runProgressLabel=document.getElementById("senderProgressLabel"),this.connectButton=document.getElementById("connectButton"),this.gcodeResponseContainer=document.getElementById("gcodeResponseContainer"),r=document.getElementById("moveDistance"),e=document.getElementById("fastFeedrate"),n=document.getElementById("slowFeedrate"),this.jogButtons=document.querySelectorAll("#latheControls .jog-btn"),this.toolButtons=document.querySelectorAll("#latheControls .tool-btn"),this.sendButton=document.getElementById("gcodeSenderButton");let o=null;o||(o=new ut(()=>this.senderStatusChange())),this.sender=o,this.jogButtons.forEach(function(a){a.addEventListener("click",function(){let d="",v="",g="",y=!0;this.id=="fastForward"?(d=e.value,v="X",g=r.value,y=!0):this.id=="slowForward"?(d=n.value,v="X",g=r.value,y=!0):this.id=="fastBackward"?(d=e.value,v="X",g=r.value,y=!1):this.id=="slowBackward"?(d=n.value,v="X",g=r.value,y=!1):this.id=="fastLeft"?(d=e.value,v="Z",g=r.value,y=!0):this.id=="slowLeft"?(d=n.value,v="Z",g=r.value,y=!0):this.id=="fastRight"?(d=e.value,v="Z",g=r.value,y=!1):this.id=="slowRight"&&(d=n.value,v="Z",g=r.value,y=!1);let M=`${v}${y===!0?"":"-"}${g} F${d}`;o&&o.sendCommand(M)})}),this.toolButtons.forEach(function(a){a.addEventListener("click",function(){let d=this.id,v="T";d=="tool0"?v+="0":d=="tool1"?v+="1":d=="tool2"?v+="2":d=="tool3"&&(v+="3"),document.querySelectorAll("#latheControls .tool-btn").forEach(function(w){w.id!=d?w.classList.remove("tool-selected"):w.classList.add("tool-selected")});let y=new Array(2);y[0]="G91",y[1]=v,o&&o.sendCommands(y)})}),this.connectButton.addEventListener("click",()=>{this.gcodeResponseContainer.style.display="block",!this.isConnected&&o&&o.connect()}),this.sendButton.addEventListener("click",()=>{o&&o.start(R.getValue())}),this.stopButton=document.getElementById("stopButton"),this.stopButton.addEventListener("click",()=>o.stop()),this.stopButton.style.display="none"}hide(){}senderStatusChange(){if(!this.sender)return;const e=this.sender.getStatus();if(e.isConnected===!1){this.sendButton.style.display="none",this.connectButton.innerText="Connect",this.isConnected=!1;return}else this.isConnected=!0,this.sendButton.style.display="inline-block",this.connectButton.innerText="Connected",this.connectButton.disabled=!0;const n=e.condition==="run";this.runProgress&&(this.runProgress.value=e.progress,this.runProgress.style.display=n?"block":"none",this.runProgressLabel.style.display=n?"block":"none"),this.stopButton&&(this.stopButton.style.display=n?"inline-block":"none");const r=this.sender.getDisconnectingStatus();this.senderError&&!r&&(e.error?(this.senderError.style.display="block",this.senderError.innerText=e.error,this.showError(),this.appendLineToResponseEditor(e.error)):(this.hideError(),this.senderError.innerText=""))}appendLineToResponseEditor(e){var n=A.getSession(),r=n.getLength(),o=new Date().toLocaleTimeString(),a=`[${o}] ${e}
`;n.insert({row:r,column:0},a)}showError(){this.senderError.style.display="block"}hideError(){this.senderError.style.display="none"}}const ht=`; This example shows a boring operation, then an internal grooving operation

G21 ; metric
G18 ; ZX plane
G90 ; absolute positioning
F200
X0 ; zero your tool X on centerline
Z0 ; zero your tool Z at the right edge of the stock
G91 ; relative positioning

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;1mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;2mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;3mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;4mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;5mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;6mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;7mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;8mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;9mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;10mm

Z-10

Z3.25 ; cut
X-5 ; cut

X-1.7 ; cut

X6.7 ; retract
Z-3.25 ; retract
`;function vt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var mt=function(e,n){return Array.prototype.slice.call(e,n)},pt=typeof setImmediate=="function",Ne;pt?Ne=function(t){setImmediate(t)}:Ne=function(t){setTimeout(t,0)};var gt=Ne,yt=gt,Et=function(e,n,r){e&&yt(function(){e.apply(r||null,n||[])})},$e=mt,wt=Et,Ct=function(e,n){var r=n||{},o={};return e===void 0&&(e={}),e.on=function(a,d){return o[a]?o[a].push(d):o[a]=[d],e},e.once=function(a,d){return d._once=!0,e.on(a,d),e},e.off=function(a,d){var v=arguments.length;if(v===1)delete o[a];else if(v===0)o={};else{var g=o[a];if(!g)return e;g.splice(g.indexOf(d),1)}return e},e.emit=function(){var a=$e(arguments);return e.emitterSnapshot(a.shift()).apply(this,a)},e.emitterSnapshot=function(a){var d=(o[a]||[]).slice(0);return function(){var v=$e(arguments),g=this||e;if(a==="error"&&r.throws!==!1&&!d.length)throw v.length===1?v[0]:v;return d.forEach(function(w){r.async?wt(w,v,g):w.apply(g,v),w._once&&e.off(a,w)}),e}},e},Ue=window.CustomEvent;function bt(){try{var t=new Ue("cat",{detail:{foo:"bar"}});return t.type==="cat"&&t.detail.foo==="bar"}catch{}return!1}var St=bt()?Ue:typeof document<"u"&&typeof document.createEvent=="function"?function(e,n){var r=document.createEvent("CustomEvent");return n?r.initCustomEvent(e,n.bubbles,n.cancelable,n.detail):r.initCustomEvent(e,!1,!1,void 0),r}:function(e,n){var r=document.createEventObject();return r.type=e,n?(r.bubbles=!!n.bubbles,r.cancelable=!!n.cancelable,r.detail=n.detail):(r.bubbles=!1,r.cancelable=!1,r.detail=void 0),r},Ke=[],Me="",Xt=/^on/;for(Me in window)Xt.test(Me)&&Ke.push(Me.slice(2));var Bt=Ke,kt=St,Lt=Bt,Le=window.document,Je=Tt,Qe=Zt,we=[];window.addEventListener||(Je=xt,Qe=Ot);var It={add:Je,remove:Qe,fabricate:Pt};function Tt(t,e,n,r){return t.addEventListener(e,n,r)}function xt(t,e,n){return t.attachEvent("on"+e,Mt(t,e,n))}function Zt(t,e,n,r){return t.removeEventListener(e,n,r)}function Ot(t,e,n){var r=et(t,e,n);if(r)return t.detachEvent("on"+e,r)}function Pt(t,e,n){var r=Lt.indexOf(e)===-1?a():o();t.dispatchEvent?t.dispatchEvent(r):t.fireEvent("on"+e,r);function o(){var d;return Le.createEvent?(d=Le.createEvent("Event"),d.initEvent(e,!0,!0)):Le.createEventObject&&(d=Le.createEventObject()),d}function a(){return new kt(e,{detail:n})}}function Rt(t,e,n){return function(o){var a=o||window.event;a.target=a.target||a.srcElement,a.preventDefault=a.preventDefault||function(){a.returnValue=!1},a.stopPropagation=a.stopPropagation||function(){a.cancelBubble=!0},a.which=a.which||a.keyCode,n.call(t,a)}}function Mt(t,e,n){var r=et(t,e,n)||Rt(t,e,n);return we.push({wrapper:r,element:t,type:e,fn:n}),r}function et(t,e,n){var r=Ft(t,e,n);if(r){var o=we[r].wrapper;return we.splice(r,1),o}}function Ft(t,e,n){var r,o;for(r=0;r<we.length;r++)if(o=we[r],o.element===t&&o.type===e&&o.fn===n)return r}var Ve={},Nt="(?:^|\\s)",zt="(?:\\s|$)";function tt(t){var e=Ve[t];return e?e.lastIndex=0:Ve[t]=e=new RegExp(Nt+t+zt,"g"),e}function Dt(t,e){var n=t.className;n.length?tt(e).test(n)||(t.className+=" "+e):t.className=e}function $t(t,e){t.className=t.className.replace(tt(e)," ").trim()}var Vt={add:Dt,rm:$t},_t=Ct,ae=It,j=Vt,ce=document,$=ce.documentElement;function Gt(t,e){var n=arguments.length;n===1&&Array.isArray(t)===!1&&(e=t,t=[]);var r,o,a,d,v,g,y,w,M,C,le,z=null,Z,l=e||{};l.moves===void 0&&(l.moves=Ye),l.accepts===void 0&&(l.accepts=Ye),l.invalid===void 0&&(l.invalid=Oe),l.containers===void 0&&(l.containers=t||[]),l.isContainer===void 0&&(l.isContainer=Yt),l.copy===void 0&&(l.copy=!1),l.copySortSource===void 0&&(l.copySortSource=!1),l.revertOnSpill===void 0&&(l.revertOnSpill=!1),l.removeOnSpill===void 0&&(l.removeOnSpill=!1),l.direction===void 0&&(l.direction="vertical"),l.ignoreInputTextSelection===void 0&&(l.ignoreInputTextSelection=!0),l.mirrorContainer===void 0&&(l.mirrorContainer=ce.body);var E=_t({containers:l.containers,start:Ze,end:ne,cancel:Y,remove:Xe,destroy:Ie,canMove:xe,dragging:!1});return l.removeOnSpill===!0&&E.on("over",ve).on("out",Be),Ce(),E;function ue(i){return E.containers.indexOf(i)!==-1||l.isContainer(i)}function Ce(i){var c=i?"remove":"add";ye($,c,"mousedown",K),ye($,c,"mouseup",J)}function de(i){var c=i?"remove":"add";ye($,c,"mousemove",Te)}function U(i){var c=i?"remove":"add";ae[c]($,"selectstart",be),ae[c]($,"click",be)}function Ie(){Ce(!0),J({})}function be(i){Z&&i.preventDefault()}function K(i){g=i.clientX,y=i.clientY;var c=_e(i)!==1||i.metaKey||i.ctrlKey;if(!c){var f=i.target,m=fe(f);m&&(Z=m,de(),i.type==="mousedown"&&(je(f)?f.focus():i.preventDefault()))}}function Te(i){if(Z){if(_e(i)===0){J({});return}if(!(i.clientX!==void 0&&Math.abs(i.clientX-g)<=(l.slideFactorX||0)&&i.clientY!==void 0&&Math.abs(i.clientY-y)<=(l.slideFactorY||0))){if(l.ignoreInputTextSelection){var c=q("clientX",i)||0,f=q("clientY",i)||0,m=ce.elementFromPoint(c,f);if(je(m))return}var x=Z;de(!0),U(),ne(),Se(x);var b=At(a);d=q("pageX",i)-b.left,v=q("pageY",i)-b.top,j.add(C||a,"gu-transit"),me(),ee(i)}}}function fe(i){if(!(E.dragging&&r)&&!ue(i)){for(var c=i;O(i)&&ue(O(i))===!1;)if(l.invalid(i,c)||(i=O(i),!i))return;var f=O(i);if(f&&!l.invalid(i,c)){var m=l.moves(i,f,c,Ee(i));if(m)return{item:i,source:f}}}}function xe(i){return!!fe(i)}function Ze(i){var c=fe(i);c&&Se(c)}function Se(i){Pe(i.item,i.source)&&(C=i.item.cloneNode(!0),E.emit("cloned",C,i.item,"copy")),o=i.source,a=i.item,w=M=Ee(i.item),E.dragging=!0,E.emit("drag",a,o)}function Oe(){return!1}function ne(){if(E.dragging){var i=C||a;he(i,O(i))}}function re(){Z=!1,de(!0),U(!0)}function J(i){if(re(),!!E.dragging){var c=C||a,f=q("clientX",i)||0,m=q("clientY",i)||0,x=Ae(r,f,m),b=Q(x,f,m);b&&(C&&l.copySortSource||!C||b!==o)?he(c,b):l.removeOnSpill?Xe():Y()}}function he(i,c){var f=O(i);C&&l.copySortSource&&c===o&&f.removeChild(a),W(c)?E.emit("cancel",i,o,o):E.emit("drop",i,c,o,M),V()}function Xe(){if(E.dragging){var i=C||a,c=O(i);c&&c.removeChild(i),E.emit(C?"cancel":"remove",i,c,o),V()}}function Y(i){if(E.dragging){var c=arguments.length>0?i:l.revertOnSpill,f=C||a,m=O(f),x=W(m);x===!1&&c&&(C?m&&m.removeChild(C):o.insertBefore(f,w)),x||c?E.emit("cancel",f,o,o):E.emit("drop",f,m,o,M),V()}}function V(){var i=C||a;re(),pe(),i&&j.rm(i,"gu-transit"),le&&clearTimeout(le),E.dragging=!1,z&&E.emit("out",i,z,o),E.emit("dragend",i),o=a=C=w=M=le=z=null}function W(i,c){var f;return c!==void 0?f=c:r?f=M:f=Ee(C||a),i===o&&f===w}function Q(i,c,f){for(var m=i;m&&!x();)m=O(m);return m;function x(){var b=ue(m);if(b===!1)return!1;var H=S(m,i),I=ie(m,H,c,f),F=W(m,I);return F?!0:l.accepts(a,m,o,I)}}function ee(i){if(!r)return;i.preventDefault();var c=q("clientX",i)||0,f=q("clientY",i)||0,m=c-d,x=f-v;r.style.left=m+"px",r.style.top=x+"px";var b=C||a,H=Ae(r,c,f),I=Q(H,c,f),F=I!==null&&I!==z;(F||I===null)&&(u(),z=I,s());var k=O(b);if(I===o&&C&&!l.copySortSource){k&&k.removeChild(b);return}var T,_=S(I,H);if(_!==null)T=ie(I,_,c,f);else if(l.revertOnSpill===!0&&!C)T=w,I=o;else{C&&k&&k.removeChild(b);return}(T===null&&F||T!==b&&T!==Ee(b))&&(M=T,I.insertBefore(b,T),E.emit("shadow",b,I,o));function D(h){E.emit(h,b,z,o)}function s(){F&&D("over")}function u(){z&&D("out")}}function ve(i){j.rm(i,"gu-hide")}function Be(i){E.dragging&&j.add(i,"gu-hide")}function me(){if(!r){var i=a.getBoundingClientRect();r=a.cloneNode(!0),r.style.width=We(i)+"px",r.style.height=He(i)+"px",j.rm(r,"gu-transit"),j.add(r,"gu-mirror"),l.mirrorContainer.appendChild(r),ye($,"add","mousemove",ee),j.add(l.mirrorContainer,"gu-unselectable"),E.emit("cloned",r,a,"mirror")}}function pe(){r&&(j.rm(l.mirrorContainer,"gu-unselectable"),ye($,"remove","mousemove",ee),O(r).removeChild(r),r=null)}function S(i,c){for(var f=c;f!==i&&O(f)!==i;)f=O(f);return f===$?null:f}function ie(i,c,f,m){var x=l.direction==="horizontal",b=c!==i?I():H();return b;function H(){var k=i.children.length,T,_,D;for(T=0;T<k;T++)if(_=i.children[T],D=_.getBoundingClientRect(),x&&D.left+D.width/2>f||!x&&D.top+D.height/2>m)return _;return null}function I(){var k=c.getBoundingClientRect();return F(x?f>k.left+We(k)/2:m>k.top+He(k)/2)}function F(k){return k?Ee(c):c}}function Pe(i,c){return typeof l.copy=="boolean"?l.copy:l.copy(i,c)}}function ye(t,e,n,r){var o={mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"},a={mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"},d={mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"};window.navigator.pointerEnabled?ae[e](t,a[n],r):window.navigator.msPointerEnabled?ae[e](t,d[n],r):(ae[e](t,o[n],r),ae[e](t,n,r))}function _e(t){if(t.touches!==void 0)return t.touches.length;if(t.which!==void 0&&t.which!==0)return t.which;if(t.buttons!==void 0)return t.buttons;var e=t.button;if(e!==void 0)return e&1?1:e&2?3:e&4?2:0}function At(t){var e=t.getBoundingClientRect();return{left:e.left+Ge("scrollLeft","pageXOffset"),top:e.top+Ge("scrollTop","pageYOffset")}}function Ge(t,e){return typeof window[e]<"u"?window[e]:$.clientHeight?$[t]:ce.body[t]}function Ae(t,e,n){t=t||{};var r=t.className||"",o;return t.className+=" gu-hide",o=ce.elementFromPoint(e,n),t.className=r,o}function Yt(){return!1}function Ye(){return!0}function We(t){return t.width||t.right-t.left}function He(t){return t.height||t.bottom-t.top}function O(t){return t.parentNode===ce?null:t.parentNode}function je(t){return t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.tagName==="SELECT"||nt(t)}function nt(t){return!t||t.contentEditable==="false"?!1:t.contentEditable==="true"?!0:nt(O(t))}function Ee(t){return t.nextElementSibling||e();function e(){var n=t;do n=n.nextSibling;while(n&&n.nodeType!==1);return n}}function Wt(t){return t.targetTouches&&t.targetTouches.length?t.targetTouches[0]:t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t}function q(t,e){var n=Wt(e),r={pageX:"clientX",pageY:"clientY"};return t in r&&!(t in n)&&r[t]in n&&(t=r[t]),n[t]}var Ht=Gt;const jt=vt(Ht),Fe=document.getElementById("availableTasks"),qe=document.getElementById("tasksToExecute");document.addEventListener("DOMContentLoaded",()=>{jt([Fe,qe],{copy:(t,e)=>e===Fe,accepts:(t,e,n)=>e===qe&&n===Fe})});const B=ace.edit("gcodeEditor"),A=ace.edit("gcodeResponseEditor"),R=ace.edit("gcodeSenderEditor"),qt="#DC143C",Ut="#6B8E23",Kt="#FFA500";document.addEventListener("DOMContentLoaded",()=>{new ft;const t=document.getElementById("gcodeCanvas"),e=document.getElementById("zoomCanvas");let n=null;const r=document.getElementById("fileInput"),o=document.getElementById("simulateButton"),a=document.getElementById("showCuts"),d=document.getElementById("showNonCuts"),v=document.getElementById("sliderLabel"),g=document.getElementById("zoomSliderLabel"),y=document.getElementById("progressSlider"),w=document.getElementById("zoomProgressSlider"),M=document.getElementById("sliderContainer"),C=document.getElementById("displayOptionsContainer"),le=document.getElementById("clearButton"),z=document.querySelector(".saveGCodeNameInput"),Z=document.querySelector(".loadGCodeSelect"),l=document.querySelector(".loadGCodeButton"),E=document.querySelector(".saveGCodeButton"),ue=document.querySelector(".deleteGCodeButton"),Ce=document.getElementById("gcodeSenderContainer"),de=document.getElementById("exampleCode"),U=document.getElementById("helpModal"),Ie=document.getElementById("helpButton"),be=document.getElementById("closeHelpModal"),K=document.getElementById("zoomModal"),Te=document.getElementById("zoomButton"),fe=document.getElementById("closeZoomModal"),xe=document.getElementById("zoomCloseButton"),Ze=document.getElementById("simulationTab"),Se=document.getElementById("controlTab"),Oe=document.getElementById("plannerTab"),ne=document.getElementById("simulationContainer"),re=document.getElementById("controlsContainer"),J=document.getElementById("plannerContainer"),he=document.querySelectorAll("#latheControls .increment-btn"),Xe=document.getElementById("moveDistance");he.forEach(function(s){s.addEventListener("click",function(){he.forEach(function(h){h.classList.remove("active")}),this.classList.add("active");var u=this.dataset.increment;Xe.value=u,console.log("Jog increment set to:",u)})}),Ze.addEventListener("click",()=>{ne.style.display="flex",re.style.display="none",J.style.display="none",B.setValue(R.getValue())}),Se.addEventListener("click",()=>{ne.style.display="none",re.style.display="flex",J.style.display="none",R.setValue(B.getValue())}),Oe.addEventListener("click",()=>{ne.style.display="none",re.style.display="none",J.style.display="flex"}),e.width=window.visualViewport.width-100,e.height=window.visualViewport.height-150,window.addEventListener("resize",function(){e.width=window.visualViewport.width-100,e.height=window.visualViewport.height-150,w.value=w.min,ie(e)}),Te.onclick=function(){K.style.display="block",ie(e)},fe.onclick=function(){K.style.display="none"},xe.onclick=function(){K.style.display="none"},Ie.onclick=function(){U.style.display="block"},be.onclick=function(){U.style.display="none"},window.onclick=function(s){s.target==U&&(U.style.display="none"),s.target==K&&(K.style.display="none")},E.addEventListener("click",()=>Pe()),l.addEventListener("click",()=>i()),ue.addEventListener("click",()=>c()),f(),B.setTheme("ace/theme/github_dark"),B.session.setMode("ace/mode/plain_text"),B.setShowPrintMargin(!1),R.setTheme("ace/theme/github_dark"),R.session.setMode("ace/mode/plain_text"),R.setShowPrintMargin(!1),de.addEventListener("click",()=>D()),A.setTheme("ace/theme/monokai"),A.session.setMode("ace/mode/text"),A.setReadOnly(!0),A.setShowPrintMargin(!1),A.getSession().on("change",()=>{setTimeout(()=>{var s=A.getSession().getLength();A.scrollToLine(s,!0,!0,function(){})},0)}),R.on("focus",()=>{R.getValue()==="Paste your gcode here or click choose file to upload"&&R.setValue("")}),m();let Y=0,V=0,W=0,Q=0,ee=0,ve=0,Be=5,me=0,pe=0,S=[];y.oninput=()=>{const s=Math.floor(parseInt(y.value));if(s<S.length){const u=S[s];let h=k(S,t);T(t,S,h,s),x(u)}},w.oninput=()=>{const s=Math.floor(parseInt(w.value));if(s<S.length){const u=S[s];let h=k(S,e);T(e,S,h,s),b(u)}},le.addEventListener("click",()=>{R.setValue(""),B.setValue(""),m();const s=t.getContext("2d");s&&(s.clearRect(0,0,t.width,t.height),r.value="",y.value="0",w.value="0",M.style.display="none",C.style.display="none")}),r.addEventListener("change",s=>{if(s.target instanceof HTMLInputElement&&s.target.files&&s.target.files.length>0){const u=s.target.files[0];u&&H(u)}}),o.addEventListener("click",()=>{ie(t)});function ie(s){if(!s)return;const u=B.getValue();if(u){I(u);let h=k(S,s);T(s,S,h),M.style.display="block",C.style.display="block",a.addEventListener("change",F),d.addEventListener("change",F),y.max=(S.length-1).toString(),y.value=y.min,w.max=(S.length-1).toString(),w.value=w.min,Ce.style.display="block"}}function Pe(){const s=z.value.trim();if(!s)return;const u=`gCode-${s}`;localStorage.setItem(u,B.getValue()),f(u),z.value=""}function i(){const s=Z.value,u=localStorage.getItem(s);u&&(B.setValue(u),R.setValue(u))}function c(){const s=Z.value;localStorage.removeItem(s),f()}function f(s){Z.innerHTML="";let u=!1;for(let h=0;h<localStorage.length;h++){const X=localStorage.key(h);if(X&&X!=="latheCode"&&X.startsWith("gCode-")){u=!0;const L=document.createElement("option"),P=X.replace("gCode-","");L.value=X,L.textContent=P,Z.appendChild(L),X===s&&(L.selected=!0)}}if(u){const h=Array.from(Z.options).sort((X,L)=>X.text.localeCompare(L.text));Z.innerHTML="",h.forEach(X=>{Z.appendChild(X)})}else{const h=document.createElement("option");h.textContent="No items saved",h.disabled=!0,Z.appendChild(h)}}function m(){B.getValue()===""&&(B.setValue("Paste your gcode here or click choose file to upload"),B.gotoLine(1,0),B.on("focus",function(){B.getValue()==="Paste your gcode here or click choose file to upload"&&B.setValue("")}))}function x(s){(s==null?void 0:s.lineNumber)!==void 0?(B.gotoLine(s.lineNumber,0,!0),v.innerHTML=`Line:${s.lineNumber}<br>${s==null?void 0:s.originalLine}`||""):v.innerHTML=""}function b(s){(s==null?void 0:s.lineNumber)!==void 0?(B.gotoLine(s.lineNumber,0,!0),g.innerHTML=`Line:${s.lineNumber}<br>${s==null?void 0:s.originalLine}`||""):g.innerHTML=""}function H(s){const u=new FileReader;u.onload=h=>{const X=h.target.result;B.setValue(X),R.setValue(X)},u.readAsText(s)}function I(s){const u=[];let h=!1;return S=[],s.split(`
`).forEach((L,P)=>{const ge=L.includes("; cut")?0:L.includes("; retract")?2:1,N={isRelative:h,movementType:ge},te=L.match(/([GXYZF])([0-9.-]+)/g);te==null||te.forEach(ke=>{const se=parseFloat(ke.slice(1));switch(ke[0]){case"G":se===90&&(N.isRelative=!1,h=!1),se===91&&(N.isRelative=!0,h=!0);break;case"X":N.x=se;break;case"Z":N.z=se;break}});const oe={...N,lineNumber:P+1,originalLine:L};(N.z!==void 0||N.x!==void 0)&&S.push(oe),u.push(oe)}),u}function F(){y.value="0";const s=k(S,t);T(t,S,s,S.length)}function k(s,u){let h=0,X=0,L=0,P=0,ge=0,N=0,te=0,oe=0;u.id==="zoomCanvas"?oe=80:oe=40,s.forEach(G=>{G.isRelative?(G.x!==void 0&&(h+=G.x),G.z!==void 0&&(X+=G.z)):(G.x!==void 0&&(L=Math.min(L,G.x)),G.z!==void 0&&(P=Math.max(P,G.z)));const st=h+=L,De=X+=P;L=0,P=0,ge=Math.max(ge,Math.abs(st)),N=Math.max(N,Math.abs(De)),te=Math.min(te,De)});const ke=ge,se=N-te,rt=u.height/2,ze=1,it=rt/ke-ze,ot=u.width/se-ze;return Math.min(it,ot,oe)}function T(s,u,h,X){if(n=s.getContext("2d"),!n)return;n.clearRect(0,0,s.width,s.height),Y=0,V=0,ee=0,ve=0,W=0,Q=0,W=s.height/2,Q=s.width-Be;const L=X!==void 0?Math.min(X+1,u.length):u.length;for(let P=0;P<L;P++)_(s,u[P],h)}function _(s,u,h){n=s.getContext("2d"),n&&(n.lineWidth=2,u.isRelative?(Y+=u.x??0,V+=u.z??0):(Y=u.x??ee,V=u.z??ve,ee=Y,ve=V),me=s.height/2-Y*h,pe=s.width-V*h-Be,(u.movementType==0&&a.checked||u.movementType==1&&d.checked||u.movementType==2&&d.checked)&&(n.beginPath(),n.strokeStyle=u.movementType==0?qt:u.movementType==1?Ut:Kt,n.moveTo(Q,W),n.lineTo(pe,me),n.stroke()),W=me,Q=pe)}function D(){B.setValue(ht)}});

</script>
  <style>
:root{font-family:Inter,system-ui,Avenir,Helvetica,Arial,sans-serif;line-height:1.5;font-weight:400;color-scheme:light dark;color:#ffffffde;background-color:#242424;font-synthesis:none;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}a{font-weight:500;color:#646cff;text-decoration:inherit}a:hover{color:#535bf2}h1{font-size:3.2em;line-height:1.1}#app{max-width:1280px;margin:0 auto;padding:2rem;text-align:center}.logo{height:6em;padding:1.5em;will-change:filter;transition:filter .3s}.logo:hover{filter:drop-shadow(0 0 2em #646cffaa)}.logo.vanilla:hover{filter:drop-shadow(0 0 2em #3178c6aa)}.card{padding:2em}.read-the-docs{color:#888}button{border-radius:3px;border:1px solid transparent;padding:.6em 1.2em;font-size:1em;font-weight:500;font-family:inherit;background-color:#1a1a1a;cursor:pointer;transition:background-color .25s}button:hover{background-color:#646cff}button:focus,button:focus-visible{outline:4px auto -webkit-focus-ring-color}@media (prefers-color-scheme: light){:root{color:#213547;background-color:#fff}a:hover{color:#747bff}button{background-color:#f9f9f9}}.main-container{display:flex;align-items:start}.controls-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;width:800px;max-width:1280px;text-align:center;border:1px solid #ccc}.canvas-container{display:flex;flex-direction:column;align-items:center;margin:5px;border:1px solid #ccc}.canvas-wrapper{display:flex;flex-direction:column;align-items:center}.innerContainer{margin:5px;align-items:center;width:auto}.innerContainer.toolbar{display:flex;align-items:center;gap:5px;padding:2px}.saveGCodeNameInput,.loadGCodeSelect{flex-grow:1}#gcodeCanvas{border-bottom:1px solid #ccc;background-color:#242424}#gcodeInput{position:relative;background:transparent;width:100%;height:240px;font-family:monospace;font-size:13px;line-height:1.5;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}#gcodeContainer{position:relative;width:100%}#gcodeSenderContainer{display:block}.save-group,.load-group,.import-export-group{display:flex;flex-direction:row;align-items:center;gap:10px}.toolbar input[type=text],.toolbar select{max-width:200px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem;font-size:1rem;line-height:1.5}input[type=file]::file-selector-button{border:2px solid #6c5ce7;padding:.2em .4em;border-radius:.2em;background-color:#1a1a1a;transition:.25s}input[type=file]::-ms-browse:hover{background-color:#646cff}input[type=file]::-webkit-file-upload-button:hover{background-color:#646cff}input[type=file]::file-selector-button:hover{background-color:#646cff}.bottom-container{margin:5px}#gcodeResponseContainer{border:1px solid #ccc;width:100%;display:flex;flex-direction:column;align-items:center;margin-top:5px}.senderError{display:none;color:#fff;background-color:red;padding:10px;border-radius:5px;animation:flashError 1s infinite}@keyframes flashError{0%,to{opacity:1}50%{opacity:0}}#helpText li{margin-bottom:10px}#helpText a{color:#f95959}.help-modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.help-modal-content{position:relative;background-color:#242424;margin:15% auto;padding:20px;border:2px solid #6c5ce7;width:30%}.zoom-modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#242424}.zoom-modal-content{display:flex;flex-direction:column;align-items:center;margin:10px auto;padding:20px;border:1px solid #888}.close-modal{position:absolute;top:0;right:0;padding-right:10px;cursor:pointer;font-size:35px}#sliderAndButtonContainer{display:flex;justify-content:center;align-items:center;gap:10px}.text-red{color:#dc143c}.text-green{color:#6b8e23}.text-orange{color:orange}.line{display:inline-block;vertical-align:middle;width:20px;height:2px;margin-right:5px}.red-line{border-top:2px solid #DC143C}.green-line{border-top:2px solid #6B8E23}.orange-line{border-top:2px solid #FFA500}#latheControls #jogControls{display:grid;grid-template-columns:repeat(9,60px);grid-template-rows:repeat(5,60px);justify-content:center;align-items:center;place-items:center}#latheControls .jog-btn,#latheControls .tool-btn{width:50px;height:50px;border-radius:5px;cursor:pointer;background-color:#f0ad4e;display:flex;justify-content:center;align-items:center;text-align:center;line-height:50px;font-size:24px;padding:0}#latheControls .tool{background-color:#f0ad4e;border:none}#latheControls .tool-selected{background-color:#6c5ce7;border:2px solid white}#latheControls .fast{background-color:#f0ad4e}#latheControls .slow{background-color:#5bc0de}#latheControls .jog-btn:hover{background-color:#6c5ce7}#fastForward{grid-column:5;grid-row:1}#fastText{grid-column:4;grid-row:1}#slowText{grid-column:4;grid-row:2}#fastLeft{grid-column:3;grid-row:3}#fastBackward{grid-column:5;grid-row:5}#fastRight{grid-column:7;grid-row:3}#slowForward{grid-column:5;grid-row:2}#slowLeft{grid-column:4;grid-row:3}#slowBackward{grid-column:5;grid-row:4}#slowRight{grid-column:6;grid-row:3}#toolText{grid-column:1;grid-row:1}#tool0{grid-column:1;grid-row:2}#tool1{grid-column:1;grid-row:3}#tool2{grid-column:1;grid-row:4}#tool3{grid-column:1;grid-row:5}.menu ul{list-style-type:none;padding:0}.menu li{cursor:pointer;padding:10px;background-color:#242424;border-bottom:1px solid #6c5ce7}.menu li:hover{background-color:#6c5ce7}.content{margin-left:200px;padding:20px}#senderProgressContainer{display:flex;justify-content:center;align-items:center}#senderProgressLabel{margin-right:10px}.innerContentCentre{display:flex;justify-content:center;align-items:center;margin:10px}#gcodeSenderContainer{position:relative;width:100%}#gcodeSenderEditor{border-bottom:1px solid #ccc;background-color:#242424}#latheControls #incrementControls{display:flex;justify-content:center;gap:10px;margin:10px 0 20px}#latheControls .increment-btn{padding:5px 10px;border:1px solid #ccc;background-color:#f0ad4e;border-radius:5px;cursor:pointer;transition:background-color .3s}#latheControls .increment-btn:hover,#latheControls .increment-btn.active{background-color:#6c5ce7}.control-inputs input[type=text]{max-width:200px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem}.control-inputs label{display:block;margin-right:5px}#latheControls label{white-space:nowrap;margin-right:10px;display:inline-block;min-width:120px}.planner-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;width:800px;max-width:1280px;text-align:center;border:1px solid #ccc}#taskContainer{display:flex;justify-content:space-between;align-items:start;gap:20px;padding-bottom:20px}#tasksToExecute,#availableTasks{border:1px solid #ccc;padding:10px}#tasksToExecute div,#availableTasks div{margin:5px 0;padding:5px;background-color:#0003}.gu-mirror{position:fixed!important;margin:0!important;z-index:9999!important;opacity:.8}.gu-hide{display:none!important}.gu-unselectable{-webkit-user-select:none!important;-moz-user-select:none!important;-ms-user-select:none!important;user-select:none!important}.gu-transit{opacity:.2}

</style>
</head>

<body>

    <div id="mainContainer" class="main-container">
        <div class="menu">
            <ul>
                <li id="simulationTab">Simulation</li>
                <li id="controlTab">Control</li>
                <li id="plannerTab">Planner</li>
            </ul>
        </div>

        <div id="simulationContainer" class="main-container">
            <div id="simulationContent" class="controls-container">
                <div id="gcodeContainer" style="position: relative;">
                    <div id="gcodeEditor" style="height: 200px; width: 100%;"></div>
                </div>
                <div class="innerContainer">
                    <input type="file" id="fileInput" accept=".txt,.gcode">
                </div>
                <div class="innerContainer">
                    <button id="simulateButton">Simulate</button>
                    <button id="clearButton">Clear</button>
                    <button id="helpButton">How to use</button>
                </div>
                <div id="sliderContainer" class="innerContainer" style="display: none; width: 400px;">
                    <input type="range" id="progressSlider" min="0" max="100" value="0" style="width: 100%;">
                    <div id="sliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                </div>
                <div id="displayOptionsContainer" class="innerContainer" style="display: none;">
                    <input type="checkbox" id="showCuts" checked> Show Cut Moves
                    </label>
                    <label>
                        <input type="checkbox" id="showNonCuts" checked>
                        Show Non-Cut Moves
                    </label>
                </div>
                <div class="innerContainer" id="loadAndSave">
                    <hr>
                    <div class="innerContainer toolbar">
                        <input type="text" class="saveGCodeNameInput" placeholder="name of save"></input>
                        <button class="saveGCodeButton" title="Save GCode to local browser storage">Save local</button>
                    </div>
                    <div class="innerContainer toolbar">
                        <select class="loadGCodeSelect"></select>
                        <button class="loadGCodeButton" title="Load GCode from local browser storage">Load</button>
                        <button class="deleteGCodeButton" title="Delete GCode from local browser storage">Delete</button>
                    </div>
                    <hr>
                </div>
            </div>

            <div class="canvas-container">
                <canvas id="gcodeCanvas" width="800" height="600"></canvas>
                <div class="innerContainer"><button id="zoomButton" title="Zoom in">Zoom In</button></div>
            </div>

        </div>
        <div id="controlsContainer" class="main-container" style="display: none;">
            <div id="controlsContent" class="controls-container">
                <div id="gcodeSenderContainer" class="innerContainer">

                    <span>Send GCode to Nano ELS H4</span>

                    <div class="innerContainer">
                        <button id="connectButton" title="Connect to Nano ELS H4">Connect</button>
                        <button id="gcodeSenderButton" title="Send GCode to CNC" style="display: none;">Send</button>
                        <button id="stopButton" style="display: none;">Stop</button>
                    </div>
                </div>

                <div id="latheControls">
                    <div id="jogControls">
                        <span id="fastText">Fast</span>
                        <span id="slowText">Slow</span>
                        <span id="toolText">Tool</span>

                        <!-- Tools -->
                        <button class="tool-btn tool-selected" id="tool0">T0</button>
                        <button class="tool-btn" id="tool1">T1</button>
                        <button class="tool-btn" id="tool2">T2</button>
                        <button class="tool-btn" id="tool3">T3</button>
                        <!-- Fast arrows -->
                        <button class="arrow fast jog-btn" id="fastForward"><i class="fas fa-arrow-up"></i></button>
                        <button class="arrow fast jog-btn" id="fastBackward"><i class="fas fa-arrow-down"></i></button>
                        <button class="arrow fast jog-btn" id="fastLeft"><i class="fas fa-arrow-left"></i></button>
                        <button class="arrow fast jog-btn" id="fastRight"><i class="fas fa-arrow-right"></i></button>
                        <!-- Slow arrows -->
                        <button class="arrow slow jog-btn" id="slowForward"><i class="fas fa-arrow-up"></i></button>
                        <button class="arrow slow jog-btn" id="slowBackward"><i class="fas fa-arrow-down"></i></button>
                        <button class="arrow slow jog-btn" id="slowLeft"><i class="fas fa-arrow-left"></i></button>
                        <button class="arrow slow jog-btn" id="slowRight"><i class="fas fa-arrow-right"></i></button>
                    </div>
                    <div id="incrementControls">
                        <button class="increment-btn" data-increment="0.01">0.01</button>
                        <button class="increment-btn" data-increment="0.1">0.1</button>
                        <button class="increment-btn active" data-increment="1">1</button>
                        <button class="increment-btn" data-increment="10">10</button>
                    </div>
                    <div id="feedrateControls" class="innerContentCentre control-inputs">
                        <label for="fastFeedrate">Fast Feedrate:</label>
                        <input type="text" id="fastFeedrate" name="fastFeedrate" value="200">
                        <label for="slowFeedrate">Slow Feedrate:</label>
                        <input type="text" id="slowFeedrate" name="slowFeedrate" value="50">
                    </div>
                    <div id="distanceControl" class="innerContentCentre control-inputs">
                        <label for="moveDistance">Move Distance (mm):</label>
                        <input type="text" id="moveDistance" name="moveDistance" value="1">
                    </div>
                </div>

                <div id="gcodeResponseContainer" style="display: none;">
                    <div id="gcodeResponseHeader">GCode Responses</div>
                    <div id="gcodeResponseEditor" style="height: 200px; width: 100%;"></div>
                    <div class="senderError" style="display: none;"></div>
                    <div id="senderProgressContainer">
                        <span id="senderProgressLabel" style="display: none;">Progress...</span>
                        <progress id="senderProgress" max="1" style="display: none;"></progress>
                    </div>
                </div>
            </div>
            <div class="controls-container">
                <div id="gcodeSenderContainer" style="position: relative;">
                    <span>GCode to Send</span>
                    <div id="gcodeSenderEditor" style="height: 200px; width: 100%;"></div>
                </div>
            </div>
        </div>
        <div id="plannerContainer" class="main-container" style="display: none;">
            <div id="plannerContent" class="planner-container">
                <div class="innerContainer">
                    <span>Planner</span>
                </div>
                <div id="taskContainer">
                    <div id="tasksToExecute" class="container">
                        <h2>Tasks to Execute</h2>
                        <div>Set up stock</div>
                        <div>Mount T0</div>
                    </div>
                    <div id="availableTasks" class="container">
                        <h2>Available Tasks</h2>
                        <div>Set up stock</div>
                        <div>Mount T0</div>
                        <div>Mount T1</div>
                        <div>Mount T2</div>
                        <div>Mount T3</div>
                    </div>
                </div>
            </div>
        </div>
        <div id="helpModal" class="help-modal">
            <div class="help-modal-content">
                <span id="closeHelpModal" class="close-modal">&times;</span>
                <div id="helpText">
                    <div>This tool is designed to be used in cunjunction with LatheCode:</div>
                    <div><a href="https://kachurovskiy.github.io/lathecode/ " target="_blank ">https://kachurovskiy.github.io/lathecode/</a></div>
                    <ul style="list-style-type: disc; padding-left: 20px; ">
                        <li>Use LatheCode to generate the G-code, then paste it into this tool.</li>
                        <li>You can also write the G-code by hand for simple operations such as boring or grooving. <a href="# " id="exampleCode">Click here</a> to load an example.</li>
                        <li>Click "Simulate" to plot the moves onto the canvas.</li>
                        <li>movement lines marked with "; cut" will show in <span class="line red-line"></span><span class="text-red">red</span>.</li>
                        <li>movement lines marked with "; travel" will show in <span class="line green-line"></span><span class="text-green">green</span>.</li>
                        <li>movement lines marked with "; retract" will show in <span class="line orange-line"></span><span class="text-orange">orange</span>.</li>
                        <li>movement lines not marked will default to <span class="line green-line"></span><span class="text-green">green</span>.</li>
                        <li>All other moves will be considered travel moves and will show in green.</li>
                        <li>Any G-code you paste or write can be saved into the browser's local storage. This is useful for saving common operations.</li>
                        <li>When you're ready, you can send the G-code to the Nano ELS H4 by clicking "Send."</li>
                        <li>More functionality to come soon! Version 0.2</li>
                        <li>Please provide feedback, raise issues or make suggestions here: <a href="https://github.com/Festivejelly/LatheGcodeVisualiser " target="_blank ">https://github.com/Festivejelly/LatheGcodeVisualiser</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="zoomModal" class="zoom-modal">
            <div class="zoom-modal-content" style="background-color: #242424;">
                <span id="closeZoomModal" class="close-modal">&times;</span>
                <canvas id="zoomCanvas" width="1600 " height="1200 "></canvas>
                <div id="sliderAndButtonContainer">
                    <div id="zoomSliderContainer" class="innerContainer" style="width: 400px;">
                        <input type="range" id="zoomProgressSlider" min="0" max="100" value="0" style="width: 100%;">
                        <div id="zoomSliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                    </div>
                    <button id="zoomCloseButton">Close</button>
                </div>
            </div>
        </div>
</body>

</html>