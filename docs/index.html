<!DOCTYPE html>
<html>

<head>
    <title>G-Code Visualizer</title>
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/ace.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <script type="module" crossorigin>
var Ut=Object.defineProperty;var Yt=(t,e,n)=>e in t?Ut(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var B=(t,e,n)=>(Yt(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&a(h)}).observe(document,{childList:!0,subtree:!0});function n(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(l){if(l.ep)return;l.ep=!0;const r=n(l);fetch(l.href,r)}})();class Wt{constructor(e,n,a,l,r,h,I,C){this.isConnected=e,this.condition=n,this.error=a,this.progress=l,this.z=r,this.x=h,this.feed=I,this.rpm=C}}const be=class be{constructor(){B(this,"listeners",[]);B(this,"port",null);B(this,"readTimeout",0);B(this,"reader",null);B(this,"writer",null);B(this,"isOn",!1);B(this,"waitForOkOrError",!1);B(this,"lines",[]);B(this,"lineIndex",0);B(this,"unparsedResponse","");B(this,"error","");B(this,"statusReceived",!1);B(this,"z",0);B(this,"x",0);B(this,"feed",0);B(this,"rpm",0);B(this,"isDisconnecting",!1);B(this,"lastStatus",null)}static getInstance(){return be.instance||(be.instance=new be),be.instance}getStatus(){return this.lastStatus=new Wt(this.port!==null,this.isOn?"run":"idle",this.error,this.lines.length?this.lineIndex/this.lines.length:0,this.z,this.x,this.feed,this.rpm),this.lastStatus}addStatusChangeListener(e){this.listeners.push(e)}notifyStatusChange(){this.listeners.forEach(e=>e())}setStatus(e){e.startsWith("<")&&(e=e.substring(1)),e.endsWith(">")&&(e=e.slice(0,-1));const n=e.split("|");if(n.length>=3){if(this.statusReceived=!0,n[1].startsWith("WPos:")){const a=n[1].substring(5).split(",");this.z=Number(a[2]),this.x=Number(a[0])}if(n[2].startsWith("FS:")){const a=n[2].substring(3).split(",");this.feed=Number(a[0]),this.rpm=Number(a[1])}}this.notifyStatusChange()}setError(e){this.error=e,ot(e),this.notifyStatusChange()}isConnected(){return this.lastStatus!==null&&this.lastStatus.isConnected}async connect(){try{if(this.port)this.closePort();else{if(await this.selectPort(),await this.askForStatus(),!await Kt(()=>this.statusReceived)){this.setError("Device is not reponding, is it in GCODE mode?");return}this.isDisconnecting=!1,this.isOn=!1,this.setError(""),this.waitForOkOrError=!1,this.unparsedResponse=""}}catch(e){console.log(e)}this.notifyStatusChange()}async disconnect(){this.isDisconnecting=!0,this.port&&this.closePort()}getDisconnectingStatus(){return this.isDisconnecting}async start(e){e&&(this.isOn=!0,this.lines=e.split(`
`),this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange())}async sendCommand(e){this.isOn=!0;let n=new Array(3);n[0]="G91",n[1]=e,n[2]="G90",this.lines=n,this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange()}async sendCommands(e){this.isOn=!0,this.lines=e,this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange()}async stop(){await this.write("!"),this.isOn&&(this.isOn=!1,this.askForStatus(),this.notifyStatusChange())}async write(e){if(this.port){if(ot(`command: ${e}`),console.log("command: ",e),!this.port.writable){e!="?"&&this.setError("Port is not writable, try reconnecting the USB and switching to GCODE mode.");return}if(!this.writer)try{const n=new TextEncoderStream;n.readable.pipeTo(this.port.writable),this.writer=n.writable.getWriter()}catch(n){this.setError("Failed to write: "+n);return}await this.writer.write(e)}}async writeCurrentLine(){if(!this.isOn||this.waitForOkOrError)return;if(this.lineIndex>=this.lines.length){this.stop();return}const e=this.lines[this.lineIndex].split(";")[0].trim();if(!e){this.lineIndex++,this.writeCurrentLine();return}this.waitForOkOrError=!0,await this.write(e+`
`),await this.readFromPort()}async processResponse(e){this.unparsedResponse=(this.unparsedResponse+e).trimStart(),ot(`command: ${e}`),console.log(`response: "${e}"`);const n=this.unparsedResponse.match(/(<[^>]+>)/);if(n&&n.length>1){n.shift();for(const a of n)this.unparsedResponse=this.unparsedResponse.replace(a,"");this.setStatus(n.pop())}this.unparsedResponse.startsWith("error:")?(this.setError(this.unparsedResponse),this.unparsedResponse="",this.stop()):this.unparsedResponse.startsWith("ok")&&(this.unparsedResponse="",this.waitForOkOrError=!1,this.lineIndex++,this.notifyStatusChange(),this.isOn&&await this.writeCurrentLine())}async selectPort(){if(this.port&&this.closePort(),navigator.serial?this.port=await navigator.serial.requestPort():(this.error="This browser does not support Serial API, try Chrome or Edge",this.notifyStatusChange()),this.port)try{await this.port.open({baudRate:115200}),this.notifyStatusChange(),this.readSoon()}catch(e){this.setError(`Unable to open port - likely some other app is using it - try closing Arduino IDE.
${e}`),this.closePort()}}async askForStatus(){try{await this.write("?")}catch(e){this.setError(`Device disconnected? ${e}`),this.closePort()}}readSoon(){clearTimeout(this.readTimeout),this.readTimeout=window.setTimeout(()=>this.readFromPort(),200)}async readFromPort(){if(this.port)try{if(!this.port.readable){this.readSoon();return}if(!this.reader){const n=new TextDecoderStream;this.port.readable.pipeTo(n.writable),this.reader=n.readable.getReader()}const{value:e}=await this.reader.read();if(!e){this.readSoon();return}await this.processResponse(e),this.readSoon()}catch(e){this.setError(e.message||String(e)),this.closePort()}}async closePort(){if(this.port){if(clearTimeout(this.readTimeout),this.reader){try{await this.reader.cancel(),this.reader.releaseLock()}catch(e){console.error("Error cancelling reader: ",e)}this.reader=null}if(this.writer){try{await this.writer.close(),this.writer.releaseLock()}catch(e){console.error("Error closing writer: ",e)}this.writer=null}await new Promise(e=>setTimeout(e,500));try{await this.port.close()}catch(e){console.error("Error closing port: ",e)}this.port=null,this.statusReceived=!1,this.z=0,this.x=0,this.feed=0,this.rpm=0}}};B(be,"instance",null);let We=be;function ot(t){var e=ie.getSession(),n=e.getLength(),a=new Date().toLocaleTimeString(),l=`[${a}] ${t}
`;e.insert({row:n,column:0},l)}function Kt(t){return new Promise(e=>{let n=0;function a(){t()?e(!0):n>=10?e(!1):(n++,setTimeout(a,100))}a()})}class Qt{constructor(){B(this,"sendButton");B(this,"stopButton");B(this,"senderError");B(this,"runProgress");B(this,"runProgressLabel");B(this,"connectButton");B(this,"isConnected",!1);B(this,"gcodeResponseContainer");B(this,"jogButtons");B(this,"toolButtons");B(this,"sender");let e,n,a;this.senderError=document.querySelector(".senderError"),this.runProgress=document.getElementById("senderProgress"),this.runProgressLabel=document.getElementById("senderProgressLabel"),this.connectButton=document.getElementById("connectButton"),this.gcodeResponseContainer=document.getElementById("gcodeResponseContainer"),a=document.getElementById("moveDistance"),e=document.getElementById("fastFeedrate"),n=document.getElementById("slowFeedrate"),this.jogButtons=document.querySelectorAll("#latheControls .jog-btn"),this.toolButtons=document.querySelectorAll("#latheControls .tool-btn"),this.sendButton=document.getElementById("gcodeSenderButton"),this.sender=We.getInstance(),this.sender.addStatusChangeListener(()=>this.handleStatusChange()),this.jogButtons.forEach(l=>{l.addEventListener("click",()=>{let r="",h="",I="",C=!0;l.id=="fastForward"?(r=e.value,h="X",I=a.value,C=!0):l.id=="slowForward"?(r=n.value,h="X",I=a.value,C=!0):l.id=="fastBackward"?(r=e.value,h="X",I=a.value,C=!1):l.id=="slowBackward"?(r=n.value,h="X",I=a.value,C=!1):l.id=="fastLeft"?(r=e.value,h="Z",I=a.value,C=!0):l.id=="slowLeft"?(r=n.value,h="Z",I=a.value,C=!0):l.id=="fastRight"?(r=e.value,h="Z",I=a.value,C=!1):l.id=="slowRight"&&(r=n.value,h="Z",I=a.value,C=!1);let L=`${h}${C===!0?"":"-"}${I} F${r}`;this.sender&&this.sender.sendCommand(L)})}),this.toolButtons.forEach(l=>{l.addEventListener("click",()=>{let r=l.id,h="T";r=="tool0"?h+="0":r=="tool1"?h+="1":r=="tool2"?h+="2":r=="tool3"&&(h+="3"),document.querySelectorAll("#latheControls .tool-btn").forEach(function(x){x.id!=r?x.classList.remove("tool-selected"):x.classList.add("tool-selected")});let C=new Array(2);C[0]="G91",C[1]=h,this.sender&&this.sender.sendCommands(C)})}),this.connectButton.addEventListener("click",()=>{this.gcodeResponseContainer.style.display="block",!this.isConnected&&this.sender&&this.sender.connect()}),this.sendButton.addEventListener("click",()=>{this.sender&&this.sender.start(U.getValue())}),this.stopButton=document.getElementById("stopButton"),this.stopButton.addEventListener("click",()=>this.sender.stop()),this.stopButton.style.display="none"}hide(){}handleStatusChange(){if(!this.sender)return;const e=this.sender.getStatus();if(e.isConnected===!1){this.sendButton.style.display="none",this.connectButton.innerText="Connect",this.isConnected=!1;return}else this.isConnected=!0,this.sendButton.style.display="inline-block",this.connectButton.innerText="Connected",this.connectButton.disabled=!0;const n=e.condition==="run";this.runProgress&&(this.runProgress.value=e.progress,this.runProgress.style.display=n?"block":"none",this.runProgressLabel.style.display=n?"block":"none"),this.stopButton&&(this.stopButton.style.display=n?"inline-block":"none");const a=this.sender.getDisconnectingStatus();this.senderError&&!a&&(e.error?(this.senderError.style.display="block",this.senderError.innerText=e.error,this.showError(),this.appendLineToResponseEditor(e.error)):(this.hideError(),this.senderError.innerText=""))}appendLineToResponseEditor(e){var n=ie.getSession(),a=n.getLength(),l=new Date().toLocaleTimeString(),r=`[${l}] ${e}
`;n.insert({row:a,column:0},r)}showError(){this.senderError.style.display="block"}hideError(){this.senderError.style.display="none"}}const en=`; This example shows a boring operation, then an internal grooving operation

G21 ; metric
G18 ; ZX plane
G90 ; absolute positioning
F200
X0 ; zero your tool X on centerline
Z0 ; zero your tool Z at the right edge of the stock
G91 ; relative positioning

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;1mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;2mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;3mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;4mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;5mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;6mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;7mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;8mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;9mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;10mm

Z-10

Z3.25 ; cut
X-5 ; cut

X-1.7 ; cut

X6.7 ; retract
Z-3.25 ; retract
`;function tn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var nn=function(e,n){return Array.prototype.slice.call(e,n)},on=typeof setImmediate=="function",gt;on?gt=function(t){setImmediate(t)}:gt=function(t){setTimeout(t,0)};var an=gt,sn=an,rn=function(e,n,a){e&&sn(function(){e.apply(a||null,n||[])})},kt=nn,ln=rn,cn=function(e,n){var a=n||{},l={};return e===void 0&&(e={}),e.on=function(r,h){return l[r]?l[r].push(h):l[r]=[h],e},e.once=function(r,h){return h._once=!0,e.on(r,h),e},e.off=function(r,h){var I=arguments.length;if(I===1)delete l[r];else if(I===0)l={};else{var C=l[r];if(!C)return e;C.splice(C.indexOf(h),1)}return e},e.emit=function(){var r=kt(arguments);return e.emitterSnapshot(r.shift()).apply(this,r)},e.emitterSnapshot=function(r){var h=(l[r]||[]).slice(0);return function(){var I=kt(arguments),C=this||e;if(r==="error"&&a.throws!==!1&&!h.length)throw I.length===1?I[0]:I;return h.forEach(function(L){a.async?ln(L,I,C):L.apply(C,I),L._once&&e.off(r,L)}),e}},e},Rt=window.CustomEvent;function un(){try{var t=new Rt("cat",{detail:{foo:"bar"}});return t.type==="cat"&&t.detail.foo==="bar"}catch{}return!1}var dn=un()?Rt:typeof document<"u"&&typeof document.createEvent=="function"?function(e,n){var a=document.createEvent("CustomEvent");return n?a.initCustomEvent(e,n.bubbles,n.cancelable,n.detail):a.initCustomEvent(e,!1,!1,void 0),a}:function(e,n){var a=document.createEventObject();return a.type=e,n?(a.bubbles=!!n.bubbles,a.cancelable=!!n.cancelable,a.detail=n.detail):(a.bubbles=!1,a.cancelable=!1,a.detail=void 0),a},Pt=[],at="",mn=/^on/;for(at in window)mn.test(at)&&Pt.push(at.slice(2));var fn=Pt,pn=dn,hn=fn,Ve=window.document,$t=vn,Zt=kn,Je=[];window.addEventListener||($t=yn,Zt=bn);var gn={add:$t,remove:Zt,fabricate:En};function vn(t,e,n,a){return t.addEventListener(e,n,a)}function yn(t,e,n){return t.attachEvent("on"+e,Bn(t,e,n))}function kn(t,e,n,a){return t.removeEventListener(e,n,a)}function bn(t,e,n){var a=Jt(t,e,n);if(a)return t.detachEvent("on"+e,a)}function En(t,e,n){var a=hn.indexOf(e)===-1?r():l();t.dispatchEvent?t.dispatchEvent(a):t.fireEvent("on"+e,a);function l(){var h;return Ve.createEvent?(h=Ve.createEvent("Event"),h.initEvent(e,!0,!0)):Ve.createEventObject&&(h=Ve.createEventObject()),h}function r(){return new pn(e,{detail:n})}}function Cn(t,e,n){return function(l){var r=l||window.event;r.target=r.target||r.srcElement,r.preventDefault=r.preventDefault||function(){r.returnValue=!1},r.stopPropagation=r.stopPropagation||function(){r.cancelBubble=!0},r.which=r.which||r.keyCode,n.call(t,r)}}function Bn(t,e,n){var a=Jt(t,e,n)||Cn(t,e,n);return Je.push({wrapper:a,element:t,type:e,fn:n}),a}function Jt(t,e,n){var a=wn(t,e,n);if(a){var l=Je[a].wrapper;return Je.splice(a,1),l}}function wn(t,e,n){var a,l;for(a=0;a<Je.length;a++)if(l=Je[a],l.element===t&&l.type===e&&l.fn===n)return a}var bt={},Sn="(?:^|\\s)",Tn="(?:\\s|$)";function Ft(t){var e=bt[t];return e?e.lastIndex=0:bt[t]=e=new RegExp(Sn+t+Tn,"g"),e}function In(t,e){var n=t.className;n.length?Ft(e).test(n)||(t.className+=" "+e):t.className=e}function Ln(t,e){t.className=t.className.replace(Ft(e)," ").trim()}var Nn={add:In,rm:Ln},xn=cn,Ne=gn,me=Nn,xe=document,ee=xe.documentElement;function _n(t,e){var n=arguments.length;n===1&&Array.isArray(t)===!1&&(e=t,t=[]);var a,l,r,h,I,C,x,L,J,o,u,c=null,d,s=e||{};s.moves===void 0&&(s.moves=wt),s.accepts===void 0&&(s.accepts=wt),s.invalid===void 0&&(s.invalid=et),s.containers===void 0&&(s.containers=t||[]),s.isContainer===void 0&&(s.isContainer=Xn),s.copy===void 0&&(s.copy=!1),s.copySortSource===void 0&&(s.copySortSource=!1),s.revertOnSpill===void 0&&(s.revertOnSpill=!1),s.removeOnSpill===void 0&&(s.removeOnSpill=!1),s.direction===void 0&&(s.direction="vertical"),s.ignoreInputTextSelection===void 0&&(s.ignoreInputTextSelection=!0),s.mirrorContainer===void 0&&(s.mirrorContainer=xe.body);var f=xn({containers:s.containers,start:Qe,end:je,cancel:_e,remove:ye,destroy:w,canMove:Ke,dragging:!1});return s.removeOnSpill===!0&&f.on("over",Ee).on("out",Xe),E(),f;function p(i){return f.containers.indexOf(i)!==-1||s.isContainer(i)}function E(i){var g=i?"remove":"add";De(ee,g,"mousedown",V),De(ee,g,"mouseup",re)}function b(i){var g=i?"remove":"add";De(ee,g,"mousemove",te)}function k(i){var g=i?"remove":"add";Ne[g](ee,"selectstart",G),Ne[g](ee,"click",G)}function w(){E(!0),re({})}function G(i){d&&i.preventDefault()}function V(i){C=i.clientX,x=i.clientY;var g=Et(i)!==1||i.metaKey||i.ctrlKey;if(!g){var y=i.target,S=R(y);S&&(d=S,b(),i.type==="mousedown"&&(It(y)?y.focus():i.preventDefault()))}}function te(i){if(d){if(Et(i)===0){re({});return}if(!(i.clientX!==void 0&&Math.abs(i.clientX-C)<=(s.slideFactorX||0)&&i.clientY!==void 0&&Math.abs(i.clientY-x)<=(s.slideFactorY||0))){if(s.ignoreInputTextSelection){var g=fe("clientX",i)||0,y=fe("clientY",i)||0,S=xe.elementFromPoint(g,y);if(It(S))return}var M=d;b(!0),k(),je(),Fe(M);var N=On(r);h=fe("pageX",i)-N.left,I=fe("pageY",i)-N.top,me.add(o||r,"gu-transit"),Me(),ue(i)}}}function R(i){if(!(f.dragging&&a)&&!p(i)){for(var g=i;Z(i)&&p(Z(i))===!1;)if(s.invalid(i,g)||(i=Z(i),!i))return;var y=Z(i);if(y&&!s.invalid(i,g)){var S=s.moves(i,y,g,Re(i));if(S)return{item:i,source:y}}}}function Ke(i){return!!R(i)}function Qe(i){var g=R(i);g&&Fe(g)}function Fe(i){O(i.item,i.source)&&(o=i.item.cloneNode(!0),f.emit("cloned",o,i.item,"copy")),l=i.source,r=i.item,L=J=Re(i.item),f.dragging=!0,f.emit("drag",r,l)}function et(){return!1}function je(){if(f.dragging){var i=o||r;le(i,Z(i))}}function ve(){d=!1,b(!0),k(!0)}function re(i){if(ve(),!!f.dragging){var g=o||r,y=fe("clientX",i)||0,S=fe("clientY",i)||0,M=Bt(a,y,S),N=ce(M,y,S);N&&(o&&s.copySortSource||!o||N!==l)?le(g,N):s.removeOnSpill?ye():_e()}}function le(i,g){var y=Z(i);o&&s.copySortSource&&g===l&&y.removeChild(r),ne(g)?f.emit("cancel",i,l,l):f.emit("drop",i,g,l,J),Oe()}function ye(){if(f.dragging){var i=o||r,g=Z(i);g&&g.removeChild(i),f.emit(o?"cancel":"remove",i,g,l),Oe()}}function _e(i){if(f.dragging){var g=arguments.length>0?i:s.revertOnSpill,y=o||r,S=Z(y),M=ne(S);M===!1&&g&&(o?S&&S.removeChild(o):l.insertBefore(y,L)),M||g?f.emit("cancel",y,l,l):f.emit("drop",y,S,l,J),Oe()}}function Oe(){var i=o||r;ve(),ze(),i&&me.rm(i,"gu-transit"),u&&clearTimeout(u),f.dragging=!1,c&&f.emit("out",i,c,l),f.emit("dragend",i),l=r=o=L=J=u=c=null}function ne(i,g){var y;return g!==void 0?y=g:a?y=J:y=Re(o||r),i===l&&y===L}function ce(i,g,y){for(var S=i;S&&!M();)S=Z(S);return S;function M(){var N=p(S);if(N===!1)return!1;var de=Ce(S,i),D=Be(S,de,g,y),W=ne(S,D);return W?!0:s.accepts(r,S,l,D)}}function ue(i){if(!a)return;i.preventDefault();var g=fe("clientX",i)||0,y=fe("clientY",i)||0,S=g-h,M=y-I;a.style.left=S+"px",a.style.top=M+"px";var N=o||r,de=Bt(a,g,y),D=ce(de,g,y),W=D!==null&&D!==c;(W||D===null)&&(nt(),c=D,tt());var P=Z(N);if(D===l&&o&&!s.copySortSource){P&&P.removeChild(N);return}var $,H=Ce(D,de);if(H!==null)$=Be(D,H,g,y);else if(s.revertOnSpill===!0&&!o)$=L,D=l;else{o&&P&&P.removeChild(N);return}($===null&&W||$!==N&&$!==Re(N))&&(J=$,D.insertBefore(N,$),f.emit("shadow",N,D,l));function F(m){f.emit(m,N,c,l)}function tt(){W&&F("over")}function nt(){c&&F("out")}}function Ee(i){me.rm(i,"gu-hide")}function Xe(i){f.dragging&&me.add(i,"gu-hide")}function Me(){if(!a){var i=r.getBoundingClientRect();a=r.cloneNode(!0),a.style.width=St(i)+"px",a.style.height=Tt(i)+"px",me.rm(a,"gu-transit"),me.add(a,"gu-mirror"),s.mirrorContainer.appendChild(a),De(ee,"add","mousemove",ue),me.add(s.mirrorContainer,"gu-unselectable"),f.emit("cloned",a,r,"mirror")}}function ze(){a&&(me.rm(s.mirrorContainer,"gu-unselectable"),De(ee,"remove","mousemove",ue),Z(a).removeChild(a),a=null)}function Ce(i,g){for(var y=g;y!==i&&Z(y)!==i;)y=Z(y);return y===ee?null:y}function Be(i,g,y,S){var M=s.direction==="horizontal",N=g!==i?D():de();return N;function de(){var P=i.children.length,$,H,F;for($=0;$<P;$++)if(H=i.children[$],F=H.getBoundingClientRect(),M&&F.left+F.width/2>y||!M&&F.top+F.height/2>S)return H;return null}function D(){var P=g.getBoundingClientRect();return W(M?y>P.left+St(P)/2:S>P.top+Tt(P)/2)}function W(P){return P?Re(g):g}}function O(i,g){return typeof s.copy=="boolean"?s.copy:s.copy(i,g)}}function De(t,e,n,a){var l={mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"},r={mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"},h={mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"};window.navigator.pointerEnabled?Ne[e](t,r[n],a):window.navigator.msPointerEnabled?Ne[e](t,h[n],a):(Ne[e](t,l[n],a),Ne[e](t,n,a))}function Et(t){if(t.touches!==void 0)return t.touches.length;if(t.which!==void 0&&t.which!==0)return t.which;if(t.buttons!==void 0)return t.buttons;var e=t.button;if(e!==void 0)return e&1?1:e&2?3:e&4?2:0}function On(t){var e=t.getBoundingClientRect();return{left:e.left+Ct("scrollLeft","pageXOffset"),top:e.top+Ct("scrollTop","pageYOffset")}}function Ct(t,e){return typeof window[e]<"u"?window[e]:ee.clientHeight?ee[t]:xe.body[t]}function Bt(t,e,n){t=t||{};var a=t.className||"",l;return t.className+=" gu-hide",l=xe.elementFromPoint(e,n),t.className=a,l}function Xn(){return!1}function wt(){return!0}function St(t){return t.width||t.right-t.left}function Tt(t){return t.height||t.bottom-t.top}function Z(t){return t.parentNode===xe?null:t.parentNode}function It(t){return t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.tagName==="SELECT"||jt(t)}function jt(t){return!t||t.contentEditable==="false"?!1:t.contentEditable==="true"?!0:jt(Z(t))}function Re(t){return t.nextElementSibling||e();function e(){var n=t;do n=n.nextSibling;while(n&&n.nodeType!==1);return n}}function Mn(t){return t.targetTouches&&t.targetTouches.length?t.targetTouches[0]:t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t}function fe(t,e){var n=Mn(e),a={pageX:"clientX",pageY:"clientY"};return t in a&&!(t in n)&&a[t]in n&&(t=a[t]),n[t]}var An=_n;const Lt=tn(An);class zt{static getButtonName(e){const n=this.buttons.find(a=>a.id===e);return n?n.name:""}static createKeyPressEvent(e,n){const a=this.buttons.find(r=>r.id===e);if(!a)throw new Error(`No button found with id: ${e}`);let l=a.number;return l&=127,n&&(l|=128),l}}B(zt,"buttons",[{name:"arrow_left_alt",id:"B_LEFT",number:57},{name:"arrow_right_alt",id:"B_RIGHT",number:37},{name:"arrow_upward_alt",id:"B_UP",number:47},{name:"arrow_downward_alt",id:"B_DOWN",number:67},{name:"+",id:"B_MINUS",number:5},{name:"-",id:"B_PLUS",number:64},{name:"play_arrow",id:"B_ON",number:17},{name:"crop_square",id:"B_OFF",number:27},{name:"keyboard_tab_rtl",id:"B_STOPL",number:7},{name:"keyboard_tab",id:"B_STOPR",number:15},{name:"vertical_align_top",id:"B_STOPU",number:6},{name:"vertical_align_bottom",id:"B_STOPD",number:16},{name:"rotate_left",id:"B_DISPL",number:14},{name:"signal_cellular_alt",id:"B_STEP",number:24},{name:"settings",id:"B_SETTINGS",number:34},{name:"space_bar",id:"B_MEASURE",number:54},{name:"sync_alt",id:"B_REVERSE",number:44},{name:"1",id:"B_0",number:51},{name:"2",id:"B_1",number:41},{name:"3",id:"B_2",number:61},{name:"4",id:"B_3",number:31},{name:"5",id:"B_4",number:2},{name:"6",id:"B_5",number:21},{name:"7",id:"B_6",number:12},{name:"8",id:"B_7",number:11},{name:"9",id:"B_8",number:22},{name:"10",id:"B_9",number:1},{name:"backspace",id:"B_BACKSPACE",number:32},{name:"manufacturing",id:"B_MODE_GEARS",number:42},{name:"reply",id:"B_MODE_TURN",number:52},{name:"turn_slight_left",id:"B_MODE_FACE",number:62},{name:"arrow_forward_ios",id:"B_MODE_CONE",number:3},{name:"publish",id:"B_MODE_CUT",number:13},{name:"home_improvement_and_tools",id:"B_MODE_THREAD",number:23},{name:"M",id:"B_MODE_OTHER",number:33},{name:"X",id:"B_X",number:53},{name:"Z",id:"B_Z",number:43},{name:"A",id:"B_A",number:4},{name:"B",id:"B_B",number:63}]);let Dn=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),"");const K=document.getElementById("availableTasks"),j=document.getElementById("tasksToExecute"),st=document.getElementById("deleteTasks"),Rn=document.getElementById("addNewTaskButton"),Te=document.getElementById("newTaskModal"),Pn=document.getElementById("closeNewTaskModal"),ae=document.getElementById("newTaskType"),Ie=document.getElementById("gcodeTaskContainer"),z=document.getElementById("newTaskGcode"),Le=document.getElementById("emulationOuterContainer"),$n=document.getElementById("saveNewTaskButton"),Pe=document.getElementById("newTaskName"),Nt=document.getElementById("taskTextTitle"),it=document.getElementById("newTaskDescription");let pe;const He=document.getElementById("plannerConnectButton"),Zn=document.getElementById("plannerContainer");let qe=!1,rt=!1;const Jn=document.getElementById("saveAvailableTaskCollection"),Fn=document.getElementById("saveAvailableTaskCollectionButtonModal"),jn=document.getElementById("loadTaskCollection"),he=document.getElementById("availableTaskCollections"),Q=document.getElementById("collectionToSaveTo"),xt=document.getElementById("newCollectionNameContainer"),lt=document.getElementById("newCollectionName"),zn=document.getElementById("deleteTaskCollection"),ct=document.getElementById("saveCollectionModal"),ge=document.getElementById("saveCollectionModalToSaveTo"),Gn=document.getElementById("saveCollectionModalClose"),Vn=document.getElementById("newCollectionNameModal"),_t=document.getElementById("newCollectionNameContainerModal"),Hn=document.getElementById("importAvailableTasks"),qn=document.getElementById("exportAvailableTasks"),ut=document.getElementById("saveJobModal"),Un=document.getElementById("saveJobModalClose"),Yn=document.getElementById("executeJobButton"),Wn=document.getElementById("saveJobButton"),$e=document.getElementById("saveJobNameInput"),Kn=document.getElementById("saveJobSaveButton"),Ue=document.getElementById("jobLoadSelect"),Qn=document.getElementById("loadJobToExecute"),eo=document.getElementById("deleteJobToExecute"),to=document.getElementById("importJobToExecute"),no=document.getElementById("exportJobToExecute"),Ze=[],dt=document.getElementById("manualTaskModal"),mt=document.getElementById("cncTaskModal"),oo=document.getElementById("cancelManualTask"),ao=document.getElementById("completeManualTask"),so=document.getElementById("manualTaskInstructions"),Ot=document.getElementById("cncTaskGcode"),io=document.getElementById("cancelCncTask"),Xt=document.getElementById("executeGcode"),Ye=document.getElementById("completeCncTask"),ro=document.getElementById("manualTaskName"),lo=document.getElementById("cncTaskName"),Mt=document.getElementById("cncTaskSenderProgressLabel"),ft=document.getElementById("cncTaskSenderProgress"),pt=document.getElementById("jobCancelledModal"),co=document.getElementById("jobCancelledCloseButton"),At=document.getElementById("completeTaskModal"),uo=document.getElementById("completeTaskCloseButton"),Dt=document.getElementById("notConnectedModal"),mo=document.getElementById("notConnectedCloseButton"),fo=document.getElementById("emulationInnerContainer"),se=document.getElementById("emulationNewTasks"),ht=document.getElementById("emulatedButtonListDelete"),po=document.getElementById("emulationTaskModal");document.addEventListener("DOMContentLoaded",()=>{pe=We.getInstance(),pe.addStatusChangeListener(()=>a()),Zn.addEventListener("containerVisible",()=>{x()}),I(),L(),C(),e(),n(),ge.addEventListener("change",()=>{ge.value==="new"?_t.style.display="block":_t.style.display="none"}),Q.addEventListener("change",()=>{Q.value==="new"?xt.style.display="block":xt.style.display="none"}),Gn.onclick=function(){ct.style.display="none"},Jn.onclick=function(){ct.style.display="block"},Fn.onclick=function(){let o="";if(ge.value==="new"){if(o=Vn.value,o===null||o===""){alert("Please enter a name for the collection");return}}else o=ge.value;const u={name:o,tasks:[]};K.querySelectorAll(".available-task").forEach(s=>{const f=s.getAttribute("data-task-id"),p=localStorage.getItem(`task_${f}`);p&&u.tasks.push(JSON.parse(p))}),localStorage.setItem(`taskCollection_${o}`,JSON.stringify(u));const d=document.createElement("option");d.value=o,d.textContent=o,he.appendChild(d),ct.style.display="none",alert(`Collection ${o} saved`),n()},jn.onclick=function(){x()},zn.onclick=function(){const o=he.value;if(o==="default"){alert("You cannot delete the default collection");return}confirm(`Are you sure you want to delete the collection ${o}?`)&&(localStorage.removeItem(`taskCollection_${o}`),n(),x())},Hn.onclick=function(){const o=document.createElement("input");o.type="file",o.accept=".json",o.multiple=!0,o.onchange=function(u){const c=u.target.files;if(c){const d=new FileReader;d.onload=function(s){var p;const f=(p=s.target)==null?void 0:p.result;f&&(JSON.parse(f).forEach(b=>{const k=b.name;localStorage.getItem(`taskCollection_${k}`)||localStorage.setItem(`taskCollection_${k}`,JSON.stringify(b))}),n())},d.readAsText(c[0])}},o.click()},qn.onclick=function(){const o=Object.keys(localStorage).filter(E=>E.includes("taskCollection_")),u=[];o.forEach(E=>{const b=localStorage.getItem(E);b&&u.push(JSON.parse(b))});const c=new Blob([JSON.stringify(u,null,2)],{type:"application/json"}),d=URL.createObjectURL(c),s=document.createElement("a");s.href=d;const p=new Date().toISOString().split("T")[0];s.download=`availableTasks_${p}.json`,s.click(),URL.revokeObjectURL(d)},fo.addEventListener("click",function(o){const u=o.target;if(u.tagName==="BUTTON"){const c=u.id;t(c)}});function t(o){const u=document.getElementById(o),c=u==null?void 0:u.cloneNode(!0);c.classList.add("emulated-button-list"),c.removeAttribute("id");const d="emulated-"+Date.now();c.setAttribute("data-emulated-id",d),se==null||se.appendChild(c)}function e(o=!1){o&&(Ue.innerHTML=""),Object.keys(localStorage).filter(c=>c.includes("savedJob_")).forEach(c=>{const d=c.replace("savedJob_",""),s=document.createElement("option");s.value=d,s.textContent=d,Ue.appendChild(s)})}function n(){he.innerHTML="",Q.innerHTML="",ge.innerHTML="";const o=document.createElement("option");o.value="default",o.textContent="default",he.appendChild(o),Q.appendChild(o.cloneNode(!0)),ge.appendChild(o.cloneNode(!0)),Object.keys(localStorage).filter(s=>s.includes("taskCollection_")).forEach(s=>{if(s==="taskCollection_default")return;const f=s.replace("taskCollection_",""),p=document.createElement("option");p.value=f,p.textContent=f,he.appendChild(p),Q.appendChild(p.cloneNode(!0)),ge.appendChild(p.cloneNode(!0))});const c=localStorage.getItem("selectedTaskCollection");c&&(he.value=c);const d=document.createElement("option");d.value="new",d.textContent="--new collection--",Q.appendChild(d.cloneNode(!0)),ge.appendChild(d.cloneNode(!0))}mo.onclick=function(){Dt.style.display="none"},He.addEventListener("click",()=>{!qe&&pe&&pe.connect()});function a(){if(!pe)return;const o=pe.getStatus();if(o.isConnected===!1){He.innerText="Connect",qe=!1;return}else qe=!0,He.innerText="Connected",He.disabled=!0;const u=o.condition==="run";!u&&rt?(Ye.style.display="block",Ye.disabled=!1,rt=!1):u&&(Xt.disabled=!0,rt=!0),ft.value=o.progress,console.log(`Progress: ${o.progress}`),ft.style.display="block",Mt.style.display="block"}Lt([se,ht],{copy:!1,accepts:(o,u)=>u===ht||u===se,revertOnSpill:!0,removeOnSpill:!1}).on("drop",(o,u)=>{if(u===ht){o.remove();const c=o.getAttribute("data-emulated-id"),d=se.querySelector(`[data-emulated-id="${c}"]`);d&&d.remove()}});const r=Lt([K,j,st],{copy:(o,u)=>u===K,accepts:(o,u)=>u===j||u===st,revertOnSpill:!0,removeOnSpill:!1});r.on("dragend",()=>{L(),C(),h()});function h(o="currentJob"){const u=j.querySelectorAll(".task-to-execute"),c=[];u.forEach(d=>{const s=d.getAttribute("data-task-id"),f=d.getAttribute("data-collection-name");c.push({id:s,collectionName:f})}),localStorage.setItem(o,JSON.stringify(c))}function I(){const o=localStorage.getItem("currentJob");o&&JSON.parse(o).forEach(c=>{const d=localStorage.getItem(`taskCollection_${c.collectionName}`);if(d){const f=JSON.parse(d).tasks.find(p=>p.id===c.id);if(f){const p=document.createElement("div");p.classList.add(`task-${f.type}`),p.classList.add("task-to-execute"),p.setAttribute("data-task-id",f.id),p.setAttribute("data-task-name",f.name),p.setAttribute("data-collection-name",c.collectionName),p.textContent=f.name,j.appendChild(p)}}})}r.on("drop",(o,u,c)=>{const d=o.getAttribute("data-task-id"),s=o.getAttribute("data-task-order");if(u===j)o.classList.remove("available-task"),o.classList.add("task-to-execute"),C();else if(u===st){o.remove();let f=null;if(c===j)f=j.querySelector(`[data-task-order="${s}"]`);else if(c===K&&(f=K.querySelector(`[data-task-id="${d}"]`),f)){const p=f.getAttribute("data-collection-name"),E=localStorage.getItem(`taskCollection_${p}`);if(E){const b=JSON.parse(E);b.tasks=b.tasks.filter(k=>k.id!==d),localStorage.setItem(`taskCollection_${p}`,JSON.stringify(b))}}f&&f.remove()}});function C(){j.querySelectorAll(".task-to-execute").forEach(u=>{if(u.querySelector("i")){let c=u.querySelector("i");c&&(c.remove(),c=document.createElement("i"),u.classList.contains("task-manual")?(c.className="fas fa-users-cog icon-tooltip",c.setAttribute("data-tooltip","Manual Task")):u.classList.contains("task-gcode")?(c.className="fas fa-code icon-tooltip",c.setAttribute("data-tooltip","Gcode Task")):u.classList.contains("task-emulation")&&(c.className="far fa-keyboard icon-tooltip",c.setAttribute("data-tooltip","Emulation Task")),u.appendChild(c))}else{const c=document.createElement("i");u.classList.contains("task-manual")?(c.className="fas fa-users-cog icon-tooltip",c.setAttribute("data-tooltip","Manual Task")):u.classList.contains("task-gcode")?(c.className="fas fa-code icon-tooltip",c.setAttribute("data-tooltip","Gcode Task")):u.classList.contains("task-emulation")&&(c.className="far fa-keyboard icon-tooltip",c.setAttribute("data-tooltip","Emulation Task")),u.appendChild(c)}})}function x(){K.innerHTML="";const o=he.value;localStorage.setItem("selectedTaskCollection",o);const u=localStorage.getItem(`taskCollection_${o}`);u&&JSON.parse(u).tasks.forEach(d=>{d.id,d.name,d.type,d.description,d.gcode&&d.gcode,d.buttonKeys&&d.buttonKeys;const s=document.createElement("div");s.classList.add(`task-${d.type}`),s.classList.add("available-task"),s.setAttribute("data-task-id",d.id.toString()),s.setAttribute("data-task-name",d.name),s.setAttribute("data-collection-name",o),s.textContent=d.name;const f=document.createElement("i");f.classList.add("fas","fa-info-circle","fa-fw","show-info","icon-tooltip"),f.setAttribute("data-tooltip","Click for more info..."),s.appendChild(f),K.appendChild(s)})}function L(){const o=document.getElementById("tasksToExecute");o&&o.querySelectorAll("div").forEach((c,d)=>{const s=c.getAttribute("data-task-name");c.setAttribute("data-task-order",(d+1).toString()),c.textContent=`Task ${d+1}: ${s}`})}ae.addEventListener("change",()=>{ae.value==="manual"?(z.disabled=!0,z.placeholder="Disabled for manual tasks",z.value="",Ie.style.display="none",Le.style.display="none"):ae.value==="emulation"?(z.disabled=!0,z.placeholder="Disabled for emulation tasks",z.value="",Ie.style.display="none",Le.style.display="block"):(Le.style.display="none",Ie.style.display="block",z.placeholder="Enter gcode here...",z.disabled=!1)}),Rn.addEventListener("click",()=>{Te.style.display="block",Q.value=localStorage.getItem("selectedTaskCollection")??"default",Nt.textContent="Add a new task"}),$n.addEventListener("click",()=>{if(Q.value==="new"&&lt.value===""){alert("Please enter a collection name");return}if(Pe.value===""||Pe.value===null){alert("Please enter a task name");return}const o=Pe.value,u=document.createElement("div");u.classList.add(`task-${ae.value}`),u.classList.add("available-task");let c;const d=Te.getAttribute("data-task-id");d?c=d:c=Dn(),u.setAttribute("data-task-id",c.toString()),u.setAttribute("data-task-name",o),u.textContent=o;const s=document.createElement("i");s.classList.add("fas","fa-info-circle","fa-fw","show-info","icon-tooltip"),s.setAttribute("data-tooltip","Click for more info..."),u.appendChild(s);const f=K.querySelector(`[data-task-id="${c}"]`);f&&f.remove(),K.appendChild(u),Te.style.display="none";let p="";ae.value==="emulation"&&(se.querySelectorAll(".emulated-button-list").forEach(k=>{const w=k.getAttribute("data-button-key");p+=w+","}),p.length>0&&(p=p.slice(0,-1)));const E={id:c,name:o,type:ae.value,description:it.value};if(ae.value==="gcode"&&(E.gcode=z.value),ae.value==="emulation"&&(E.buttonKeys=p),Q.value==="new"){const b=lt.value,k={name:b,tasks:[]};k.tasks.push(E),localStorage.setItem(`taskCollection_${b}`,JSON.stringify(k));const w=document.createElement("option");w.value=b,w.textContent=b,he.appendChild(w),n()}else{const b=Q.value,k=localStorage.getItem(`taskCollection_${b}`);if(k){const w=JSON.parse(k);w.tasks.find(V=>V.id===c)&&(w.tasks=w.tasks.filter(V=>V.id!==c)),w.tasks.push(E),localStorage.setItem(`taskCollection_${b}`,JSON.stringify(w))}else{const w={name:b,tasks:[]};w.tasks.push(E),localStorage.setItem(`taskCollection_${b}`,JSON.stringify(w))}}Pe.value="",it.value="",z.value="",lt.value=""}),K.addEventListener("click",o=>{const u=o.target;if(u.matches(".show-info")){const d=u.parentNode.getAttribute("data-task-id");let s=null;const f=localStorage.getItem("selectedTaskCollection"),p=localStorage.getItem(`taskCollection_${f}`);if(p){const b=JSON.parse(p).tasks.find(k=>k.id===d);b&&(s=b)}s&&(Te.style.display="block",Pe.value=s.name,ae.value=s.type,it.value=s.description,z.value=s.gcode||"",Nt.textContent="Edit Task",s.type==="emulation"?(Le.style.display="block",Ie.style.display="none",se.innerHTML="",(s.buttonKeys??"").split(",").forEach(b=>{const k=document.createElement("button");k.classList.add("emulated-button-list"),k.classList.add("material-symbols-outlined"),k.setAttribute("data-button-key",b),k.textContent=zt.getButtonName(b),k.textContent.length===1&&k.classList.add("standard-font"),se.appendChild(k)})):s.type==="gcode"?(Le.style.display="none",Ie.style.display="block",z.disabled=!1,z.placeholder="Enter gcode here..."):(Le.style.display="none",Ie.style.display="none"),d&&Te.setAttribute("data-task-id",d.toString()))}}),Pn.onclick=function(){Te.style.display="none"},uo.onclick=function(){At.style.display="none"};function J(){if(Ze.length===0){console.log("All tasks completed"),At.style.display="block";return}const o=Ze.shift();o&&o.type==="manual"?(ro.textContent=`Task ${o.order}: ${o.name}`,so.value=o.description,dt.style.display="block"):o&&o.type==="gcode"?(lo.textContent=`Task ${o.order}: ${o.name}`,Ot.value=o.gcode??"",mt.style.display="block",Ye.disabled=!0,ft.style.display="none",Mt.style.display="none"):o&&o.type==="emulation"&&(po.style.display="block")}oo.onclick=function(){dt.style.display="none",Ze.length=0,pt.style.display="block"},io.onclick=function(){mt.style.display="none",Ze.length=0,pt.style.display="block"},ao.onclick=function(){dt.style.display="none",J()},Ye.onclick=function(){mt.style.display="none",J()},Xt.onclick=function(){pe&&pe.start(Ot.value)},co.onclick=function(){pt.style.display="none"},Yn.onclick=function(){if(!qe){Dt.style.display="block";return}j.querySelectorAll(".task-to-execute").forEach(u=>{const c=u.getAttribute("data-task-id"),d=u.getAttribute("data-task-order"),s=u.getAttribute("data-collection-name"),f=localStorage.getItem(`taskCollection_${s}`);let p=null;if(f){const b=JSON.parse(f).tasks.find(k=>k.id===c);b&&(p=b)}p&&(p.order=parseInt(d||"0"),Ze.push(p))}),J()},Wn.onclick=function(){ut.style.display="block"},Kn.onclick=function(){if($e.value===""||$e.value===null){alert("Please enter a name for the job");return}const o=$e.value;localStorage.getItem(`savedJob_${o}`)&&!confirm("A job with this name already exists. Do you want to overwrite it?")||(h(`savedJob_${$e.value}`),e(!0),ut.style.display="none",$e.value="")},Un.onclick=function(){ut.style.display="none"},Qn.onclick=function(){j.innerHTML="";const o=Ue.value,u=localStorage.getItem(`savedJob_${o}`);u&&JSON.parse(u).forEach(d=>{const s=localStorage.getItem(`taskCollection_${d.collectionName}`);if(s){const p=JSON.parse(s).tasks.find(E=>E.id===d.id);if(p){const E=document.createElement("div");E.classList.add(`task-${p.type}`),E.classList.add("task-to-execute"),E.setAttribute("data-task-id",p.id.toString()),E.setAttribute("data-task-name",p.name),E.setAttribute("data-collection-name",d.collectionName),E.textContent=p.name,j.appendChild(E)}}}),L(),C()},eo.onclick=function(){const o=Ue.value;localStorage.removeItem(`savedJob_${o}`),e(!0)},to.onclick=function(){const o=document.createElement("input");o.type="file",o.accept=".json",o.onchange=function(u){var d;const c=(d=u.target.files)==null?void 0:d[0];if(c){const s=new FileReader;s.onload=function(f){var E;const p=(E=f.target)==null?void 0:E.result;if(p){const b=JSON.parse(p);j.innerHTML="";const k=[];if(b.tasks.forEach(w=>{const G=localStorage.getItem(`taskCollection_${w.collectionName}`);if(G){const te=JSON.parse(G).tasks.find(R=>R.id===w.id);if(te){const R=document.createElement("div");R.classList.add(`task-${te.type}`),R.classList.add("task-to-execute"),R.setAttribute("data-task-id",te.id.toString()),R.setAttribute("data-task-name",te.name),R.setAttribute("data-collection-name",w.collectionName),R.textContent=te.name,j.appendChild(R)}else k.push({id:w.id,collectionName:w.collectionName,reason:"Task not found in collection"})}else k.push({id:w.id,collectionName:w.collectionName,reason:"Collection not found"})}),L(),C(),h(),x(),k.length>0){const w=k.map(G=>`Task ${G.id} in collection ${G.collectionName} was skipped because ${G.reason}.`).join(`
`);alert(`Could not import all tasks. The following tasks were skipped:
${w}`)}}},s.readAsText(c)}},o.click()},no.onclick=function(){const o=localStorage.getItem("currentJob");if(o){const u=JSON.parse(o),c={tasks:[]};u.forEach(p=>{const E=localStorage.getItem(`taskCollection_${p.collectionName}`);if(E){const k=JSON.parse(E).tasks.find(w=>w.id===p.id);k&&c.tasks.push({id:k.id,collectionName:p.collectionName})}});const d=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),s=URL.createObjectURL(d),f=document.createElement("a");f.href=s,f.download="MyJob.json",f.click(),URL.revokeObjectURL(s)}}});const X=ace.edit("gcodeEditor"),ie=ace.edit("gcodeResponseEditor"),U=ace.edit("gcodeSenderEditor"),ho="#DC143C",go="#6B8E23",vo="#FFA500";document.addEventListener("DOMContentLoaded",()=>{new Qt;const t=document.getElementById("gcodeCanvas"),e=document.getElementById("zoomCanvas");let n=null;const a=document.getElementById("fileInput"),l=document.getElementById("simulateButton"),r=document.getElementById("showCuts"),h=document.getElementById("showNonCuts"),I=document.getElementById("sliderLabel"),C=document.getElementById("zoomSliderLabel"),x=document.getElementById("progressSlider"),L=document.getElementById("zoomProgressSlider"),J=document.getElementById("sliderContainer"),o=document.getElementById("displayOptionsContainer"),u=document.getElementById("clearButton"),c=document.querySelector(".saveGCodeNameInput"),d=document.querySelector(".loadGCodeSelect"),s=document.querySelector(".loadGCodeButton"),f=document.querySelector(".saveGCodeButton"),p=document.querySelector(".deleteGCodeButton"),E=document.getElementById("gcodeSenderContainer"),b=document.getElementById("exampleCode"),k=document.getElementById("helpModal"),w=document.getElementById("helpButton"),G=document.getElementById("closeHelpModal"),V=document.getElementById("zoomModal"),te=document.getElementById("zoomButton"),R=document.getElementById("closeZoomModal"),Ke=document.getElementById("zoomCloseButton"),Qe=document.getElementById("simulationTab"),Fe=document.getElementById("controlTab"),et=document.getElementById("plannerTab"),je=document.getElementById("threadingTab"),ve=document.getElementById("simulationContainer"),re=document.getElementById("controlsContainer"),le=document.getElementById("plannerContainer"),ye=document.getElementById("threadingContainer"),_e=document.querySelectorAll("#latheControls .increment-btn"),Oe=document.getElementById("moveDistance");_e.forEach(function(m){m.addEventListener("click",function(){_e.forEach(function(T){T.classList.remove("active")}),this.classList.add("active");var v=this.dataset.increment;Oe.value=v,console.log("Jog increment set to:",v)})}),Qe.addEventListener("click",()=>{ve.style.display="flex",re.style.display="none",le.style.display="none",ye.style.display="none",X.setValue(U.getValue())}),Fe.addEventListener("click",()=>{ve.style.display="none",re.style.display="flex",le.style.display="none",ye.style.display="none",U.setValue(X.getValue())}),et.addEventListener("click",()=>{ve.style.display="none",re.style.display="none",le.style.display="flex",ye.style.display="none";const m=new Event("containerVisible");le.dispatchEvent(m)}),je.addEventListener("click",()=>{ve.style.display="none",re.style.display="none",le.style.display="none",ye.style.display="flex"}),e.width=window.visualViewport.width-100,e.height=window.visualViewport.height-150,window.addEventListener("resize",function(){e.width=window.visualViewport.width-100,e.height=window.visualViewport.height-150,L.value=L.min,i(e)}),te.onclick=function(){V.style.display="block",i(e)},R.onclick=function(){V.style.display="none"},Ke.onclick=function(){V.style.display="none"},w.onclick=function(){k.style.display="block"},G.onclick=function(){k.style.display="none"},window.onclick=function(m){m.target==k&&(k.style.display="none"),m.target==V&&(V.style.display="none")},f.addEventListener("click",()=>g()),s.addEventListener("click",()=>y()),p.addEventListener("click",()=>S()),M(),X.setTheme("ace/theme/github_dark"),X.session.setMode("ace/mode/plain_text"),X.setShowPrintMargin(!1),U.setTheme("ace/theme/github_dark"),U.session.setMode("ace/mode/plain_text"),U.setShowPrintMargin(!1),b.addEventListener("click",()=>nt()),ie.setTheme("ace/theme/monokai"),ie.session.setMode("ace/mode/text"),ie.setReadOnly(!0),ie.setShowPrintMargin(!1),ie.getSession().on("change",()=>{setTimeout(()=>{var m=ie.getSession().getLength();ie.scrollToLine(m,!0,!0,function(){})},0)}),U.on("focus",()=>{U.getValue()==="Paste your gcode here or click choose file to upload"&&U.setValue("")}),N();let ne=0,ce=0,ue=0,Ee=0,Xe=0,Me=0,ze=5,Ce=0,Be=0,O=[];x.oninput=()=>{const m=Math.floor(parseInt(x.value));if(m<O.length){const v=O[m];let T=H(O,t);F(t,O,T,m),de(v)}},L.oninput=()=>{const m=Math.floor(parseInt(L.value));if(m<O.length){const v=O[m];let T=H(O,e);F(e,O,T,m),D(v)}},u.addEventListener("click",()=>{U.setValue(""),X.setValue(""),N();const m=t.getContext("2d");m&&(m.clearRect(0,0,t.width,t.height),a.value="",x.value="0",L.value="0",J.style.display="none",o.style.display="none")}),a.addEventListener("change",m=>{if(m.target instanceof HTMLInputElement&&m.target.files&&m.target.files.length>0){const v=m.target.files[0];v&&W(v)}}),l.addEventListener("click",()=>{i(t)});function i(m){if(!m)return;const v=X.getValue();if(v){P(v);let T=H(O,m);F(m,O,T),J.style.display="block",o.style.display="block",r.addEventListener("change",$),h.addEventListener("change",$),x.max=(O.length-1).toString(),x.value=x.min,L.max=(O.length-1).toString(),L.value=L.min,E.style.display="block"}}function g(){const m=c.value.trim();if(!m)return;const v=`gCode-${m}`;localStorage.setItem(v,X.getValue()),M(v),c.value=""}function y(){const m=d.value,v=localStorage.getItem(m);v&&(X.setValue(v),U.setValue(v))}function S(){const m=d.value;localStorage.removeItem(m),M()}function M(m){d.innerHTML="";let v=!1;for(let T=0;T<localStorage.length;T++){const _=localStorage.key(T);if(_&&_!=="latheCode"&&_.startsWith("gCode-")){v=!0;const A=document.createElement("option"),q=_.replace("gCode-","");A.value=_,A.textContent=q,d.appendChild(A),_===m&&(A.selected=!0)}}if(v){const T=Array.from(d.options).sort((_,A)=>_.text.localeCompare(A.text));d.innerHTML="",T.forEach(_=>{d.appendChild(_)})}else{const T=document.createElement("option");T.textContent="No items saved",T.disabled=!0,d.appendChild(T)}}function N(){X.getValue()===""&&(X.setValue("Paste your gcode here or click choose file to upload"),X.gotoLine(1,0),X.on("focus",function(){X.getValue()==="Paste your gcode here or click choose file to upload"&&X.setValue("")}))}function de(m){(m==null?void 0:m.lineNumber)!==void 0?(X.gotoLine(m.lineNumber,0,!0),I.innerHTML=`Line:${m.lineNumber}<br>${m==null?void 0:m.originalLine}`||""):I.innerHTML=""}function D(m){(m==null?void 0:m.lineNumber)!==void 0?(X.gotoLine(m.lineNumber,0,!0),C.innerHTML=`Line:${m.lineNumber}<br>${m==null?void 0:m.originalLine}`||""):C.innerHTML=""}function W(m){const v=new FileReader;v.onload=T=>{const _=T.target.result;X.setValue(_),U.setValue(_)},v.readAsText(m)}function P(m){const v=[];let T=!1;return O=[],m.split(`
`).forEach((A,q)=>{const Ae=A.includes("; cut")?0:A.includes("; retract")?2:1,Y={isRelative:T,movementType:Ae},ke=A.match(/([GXYZF])([0-9.-]+)/g);ke==null||ke.forEach(Ge=>{const Se=parseFloat(Ge.slice(1));switch(Ge[0]){case"G":Se===90&&(Y.isRelative=!1,T=!1),Se===91&&(Y.isRelative=!0,T=!0);break;case"X":Y.x=Se;break;case"Z":Y.z=Se;break}});const we={...Y,lineNumber:q+1,originalLine:A};(Y.z!==void 0||Y.x!==void 0)&&O.push(we),v.push(we)}),v}function $(){x.value="0";const m=H(O,t);F(t,O,m,O.length)}function H(m,v){let T=0,_=0,A=0,q=0,Ae=0,Y=0,ke=0,we=0;v.id==="zoomCanvas"?we=80:we=40,m.forEach(oe=>{oe.isRelative?(oe.x!==void 0&&(T+=oe.x),oe.z!==void 0&&(_+=oe.z)):(oe.x!==void 0&&(A=Math.min(A,oe.x)),oe.z!==void 0&&(q=Math.max(q,oe.z)));const qt=T+=A,yt=_+=q;A=0,q=0,Ae=Math.max(Ae,Math.abs(qt)),Y=Math.max(Y,Math.abs(yt)),ke=Math.min(ke,yt)});const Ge=Ae,Se=Y-ke,Gt=v.height/2,vt=1,Vt=Gt/Ge-vt,Ht=v.width/Se-vt;return Math.min(Vt,Ht,we)}function F(m,v,T,_){if(n=m.getContext("2d"),!n)return;n.clearRect(0,0,m.width,m.height),ne=0,ce=0,Xe=0,Me=0,ue=0,Ee=0,ue=m.height/2,Ee=m.width-ze;const A=_!==void 0?Math.min(_+1,v.length):v.length;for(let q=0;q<A;q++)tt(m,v[q],T)}function tt(m,v,T){n=m.getContext("2d"),n&&(n.lineWidth=2,v.isRelative?(ne+=v.x??0,ce+=v.z??0):(ne=v.x??Xe,ce=v.z??Me,Xe=ne,Me=ce),Ce=m.height/2-ne*T,Be=m.width-ce*T-ze,(v.movementType==0&&r.checked||v.movementType==1&&h.checked||v.movementType==2&&h.checked)&&(n.beginPath(),n.strokeStyle=v.movementType==0?ho:v.movementType==1?go:vo,n.moveTo(Ee,ue),n.lineTo(Be,Ce),n.stroke()),ue=Ce,Ee=Be)}function nt(){X.setValue(en)}});

</script>
  <style>
:root{font-family:Inter,system-ui,Avenir,Helvetica,Arial,sans-serif;line-height:1.5;font-weight:400;color-scheme:light dark;color:#ffffffde;background-color:#242424;font-synthesis:none;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}a{font-weight:500;color:#646cff;text-decoration:inherit}a:hover{color:#535bf2}h1{font-size:3.2em;line-height:1.1}#app{max-width:1280px;margin:0 auto;padding:2rem;text-align:center}.logo{height:6em;padding:1.5em;will-change:filter;transition:filter .3s}.logo:hover{filter:drop-shadow(0 0 2em #646cffaa)}.logo.vanilla:hover{filter:drop-shadow(0 0 2em #3178c6aa)}.card{padding:2em}.read-the-docs{color:#888}button{border-radius:3px;border:1px solid transparent;padding:.6em 1.2em;font-size:1em;font-weight:500;font-family:inherit;background-color:#1a1a1a;cursor:pointer;transition:background-color .25s;border:2px solid white}button:hover{background-color:#646cff}button:focus,button:focus-visible{outline:4px auto -webkit-focus-ring-color}@media (prefers-color-scheme: light){:root{color:#213547;background-color:#fff}a:hover{color:#747bff}button{background-color:#f9f9f9}}#simulationContainer{display:flex;flex-direction:column;width:800px;max-width:1280px;text-align:center}.main-container{display:flex;width:100%}#controlsContainer{display:flex;flex-direction:column;width:800px;max-width:1280px;text-align:center}.controls-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;border:1px solid #ccc}.canvas-container{display:flex;flex-direction:column;align-items:center;margin:5px;border:1px solid #ccc}.canvas-wrapper{display:flex;flex-direction:column;align-items:center}.innerContainer{margin:5px;align-items:center;width:auto}.modal-pad{padding-top:10px}.modal-pad-bottom{padding-bottom:10px}.emulation-modal-pad-border{padding:10px;border:2px dashed green;min-height:40px}.innerContainer.toolbar{display:flex;align-items:center;gap:5px;padding:2px}.saveGCodeNameInput,.loadGCodeSelect{flex-grow:1}#gcodeCanvas{border-bottom:1px solid #ccc;background-color:#242424}#gcodeInput{position:relative;background:transparent;width:100%;height:240px;font-family:monospace;font-size:13px;line-height:1.5;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}#gcodeContainer{position:relative;width:100%}#gcodeSenderContainer{display:block}.save-group,.load-group,.import-export-group{display:flex;flex-direction:row;align-items:center;gap:10px}.toolbar input[type=text],.toolbar select{max-width:200px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem;font-size:1rem;line-height:1.5}input[type=file]::file-selector-button{border:2px solid #6c5ce7;padding:.2em .4em;border-radius:.2em;background-color:#1a1a1a;transition:.25s}input[type=file]::-ms-browse:hover{background-color:#646cff}input[type=file]::-webkit-file-upload-button:hover{background-color:#646cff}input[type=file]::file-selector-button:hover{background-color:#646cff}.bottom-container{margin:5px}#gcodeResponseContainer{border:1px solid #ccc;width:100%;display:flex;flex-direction:column;align-items:center;margin-top:5px}.senderError{display:none;color:#fff;background-color:red;padding:10px;border-radius:5px;animation:flashError 1s infinite}@keyframes flashError{0%,to{opacity:1}50%{opacity:0}}#helpText li{margin-bottom:10px}#helpText a{color:#f95959}.help-modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.help-modal-content{position:relative;background-color:#242424;margin:15% auto;padding:20px;border:2px solid #6c5ce7;width:30%}.zoom-modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#242424}.zoom-modal-content{display:flex;flex-direction:column;align-items:center;margin:10px auto;padding:20px;border:1px solid #888}.close-modal{position:absolute;top:0;right:0;padding-right:10px;cursor:pointer;font-size:35px}#sliderAndButtonContainer{display:flex;justify-content:center;align-items:center;gap:10px}.text-red{color:#dc143c}.text-green{color:#6b8e23}.text-orange{color:orange}.line{display:inline-block;vertical-align:middle;width:20px;height:2px;margin-right:5px}.red-line{border-top:2px solid #DC143C}.green-line{border-top:2px solid #6B8E23}.orange-line{border-top:2px solid #FFA500}#latheControls #jogControls{display:grid;grid-template-columns:repeat(9,60px);grid-template-rows:repeat(5,60px);justify-content:center;align-items:center;place-items:center}#latheControls .jog-btn,#latheControls .tool-btn{width:50px;height:50px;border-radius:5px;cursor:pointer;background-color:#f0ad4e;display:flex;justify-content:center;align-items:center;text-align:center;line-height:50px;font-size:24px;padding:0}#latheControls .tool{background-color:#f0ad4e;border:none}#latheControls .tool-selected{background-color:#6c5ce7;border:2px solid white}#latheControls .fast{background-color:#f0ad4e}#latheControls .slow{background-color:#5bc0de}#latheControls .jog-btn:hover{background-color:#6c5ce7}#fastForward{grid-column:5;grid-row:1}#fastText{grid-column:4;grid-row:1}#slowText{grid-column:4;grid-row:2}#fastLeft{grid-column:3;grid-row:3}#fastBackward{grid-column:5;grid-row:5}#fastRight{grid-column:7;grid-row:3}#slowForward{grid-column:5;grid-row:2}#slowLeft{grid-column:4;grid-row:3}#slowBackward{grid-column:5;grid-row:4}#slowRight{grid-column:6;grid-row:3}#toolText{grid-column:1;grid-row:1}#tool0{grid-column:1;grid-row:2}#tool1{grid-column:1;grid-row:3}#tool2{grid-column:1;grid-row:4}#tool3{grid-column:1;grid-row:5}.menu ul{list-style-type:none;padding:0}.menu li{cursor:pointer;padding:10px;background-color:#242424;border-bottom:1px solid #6c5ce7}.menu li:hover{background-color:#6c5ce7}.content{margin-left:200px;padding:20px}#senderProgressContainer{display:flex;justify-content:center;align-items:center}#senderProgressLabel{margin-right:10px}.innerContentCentre{display:flex;justify-content:center;align-items:center;margin:10px}#gcodeSenderContainer{position:relative;width:100%}#gcodeSenderEditor{border-bottom:1px solid #ccc;background-color:#242424}#latheControls #incrementControls{display:flex;justify-content:center;gap:10px;margin:10px 0 20px}#latheControls .increment-btn{padding:5px 10px;border:1px solid #ccc;background-color:#f0ad4e;border-radius:5px;cursor:pointer;transition:background-color .3s}#latheControls .increment-btn:hover,#latheControls .increment-btn.active{background-color:#6c5ce7}.control-inputs input[type=text]{max-width:200px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem}.control-inputs label{display:block;margin-right:5px}#latheControls label{white-space:nowrap;margin-right:10px;display:inline-block;min-width:120px}.planner-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;width:800px;max-width:1280px;text-align:center;border:1px solid #ccc}.planner-container h1{margin:10px 0}.planner-guidance{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:10px;text-align:center}.planner-guidance span{display:block;margin:10px 0;text-align:left}#taskContainer{display:flex;justify-content:space-between;align-items:start;padding:20px}.container-wrapper{padding:10px}.container-wrapper-inner{padding:5px 0}.container-wrapper-outer{border:1px solid #ccc;border-radius:5px;margin:10px;background-color:#333}.container-wrapper-delete{min-height:50px;display:flex;justify-content:center;align-items:center;border:2px dashed red}#availableTasks{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;align-items:start;min-width:450px}#availableTasks .span-2-rows{grid-row:span 3;height:100%}#availableTasks div{box-sizing:border-box;padding:5px}#tasksToExecute{min-height:50px;padding:5px;border:2px dashed green}#tasksToExecute div{margin:5px}.task-to-execute{text-align:left}.task-to-execute i{text-align:left;margin-left:5px;cursor:help}.available-task{width:150px;-webkit-user-select:none;user-select:none}.available-task i{margin-left:5px;cursor:help}.task-manual{background-color:#4c956c}.task-gcode{background-color:#386e97}.task-emulation{background-color:#e74c3c}.emulate-noselect{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#emulationInnerContainer{display:flex;flex-direction:row;justify-content:center;align-items:center;height:100%}#emulationNewTasksMovement{display:grid;grid-template-columns:repeat(9,40px);grid-template-rows:repeat(3,40px);gap:3px;align-items:center;justify-items:center}#emulationNewTasksNumbers,#emulationNewTasksOther{display:grid;grid-template-columns:repeat(2,40px);grid-template-rows:repeat(6,40px);gap:3px;align-items:center;justify-items:center}#emulationNewTasksMode{display:grid;grid-template-columns:repeat(8,40px);grid-template-rows:repeat(1,40px);gap:3px;align-items:center;justify-items:center}#movementContainer,#modeContainer{width:100%;display:flex;justify-content:center;align-items:center;margin:5px;padding:5px}#emulateKeyUp{grid-area:1 / 2}#emulateKeyDown{grid-area:3 / 2}#emulateKeyLeft{grid-area:2 / 1}#emulateKeyRight{grid-area:2 / 3}#emulateKeyPlay{grid-area:1 / 5}#emulateKeyStop{grid-area:3 / 5}#emulateKeyStopUp{grid-area:1 / 8}#emulateKeyStopDown{grid-area:3 / 8}#emulateKeyStopLeft{grid-area:2 / 7}#emulateKeyStopRight{grid-area:2 / 9}#emulationNewTasksMode button.material-symbols-outlined{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksMode button:hover{background-color:#18a79b}#emulationNewTasksMode button:focus,#emulationNewTasksMode button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksMovement button.material-symbols-outlined{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksMovement button:hover{background-color:#18a79b}#emulationNewTasksMovement button:focus,#emulationNewTasksMovement button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksNumbers button{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700;font-family:monospace}#emulationNewTasksNumbers button:hover{background-color:#18a79b}#emulationNewTasksNumbers button:focus,#emulationNewTasksNumbers button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksOther button{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksOther button:hover{background-color:#18a79b}#emulationNewTasksOther button:focus,#emulationNewTasksOther button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}.emulated-button-list{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700!important}.standard-font{font-family:monospace!important}#emulationNewTasks{list-style-type:none;display:grid;grid-template-columns:repeat(11,1fr);grid-auto-rows:auto;gap:10px;padding:0;margin:0}#emulateKeySteps{transform:scaleX(-1)}.flexCol{display:flex;flex-direction:column;align-items:center;justify-content:center}.outerCol{padding-top:15px}.middleCol{align-self:flex-start}.task-container{margin:5px}.task-container>div,.gu-mirror{transition:opacity .4s ease-in-out}.task-container>div{padding:5px;cursor:move;cursor:grab;cursor:-moz-grab;cursor:-webkit-grab;display:flex;align-items:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.gu-mirror{padding:5px;text-align:center;cursor:grabbing;cursor:-moz-grabbing;cursor:-webkit-grabbing}.task-container .ex-moved{background-color:#e74c3c}.task-container.ex-over{background-color:#ffffff4d}.planner-save-text{max-width:none!important}.planner-save-button{flex:auto}.planner-load-select{max-width:none!important}.planner-load-delete-buttons{width:50%}.planner-saving-label{text-wrap:nowrap}.no-marge{margin:0}.task-modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.task-modal-content{position:relative;background-color:#242424;margin:15% auto;padding:20px;border:2px solid #6c5ce7;max-width:600px;min-width:600px}.center-modal{text-align:center}.icon-tooltip{position:relative;cursor:pointer}.icon-tooltip:after{content:attr(data-tooltip);position:absolute;bottom:100%;left:50%;transform:translate(-50%);white-space:nowrap;z-index:1;background-color:#000;color:#fff;padding:5px;border-radius:4px;opacity:0;visibility:hidden;transition:opacity .2s,visibility .2s}.icon-tooltip:hover:after{opacity:1;visibility:visible}.threading-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;width:800px;max-width:1280px;text-align:center;border:1px solid #ccc}.gu-mirror{position:fixed!important;margin:0!important;z-index:9999!important;opacity:.8}.gu-hide{display:none!important}.gu-unselectable{-webkit-user-select:none!important;-moz-user-select:none!important;-ms-user-select:none!important;user-select:none!important}.gu-transit{opacity:.2}

</style>
</head>

<body>

    <div id="mainContainer" class="main-container">
        <div class="menu">
            <ul>
                <li id="simulationTab">Simulation</li>
                <li id="controlTab">Control</li>
                <li id="plannerTab">Planner</li>
                <li id="threadingTab">Threading</li>
            </ul>
        </div>

        <div id="simulationContainer" class="main-container">
            <div id="simulationContent" class="controls-container">
                <div id="gcodeContainer" style="position: relative;">
                    <div id="gcodeEditor" style="height: 200px; width: 100%;"></div>
                </div>
                <div class="innerContainer">
                    <input type="file" id="fileInput" accept=".txt,.gcode">
                </div>
                <div class="innerContainer">
                    <button id="simulateButton">Simulate</button>
                    <button id="clearButton">Clear</button>
                    <button id="helpButton">How to use</button>
                </div>


                <div class="innerContainer" id="loadAndSave">


                    <hr>
                    <div class="innerContainer toolbar">
                        <input type="text" class="saveGCodeNameInput" placeholder="name of save"></input>
                        <button class="saveGCodeButton" title="Save GCode to local browser storage">Save local</button>
                    </div>
                    <div class="innerContainer toolbar">
                        <select class="loadGCodeSelect"></select>
                        <button class="loadGCodeButton" title="Load GCode from local browser storage">Load</button>
                        <button class="deleteGCodeButton" title="Delete GCode from local browser storage">Delete</button>
                    </div>
                    <hr>
                </div>
            </div>

            <div class="canvas-container">
                <canvas id="gcodeCanvas" width="785" height="600"></canvas>
                <div id="sliderContainer" class="innerContainer" style="display: none; width: 400px;">
                    <input type="range" id="progressSlider" min="0" max="100" value="0" style="width: 100%;">
                    <div id="sliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                </div>
                <div id="displayOptionsContainer" class="innerContainer" style="display: none;">
                    <input type="checkbox" id="showCuts" checked> Show Cut Moves
                    </label>
                    <label>
                        <input type="checkbox" id="showNonCuts" checked>
                        Show Non-Cut Moves
                    </label>
                </div>
                <div id="sliderContainer" class="innerContainer" style="display: none; width: 400px;">
                    <input type="range" id="progressSlider" min="0" max="100" value="0" style="width: 100%;">
                    <div id="sliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                </div>
                <div id="displayOptionsContainer" class="innerContainer" style="display: none;">
                    <input type="checkbox" id="showCuts" checked> Show Cut Moves
                    </label>
                    <label>
                        <input type="checkbox" id="showNonCuts" checked>
                        Show Non-Cut Moves
                    </label>
                </div>
                <div class="innerContainer"><button id="zoomButton" title="Zoom in">Zoom In</button></div>
            </div>

        </div>
        <div id="controlsContainer" class="main-container" style="display: none;">
            <div id="controlsContent" class="controls-container">
                <div id="gcodeSenderContainer" class="innerContainer">

                    <span>Send GCode to Nano ELS H4</span>

                    <div class="innerContainer">
                        <button id="connectButton" title="Connect to Nano ELS H4">Connect</button>
                        <button id="gcodeSenderButton" title="Send GCode to CNC" style="display: none;">Send</button>
                        <button id="stopButton" style="display: none;">Stop</button>
                    </div>
                </div>

                <div id="latheControls">
                    <div id="jogControls">
                        <span id="fastText">Fast</span>
                        <span id="slowText">Slow</span>
                        <span id="toolText">Tool</span>

                        <!-- Tools -->
                        <button class="tool-btn tool-selected" id="tool0">T0</button>
                        <button class="tool-btn" id="tool1">T1</button>
                        <button class="tool-btn" id="tool2">T2</button>
                        <button class="tool-btn" id="tool3">T3</button>
                        <!-- Fast arrows -->
                        <button class="arrow fast jog-btn" id="fastForward"><i class="fas fa-arrow-up"></i></button>
                        <button class="arrow fast jog-btn" id="fastBackward"><i class="fas fa-arrow-down"></i></button>
                        <button class="arrow fast jog-btn" id="fastLeft"><i class="fas fa-arrow-left"></i></button>
                        <button class="arrow fast jog-btn" id="fastRight"><i class="fas fa-arrow-right"></i></button>
                        <!-- Slow arrows -->
                        <button class="arrow slow jog-btn" id="slowForward"><i class="fas fa-arrow-up"></i></button>
                        <button class="arrow slow jog-btn" id="slowBackward"><i class="fas fa-arrow-down"></i></button>
                        <button class="arrow slow jog-btn" id="slowLeft"><i class="fas fa-arrow-left"></i></button>
                        <button class="arrow slow jog-btn" id="slowRight"><i class="fas fa-arrow-right"></i></button>
                    </div>
                    <div id="incrementControls">
                        <button class="increment-btn" data-increment="0.01">0.01</button>
                        <button class="increment-btn" data-increment="0.1">0.1</button>
                        <button class="increment-btn active" data-increment="1">1</button>
                        <button class="increment-btn" data-increment="10">10</button>
                    </div>
                    <div id="feedrateControls" class="innerContentCentre control-inputs">
                        <label for="fastFeedrate">Fast Feedrate:</label>
                        <input type="text" id="fastFeedrate" name="fastFeedrate" value="200">
                        <label for="slowFeedrate">Slow Feedrate:</label>
                        <input type="text" id="slowFeedrate" name="slowFeedrate" value="50">
                    </div>
                    <div id="distanceControl" class="innerContentCentre control-inputs">
                        <label for="moveDistance">Move Distance (mm):</label>
                        <input type="text" id="moveDistance" name="moveDistance" value="1">
                    </div>
                </div>

                <div id="gcodeResponseContainer" style="display: none;">
                    <div id="gcodeResponseHeader">GCode Responses</div>
                    <div id="gcodeResponseEditor" style="height: 200px; width: 100%;"></div>
                    <div class="senderError" style="display: none;"></div>
                    <div id="senderProgressContainer">
                        <span id="senderProgressLabel" style="display: none;">Progress...</span>
                        <progress id="senderProgress" max="1" style="display: none;"></progress>
                    </div>
                </div>
            </div>
            <div class="controls-container">
                <div id="gcodeSenderContainer" style="position: relative;">
                    <span>GCode to Send</span>
                    <div id="gcodeSenderEditor" style="height: 200px; width: 100%;"></div>
                </div>
            </div>
        </div>
        <div id="plannerContainer" class="main-container" style="display: none;">
            <div id="plannerContent" class="planner-container">
                <div class="innerContainer">
                    <h1>Planner</h1>
                    <div class="planner-guidance">
                        <span>Use this tool to create a job of tasks to execute. This can be manual, gcode, button press
                            emulation or a
                            combination
                            of them.
                            When you click execute the job wizard will execute the tasks one after another. Each task
                            with require confirmation to start.</span>
                    </div>
                </div>
                <div class="innerContainer">
                    <h1>Device status</h1>
                    <button id="plannerConnectButton">Connect</button>
                </div>
                <div id="taskContainer">
                    <div class="container-wrapper-outer">
                        <div class="container-wrapper">
                            <h2>Current Job</h2>
                            <span>Drag an available task to below</span>
                            <div id="tasksToExecute" class="task-container">
                            </div>
                        </div>
                        <div class="container-wrapper">
                            <button id="executeJobButton">Execute Job</button>
                        </div>
                        <hr>
                        <div class="container-wrapper">
                            <div class="innerContainer" id="loadAndSaveJob">
                                <div class="innerContainer toolbar">
                                    <button id="saveJobButton" class="planner-save-button" title="Save Job to local browser storage">Save
                                        Job</button>
                                </div>
                                <div class="innerContainer toolbar">
                                    <button id="loadJobToExecute" class="planner-load-delete-buttons" title="Load Job from local browser storage">Load</button>
                                    <button id="deleteJobToExecute" class="planner-load-delete-buttons" title="Delete Job from local browser storage">Delete</button>
                                </div>
                                <div class="innerContainer toolbar">
                                    <select id="jobLoadSelect" class="planner-load-select">
                                    </select>
                                </div>
                                <div class="container-wrapper-inner">
                                    <hr>
                                </div>
                                <span class="planner-saving-label">Import and export Job to JSON</span>
                                <div class="innerContainer toolbar">
                                    <button id="importJobToExecute" class="planner-load-delete-buttons" title="Import Job from JSON file">Import</button>
                                    <button id="exportJobToExecute" class="planner-load-delete-buttons" title="Export Job to JSON">Export</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="container-wrapper-outer">
                        <div class="container-wrapper">
                            <h2>Available Tasks</h2>
                            <div id="availableTasks" class="task-container">
                            </div>
                        </div>
                        <div class="container-wrapper">
                            <div class="container-wrapper-inner">
                                <span>Drag here to delete</span>
                            </div>
                            <div id="deleteTasks" class="container-wrapper-delete">
                            </div>
                        </div>
                        <div class="container-wrapper">
                            <button id="addNewTaskButton">Add New Task</button>
                        </div>
                        <div class="container-wrapper-inner">
                            <hr class="no-marge">
                        </div>
                        <div class="container-wrapper">
                            <div class="innerContainer" id="loadAndSaveAvailableTasks">
                                <div><span>Task Collections</span></div>
                                <div class="innerContainer toolbar">
                                    <button id='saveAvailableTaskCollection' class="planner-save-button" title="Save Task to local browser storage">Save tasks to a collection
                                        <i class="far fa-save show-info icon-tooltip"
                                            data-tooltip="Save to local machine"></i>
                                    </button>
                                </div>
                                <div class="innerContainer toolbar">
                                    <select id="availableTaskCollections" class="planner-load-select">
                                        <option value="" disabled>Select your option</option>
                                    </select>
                                </div>
                                <div class="innerContainer toolbar">
                                    <button id="loadTaskCollection" class="planner-load-delete-buttons" title="Load selected collection">Load collection</button>
                                    <button id="deleteTaskCollection" class="planner-load-delete-buttons" title="Delete selected collection">Delete collection</button>
                                </div>
                                <div class="container-wrapper-inner">
                                    <hr>
                                </div>
                                <span class="planner-saving-label">Import and export tasks via JSON</span>
                                <div class="innerContainer toolbar">
                                    <button id="importAvailableTasks" class="planner-load-delete-buttons" title="Import tasks from JSON file">Import</button>
                                    <button id="exportAvailableTasks" class="planner-load-delete-buttons" title="Export tasks to JSON">Export</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="threadingContainer" class="main-container" style="display: none;">
            <div id="threadingContent" class="threading-container">Coming soon.</div>
        </div>
        <!-- Not Connected warning -->
        <div id="notConnectedModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Not Connected</h2>
                <div class="modal-pad-bottom">
                    <span>Please connect to the controller before executing jobs</span>
                </div>
                <div class="modal-pad">
                    <button id="notConnectedCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Manual Task Modal -->
        <div id="manualTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>Manual Task Instructions</h2>
                <hr>
                <div>
                    <span id="manualTaskName"></span>
                </div>
                <div class="modal-pad">
                    <textarea id="manualTaskInstructions" name="manualTaskInstructions" rows="4" cols="50" disabled></textarea>
                </div>
                <div class="modal-pad">
                    <button id="cancelManualTask">Cancel</button>
                    <button id="completeManualTask">Next Task --></button>
                </div>
            </div>
        </div>
        <!-- Gcode Task Modal -->
        <div id="cncTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>CNC Task Gcode</h2>
                <hr>
                <div>
                    <span id="cncTaskName"></span>
                </div>
                <div class="modal-pad">
                    <textarea id="cncTaskGcode" name="cncTaskGcode" rows="4" cols="50" disabled></textarea>
                </div>
                <div class="modal-pad">
                    <button id="cancelCncTask">Cancel</button>
                    <button id="executeGcode">Execute Gcode</button>
                </div>
                <div class="modal-pad">
                    <button id="completeCncTask" disabled>Next Task --></button>
                </div>
                <div id="cncTaskSenderProgressContainer" class="modal-pad">
                    <span id="cncTaskSenderProgressLabel">Execution in progress...</span>
                    <progress id="cncTaskSenderProgress" max="1"></progress>
                </div>
            </div>
        </div>
        <!-- key Emulation Task Modal -->
        <div id="emulationTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>Key Emulation Task</h2>
                <hr>
                <div>
                    <span id="emulationTaskName"></span>
                </div>
                <div class="modal-pad">
                    <ul id="emulationExecutionTasks">
                        <!-- List items will be added here -->
                    </ul>
                    <div class="modal-pad">
                        <button id="completeEmulationTask" disabled>Mark Complete</button>
                    </div>
                    <div id="emulationTaskSenderProgressContainer" class="modal-pad">
                        <span id="emulationTaskSenderProgressLabel">Execution in progress...</span>
                        <progress id="emulationTaskSenderProgress" max="1"></progress>
                    </div>
                </div>
            </div>
        </div>
        <!-- All tasks Complete Modal -->
        <div id="completeTaskModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>All Tasks Complete</h2>
                <div class="modal-pad">
                    <button id="completeTaskCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Job Cancelled Modal -->
        <div id="jobCancelledModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Job Cancelled</h2>
                <div>
                    <button id="jobCancelledCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Save Job Modal -->
        <div id="saveJobModal" class="task-modal">
            <div class="task-modal-content">
                <span id="saveJobModalClose" class="close-modal">&times;</span>
                <h2>Save Job</h2>
                <hr>
                <div>
                    <input id="saveJobNameInput" type="text" class="planner-save-text" placeholder="Name of Job"></input>
                </div>
                <div class="modal-pad">
                    <button id="saveJobSaveButton">Save</button>
                </div>
            </div>
        </div>
        <!-- Save Collection -->
        <div id="saveCollectionModal" class="task-modal">
            <div class="task-modal-content">
                <span id="saveCollectionModalClose" class="close-modal">&times;</span>
                <div>
                    <div>Which collection would you like to save the tasks to?</div>
                    <div class="modal-pad">
                        <select id="saveCollectionModalToSaveTo" name="collectionToSaveToModal">
                        </select>
                    </div>
                    <div id="newCollectionNameContainerModal" style="display: none;">
                        <div class="modal-pad">New Collection Name:</div>
                        <div>
                            <input type="text" id="newCollectionNameModal" name="newCollectionNameModal" placeholder="Enter collection name...">
                        </div>
                    </div>

                    <div class="modal-pad">
                        <button id="saveAvailableTaskCollectionButtonModal">Save</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- new task modal-->
        <div id="newTaskModal" class="task-modal">
            <div class="task-modal-content">
                <span id="closeNewTaskModal" class="close-modal">&times;</span>
                <div id="newTaskHelpText">
                    <h2 id="taskTextTitle">Add a new task</h2>
                    <hr>
                    <div class="modal-pad">Task Name:</div>
                    <div>
                        <input type="text" id="newTaskName" name="newTaskName" placeholder="Enter task name...">
                    </div>
                    <div class="modal-pad">Task Type:</div>
                    <div>
                        <select id="newTaskType" name="newTaskType">
                            <option value="manual">Manual</option>
                            <option value="gcode">GCode</option>
                            <option value="emulation" disabled>Key Emulation</option>
                        </select>
                    </div>
                    <div class="modal-pad">Task Description:</div>
                    <div>
                        <textarea id="newTaskDescription" name="newTaskDescription" rows="4" cols="50" placeholder="Enter Description..."></textarea>
                    </div>
                    <div id="gcodeTaskContainer" style="display:none">
                        <div class="modal-pad">Task GCode:</div>
                        <div>
                            <textarea id="newTaskGcode" name="newTaskGcode" rows="4" cols="50" placeholder="Disabled for manual tasks" disabled></textarea>
                        </div>
                    </div>
                    <div id="emulationOuterContainer" class="emulate-noselect" style="display:none">
                        <div>
                            <span>Use built in controller functions by emulating button presses
                                Simply click the buttons you want to emulate to build up a sequence which will be
                                displayed at the bottom. Each emulated press will have a 500ms delay between them.
                                <br>
                                <br>
                                <i>Tip: Hover over the buttons for a description.</i>
                            </span>
                        </div>
                        <div id="emulationInnerContainer">
                            <div class="flexCol outerCol">
                                <div id="numberContainer">
                                    <div id="emulationNewTasksNumbers">
                                        <button id="emulateKey9" data-button-key="B_9" class="standard-font material-symbols-outlined">
                                            9
                                        </button>
                                        <button id="emulateKey8" data-button-key="B_8" class="standard-font material-symbols-outlined">
                                            8
                                        </button>
                                        <button id="emulateKey7" data-button-key="B_7" class="standard-font material-symbols-outlined">
                                            7
                                        </button>
                                        <button id="emulateKey6" data-button-key="B_6" class="standard-font material-symbols-outlined">
                                            6
                                        </button>
                                        <button id="emulateKey5" data-button-key="B_5" class="standard-font material-symbols-outlined">
                                            5
                                        </button>
                                        <button id="emulateKey4" data-button-key="B_4" class="standard-font material-symbols-outlined">
                                            4
                                        </button>
                                        <button id="emulateKey3" data-button-key="B_3" class="standard-font material-symbols-outlined">
                                            3
                                        </button>
                                        <button id="emulateKey2" data-button-key="B_2" class="standard-font material-symbols-outlined">
                                            2
                                        </button>
                                        <button id="emulateKey1" data-button-key="B_1" class="standard-font material-symbols-outlined">
                                            1
                                        </button>
                                        <button id="emulateKey0" data-button-key="B_0" class="standard-font material-symbols-outlined">
                                            0
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="flexCol middleCol">
                                <div id="modeContainer">
                                    <div id="emulationNewTasksMode">
                                        <button id="emulateKeyBack" data-button-key="B_BACKSPACE" class="material-symbols-outlined">
                                            backspace
                                        </button>
                                        <button id="emulateKeyGearbox" data-button-key="B_MODE_GEARS" class="material-symbols-outlined">
                                            manufacturing
                                        </button>
                                        <button id="emulateKeyTurning" data-button-key="B_MODE_TURN" class="material-symbols-outlined">
                                            reply
                                        </button>
                                        <button id="emulateKeyFacing" data-button-key="B_MODE_FACE" class="material-symbols-outlined">
                                            turn_slight_left
                                        </button>
                                        <button id="emulateKeyCone" data-button-key="B_MODE_CONE" class="material-symbols-outlined">
                                            arrow_forward_ios
                                        </button>
                                        <button id="emulateKeyParting" data-button-key="B_MODE_CUT" class="material-symbols-outlined">
                                            publish
                                        </button>
                                        <button id="emulateKeyThreading" data-button-key="B_MODE_THREAD" class="material-symbols-outlined">
                                            home_improvement_and_tools
                                        </button>
                                        <button id="emulateKeyMode" data-button-key="B_MODE_OTHER" class="standard-font material-symbols-outlined">
                                            M
                                        </button>
                                    </div>
                                </div>
                                <div id="movementContainer">
                                    <div id="emulationNewTasksMovement">
                                        <button id="emulateKeyLeft" data-button-key="B_LEFT" class="material-symbols-outlined">
                                            arrow_left_alt
                                        </button>
                                        <button id="emulateKeyRight" data-button-key="B_RIGHT" class="material-symbols-outlined">
                                            arrow_right_alt
                                        </button>
                                        <button id="emulateKeyUp" data-button-key="B_UP" class="material-symbols-outlined">
                                            arrow_upward_alt
                                        </button>
                                        <button id="emulateKeyDown" data-button-key="B_DOWN" class="material-symbols-outlined">
                                            arrow_downward_alt
                                        </button>
                                        <button id="emulateKeyPlay" data-button-key="B_ON" class="material-symbols-outlined">
                                            play_arrow
                                        </button>
                                        <button id="emulateKeyStop" data-button-key="B_OFF" class="material-symbols-outlined">
                                            crop_square
                                        </button>
                                        <button id="emulateKeyStopLeft" data-button-key="B_STOPL" class="material-symbols-outlined">
                                            keyboard_tab_rtl
                                        </button>
                                        <button id="emulateKeyStopRight" data-button-key="B_STOPR" class="material-symbols-outlined">
                                            keyboard_tab
                                        </button>
                                        <button id="emulateKeyStopUp" data-button-key="B_STOPU" class="material-symbols-outlined">
                                            vertical_align_top
                                        </button>
                                        <button id="emulateKeyStopDown" data-button-key="B_STOPD" class="material-symbols-outlined">
                                            vertical_align_bottom
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="flexCol outerCol">
                                <div id="otherContainer">
                                    <div id="emulationNewTasksOther">
                                        <button id="emulateKeyZ" data-button-key="B_Z" class="standard-font material-symbols-outlined">
                                            Z
                                        </button>
                                        <button id="emulateKeyX" data-button-key="B_X" class="standard-font material-symbols-outlined">
                                            X
                                        </button>
                                        <button id="emulateKeyB" data-button-key="B_B" class="standard-font material-symbols-outlined">
                                            B
                                        </button>
                                        <button id="emulateKeyA" data-button-key="B_A" class="standard-font material-symbols-outlined">
                                            A
                                        </button>
                                        <button id="emulateKeyAngle" data-button-key="B_DISPL" class="material-symbols-outlined" title="Angle/Taco">
                                            rotate_left
                                        </button>
                                        <button id="emulateKeySteps" data-button-key="B_STEPZ" class="material-symbols-outlined">
                                            signal_cellular_alt
                                        </button>
                                        <button id="emulateKeySettings" data-button-key="B_SETTINGS" class="material-symbols-outlined">
                                            settings
                                        </button>
                                        <button id="emulateKeyReverse" data-button-key="B_REVERSE" class="material-symbols-outlined">
                                            sync_alt
                                        </button>
                                        <button id="emulateKeyMeasure" data-button-key="B_MEASURE" class="material-symbols-outlined">
                                            space_bar
                                        </button>
                                        <button id="emulateKeyPlus" data-button-key="B_PLUS" class="standard-font material-symbols-outlined">
                                            +
                                        </button>
                                        <button id="emulateKeyMinus" data-button-key="B_MINUS" class="standard-font material-symbols-outlined">
                                            -
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <span>
                                Emulated sequence: <i>Tip: Drag to reorder or delete</i>
                            </span>
                        </div>
                        <div class="emulation-modal-pad-border">
                            <div id="emulationNewTasks">
                            </div>
                        </div>
                        <div class="modal-pad-bottom">
                            <div id="emulatedTasksDelete" class="container-wrapper-inner">
                                <span>
                                    Drag here to delete
                                </span>
                            </div>
                            <div id="emulatedButtonListDelete" class="container-wrapper-delete">

                            </div>
                        </div>
                    </div>
                    <div class="modal-pad">Collection to save to:</div>
                    <div>
                        <select id="collectionToSaveTo" name="collectionToSaveTo">
                        </select>
                    </div>
                    <div id="newCollectionNameContainer" style="display: none;">
                        <div class="modal-pad">New Collection Name:</div>
                        <div>
                            <input type="text" id="newCollectionName" name="newCollectionName" placeholder="Enter collection name...">
                        </div>
                    </div>
                    <div class="modal-pad">
                        <button id="saveNewTaskButton">Save</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="helpModal" class="help-modal">
            <div class="help-modal-content">
                <span id="closeHelpModal" class="close-modal">&times;</span>
                <div id="helpText">
                    <div>This tool is designed to be used in cunjunction with LatheCode:</div>
                    <div><a href="https://kachurovskiy.github.io/lathecode/ " target="_blank ">https://kachurovskiy.github.io/lathecode/</a></div>
                    <ul style="list-style-type: disc; padding-left: 20px; ">
                        <li>Use LatheCode to generate the G-code, then paste it into this tool.</li>
                        <li>You can also write the G-code by hand for simple operations such as boring or grooving.
                            <a href="# " id="exampleCode">Click here</a> to load an example.
                        </li>
                        <li>Click "Simulate" to plot the moves onto the canvas.</li>
                        <li>movement lines marked with "; cut" will show in <span class="line red-line"></span><span class="text-red">red</span>.</li>
                        <li>movement lines marked with "; travel" will show in <span class="line green-line"></span><span class="text-green">green</span>.</li>
                        <li>movement lines marked with "; retract" will show in <span class="line orange-line"></span><span class="text-orange">orange</span>.</li>
                        <li>movement lines not marked will default to <span class="line green-line"></span><span class="text-green">green</span>.</li>
                        <li>All other moves will be considered travel moves and will show in green.</li>
                        <li>Any G-code you paste or write can be saved into the browser's local storage. This is useful for saving common operations.</li>
                        <li>When you're ready, you can send the G-code to the Nano ELS H4 by clicking "Send."
                        </li>
                        <li>More functionality to come soon! Version 0.2</li>
                        <li>Please provide feedback, raise issues or make suggestions here: <a href="https://github.com/Festivejelly/LatheGcodeVisualiser " target="_blank ">https://github.com/Festivejelly/LatheGcodeVisualiser</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="zoomModal" class="zoom-modal">
            <div class="zoom-modal-content" style="background-color: #242424;">
                <span id="closeZoomModal" class="close-modal">&times;</span>
                <canvas id="zoomCanvas" width="1600 " height="1200 "></canvas>
                <div id="sliderAndButtonContainer">
                    <div id="zoomSliderContainer" class="innerContainer" style="width: 400px;">
                        <input type="range" id="zoomProgressSlider" min="0" max="100" value="0" style="width: 100%;">
                        <div id="zoomSliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                    </div>
                    <button id="zoomCloseButton">Close</button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>