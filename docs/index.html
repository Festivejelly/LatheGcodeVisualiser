<!DOCTYPE html>
<html>

<head>
    <title>G-Code Visualizer</title>
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/ace.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <script type="module" crossorigin>
var Kt=Object.defineProperty;var Qt=(t,e,o)=>e in t?Kt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var B=(t,e,o)=>(Qt(t,typeof e!="symbol"?e+"":e,o),o);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const v of c.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&s(v)}).observe(document,{childList:!0,subtree:!0});function o(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(l){if(l.ep)return;l.ep=!0;const c=o(l);fetch(l.href,c)}})();class en{constructor(e,o,s,l,c,v,T,C){this.isConnected=e,this.condition=o,this.error=s,this.progress=l,this.z=c,this.x=v,this.feed=T,this.rpm=C}}const Se=class Se{constructor(){B(this,"listeners",[]);B(this,"port",null);B(this,"readTimeout",0);B(this,"reader",null);B(this,"writer",null);B(this,"isOn",!1);B(this,"waitForOkOrError",!1);B(this,"lines",[]);B(this,"lineIndex",0);B(this,"unparsedResponse","");B(this,"error","");B(this,"statusReceived",!1);B(this,"z",0);B(this,"x",0);B(this,"feed",0);B(this,"rpm",0);B(this,"isDisconnecting",!1);B(this,"lastStatus",null);B(this,"remainingStatus","");B(this,"remainingResponse","")}static getInstance(){return Se.instance||(Se.instance=new Se),Se.instance}getStatus(){return this.lastStatus=new en(this.port!==null,this.isOn?"run":"idle",this.error,this.lines.length?this.lineIndex/this.lines.length:0,this.z,this.x,this.feed,this.rpm),this.lastStatus}addStatusChangeListener(e){this.listeners.push(e)}notifyStatusChange(){this.listeners.forEach(e=>e())}setStatus(e){if(e=this.remainingStatus+e,this.remainingStatus="",e.startsWith("<")&&(e=e.substring(1)),e.endsWith(">"))e=e.slice(0,-1);else{this.remainingStatus=e;return}const o=e.split("|");if(o.length>=3){if(this.statusReceived=!0,o[1].startsWith("WPos:")){const s=o[1].substring(5).split(",");this.z=Number(s[2]),this.x=Number(s[0])}if(o[2].startsWith("FS:")){const s=o[2].substring(3).split(",");this.feed=Number(s[0]),this.rpm=Number(s[1])}}this.notifyStatusChange(),Re(`response: ${e}`),console.log(`response: "${e}"`)}setError(e){this.error=e,Re(e),this.notifyStatusChange()}isConnected(){return this.lastStatus!==null&&this.lastStatus.isConnected}async connect(){try{if(this.port)this.closePort();else{if(await this.selectPort(),this.write("!"),await this.askForStatus(),!await tn(()=>this.statusReceived)){this.setError("Device is not reponding, is it in GCODE mode?");return}this.isDisconnecting=!1,this.isOn=!1,this.setError(""),this.waitForOkOrError=!1,this.unparsedResponse=""}}catch(e){console.log(e)}this.notifyStatusChange()}async disconnect(){this.isDisconnecting=!0,this.port&&this.closePort()}getDisconnectingStatus(){return this.isDisconnecting}async start(e){e&&(this.isOn=!0,this.lines=e.split(`
`),this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange())}async sendCommand(e){this.isOn=!0,this.lines=[e],this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange()}async sendCommands(e){this.isOn=!0,this.lines=e,this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange()}async stop(){await this.write("!"),this.isOn&&(this.isOn=!1,this.notifyStatusChange())}async write(e){if(this.port){if(console.log("command: ",e),!this.port.writable){e!="?"&&this.setError("Port is not writable, try reconnecting the USB and switching to GCODE mode.");return}if(!this.writer)try{const o=new TextEncoderStream;o.readable.pipeTo(this.port.writable),this.writer=o.writable.getWriter()}catch(o){this.setError("Failed to write: "+o);return}await this.writer.write(e)}}async writeCurrentLine(){if(!this.isOn||this.waitForOkOrError)return;if(this.lineIndex>=this.lines.length){this.stop();return}const e=this.lines[this.lineIndex].split(";")[0].trim();if(!e){this.lineIndex++,this.writeCurrentLine();return}this.waitForOkOrError=!0,console.log(`command: "${e}"`),Re(`command: ${e}`),await this.write(e+`
`),await this.readFromPort()}async processResponse(e){this.unparsedResponse=(this.remainingResponse+e).trimStart(),this.remainingResponse="";const o=this.unparsedResponse.split(`
`);for(let s of o){const l=s.match(/(<[^>]+>)/);if(l&&l.length>1){l.shift();for(const c of l)s=s.replace(c,"");this.setStatus(l.pop())}s.startsWith("error:")?(this.remainingResponse+=s,Re(`response: ${this.remainingResponse}`),console.log(`response: "${this.remainingResponse}"`),this.setError(s),this.remainingResponse="",this.stop()):s.startsWith("ok")?(this.remainingResponse+=s,Re(`response: ${this.remainingResponse}`),console.log(`response: "${this.remainingResponse}"`),this.remainingResponse="",this.waitForOkOrError=!1,this.lineIndex++,this.notifyStatusChange(),this.isOn&&await this.writeCurrentLine()):this.remainingResponse+=s}this.unparsedResponse=""}async selectPort(){if(this.port&&this.closePort(),navigator.serial?this.port=await navigator.serial.requestPort():(this.error="This browser does not support Serial API, try Chrome or Edge",this.notifyStatusChange()),this.port)try{await this.port.open({baudRate:115200}),this.notifyStatusChange(),this.readSoon()}catch(e){this.setError(`Unable to open port - likely some other app is using it - try closing Arduino IDE.
${e}`),this.closePort()}}async askForStatus(){try{await this.write("?")}catch(e){this.setError(`Device disconnected? ${e}`),this.closePort()}}readSoon(){clearTimeout(this.readTimeout),this.readTimeout=window.setTimeout(()=>this.readFromPort(),200)}async readFromPort(){if(this.port)try{if(!this.port.readable){this.readSoon();return}if(!this.reader){const o=new TextDecoderStream;this.port.readable.pipeTo(o.writable),this.reader=o.readable.getReader()}const{value:e}=await this.reader.read();if(!e){this.readSoon();return}await this.processResponse(e),this.readSoon()}catch(e){this.setError(e.message||String(e)),this.closePort()}}async closePort(){if(this.port){if(clearTimeout(this.readTimeout),this.reader){try{await this.reader.cancel(),this.reader.releaseLock()}catch(e){console.error("Error cancelling reader: ",e)}this.reader=null}if(this.writer){try{await this.writer.close(),this.writer.releaseLock()}catch(e){console.error("Error closing writer: ",e)}this.writer=null}await new Promise(e=>setTimeout(e,500));try{await this.port.close()}catch(e){console.error("Error closing port: ",e)}this.port=null,this.statusReceived=!1,this.z=0,this.x=0,this.feed=0,this.rpm=0}}};B(Se,"instance",null);let st=Se;function Re(t){var e=ce.getSession(),o=e.getLength(),s=new Date().toLocaleTimeString(),l=`[${s}] ${t}
`;e.insert({row:o,column:0},l)}function tn(t){return new Promise(e=>{let o=0;function s(){t()?e(!0):o>=10?e(!1):(o++,setTimeout(s,100))}s()})}class nn{constructor(){B(this,"sendButton");B(this,"sendSingleCommandButton");B(this,"stopButton");B(this,"senderError");B(this,"runProgress");B(this,"runProgressLabel");B(this,"connectButton");B(this,"isConnected",!1);B(this,"gcodeResponseContainer");B(this,"jogButtons");B(this,"toolButtons");B(this,"sender");B(this,"singleCommandSender");let e,o,s;this.senderError=document.querySelector(".senderError"),this.runProgress=document.getElementById("senderProgress"),this.runProgressLabel=document.getElementById("senderProgressLabel"),this.connectButton=document.getElementById("connectButton"),this.gcodeResponseContainer=document.getElementById("gcodeResponseContainer"),s=document.getElementById("moveDistance"),e=document.getElementById("fastFeedrate"),o=document.getElementById("slowFeedrate"),this.jogButtons=document.querySelectorAll("#latheControls .jog-btn"),this.toolButtons=document.querySelectorAll("#latheControls .tool-btn"),this.sendButton=document.getElementById("gcodeSenderButton"),this.sendSingleCommandButton=document.getElementById("gcodeSendSingleCommandButton"),this.singleCommandSender=document.getElementById("singleCommandSender"),this.sender=st.getInstance(),this.sender.addStatusChangeListener(()=>this.handleStatusChange()),this.jogButtons.forEach(l=>{l.addEventListener("click",()=>{if(!this.isConnected){alert("Please connect to the controller first.");return}let c="",v="",T="",C=!0;l.id=="fastForward"?(c=e.value,v="X",T=s.value,C=!0):l.id=="slowForward"?(c=o.value,v="X",T=s.value,C=!0):l.id=="fastBackward"?(c=e.value,v="X",T=s.value,C=!1):l.id=="slowBackward"?(c=o.value,v="X",T=s.value,C=!1):l.id=="fastLeft"?(c=e.value,v="Z",T=s.value,C=!0):l.id=="slowLeft"?(c=o.value,v="Z",T=s.value,C=!0):l.id=="fastRight"?(c=e.value,v="Z",T=s.value,C=!1):l.id=="slowRight"&&(c=o.value,v="Z",T=s.value,C=!1);let O=`${v}${C===!0?"":"-"}${T} F${c}`;this.sender&&this.sender.sendCommand(O)})}),this.toolButtons.forEach(l=>{l.addEventListener("click",()=>{if(!this.isConnected){alert("Please connect to the controller first.");return}let c=l.id,v=c.replace("tool","T");document.querySelectorAll("#latheControls .tool-btn").forEach(function($){$.id!=c?$.classList.remove("tool-selected"):$.classList.add("tool-selected")});let C=new Array(1);C[0]=v,this.sender&&this.sender.sendCommands(C)})}),this.connectButton.addEventListener("click",()=>{this.gcodeResponseContainer.style.display="block",!this.isConnected&&this.sender&&this.sender.connect()}),this.sendButton.addEventListener("click",()=>{if(!this.isConnected){alert("Please connect to the controller first.");return}this.sender&&(this.sendButton.disabled=!0,this.sendSingleCommandButton.disabled=!0,this.jogButtons.forEach(l=>{l.disabled=!0}),this.toolButtons.forEach(l=>{l.disabled=!0}),this.sender.start(Z.getValue()))}),this.sendSingleCommandButton.addEventListener("click",()=>{if(!this.isConnected){alert("Please connect to the controller first.");return}this.sender&&(this.sendButton.disabled=!0,this.sendSingleCommandButton.disabled=!0,this.jogButtons.forEach(l=>{l.disabled=!0}),this.toolButtons.forEach(l=>{l.disabled=!0}),this.sender.sendCommand(this.singleCommandSender.value))}),this.stopButton=document.getElementById("stopButton"),this.stopButton.addEventListener("click",()=>this.sender.stop()),this.stopButton.style.display="none"}hide(){}handleStatusChange(){if(!this.sender)return;const e=this.sender.getStatus();if(e.isConnected===!1){this.sendButton.style.display="none",this.connectButton.innerText="Connect",this.isConnected=!1;return}else this.isConnected=!0,this.sendButton.style.display="inline-block",this.connectButton.innerText="Connected",this.connectButton.disabled=!0;const o=e.condition==="run";this.runProgress&&(this.runProgress.value=e.progress,this.runProgress.style.display=o?"block":"none",this.runProgressLabel.style.display=o?"block":"none",o||(this.sendButton.disabled=!1,this.sendSingleCommandButton.disabled=!1,this.jogButtons.forEach(l=>{l.disabled=!1}),this.toolButtons.forEach(l=>{l.disabled=!1}))),this.stopButton&&(this.stopButton.style.display=o?"inline-block":"none");const s=this.sender.getDisconnectingStatus();this.senderError&&!s&&(e.error?(this.senderError.style.display="block",this.senderError.innerText=e.error,this.showError(),this.appendLineToResponseEditor(e.error)):(this.hideError(),this.senderError.innerText=""))}appendLineToResponseEditor(e){var o=ce.getSession(),s=o.getLength(),l=new Date().toLocaleTimeString(),c=`[${l}] ${e}
`;o.insert({row:s,column:0},c)}showError(){this.senderError.style.display="block"}hideError(){this.senderError.style.display="none"}}const on=`; This example shows a boring operation, then an internal grooving operation

G21 ; metric
G18 ; ZX plane
G90 ; absolute positioning
F200
X0 ; zero your tool X on centerline
Z0 ; zero your tool Z at the right edge of the stock
G91 ; relative positioning

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;1mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;2mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;3mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;4mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;5mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;6mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;7mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;8mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;9mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;10mm

Z-10

Z3.25 ; cut
X-5 ; cut

X-1.7 ; cut

X6.7 ; retract
Z-3.25 ; retract
`;function sn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var an=function(e,o){return Array.prototype.slice.call(e,o)},ln=typeof setImmediate=="function",bt;ln?bt=function(t){setImmediate(t)}:bt=function(t){setTimeout(t,0)};var rn=bt,cn=rn,dn=function(e,o,s){e&&cn(function(){e.apply(s||null,o||[])})},Ct=an,un=dn,mn=function(e,o){var s=o||{},l={};return e===void 0&&(e={}),e.on=function(c,v){return l[c]?l[c].push(v):l[c]=[v],e},e.once=function(c,v){return v._once=!0,e.on(c,v),e},e.off=function(c,v){var T=arguments.length;if(T===1)delete l[c];else if(T===0)l={};else{var C=l[c];if(!C)return e;C.splice(C.indexOf(v),1)}return e},e.emit=function(){var c=Ct(arguments);return e.emitterSnapshot(c.shift()).apply(this,c)},e.emitterSnapshot=function(c){var v=(l[c]||[]).slice(0);return function(){var T=Ct(arguments),C=this||e;if(c==="error"&&s.throws!==!1&&!v.length)throw T.length===1?T[0]:T;return v.forEach(function(O){s.async?un(O,T,C):O.apply(C,T),O._once&&e.off(c,O)}),e}},e},Dt=window.CustomEvent;function fn(){try{var t=new Dt("cat",{detail:{foo:"bar"}});return t.type==="cat"&&t.detail.foo==="bar"}catch{}return!1}var hn=fn()?Dt:typeof document<"u"&&typeof document.createEvent=="function"?function(e,o){var s=document.createEvent("CustomEvent");return o?s.initCustomEvent(e,o.bubbles,o.cancelable,o.detail):s.initCustomEvent(e,!1,!1,void 0),s}:function(e,o){var s=document.createEventObject();return s.type=e,o?(s.bubbles=!!o.bubbles,s.cancelable=!!o.cancelable,s.detail=o.detail):(s.bubbles=!1,s.cancelable=!1,s.detail=void 0),s},Rt=[],rt="",pn=/^on/;for(rt in window)pn.test(rt)&&Rt.push(rt.slice(2));var gn=Rt,vn=hn,yn=gn,Qe=window.document,Zt=kn,Jt=Cn,Ve=[];window.addEventListener||(Zt=En,Jt=Bn);var bn={add:Zt,remove:Jt,fabricate:Sn};function kn(t,e,o,s){return t.addEventListener(e,o,s)}function En(t,e,o){return t.attachEvent("on"+e,Tn(t,e,o))}function Cn(t,e,o,s){return t.removeEventListener(e,o,s)}function Bn(t,e,o){var s=Ft(t,e,o);if(s)return t.detachEvent("on"+e,s)}function Sn(t,e,o){var s=yn.indexOf(e)===-1?c():l();t.dispatchEvent?t.dispatchEvent(s):t.fireEvent("on"+e,s);function l(){var v;return Qe.createEvent?(v=Qe.createEvent("Event"),v.initEvent(e,!0,!0)):Qe.createEventObject&&(v=Qe.createEventObject()),v}function c(){return new vn(e,{detail:o})}}function wn(t,e,o){return function(l){var c=l||window.event;c.target=c.target||c.srcElement,c.preventDefault=c.preventDefault||function(){c.returnValue=!1},c.stopPropagation=c.stopPropagation||function(){c.cancelBubble=!0},c.which=c.which||c.keyCode,o.call(t,c)}}function Tn(t,e,o){var s=Ft(t,e,o)||wn(t,e,o);return Ve.push({wrapper:s,element:t,type:e,fn:o}),s}function Ft(t,e,o){var s=In(t,e,o);if(s){var l=Ve[s].wrapper;return Ve.splice(s,1),l}}function In(t,e,o){var s,l;for(s=0;s<Ve.length;s++)if(l=Ve[s],l.element===t&&l.type===e&&l.fn===o)return s}var Bt={},Ln="(?:^|\\s)",Nn="(?:\\s|$)";function jt(t){var e=Bt[t];return e?e.lastIndex=0:Bt[t]=e=new RegExp(Ln+t+Nn,"g"),e}function xn(t,e){var o=t.className;o.length?jt(e).test(o)||(t.className+=" "+e):t.className=e}function On(t,e){t.className=t.className.replace(jt(e)," ").trim()}var _n={add:xn,rm:On},Xn=mn,_e=bn,me=_n,Xe=document,ee=Xe.documentElement;function Mn(t,e){var o=arguments.length;o===1&&Array.isArray(t)===!1&&(e=t,t=[]);var s,l,c,v,T,C,$,O,M,n,r,d=null,u,a=e||{};a.moves===void 0&&(a.moves=It),a.accepts===void 0&&(a.accepts=It),a.invalid===void 0&&(a.invalid=lt),a.containers===void 0&&(a.containers=t||[]),a.isContainer===void 0&&(a.isContainer=$n),a.copy===void 0&&(a.copy=!1),a.copySortSource===void 0&&(a.copySortSource=!1),a.revertOnSpill===void 0&&(a.revertOnSpill=!1),a.removeOnSpill===void 0&&(a.removeOnSpill=!1),a.direction===void 0&&(a.direction="vertical"),a.ignoreInputTextSelection===void 0&&(a.ignoreInputTextSelection=!0),a.mirrorContainer===void 0&&(a.mirrorContainer=Xe.body);var f=Xn({containers:a.containers,start:it,end:qe,cancel:de,remove:ve,destroy:S,canMove:at,dragging:!1});return a.removeOnSpill===!0&&f.on("over",ye).on("out",Te),y(),f;function g(i){return f.containers.indexOf(i)!==-1||a.isContainer(i)}function y(i){var h=i?"remove":"add";Ze(ee,h,"mousedown",te),Ze(ee,h,"mouseup",Me)}function k(i){var h=i?"remove":"add";Ze(ee,h,"mousemove",Y)}function w(i){var h=i?"remove":"add";_e[h](ee,"selectstart",L),_e[h](ee,"click",L)}function S(){y(!0),Me({})}function L(i){u&&i.preventDefault()}function te(i){C=i.clientX,$=i.clientY;var h=St(i)!==1||i.metaKey||i.ctrlKey;if(!h){var b=i.target,I=X(b);I&&(u=I,k(),i.type==="mousedown"&&(xt(b)?b.focus():i.preventDefault()))}}function Y(i){if(u){if(St(i)===0){Me({});return}if(!(i.clientX!==void 0&&Math.abs(i.clientX-C)<=(a.slideFactorX||0)&&i.clientY!==void 0&&Math.abs(i.clientY-$)<=(a.slideFactorY||0))){if(a.ignoreInputTextSelection){var h=fe("clientX",i)||0,b=fe("clientY",i)||0,I=Xe.elementFromPoint(h,b);if(xt(I))return}var D=u;k(!0),w(),qe(),He(D);var x=An(c);v=fe("pageX",i)-x.left,T=fe("pageY",i)-x.top,me.add(n||c,"gu-transit"),Ie(),ne(i)}}}function X(i){if(!(f.dragging&&s)&&!g(i)){for(var h=i;z(i)&&g(z(i))===!1;)if(a.invalid(i,h)||(i=z(i),!i))return;var b=z(i);if(b&&!a.invalid(i,h)){var I=a.moves(i,b,h,Je(i));if(I)return{item:i,source:b}}}}function at(i){return!!X(i)}function it(i){var h=X(i);h&&He(h)}function He(i){Pe(i.item,i.source)&&(n=i.item.cloneNode(!0),f.emit("cloned",n,i.item,"copy")),l=i.source,c=i.item,O=M=Je(i.item),f.dragging=!0,f.emit("drag",c,l)}function lt(){return!1}function qe(){if(f.dragging){var i=n||c;ge(i,z(i))}}function Ue(){u=!1,k(!0),w(!0)}function Me(i){if(Ue(),!!f.dragging){var h=n||c,b=fe("clientX",i)||0,I=fe("clientY",i)||0,D=Tt(s,b,I),x=Ye(D,b,I);x&&(n&&a.copySortSource||!n||x!==l)?ge(h,x):a.removeOnSpill?ve():de()}}function ge(i,h){var b=z(i);n&&a.copySortSource&&h===l&&b.removeChild(c),we(h)?f.emit("cancel",i,l,l):f.emit("drop",i,h,l,M),ue()}function ve(){if(f.dragging){var i=n||c,h=z(i);h&&h.removeChild(i),f.emit(n?"cancel":"remove",i,h,l),ue()}}function de(i){if(f.dragging){var h=arguments.length>0?i:a.revertOnSpill,b=n||c,I=z(b),D=we(I);D===!1&&h&&(n?I&&I.removeChild(n):l.insertBefore(b,O)),D||h?f.emit("cancel",b,l,l):f.emit("drop",b,I,l,M),ue()}}function ue(){var i=n||c;Ue(),Ae(),i&&me.rm(i,"gu-transit"),r&&clearTimeout(r),f.dragging=!1,d&&f.emit("out",i,d,l),f.emit("dragend",i),l=c=n=O=M=r=d=null}function we(i,h){var b;return h!==void 0?b=h:s?b=M:b=Je(n||c),i===l&&b===O}function Ye(i,h,b){for(var I=i;I&&!D();)I=z(I);return I;function D(){var x=g(I);if(x===!1)return!1;var W=Le(I,i),A=$e(I,W,h,b),K=we(I,A);return K?!0:a.accepts(c,I,l,A)}}function ne(i){if(!s)return;i.preventDefault();var h=fe("clientX",i)||0,b=fe("clientY",i)||0,I=h-v,D=b-T;s.style.left=I+"px",s.style.top=D+"px";var x=n||c,W=Tt(s,h,b),A=Ye(W,h,b),K=A!==null&&A!==d;(K||A===null)&&(be(),d=A,We());var J=z(x);if(A===l&&n&&!a.copySortSource){J&&J.removeChild(x);return}var F,oe=Le(A,W);if(oe!==null)F=$e(A,oe,h,b);else if(a.revertOnSpill===!0&&!n)F=O,A=l;else{n&&J&&J.removeChild(x);return}(F===null&&K||F!==x&&F!==Je(x))&&(M=F,A.insertBefore(x,F),f.emit("shadow",x,A,l));function H(ke){f.emit(ke,x,d,l)}function We(){K&&H("over")}function be(){d&&H("out")}}function ye(i){me.rm(i,"gu-hide")}function Te(i){f.dragging&&me.add(i,"gu-hide")}function Ie(){if(!s){var i=c.getBoundingClientRect();s=c.cloneNode(!0),s.style.width=Lt(i)+"px",s.style.height=Nt(i)+"px",me.rm(s,"gu-transit"),me.add(s,"gu-mirror"),a.mirrorContainer.appendChild(s),Ze(ee,"add","mousemove",ne),me.add(a.mirrorContainer,"gu-unselectable"),f.emit("cloned",s,c,"mirror")}}function Ae(){s&&(me.rm(a.mirrorContainer,"gu-unselectable"),Ze(ee,"remove","mousemove",ne),z(s).removeChild(s),s=null)}function Le(i,h){for(var b=h;b!==i&&z(b)!==i;)b=z(b);return b===ee?null:b}function $e(i,h,b,I){var D=a.direction==="horizontal",x=h!==i?A():W();return x;function W(){var J=i.children.length,F,oe,H;for(F=0;F<J;F++)if(oe=i.children[F],H=oe.getBoundingClientRect(),D&&H.left+H.width/2>b||!D&&H.top+H.height/2>I)return oe;return null}function A(){var J=h.getBoundingClientRect();return K(D?b>J.left+Lt(J)/2:I>J.top+Nt(J)/2)}function K(J){return J?Je(h):h}}function Pe(i,h){return typeof a.copy=="boolean"?a.copy:a.copy(i,h)}}function Ze(t,e,o,s){var l={mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"},c={mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"},v={mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"};window.navigator.pointerEnabled?_e[e](t,c[o],s):window.navigator.msPointerEnabled?_e[e](t,v[o],s):(_e[e](t,l[o],s),_e[e](t,o,s))}function St(t){if(t.touches!==void 0)return t.touches.length;if(t.which!==void 0&&t.which!==0)return t.which;if(t.buttons!==void 0)return t.buttons;var e=t.button;if(e!==void 0)return e&1?1:e&2?3:e&4?2:0}function An(t){var e=t.getBoundingClientRect();return{left:e.left+wt("scrollLeft","pageXOffset"),top:e.top+wt("scrollTop","pageYOffset")}}function wt(t,e){return typeof window[e]<"u"?window[e]:ee.clientHeight?ee[t]:Xe.body[t]}function Tt(t,e,o){t=t||{};var s=t.className||"",l;return t.className+=" gu-hide",l=Xe.elementFromPoint(e,o),t.className=s,l}function $n(){return!1}function It(){return!0}function Lt(t){return t.width||t.right-t.left}function Nt(t){return t.height||t.bottom-t.top}function z(t){return t.parentNode===Xe?null:t.parentNode}function xt(t){return t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.tagName==="SELECT"||zt(t)}function zt(t){return!t||t.contentEditable==="false"?!1:t.contentEditable==="true"?!0:zt(z(t))}function Je(t){return t.nextElementSibling||e();function e(){var o=t;do o=o.nextSibling;while(o&&o.nodeType!==1);return o}}function Pn(t){return t.targetTouches&&t.targetTouches.length?t.targetTouches[0]:t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t}function fe(t,e){var o=Pn(e),s={pageX:"clientX",pageY:"clientY"};return t in s&&!(t in o)&&s[t]in o&&(t=s[t]),o[t]}var Dn=Mn;const Ot=sn(Dn);class Gt{static getButtonName(e){const o=this.buttons.find(s=>s.id===e);return o?o.name:""}static createKeyPressEvent(e,o){const s=this.buttons.find(c=>c.id===e);if(!s)throw new Error(`No button found with id: ${e}`);let l=s.number;return l&=127,o&&(l|=128),l}}B(Gt,"buttons",[{name:"arrow_left_alt",id:"B_LEFT",number:57},{name:"arrow_right_alt",id:"B_RIGHT",number:37},{name:"arrow_upward_alt",id:"B_UP",number:47},{name:"arrow_downward_alt",id:"B_DOWN",number:67},{name:"+",id:"B_MINUS",number:5},{name:"-",id:"B_PLUS",number:64},{name:"play_arrow",id:"B_ON",number:17},{name:"crop_square",id:"B_OFF",number:27},{name:"keyboard_tab_rtl",id:"B_STOPL",number:7},{name:"keyboard_tab",id:"B_STOPR",number:15},{name:"vertical_align_top",id:"B_STOPU",number:6},{name:"vertical_align_bottom",id:"B_STOPD",number:16},{name:"rotate_left",id:"B_DISPL",number:14},{name:"signal_cellular_alt",id:"B_STEP",number:24},{name:"settings",id:"B_SETTINGS",number:34},{name:"space_bar",id:"B_MEASURE",number:54},{name:"sync_alt",id:"B_REVERSE",number:44},{name:"1",id:"B_0",number:51},{name:"2",id:"B_1",number:41},{name:"3",id:"B_2",number:61},{name:"4",id:"B_3",number:31},{name:"5",id:"B_4",number:2},{name:"6",id:"B_5",number:21},{name:"7",id:"B_6",number:12},{name:"8",id:"B_7",number:11},{name:"9",id:"B_8",number:22},{name:"10",id:"B_9",number:1},{name:"backspace",id:"B_BACKSPACE",number:32},{name:"manufacturing",id:"B_MODE_GEARS",number:42},{name:"reply",id:"B_MODE_TURN",number:52},{name:"turn_slight_left",id:"B_MODE_FACE",number:62},{name:"arrow_forward_ios",id:"B_MODE_CONE",number:3},{name:"publish",id:"B_MODE_CUT",number:13},{name:"home_improvement_and_tools",id:"B_MODE_THREAD",number:23},{name:"M",id:"B_MODE_OTHER",number:33},{name:"X",id:"B_X",number:53},{name:"Z",id:"B_Z",number:43},{name:"A",id:"B_A",number:4},{name:"B",id:"B_B",number:63}]);let Rn=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,o)=>(o&=63,o<36?e+=o.toString(36):o<62?e+=(o-26).toString(36).toUpperCase():o>62?e+="-":e+="_",e),"");const ae=document.getElementById("availableTasks"),j=document.getElementById("tasksToExecute"),ct=document.getElementById("deleteTasks"),Zn=document.getElementById("addNewTaskButton"),Ce=document.getElementById("newTaskModal"),Jn=document.getElementById("closeNewTaskModal"),ie=document.getElementById("newTaskType"),xe=document.getElementById("gcodeTaskContainer"),G=document.getElementById("newTaskGcode"),Oe=document.getElementById("emulationOuterContainer"),Fn=document.getElementById("saveNewTaskButton"),Fe=document.getElementById("newTaskName"),_t=document.getElementById("taskTextTitle"),dt=document.getElementById("newTaskDescription");let U;const et=document.getElementById("plannerConnectButton"),jn=document.getElementById("plannerContainer");let tt=!1;const zn=document.getElementById("saveAvailableTaskCollection"),Gn=document.getElementById("saveAvailableTaskCollectionButtonModal"),Vn=document.getElementById("loadTaskCollection"),le=document.getElementById("availableTaskCollections"),V=document.getElementById("collectionToSaveTo"),Xt=document.getElementById("newCollectionNameContainer"),ut=document.getElementById("newCollectionName"),Hn=document.getElementById("deleteTaskCollection"),mt=document.getElementById("saveCollectionModal"),he=document.getElementById("saveCollectionModalToSaveTo"),qn=document.getElementById("saveCollectionModalClose"),Un=document.getElementById("newCollectionNameModal"),Mt=document.getElementById("newCollectionNameContainerModal"),Yn=document.getElementById("importAvailableTasks"),Wn=document.getElementById("exportAvailableTasks"),ft=document.getElementById("saveJobModal"),Kn=document.getElementById("saveJobModalClose"),Qn=document.getElementById("executeJobButton"),eo=document.getElementById("saveJobButton"),je=document.getElementById("saveJobNameInput"),to=document.getElementById("saveJobSaveButton"),pe=document.getElementById("jobLoadSelect"),no=document.getElementById("loadJobToExecute"),oo=document.getElementById("deleteJobToExecute"),so=document.getElementById("importJobToExecute"),ao=document.getElementById("exportJobToExecute"),ze=[],ht=document.getElementById("manualTaskModal"),nt=document.getElementById("cncTaskModal"),io=document.getElementById("cancelManualTask"),lo=document.getElementById("completeManualTask"),ro=document.getElementById("manualTaskInstructions"),At=document.getElementById("cncTaskGcode"),co=document.getElementById("cancelCncTask"),pt=document.getElementById("executeGcode"),Ge=document.getElementById("completeCncTask"),uo=document.getElementById("manualTaskName"),mo=document.getElementById("cncTaskName"),ot=document.getElementById("cncTaskSenderProgressLabel"),gt=document.getElementById("cncTaskSenderProgress"),vt=document.getElementById("jobCancelledModal"),fo=document.getElementById("jobCancelledCloseButton"),$t=document.getElementById("completeTaskModal"),ho=document.getElementById("completeTaskCloseButton"),Pt=document.getElementById("notConnectedModal"),po=document.getElementById("notConnectedCloseButton"),go=document.getElementById("emulationInnerContainer"),re=document.getElementById("emulationNewTasks"),yt=document.getElementById("emulatedButtonListDelete"),vo=document.getElementById("emulationTaskModal");document.addEventListener("DOMContentLoaded",()=>{U=st.getInstance(),U.addStatusChangeListener(()=>s()),jn.addEventListener("containerVisible",()=>{j.innerHTML="",o(),$(),T(),O(),C(),e()}),he.addEventListener("change",()=>{he.value==="new"?Mt.style.display="block":Mt.style.display="none"}),V.addEventListener("change",()=>{V.value==="new"?Xt.style.display="block":Xt.style.display="none"}),qn.onclick=function(){mt.style.display="none"},zn.onclick=function(){mt.style.display="block"},Gn.onclick=function(){let n="";if(he.value==="new"){if(n=Un.value,n===null||n===""){alert("Please enter a name for the collection");return}}else n=he.value;const r=localStorage.getItem("selectedTaskCollection");let d;if(r){const a=localStorage.getItem(`taskCollection_${r}`);a&&(d=JSON.parse(a),n!==r&&(d.name=n,localStorage.setItem(`taskCollection_${n}`,JSON.stringify(d))))}const u=document.createElement("option");u.value=n,u.textContent=n,le.appendChild(u),mt.style.display="none",alert(`Collection ${n} saved`),o()},Vn.onclick=function(){const n=le.value;localStorage.setItem("selectedTaskCollection",n),$()},Hn.onclick=function(){const n=le.value;if(n==="default"){alert("You cannot delete the default collection");return}confirm(`Are you sure you want to delete the collection ${n}?`)&&(localStorage.removeItem(`taskCollection_${n}`),o(),$())},Yn.onclick=function(){const n=document.createElement("input");n.type="file",n.accept=".json",n.multiple=!0,n.onchange=async function(r){const d=r.target.files;if(d)for(let u=0;u<d.length;u++){const a=d[u],f=new FileReader;f.onload=function(g){var k;const y=(k=g.target)==null?void 0:k.result;y&&(JSON.parse(y).forEach(S=>{const L=S.name;localStorage.getItem(`taskCollection_${L}`)?window.confirm(`Task collection ${L} already exists. Do you want to override it?`)&&localStorage.setItem(`taskCollection_${L}`,JSON.stringify(S)):localStorage.setItem(`taskCollection_${L}`,JSON.stringify(S))}),o())},f.readAsText(a)}},n.click()},Wn.onclick=function(){const n=Object.keys(localStorage).filter(y=>y.includes("taskCollection_")),r=[];n.forEach(y=>{const k=localStorage.getItem(y);k&&r.push(JSON.parse(k))});const d=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),u=URL.createObjectURL(d),a=document.createElement("a");a.href=u;const g=new Date().toISOString().split("T")[0];a.download=`availableTasks_${g}.json`,a.click(),URL.revokeObjectURL(u)},go.addEventListener("click",function(n){const r=n.target;if(r.tagName==="BUTTON"){const d=r.id;t(d)}});function t(n){const r=document.getElementById(n),d=r==null?void 0:r.cloneNode(!0);d.classList.add("emulated-button-list"),d.removeAttribute("id");const u="emulated-"+Date.now();d.setAttribute("data-emulated-id",u),re==null||re.appendChild(d)}function e(){pe.innerHTML="",Object.keys(localStorage).filter(u=>u.includes("savedJob_")).sort().forEach(u=>{const a=u.replace("savedJob_",""),f=document.createElement("option");f.value=a,f.textContent=a,pe.appendChild(f)});const r=localStorage.getItem("loadedJobName");let d=!1;if(r){for(let u=0;u<pe.options.length;u++)if(pe.options[u].value===r){d=!0;break}}!r||!d?pe.selectedIndex=0:pe.value=r}function o(){le.innerHTML="",V.innerHTML="",he.innerHTML="";const n=document.createElement("option");n.value="default",n.textContent="default",le.appendChild(n),V.appendChild(n.cloneNode(!0)),he.appendChild(n.cloneNode(!0)),Object.keys(localStorage).filter(a=>a.includes("taskCollection_")).sort().forEach(a=>{if(a==="taskCollection_default")return;const f=a.replace("taskCollection_",""),g=document.createElement("option");g.value=f,g.textContent=f,le.appendChild(g),V.appendChild(g.cloneNode(!0)),he.appendChild(g.cloneNode(!0))});const d=localStorage.getItem("selectedTaskCollection");d&&(le.value=d);const u=document.createElement("option");u.value="new",u.textContent="--new collection--",V.appendChild(u.cloneNode(!0)),he.appendChild(u.cloneNode(!0))}po.onclick=function(){Pt.style.display="none"},et.addEventListener("click",()=>{!tt&&U&&U.connect()});function s(){if(!U)return;const n=U.getStatus();if(n.isConnected===!1){et.innerText="Connect",tt=!1;return}else tt=!0,et.innerText="Connected",et.disabled=!0;const r=n.condition==="run";r?r&&(pt.disabled=!0,ot.innerText="Task in progress",Ge.style.display="none"):(Ge.style.display="block",Ge.disabled=!1,ot.innerText="Task completed"),gt.value=n.progress,gt.style.display="block",ot.style.display="block"}Ot([re,yt],{copy:!1,accepts:(n,r)=>r===yt||r===re,revertOnSpill:!0,removeOnSpill:!1}).on("drop",(n,r)=>{if(r===yt){n.remove();const d=n.getAttribute("data-emulated-id"),u=re.querySelector(`[data-emulated-id="${d}"]`);u&&u.remove()}});const c=Ot([ae,j,ct],{copy:(n,r)=>r===ae,accepts:(n,r)=>r===j||r===ct,revertOnSpill:!0,removeOnSpill:!1});c.on("dragend",()=>{O(),C(),v()});function v(n="currentJob"){const r=j.querySelectorAll(".task-to-execute"),d=[];r.forEach(u=>{const a=u.getAttribute("data-task-id"),f=u.getAttribute("data-collection-name");d.push({id:a,collectionName:f})}),localStorage.setItem(n,JSON.stringify(d))}function T(){const n=localStorage.getItem("currentJob");let r=[];if(n){try{r=JSON.parse(n)}catch{console.warn("Error parsing current job data, clearing current job data..."),localStorage.setItem("currentJob",JSON.stringify([]))}const d=[];r=r.filter(u=>localStorage.getItem(`taskCollection_${u.collectionName}`)?!0:(d.push(u),!1)),localStorage.setItem("currentJob",JSON.stringify(r)),r.forEach(u=>{const a=localStorage.getItem(`taskCollection_${u.collectionName}`);if(a){const g=JSON.parse(a).tasks.find(y=>y.id===u.id);if(g){const y=document.createElement("div");y.classList.add(`task-${g.type}`),y.classList.add("task-to-execute"),y.setAttribute("data-task-id",g.id),y.setAttribute("data-task-name",g.name),y.setAttribute("data-collection-name",u.collectionName),y.textContent=g.name,j.appendChild(y)}}}),d.length>0&&alert(`The following tasks were removed because their collection does not exist: ${d.map(u=>u.id).join(", ")}`)}}c.on("drop",(n,r,d)=>{const u=n.getAttribute("data-task-id"),a=n.getAttribute("data-task-order");if(r===j)n.classList.remove("available-task"),n.classList.add("task-to-execute"),C();else if(r===ct){n.remove();let f=null;if(d===j)f=j.querySelector(`[data-task-order="${a}"]`);else if(d===ae&&(f=ae.querySelector(`[data-task-id="${u}"]`),f)){const g=f.getAttribute("data-collection-name"),y=localStorage.getItem(`taskCollection_${g}`);if(y){const k=JSON.parse(y);k.tasks=k.tasks.filter(w=>w.id!==u),localStorage.setItem(`taskCollection_${g}`,JSON.stringify(k))}}f&&f.remove()}});function C(){j.querySelectorAll(".task-to-execute").forEach(r=>{if(r.querySelector("i")){let d=r.querySelector("i");d&&(d.remove(),d=document.createElement("i"),r.classList.contains("task-manual")?(d.className="fas fa-users-cog icon-tooltip",d.setAttribute("data-tooltip","Manual Task")):r.classList.contains("task-gcode")?(d.className="fas fa-code icon-tooltip",d.setAttribute("data-tooltip","Gcode Task")):r.classList.contains("task-emulation")&&(d.className="far fa-keyboard icon-tooltip",d.setAttribute("data-tooltip","Emulation Task")),r.appendChild(d))}else{const d=document.createElement("i");r.classList.contains("task-manual")?(d.className="fas fa-users-cog icon-tooltip",d.setAttribute("data-tooltip","Manual Task")):r.classList.contains("task-gcode")?(d.className="fas fa-code icon-tooltip",d.setAttribute("data-tooltip","Gcode Task")):r.classList.contains("task-emulation")&&(d.className="far fa-keyboard icon-tooltip",d.setAttribute("data-tooltip","Emulation Task")),r.appendChild(d)}})}function $(){ae.innerHTML="";let n=localStorage.getItem("selectedTaskCollection");(n===null||n==="")&&(n=le.value,localStorage.setItem("selectedTaskCollection",n));const r=localStorage.getItem(`taskCollection_${n}`);r&&JSON.parse(r).tasks.forEach(u=>{u.id,u.name,u.type,u.description,u.gcode&&u.gcode,u.buttonKeys&&u.buttonKeys;const a=document.createElement("div");a.classList.add(`task-${u.type}`),a.classList.add("available-task"),a.setAttribute("data-task-id",u.id.toString()),a.setAttribute("data-task-name",u.name),a.setAttribute("data-collection-name",n||""),a.textContent=u.name;const f=document.createElement("i");f.classList.add("fas","fa-info-circle","fa-fw","show-info","icon-tooltip"),f.setAttribute("data-tooltip","Click for more info..."),a.appendChild(f),ae.appendChild(a)})}function O(){const n=document.getElementById("tasksToExecute");n&&n.querySelectorAll("div").forEach((d,u)=>{const a=d.getAttribute("data-task-name");d.setAttribute("data-task-order",(u+1).toString()),d.textContent=`Task ${u+1}: ${a}`})}ie.addEventListener("change",()=>{ie.value==="manual"?(G.disabled=!0,G.placeholder="Disabled for manual tasks",G.value="",xe.style.display="none",Oe.style.display="none"):ie.value==="emulation"?(G.disabled=!0,G.placeholder="Disabled for emulation tasks",G.value="",xe.style.display="none",Oe.style.display="block"):(Oe.style.display="none",xe.style.display="block",G.placeholder="Enter gcode here...",G.disabled=!1)}),Zn.addEventListener("click",()=>{Ce.style.display="block",_t.textContent="Add a new task",Fe.value="",dt.value="",G.value="",ut.value="",Ce.removeAttribute("data-task-id"),V.value=""}),Fn.addEventListener("click",()=>{if(V.value===""){alert("Please select a collection.");return}if(V.value==="new"&&ut.value===""){alert("Please enter a collection name");return}if(Fe.value===""||Fe.value===null){alert("Please enter a task name");return}const n=Fe.value,r=document.createElement("div");r.classList.add(`task-${ie.value}`),r.classList.add("available-task");let d;const u=Ce.getAttribute("data-task-id");u?d=u:d=Rn(),r.setAttribute("data-task-id",d.toString()),r.setAttribute("data-task-name",n),r.textContent=n;const a=document.createElement("i");a.classList.add("fas","fa-info-circle","fa-fw","show-info","icon-tooltip"),a.setAttribute("data-tooltip","Click for more info..."),r.appendChild(a);const f=ae.querySelector(`[data-task-id="${d}"]`);f&&f.remove(),ae.appendChild(r),Ce.style.display="none";let g="";ie.value==="emulation"&&(re.querySelectorAll(".emulated-button-list").forEach(w=>{const S=w.getAttribute("data-button-key");g+=S+","}),g.length>0&&(g=g.slice(0,-1)));const y={id:d,name:n,type:ie.value,description:dt.value};if(ie.value==="gcode"&&(y.gcode=G.value),ie.value==="emulation"&&(y.buttonKeys=g),V.value==="new"){const k=ut.value,w={name:k,tasks:[]};w.tasks.push(y),localStorage.setItem(`taskCollection_${k}`,JSON.stringify(w));const S=document.createElement("option");S.value=k,S.textContent=k,le.appendChild(S),o()}else{const k=V.value,w=localStorage.getItem(`taskCollection_${k}`);if(w){const S=JSON.parse(w);S.tasks.find(te=>te.id===d)&&(S.tasks=S.tasks.filter(te=>te.id!==d)),S.tasks.push(y),localStorage.setItem(`taskCollection_${k}`,JSON.stringify(S))}else{const S={name:k,tasks:[]};S.tasks.push(y),localStorage.setItem(`taskCollection_${k}`,JSON.stringify(S))}}$()}),ae.addEventListener("click",n=>{const r=n.target;if(r.matches(".show-info")){const u=r.parentNode.getAttribute("data-task-id");let a=null;const f=localStorage.getItem("selectedTaskCollection"),g=localStorage.getItem(`taskCollection_${f}`);if(g){const k=JSON.parse(g).tasks.find(w=>w.id===u);k&&(a=k)}a&&(Ce.style.display="block",Fe.value=a.name,ie.value=a.type,dt.value=a.description,G.value=a.gcode||"",V.value=f||"default",_t.textContent="Edit Task",a.type==="emulation"?(Oe.style.display="block",xe.style.display="none",re.innerHTML="",(a.buttonKeys??"").split(",").forEach(k=>{const w=document.createElement("button");w.classList.add("emulated-button-list"),w.classList.add("material-symbols-outlined"),w.setAttribute("data-button-key",k),w.textContent=Gt.getButtonName(k),w.textContent.length===1&&w.classList.add("standard-font"),re.appendChild(w)})):a.type==="gcode"?(Oe.style.display="none",xe.style.display="block",G.disabled=!1,G.placeholder="Enter gcode here..."):(Oe.style.display="none",xe.style.display="none"),u&&Ce.setAttribute("data-task-id",u.toString()))}}),Jn.onclick=function(){Ce.style.display="none"},ho.onclick=function(){$t.style.display="none"};function M(){if(ze.length===0){$t.style.display="block";return}pt.disabled=!1;const n=ze.shift();if(n&&n.type==="manual")uo.textContent=`Task ${n.order}: ${n.name}`,ro.value=n.description,ht.style.display="block";else if(n&&n.type==="gcode"){mo.textContent=`Task ${n.order}: ${n.name}`,At.value=n.gcode??"",nt.style.display="block";const r=nt.querySelector(".task-modal-content");r&&(r.style.backgroundColor=""),Ge.disabled=!0,gt.style.display="none",ot.style.display="none"}else n&&n.type==="emulation"&&(vo.style.display="block")}io.onclick=function(){ht.style.display="none",ze.length=0,vt.style.display="block"},co.onclick=function(){nt.style.display="none",ze.length=0,vt.style.display="block",U==null||U.stop()},lo.onclick=function(){ht.style.display="none",M()},Ge.onclick=function(){nt.style.display="none",M()},pt.onclick=function(){U&&U.start(At.value)},fo.onclick=function(){vt.style.display="none"},Qn.onclick=function(){if(!tt){Pt.style.display="block";return}j.querySelectorAll(".task-to-execute").forEach(r=>{const d=r.getAttribute("data-task-id"),u=r.getAttribute("data-task-order"),a=r.getAttribute("data-collection-name"),f=localStorage.getItem(`taskCollection_${a}`);let g=null;if(f){const k=JSON.parse(f).tasks.find(w=>w.id===d);k&&(g=k)}g&&(g.order=parseInt(u||"0"),ze.push(g))}),M()},eo.onclick=function(){ft.style.display="block"},to.onclick=function(){if(je.value===""||je.value===null){alert("Please enter a name for the job");return}const n=je.value;localStorage.getItem(`savedJob_${n}`)&&!confirm("A job with this name already exists. Do you want to overwrite it?")||(v(`savedJob_${je.value}`),e(),ft.style.display="none",je.value="")},Kn.onclick=function(){ft.style.display="none"},no.onclick=function(){j.innerHTML="";const n=pe.value,r=localStorage.getItem(`savedJob_${n}`);r&&JSON.parse(r).forEach(u=>{const a=localStorage.getItem(`taskCollection_${u.collectionName}`);if(a){const g=JSON.parse(a).tasks.find(y=>y.id===u.id);if(g){const y=document.createElement("div");y.classList.add(`task-${g.type}`),y.classList.add("task-to-execute"),y.setAttribute("data-task-id",g.id.toString()),y.setAttribute("data-task-name",g.name),y.setAttribute("data-collection-name",u.collectionName),y.textContent=g.name,j.appendChild(y)}}}),O(),C(),localStorage.setItem("loadedJobName",n)},oo.onclick=function(){const n=pe.value;localStorage.removeItem(`savedJob_${n}`),e(),C()},so.onclick=function(){const n=document.createElement("input");n.type="file",n.accept=".json",n.onchange=function(r){var u;const d=(u=r.target.files)==null?void 0:u[0];if(d){const a=new FileReader;a.onload=function(f){var y;const g=(y=f.target)==null?void 0:y.result;if(g){const k=JSON.parse(g);j.innerHTML="";const w=[];if(k.tasks.forEach(S=>{const L=localStorage.getItem(`taskCollection_${S.collectionName}`);if(L){const Y=JSON.parse(L).tasks.find(X=>X.id===S.id);if(Y){const X=document.createElement("div");X.classList.add(`task-${Y.type}`),X.classList.add("task-to-execute"),X.setAttribute("data-task-id",Y.id.toString()),X.setAttribute("data-task-name",Y.name),X.setAttribute("data-collection-name",S.collectionName),X.textContent=Y.name,j.appendChild(X)}else w.push({id:S.id,collectionName:S.collectionName,reason:"Task not found in collection"})}else w.push({id:S.id,collectionName:S.collectionName,reason:"Collection not found"})}),localStorage.setItem("loadedJobName",k.name),v(`savedJob_${k.name}`),v(),O(),C(),$(),e(),w.length>0){const S=w.map(L=>`Task ${L.id} in collection ${L.collectionName} was skipped because ${L.reason}.`).join(`
`);alert(`Could not import all tasks. The following tasks were skipped:
${S}`)}}},a.readAsText(d)}},n.click()},ao.onclick=function(){const n=localStorage.getItem("currentJob");if(n){const r=JSON.parse(n),d=window.prompt("Enter a name for the job");if(d===null||d===""){alert("Job name cannot be empty");return}const u={name:d,tasks:[]};r.forEach(y=>{const k=localStorage.getItem(`taskCollection_${y.collectionName}`);if(k){const S=JSON.parse(k).tasks.find(L=>L.id===y.id);S&&u.tasks.push({id:S.id,collectionName:y.collectionName})}});const a=new Blob([JSON.stringify(u,null,2)],{type:"application/json"}),f=URL.createObjectURL(a),g=document.createElement("a");g.href=f,g.download=`${u.name}.json`,g.click(),URL.revokeObjectURL(f)}}});const P=ace.edit("gcodeEditor"),ce=ace.edit("gcodeResponseEditor"),Z=ace.edit("gcodeSenderEditor");let Be={z:0,x:0};const yo="#DC143C",bo="#6B8E23",ko="#FFA500",Eo="#ADD8E6";document.addEventListener("DOMContentLoaded",()=>{new nn;const t=document.getElementById("gcodeCanvas"),e=document.getElementById("zoomCanvas");let o=null;const s=document.getElementById("fileInput"),l=document.getElementById("simulateButton"),c=document.getElementById("showCuts"),v=document.getElementById("showNonCuts"),T=document.getElementById("showCutsZoom"),C=document.getElementById("showNonCutsZoom"),$=document.getElementById("sliderLabel"),O=document.getElementById("zoomSliderLabel"),M=document.getElementById("progressSlider"),n=document.getElementById("zoomProgressSlider"),r=document.getElementById("sliderContainer"),d=document.getElementById("displayOptionsContainer"),u=document.getElementById("clearButton"),a=document.querySelector(".saveGCodeNameInput"),f=document.querySelector(".loadGCodeSelect"),g=document.querySelector(".loadGCodeButton"),y=document.querySelector(".saveGCodeButton"),k=document.querySelector(".deleteGCodeButton"),w=document.getElementById("gcodeSenderContainer"),S=document.getElementById("exampleCode"),L=document.getElementById("helpModal"),te=document.getElementById("helpButton"),Y=document.getElementById("closeHelpModal"),X=document.getElementById("zoomModal"),at=document.getElementById("zoomButton"),it=document.getElementById("closeZoomModal"),He=document.getElementById("zoomCloseButton"),lt=document.getElementById("simulationTab"),qe=document.getElementById("controlTab"),Ue=document.getElementById("plannerTab"),Me=document.getElementById("threadingTab"),ge=document.getElementById("simulationContainer"),ve=document.getElementById("controlsContainer"),de=document.getElementById("plannerContainer"),ue=document.getElementById("threadingContainer"),we=document.querySelectorAll("#latheControls .increment-btn"),Ye=document.getElementById("moveDistance");localStorage.getItem("helpModalShown")||(L.style.display="block",localStorage.setItem("helpModalShown","true")),we.forEach(function(m){m.addEventListener("click",function(){we.forEach(function(E){E.classList.remove("active")}),this.classList.add("active");var p=this.dataset.increment;Ye.value=p,console.log("Jog increment set to:",p)})}),lt.addEventListener("click",()=>{ge.style.display="flex",ve.style.display="none",de.style.display="none",ue.style.display="none"}),qe.addEventListener("click",()=>{ge.style.display="none",ve.style.display="flex",de.style.display="none",ue.style.display="none"}),Ue.addEventListener("click",()=>{ge.style.display="none",ve.style.display="none",de.style.display="flex",ue.style.display="none";const m=new Event("containerVisible");de.dispatchEvent(m)}),Me.addEventListener("click",()=>{ge.style.display="none",ve.style.display="none",de.style.display="none",ue.style.display="flex"}),e.width=window.visualViewport.width-100,e.height=window.visualViewport.height-150,window.addEventListener("resize",function(){e.width=window.visualViewport.width-100,e.height=window.visualViewport.height-150,n.value=n.min,b(e)}),at.onclick=function(){X.style.display="block",b(e)},it.onclick=function(){X.style.display="none"},He.onclick=function(){X.style.display="none"},te.onclick=function(){L.style.display="block"},Y.onclick=function(){L.style.display="none"},window.onclick=function(m){m.target==L&&(L.style.display="none"),m.target==X&&(X.style.display="none")},y.addEventListener("click",()=>I()),g.addEventListener("click",()=>D()),k.addEventListener("click",()=>x()),W(),P.setTheme("ace/theme/github_dark"),P.session.setMode("ace/mode/plain_text"),P.setShowPrintMargin(!1),Z.setTheme("ace/theme/github_dark"),Z.session.setMode("ace/mode/plain_text"),Z.setShowPrintMargin(!1),S.addEventListener("click",()=>Ht()),ce.setTheme("ace/theme/monokai"),ce.session.setMode("ace/mode/text"),ce.setReadOnly(!0),ce.setShowPrintMargin(!1),ce.getSession().on("change",()=>{setTimeout(()=>{var m=ce.getSession().getLength();ce.scrollToLine(m,!0,!0,function(){})},0)}),Z.on("focus",()=>{Z.getValue()==="Paste your gcode here or click choose file to upload"&&Z.setValue("")}),A();let ne=0,ye=0,Te=0,Ie=0,Ae=0,Le=0,$e=5,Pe=0,i=0,h=[];M.oninput=()=>{const m=Math.floor(parseInt(M.value));if(m<h.length){const p=h[m];let E=be(h,t);ke(t,h,E,m),K(p)}},n.oninput=()=>{const m=Math.floor(parseInt(n.value));if(m<h.length){const p=h[m];let E=be(h,e);ke(e,h,E,m),J(p)}},u.addEventListener("click",()=>{Z.setValue(""),P.setValue(""),A();const m=t.getContext("2d");m&&(m.clearRect(0,0,t.width,t.height),s.value="",M.value="0",n.value="0",r.style.display="none",d.style.display="none")}),s.addEventListener("change",m=>{if(m.target instanceof HTMLInputElement&&m.target.files&&m.target.files.length>0){const p=m.target.files[0];p&&F(p)}}),l.addEventListener("click",()=>{b(t)});function b(m){if(!m)return;const p=P.getValue();if(p){oe(p);let E=be(h,m);ke(m,h,E),r.style.display="block",d.style.display="block",c.addEventListener("change",H),v.addEventListener("change",H),T.addEventListener("change",We),C.addEventListener("change",We),M.max=(h.length-1).toString(),M.value=M.min,n.max=(h.length-1).toString(),n.value=n.min,w.style.display="block"}}function I(){const m=a.value.trim();if(!m)return;const p=`gCode-${m}`;localStorage.setItem(p,P.getValue()),W(p),a.value=""}function D(){const m=f.value,p=localStorage.getItem(m);p&&(P.setValue(p),Z.setValue(p))}function x(){const m=f.value;localStorage.removeItem(m),W()}function W(m){f.innerHTML="";let p=!1;for(let E=0;E<localStorage.length;E++){const N=localStorage.key(E);if(N&&N!=="latheCode"&&N.startsWith("gCode-")){p=!0;const _=document.createElement("option"),R=N.replace("gCode-","");_.value=N,_.textContent=R,f.appendChild(_),N===m&&(_.selected=!0)}}if(p){const E=Array.from(f.options).sort((N,_)=>N.text.localeCompare(_.text));f.innerHTML="",E.forEach(N=>{f.appendChild(N)})}else{const E=document.createElement("option");E.textContent="No items saved",E.disabled=!0,f.appendChild(E)}}function A(){const m=P.getValue(),p=Z.getValue();m===""&&(P.setValue("Paste your gcode here or click choose file to upload"),P.gotoLine(1,0),P.on("focus",function(){P.getValue()==="Paste your gcode here or click choose file to upload"&&P.setValue("")})),p===""&&(Z.setValue("Paste your gcode here or click choose file to upload"),Z.gotoLine(1,0),Z.on("focus",function(){Z.getValue()==="Paste your gcode here or click choose file to upload"&&Z.setValue("")}))}function K(m){var p,E;(m==null?void 0:m.lineNumber)!==void 0?(P.gotoLine(m.lineNumber,0,!0),$.innerHTML=`Line:${m.lineNumber}<br>${m==null?void 0:m.originalLine}<br>Abs: X${(p=m.absolutePosition)==null?void 0:p.x} Z${(E=m.absolutePosition)==null?void 0:E.z}`||""):$.innerHTML=""}function J(m){var p,E;(m==null?void 0:m.lineNumber)!==void 0?(P.gotoLine(m.lineNumber,0,!0),O.innerHTML=`Line:${m.lineNumber}<br>${m==null?void 0:m.originalLine}<br>Abs: X${(p=m.absolutePosition)==null?void 0:p.x} Z${(E=m.absolutePosition)==null?void 0:E.z}`||""):O.innerHTML=""}function F(m){const p=new FileReader;p.onload=E=>{const N=E.target.result;P.setValue(N),Z.setValue(N)},p.readAsText(m)}function oe(m){const p=[];let E=!1;return h=[],m.split(`
`).forEach((_,R)=>{const De=_.includes("; cut")?0:_.includes("; retract")?2:1,q={isRelative:E,movementType:De},Ee=_.match(/([GXYZF])([0-9.-]+)/g);Ee==null||Ee.forEach(Ke=>{const Q=parseFloat(Ke.slice(1));switch(Ke[0]){case"G":Q===90&&(q.isRelative=!1,E=!1),Q===91&&(q.isRelative=!0,E=!0);break;case"X":q.x=parseFloat(Q.toFixed(3)),E?Be.x=parseFloat((Be.x+Q).toFixed(3)):Be.x=parseFloat(Q.toFixed(3));break;case"Z":q.z=parseFloat(Q.toFixed(3)),E?Be.z=parseFloat((Be.z+Q).toFixed(3)):Be.z=parseFloat(Q.toFixed(3));break}});const Ne={...q,lineNumber:R+1,originalLine:_,absolutePosition:{...Be}};(q.z!==void 0||q.x!==void 0)&&h.push(Ne),p.push(Ne)}),p}function H(){T.checked=c.checked,C.checked=v.checked,M.value="0";const m=be(h,t);ke(t,h,m,h.length)}function We(){c.checked=T.checked,v.checked=C.checked,n.value="0";const m=be(h,e);ke(e,h,m,h.length)}function be(m,p){let E=0,N=0,_=0,R=0,De=0,q=0,Ee=0,Ne=0;p.id==="zoomCanvas"?Ne=80:Ne=40,m.forEach(se=>{se.isRelative?(se.x!==void 0&&(E+=se.x),se.z!==void 0&&(N+=se.z)):(se.x!==void 0&&(_=Math.min(_,se.x)),se.z!==void 0&&(R=Math.max(R,se.z)));const Wt=E+=_,Et=N+=R;_=0,R=0,De=Math.max(De,Math.abs(Wt)),q=Math.max(q,Math.abs(Et)),Ee=Math.min(Ee,Et)});const Ke=De,Q=q-Ee,qt=p.height/2,kt=1,Ut=qt/Ke-kt,Yt=p.width/Q-kt;return Math.min(Ut,Yt,Ne)}function ke(m,p,E,N){if(o=m.getContext("2d"),!o)return;o.clearRect(0,0,m.width,m.height),ne=0,ye=0,Ae=0,Le=0,Te=0,Ie=0,Te=m.height/2,Ie=m.width-$e;const _=N!==void 0?Math.min(N+1,p.length):p.length;for(let R=0;R<_;R++)Vt(m,p[R],E,R===N)}function Vt(m,p,E,N){if(o=m.getContext("2d"),!o)return;let _=c.checked||T.checked,R=v.checked||C.checked;o.lineWidth=2,p.isRelative?(ne+=p.x??0,ye+=p.z??0):(ne=p.x??Ae,ye=p.z??Le,Ae=ne,Le=ye),Pe=m.height/2-ne*E,i=m.width-ye*E-$e,(p.movementType==0&&_||p.movementType==1&&R||p.movementType==2&&R)&&(o.beginPath(),o.strokeStyle=N?Eo:p.movementType==0?yo:p.movementType==1?bo:ko,o.moveTo(Ie,Te),o.lineTo(i,Pe),o.stroke()),Te=Pe,Ie=i}function Ht(){P.setValue(on)}});

</script>
  <style>
:root{font-family:Inter,system-ui,Avenir,Helvetica,Arial,sans-serif;line-height:1.5;font-weight:400;color-scheme:light dark;color:#ffffffde;background-color:#242424;font-synthesis:none;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}a{font-weight:500;color:#646cff;text-decoration:inherit}a:hover{color:#535bf2}h1{font-size:3.2em;line-height:1.1}#app{max-width:1280px;margin:0 auto;padding:2rem;text-align:center}.logo{height:6em;padding:1.5em;will-change:filter;transition:filter .3s}.logo:hover{filter:drop-shadow(0 0 2em #646cffaa)}.logo.vanilla:hover{filter:drop-shadow(0 0 2em #3178c6aa)}.card{padding:2em}.read-the-docs{color:#888}button{border-radius:3px;border:1px solid transparent;padding:.6em 1.2em;font-size:1em;font-weight:500;font-family:inherit;background-color:#1a1a1a;cursor:pointer;transition:background-color .25s;border:2px solid white}button:hover{background-color:#646cff}button:focus,button:focus-visible{outline:4px auto -webkit-focus-ring-color}@media (prefers-color-scheme: light){:root{color:#213547;background-color:#fff}a:hover{color:#747bff}button{background-color:#f9f9f9}}#simulationContainer{display:flex;flex-direction:column;width:800px;max-width:1280px;text-align:center}.main-container{display:flex;width:100%}#controlsContainer{display:flex;flex-direction:column;width:800px;max-width:1280px;text-align:center}.controls-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;border:1px solid #ccc}.canvas-container{display:flex;flex-direction:column;align-items:center;margin:5px;border:1px solid #ccc}.canvas-wrapper{display:flex;flex-direction:column;align-items:center}.innerContainer{margin:5px;align-items:center;width:auto}.modal-pad{padding-top:10px}.modal-pad-bottom{padding-bottom:10px}.emulation-modal-pad-border{padding:10px;border:2px dashed green;min-height:40px}.innerContainer.toolbar{display:flex;align-items:center;gap:5px;padding:2px}.saveGCodeNameInput,.loadGCodeSelect{flex-grow:1}#gcodeCanvas{border-bottom:1px solid #ccc;background-color:#242424}#gcodeInput{position:relative;background:transparent;width:100%;height:240px;font-family:monospace;font-size:13px;line-height:1.5;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}#gcodeContainer{position:relative;width:100%}#gcodeSenderContainer{display:block}.save-group,.load-group,.import-export-group{display:flex;flex-direction:row;align-items:center;gap:10px}.toolbar input[type=text],.toolbar select{max-width:200px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem;font-size:1rem;line-height:1.5}input[type=file]::file-selector-button{border:2px solid #6c5ce7;padding:.2em .4em;border-radius:.2em;background-color:#1a1a1a;transition:.25s}input[type=file]::-ms-browse:hover{background-color:#646cff}input[type=file]::-webkit-file-upload-button:hover{background-color:#646cff}input[type=file]::file-selector-button:hover{background-color:#646cff}.bottom-container{margin:5px}#gcodeResponseContainer{border:1px solid #ccc;width:100%;display:flex;flex-direction:column;align-items:center;margin-top:5px}.senderError{display:none;color:#fff;background-color:red;padding:10px;border-radius:5px;animation:flashError 1s infinite}@keyframes flashError{0%,to{opacity:1}50%{opacity:0}}#helpText li{margin-bottom:10px}#helpText a{color:#f95959}.help-modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.help-modal-content{position:relative;background-color:#242424;margin:15% auto;padding:20px;border:2px solid #6c5ce7;width:30%}.zoom-modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#242424}.zoom-modal-content{display:flex;flex-direction:column;align-items:center;margin:10px auto;padding:20px;border:1px solid #888}.close-modal{position:absolute;top:0;right:0;padding-right:10px;cursor:pointer;font-size:35px}#sliderAndButtonContainer{display:flex;justify-content:center;align-items:center;gap:10px;flex-direction:column}.text-red{color:#dc143c}.text-green{color:#6b8e23}.text-orange{color:orange}.line{display:inline-block;vertical-align:middle;width:20px;height:2px;margin-right:5px}.red-line{border-top:2px solid #DC143C}.green-line{border-top:2px solid #6B8E23}.orange-line{border-top:2px solid #FFA500}#latheControls #jogControls{display:grid;grid-template-columns:repeat(10,60px);grid-template-rows:repeat(6,60px);justify-content:center;align-items:center;place-items:center}#latheControls .jog-btn,#latheControls .tool-btn{width:50px;height:50px;border-radius:5px;cursor:pointer;background-color:#f0ad4e;display:flex;justify-content:center;align-items:center;text-align:center;line-height:50px;font-size:24px;padding:0}#latheControls .tool{background-color:#f0ad4e;border:none}#latheControls .tool-selected{background-color:#6c5ce7;border:2px solid white}#latheControls .fast{background-color:#f0ad4e}#latheControls .slow{background-color:#5bc0de}#latheControls .jog-btn:hover{background-color:#6c5ce7}#jogText{grid-column:6;grid-row:1}#fastForward{grid-column:6;grid-row:2}#fastText{grid-column:5;grid-row:2}#slowText{grid-column:5;grid-row:3}#fastLeft{grid-column:4;grid-row:4}#fastBackward{grid-column:6;grid-row:6}#fastRight{grid-column:8;grid-row:4}#slowForward{grid-column:6;grid-row:3}#slowLeft{grid-column:5;grid-row:4}#slowBackward{grid-column:6;grid-row:5}#slowRight{grid-column:7;grid-row:4}#toolText{grid-column:1;grid-row:1}#tool0{grid-column:1;grid-row:2}#tool1{grid-column:1;grid-row:3}#tool2{grid-column:1;grid-row:4}#tool3{grid-column:1;grid-row:5}#tool4{grid-column:1;grid-row:6}#tool5{grid-column:2;grid-row:2}#tool6{grid-column:2;grid-row:3}#tool7{grid-column:2;grid-row:4}#tool8{grid-column:2;grid-row:5}#tool9{grid-column:2;grid-row:6}.menu ul{list-style-type:none;padding:0}.menu li{cursor:pointer;padding:10px;background-color:#242424;border-bottom:1px solid #6c5ce7}.menu li:hover{background-color:#6c5ce7}.content{margin-left:200px;padding:20px}#senderProgressContainer{display:flex;justify-content:center;align-items:center}#senderProgressLabel{margin-right:10px}.innerContentCentre{display:flex;justify-content:center;align-items:center;margin:10px}#gcodeSenderContainer{position:relative;width:100%}#latheControls #incrementControls{display:flex;justify-content:center;gap:10px;margin:20px 0}#latheControls .increment-btn{padding:5px 10px;border:1px solid #ccc;background-color:#f0ad4e;border-radius:5px;cursor:pointer;transition:background-color .3s}#latheControls .increment-btn:hover,#latheControls .increment-btn.active{background-color:#6c5ce7}.control-inputs input[type=text]{max-width:200px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem}.control-inputs label{display:block;margin-right:5px}.sender-inputs input[type=text]{max-width:350px;min-width:350px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem}#latheControls label{white-space:nowrap;margin-right:10px;display:inline-block;min-width:120px}.planner-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;width:800px;max-width:1280px;text-align:center;border:1px solid #ccc}.planner-container h1{margin:10px 0}.planner-guidance{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:10px;text-align:center}.planner-guidance span{display:block;margin:10px 0;text-align:left}#taskContainer{display:flex;justify-content:space-between;align-items:start;padding:20px}.container-wrapper{padding:10px}.container-wrapper-inner{padding:5px 0}.container-wrapper-outer{border:1px solid #ccc;border-radius:5px;margin:10px;background-color:#333}.container-wrapper-delete{min-height:50px;display:flex;justify-content:center;align-items:center;border:2px dashed red}#availableTasks{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;align-items:start;min-width:450px}#availableTasks .span-2-rows{grid-row:span 3;height:100%}#availableTasks div{box-sizing:border-box;padding:5px}#tasksToExecute{min-height:50px;padding:5px;border:2px dashed green}#tasksToExecute div{margin:5px}.task-to-execute{text-align:left}.task-to-execute i{text-align:left;margin-left:5px;cursor:help}.available-task{width:150px;-webkit-user-select:none;user-select:none}.available-task i{margin-left:5px;cursor:help}.task-manual{background-color:#4c956c}.task-gcode{background-color:#386e97}.task-emulation{background-color:#e74c3c}.emulate-noselect{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#emulationInnerContainer{display:flex;flex-direction:row;justify-content:center;align-items:center;height:100%}#emulationNewTasksMovement{display:grid;grid-template-columns:repeat(9,40px);grid-template-rows:repeat(3,40px);gap:3px;align-items:center;justify-items:center}#emulationNewTasksNumbers,#emulationNewTasksOther{display:grid;grid-template-columns:repeat(2,40px);grid-template-rows:repeat(6,40px);gap:3px;align-items:center;justify-items:center}#emulationNewTasksMode{display:grid;grid-template-columns:repeat(8,40px);grid-template-rows:repeat(1,40px);gap:3px;align-items:center;justify-items:center}#movementContainer,#modeContainer{width:100%;display:flex;justify-content:center;align-items:center;margin:5px;padding:5px}#emulateKeyUp{grid-area:1 / 2}#emulateKeyDown{grid-area:3 / 2}#emulateKeyLeft{grid-area:2 / 1}#emulateKeyRight{grid-area:2 / 3}#emulateKeyPlay{grid-area:1 / 5}#emulateKeyStop{grid-area:3 / 5}#emulateKeyStopUp{grid-area:1 / 8}#emulateKeyStopDown{grid-area:3 / 8}#emulateKeyStopLeft{grid-area:2 / 7}#emulateKeyStopRight{grid-area:2 / 9}#emulationNewTasksMode button.material-symbols-outlined{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksMode button:hover{background-color:#18a79b}#emulationNewTasksMode button:focus,#emulationNewTasksMode button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksMovement button.material-symbols-outlined{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksMovement button:hover{background-color:#18a79b}#emulationNewTasksMovement button:focus,#emulationNewTasksMovement button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksNumbers button{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700;font-family:monospace}#emulationNewTasksNumbers button:hover{background-color:#18a79b}#emulationNewTasksNumbers button:focus,#emulationNewTasksNumbers button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksOther button{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksOther button:hover{background-color:#18a79b}#emulationNewTasksOther button:focus,#emulationNewTasksOther button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}.emulated-button-list{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700!important}.standard-font{font-family:monospace!important}#emulationNewTasks{list-style-type:none;display:grid;grid-template-columns:repeat(11,1fr);grid-auto-rows:auto;gap:10px;padding:0;margin:0}#emulateKeySteps{transform:scaleX(-1)}.flexCol{display:flex;flex-direction:column;align-items:center;justify-content:center}.outerCol{padding-top:15px}.middleCol{align-self:flex-start}.task-container{margin:5px}.task-container>div,.gu-mirror{transition:opacity .4s ease-in-out}.task-container>div{padding:5px;cursor:move;cursor:grab;cursor:-moz-grab;cursor:-webkit-grab;display:flex;align-items:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.gu-mirror{padding:5px;text-align:center;cursor:grabbing;cursor:-moz-grabbing;cursor:-webkit-grabbing}.task-container .ex-moved{background-color:#e74c3c}.task-container.ex-over{background-color:#ffffff4d}.planner-save-text{max-width:none!important}.planner-save-button{flex:auto}.planner-load-select{max-width:none!important}.planner-load-delete-buttons{width:50%}.planner-saving-label{text-wrap:nowrap}.no-marge{margin:0}.task-modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.task-modal-content{position:relative;background-color:#242424;margin:15% auto;padding:20px;border:2px solid #6c5ce7;max-width:600px;min-width:600px}.center-modal{text-align:center}.icon-tooltip{position:relative;cursor:pointer}.icon-tooltip:after{content:attr(data-tooltip);position:absolute;bottom:100%;left:50%;transform:translate(-50%);white-space:nowrap;z-index:1;background-color:#000;color:#fff;padding:5px;border-radius:4px;opacity:0;visibility:hidden;transition:opacity .2s,visibility .2s}.icon-tooltip:hover:after{opacity:1;visibility:visible}.threading-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;width:800px;max-width:1280px;text-align:center;border:1px solid #ccc}.gu-mirror{position:fixed!important;margin:0!important;z-index:9999!important;opacity:.8}.gu-hide{display:none!important}.gu-unselectable{-webkit-user-select:none!important;-moz-user-select:none!important;-ms-user-select:none!important;user-select:none!important}.gu-transit{opacity:.2}

</style>
</head>

<body>

    <div id="mainContainer" class="main-container">
        <div class="menu">
            <ul>
                <li id="simulationTab">Simulation</li>
                <li id="controlTab">Control</li>
                <li id="plannerTab">Planner</li>
                <li id="threadingTab">Threading</li>
            </ul>
        </div>

        <div id="simulationContainer" class="main-container">
            <div id="simulationContent" class="controls-container">
                <div id="gcodeContainer" style="position: relative;">
                    <div id="gcodeEditor" style="height: 200px; width: 100%;"></div>
                </div>
                <div class="innerContainer">
                    <input type="file" id="fileInput" accept=".txt,.gcode">
                </div>
                <div class="innerContainer">
                    <button id="simulateButton">Simulate</button>
                    <button id="clearButton">Clear</button>
                    <button id="helpButton">How to use</button>
                </div>


                <div class="innerContainer" id="loadAndSave">


                    <hr>
                    <div class="innerContainer toolbar">
                        <input type="text" class="saveGCodeNameInput" placeholder="name of save"></input>
                        <button class="saveGCodeButton" title="Save GCode to local browser storage">Save local</button>
                    </div>
                    <div class="innerContainer toolbar">
                        <select class="loadGCodeSelect"></select>
                        <button class="loadGCodeButton" title="Load GCode from local browser storage">Load</button>
                        <button class="deleteGCodeButton" title="Delete GCode from local browser storage">Delete</button>
                    </div>
                    <hr>
                </div>
            </div>

            <div class="canvas-container">
                <canvas id="gcodeCanvas" width="785" height="600"></canvas>
                <div id="sliderContainer" class="innerContainer" style="display: none; width: 400px;">
                    <input type="range" id="progressSlider" min="0" max="100" value="0" style="width: 100%;">
                    <div id="sliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                </div>
                <div id="displayOptionsContainer" class="innerContainer" style="display: none;">
                    <input type="checkbox" id="showCuts" checked> Show Cut Moves
                    </label>
                    <label>
                        <input type="checkbox" id="showNonCuts" checked>
                        Show Non-Cut Moves
                    </label>
                </div>
                <div id="sliderContainer" class="innerContainer" style="display: none; width: 400px;">
                    <input type="range" id="progressSlider" min="0" max="100" value="0" style="width: 100%;">
                    <div id="sliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                </div>
                <div class="innerContainer"><button id="zoomButton" title="Zoom in">Zoom In</button></div>
            </div>

        </div>
        <div id="controlsContainer" class="main-container" style="display: none;">
            <div id="controlsContent" class="controls-container">
                <div id="gcodeSenderContainer" class="innerContainer">

                    <span>Send GCode to Nano ELS H4</span>

                    <div class="innerContainer">
                        <button id="connectButton" title="Connect to Nano ELS H4">Connect</button>
                    </div>
                </div>

                <div id="latheControls">
                    <div id="jogControls">
                        <span id="fastText">Fast</span>
                        <span id="slowText">Slow</span>
                        <span id="toolText">Tool</span>

                        <!-- Tools -->
                        <button class="tool-btn tool-selected" id="tool0">T0</button>
                        <button class="tool-btn" id="tool1">T1</button>
                        <button class="tool-btn" id="tool2">T2</button>
                        <button class="tool-btn" id="tool3">T3</button>
                        <button class="tool-btn" id="tool4">T4</button>
                        <button class="tool-btn" id="tool5">T5</button>
                        <button class="tool-btn" id="tool6">T6</button>
                        <button class="tool-btn" id="tool7">T7</button>
                        <button class="tool-btn" id="tool8">T8</button>
                        <button class="tool-btn" id="tool9">T9</button>

                        <span id="jogText">Move</span>
                        <!-- Fast arrows -->
                        <button class="arrow fast jog-btn" id="fastForward"><i class="fas fa-arrow-up"></i></button>
                        <button class="arrow fast jog-btn" id="fastBackward"><i class="fas fa-arrow-down"></i></button>
                        <button class="arrow fast jog-btn" id="fastLeft"><i class="fas fa-arrow-left"></i></button>
                        <button class="arrow fast jog-btn" id="fastRight"><i class="fas fa-arrow-right"></i></button>
                        <!-- Slow arrows -->
                        <button class="arrow slow jog-btn" id="slowForward"><i class="fas fa-arrow-up"></i></button>
                        <button class="arrow slow jog-btn" id="slowBackward"><i class="fas fa-arrow-down"></i></button>
                        <button class="arrow slow jog-btn" id="slowLeft"><i class="fas fa-arrow-left"></i></button>
                        <button class="arrow slow jog-btn" id="slowRight"><i class="fas fa-arrow-right"></i></button>
                    </div>
                    <div id="incrementControls">
                        <button class="increment-btn" data-increment="0.01">0.01</button>
                        <button class="increment-btn" data-increment="0.1">0.1</button>
                        <button class="increment-btn active" data-increment="1">1</button>
                        <button class="increment-btn" data-increment="10">10</button>
                    </div>
                    <div id="feedrateControls" class="innerContentCentre control-inputs">
                        <label for="fastFeedrate">Fast Feedrate:</label>
                        <input type="text" id="fastFeedrate" name="fastFeedrate" value="200">
                        <label for="slowFeedrate">Slow Feedrate:</label>
                        <input type="text" id="slowFeedrate" name="slowFeedrate" value="50">
                    </div>
                    <div id="distanceControl" class="innerContentCentre control-inputs">
                        <label for="moveDistance">Move Distance (mm):</label>
                        <input type="text" id="moveDistance" name="moveDistance" value="1">
                    </div>
                </div>

                <div id="gcodeResponseContainer" style="display: none;">
                    <div id="gcodeResponseHeader">GCode Responses</div>
                    <div id="gcodeResponseEditor" style="height: 200px; width: 100%;"></div>
                    <div class="senderError" style="display: none;"></div>
                    <div id="senderProgressContainer">
                        <span id="senderProgressLabel" style="display: none;">Progress...</span>
                        <progress id="senderProgress" max="1" style="display: none;"></progress>
                    </div>
                </div>
            </div>
            <div class="controls-container">
                <div class="innerContainer control-inputs">
                    <div class="innerContentCentre control-inputs">
                        <span>Send single command</span>
                    </div>
                    <div class="innerContentCentre sender-inputs">
                        <input id="singleCommandSender" type="text" name="singleCommandSender"></input>
                    </div>
                    <div class="innerContentCentre control-inputs">
                        <button id="gcodeSendSingleCommandButton" title="Send GCode to CNC">Send</button>
                    </div>
                </div>
            </div>
            <div class="controls-container">
                <div id="gcodeSenderContainer" style="position: relative;">
                    <span>Send multi line commands</span>
                    <div id="gcodeSenderEditor" style="height: 200px; width: 100%;"></div>
                </div>
                <div class="innerContainer">
                    <button id="gcodeSenderButton" title="Send GCode to CNC">Send</button>
                    <button id="stopButton" style="display: none;">Stop</button>
                </div>
            </div>
        </div>
        <div id="plannerContainer" class="main-container" style="display: none;">
            <div id="plannerContent" class="planner-container">
                <div class="innerContainer">
                    <h1>Planner</h1>
                    <div class="planner-guidance">
                        <span>Use this tool to create a job of tasks to execute. This can be manual, gcode, button press
                            emulation or a
                            combination
                            of them.
                            When you click execute the job wizard will execute the tasks one after another. Each task
                            with require confirmation to start.</span>
                    </div>
                </div>
                <div class="innerContainer">
                    <h1>Device status</h1>
                    <button id="plannerConnectButton">Connect</button>
                </div>
                <div id="taskContainer">
                    <div class="container-wrapper-outer">
                        <div class="container-wrapper">
                            <h2>Current Job</h2>
                            <span>Drag an available task to below</span>
                            <div id="tasksToExecute" class="task-container">
                            </div>
                        </div>
                        <div class="container-wrapper">
                            <button id="executeJobButton">Execute Job</button>
                        </div>
                        <hr>
                        <div class="container-wrapper">
                            <div class="innerContainer" id="loadAndSaveJob">
                                <div class="innerContainer toolbar">
                                    <button id="saveJobButton" class="planner-save-button" title="Save Job to local browser storage">Save
                                        Job</button>
                                </div>
                                <div class="innerContainer toolbar">
                                    <button id="loadJobToExecute" class="planner-load-delete-buttons" title="Load Job from local browser storage">Load</button>
                                    <button id="deleteJobToExecute" class="planner-load-delete-buttons" title="Delete Job from local browser storage">Delete</button>
                                </div>
                                <div class="innerContainer toolbar">
                                    <select id="jobLoadSelect" class="planner-load-select">
                                    </select>
                                </div>
                                <div class="container-wrapper-inner">
                                    <hr>
                                </div>
                                <span class="planner-saving-label">Import and export Job to JSON</span>
                                <div class="innerContainer toolbar">
                                    <button id="importJobToExecute" class="planner-load-delete-buttons" title="Import Job from JSON file">Import</button>
                                    <button id="exportJobToExecute" class="planner-load-delete-buttons" title="Export Job to JSON">Export</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="container-wrapper-outer">
                        <div class="container-wrapper">
                            <h2>Available Tasks</h2>
                            <div id="availableTasks" class="task-container">
                            </div>
                        </div>
                        <div class="container-wrapper">
                            <div class="container-wrapper-inner">
                                <span>Drag here to delete</span>
                            </div>
                            <div id="deleteTasks" class="container-wrapper-delete">
                            </div>
                        </div>
                        <div class="container-wrapper">
                            <button id="addNewTaskButton">Add New Task</button>
                        </div>
                        <div class="container-wrapper-inner">
                            <hr class="no-marge">
                        </div>
                        <div class="container-wrapper">
                            <div class="innerContainer" id="loadAndSaveAvailableTasks">
                                <div><span>Task Collections</span></div>
                                <div class="innerContainer toolbar">
                                    <button id='saveAvailableTaskCollection' class="planner-save-button" title="Save Task to local browser storage">Save tasks to a collection
                                        <i class="far fa-save show-info icon-tooltip"
                                            data-tooltip="Save to local machine"></i>
                                    </button>
                                </div>
                                <div class="innerContainer toolbar">
                                    <select id="availableTaskCollections" class="planner-load-select">
                                        <option value="" disabled>Select your option</option>
                                    </select>
                                </div>
                                <div class="innerContainer toolbar">
                                    <button id="loadTaskCollection" class="planner-load-delete-buttons" title="Load selected collection">Load collection</button>
                                    <button id="deleteTaskCollection" class="planner-load-delete-buttons" title="Delete selected collection">Delete collection</button>
                                </div>
                                <div class="container-wrapper-inner">
                                    <hr>
                                </div>
                                <span class="planner-saving-label">Import and export tasks via JSON</span>
                                <div class="innerContainer toolbar">
                                    <button id="importAvailableTasks" class="planner-load-delete-buttons" title="Import tasks from JSON file">Import</button>
                                    <button id="exportAvailableTasks" class="planner-load-delete-buttons" title="Export tasks to JSON">Export</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="threadingContainer" class="main-container" style="display: none;">
            <div id="threadingContent" class="threading-container">Coming soon.</div>
        </div>
        <!-- Not Connected warning -->
        <div id="notConnectedModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Not Connected</h2>
                <div class="modal-pad-bottom">
                    <span>Please connect to the controller before executing jobs</span>
                </div>
                <div class="modal-pad">
                    <button id="notConnectedCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Manual Task Modal -->
        <div id="manualTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>Manual Task Instructions</h2>
                <hr>
                <div>
                    <span id="manualTaskName"></span>
                </div>
                <div class="modal-pad">
                    <textarea id="manualTaskInstructions" name="manualTaskInstructions" rows="4" cols="50" disabled></textarea>
                </div>
                <div class="modal-pad">
                    <button id="cancelManualTask">Cancel</button>
                    <button id="completeManualTask">Next Task --></button>
                </div>
            </div>
        </div>
        <!-- Gcode Task Modal -->
        <div id="cncTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>CNC Task Gcode</h2>
                <hr>
                <div>
                    <span id="cncTaskName"></span>
                </div>
                <div class="modal-pad">
                    <textarea id="cncTaskGcode" name="cncTaskGcode" rows="4" cols="50" disabled></textarea>
                </div>
                <div class="modal-pad">
                    <button id="cancelCncTask">Cancel</button>
                    <button id="executeGcode">Execute Gcode</button>
                </div>
                <div class="modal-pad">
                    <button id="completeCncTask" disabled>Next Task --></button>
                </div>
                <div id="cncTaskSenderProgressContainer" class="modal-pad">
                    <span id="cncTaskSenderProgressLabel">Execution in progress...</span>
                    <progress id="cncTaskSenderProgress" max="1"></progress>
                </div>
            </div>
        </div>
        <!-- key Emulation Task Modal -->
        <div id="emulationTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>Key Emulation Task</h2>
                <hr>
                <div>
                    <span id="emulationTaskName"></span>
                </div>
                <div class="modal-pad">
                    <ul id="emulationExecutionTasks">
                        <!-- List items will be added here -->
                    </ul>
                    <div class="modal-pad">
                        <button id="completeEmulationTask" disabled>Mark Complete</button>
                    </div>
                    <div id="emulationTaskSenderProgressContainer" class="modal-pad">
                        <span id="emulationTaskSenderProgressLabel">Execution in progress...</span>
                        <progress id="emulationTaskSenderProgress" max="1"></progress>
                    </div>
                </div>
            </div>
        </div>
        <!-- All tasks Complete Modal -->
        <div id="completeTaskModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>All Tasks Complete</h2>
                <div class="modal-pad">
                    <button id="completeTaskCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Job Cancelled Modal -->
        <div id="jobCancelledModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Job Cancelled</h2>
                <div>
                    <button id="jobCancelledCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Save Job Modal -->
        <div id="saveJobModal" class="task-modal">
            <div class="task-modal-content">
                <span id="saveJobModalClose" class="close-modal">&times;</span>
                <h2>Save Job</h2>
                <hr>
                <div>
                    <input id="saveJobNameInput" type="text" class="planner-save-text" placeholder="Name of Job"></input>
                </div>
                <div class="modal-pad">
                    <button id="saveJobSaveButton">Save</button>
                </div>
            </div>
        </div>
        <!-- Save Collection -->
        <div id="saveCollectionModal" class="task-modal">
            <div class="task-modal-content">
                <span id="saveCollectionModalClose" class="close-modal">&times;</span>
                <div>
                    <div>Which collection would you like to save the tasks to?</div>
                    <div class="modal-pad">
                        <select id="saveCollectionModalToSaveTo" name="collectionToSaveToModal">
                        </select>
                    </div>
                    <div id="newCollectionNameContainerModal" style="display: none;">
                        <div class="modal-pad">New Collection Name:</div>
                        <div>
                            <input type="text" id="newCollectionNameModal" name="newCollectionNameModal" placeholder="Enter collection name...">
                        </div>
                    </div>

                    <div class="modal-pad">
                        <button id="saveAvailableTaskCollectionButtonModal">Save</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- new task modal-->
        <div id="newTaskModal" class="task-modal">
            <div class="task-modal-content">
                <span id="closeNewTaskModal" class="close-modal">&times;</span>
                <div id="newTaskHelpText">
                    <h2 id="taskTextTitle">Add a new task</h2>
                    <hr>
                    <div class="modal-pad">Task Name:</div>
                    <div>
                        <input type="text" id="newTaskName" name="newTaskName" placeholder="Enter task name...">
                    </div>
                    <div class="modal-pad">Task Type:</div>
                    <div>
                        <select id="newTaskType" name="newTaskType">
                            <option value="manual">Manual</option>
                            <option value="gcode">GCode</option>
                            <option value="emulation" disabled>Key Emulation</option>
                        </select>
                    </div>
                    <div class="modal-pad">Task Description:</div>
                    <div>
                        <textarea id="newTaskDescription" name="newTaskDescription" rows="4" cols="50" placeholder="Enter Description..."></textarea>
                    </div>
                    <div id="gcodeTaskContainer" style="display:none">
                        <div class="modal-pad">Task GCode:</div>
                        <div>
                            <textarea id="newTaskGcode" name="newTaskGcode" rows="4" cols="50" placeholder="Disabled for manual tasks" disabled></textarea>
                        </div>
                    </div>
                    <div id="emulationOuterContainer" class="emulate-noselect" style="display:none">
                        <div>
                            <span>Use built in controller functions by emulating button presses
                                Simply click the buttons you want to emulate to build up a sequence which will be
                                displayed at the bottom. Each emulated press will have a 500ms delay between them.
                                <br>
                                <br>
                                <i>Tip: Hover over the buttons for a description.</i>
                            </span>
                        </div>
                        <div id="emulationInnerContainer">
                            <div class="flexCol outerCol">
                                <div id="numberContainer">
                                    <div id="emulationNewTasksNumbers">
                                        <button id="emulateKey9" data-button-key="B_9" class="standard-font material-symbols-outlined">
                                            9
                                        </button>
                                        <button id="emulateKey8" data-button-key="B_8" class="standard-font material-symbols-outlined">
                                            8
                                        </button>
                                        <button id="emulateKey7" data-button-key="B_7" class="standard-font material-symbols-outlined">
                                            7
                                        </button>
                                        <button id="emulateKey6" data-button-key="B_6" class="standard-font material-symbols-outlined">
                                            6
                                        </button>
                                        <button id="emulateKey5" data-button-key="B_5" class="standard-font material-symbols-outlined">
                                            5
                                        </button>
                                        <button id="emulateKey4" data-button-key="B_4" class="standard-font material-symbols-outlined">
                                            4
                                        </button>
                                        <button id="emulateKey3" data-button-key="B_3" class="standard-font material-symbols-outlined">
                                            3
                                        </button>
                                        <button id="emulateKey2" data-button-key="B_2" class="standard-font material-symbols-outlined">
                                            2
                                        </button>
                                        <button id="emulateKey1" data-button-key="B_1" class="standard-font material-symbols-outlined">
                                            1
                                        </button>
                                        <button id="emulateKey0" data-button-key="B_0" class="standard-font material-symbols-outlined">
                                            0
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="flexCol middleCol">
                                <div id="modeContainer">
                                    <div id="emulationNewTasksMode">
                                        <button id="emulateKeyBack" data-button-key="B_BACKSPACE" class="material-symbols-outlined">
                                            backspace
                                        </button>
                                        <button id="emulateKeyGearbox" data-button-key="B_MODE_GEARS" class="material-symbols-outlined">
                                            manufacturing
                                        </button>
                                        <button id="emulateKeyTurning" data-button-key="B_MODE_TURN" class="material-symbols-outlined">
                                            reply
                                        </button>
                                        <button id="emulateKeyFacing" data-button-key="B_MODE_FACE" class="material-symbols-outlined">
                                            turn_slight_left
                                        </button>
                                        <button id="emulateKeyCone" data-button-key="B_MODE_CONE" class="material-symbols-outlined">
                                            arrow_forward_ios
                                        </button>
                                        <button id="emulateKeyParting" data-button-key="B_MODE_CUT" class="material-symbols-outlined">
                                            publish
                                        </button>
                                        <button id="emulateKeyThreading" data-button-key="B_MODE_THREAD" class="material-symbols-outlined">
                                            home_improvement_and_tools
                                        </button>
                                        <button id="emulateKeyMode" data-button-key="B_MODE_OTHER" class="standard-font material-symbols-outlined">
                                            M
                                        </button>
                                    </div>
                                </div>
                                <div id="movementContainer">
                                    <div id="emulationNewTasksMovement">
                                        <button id="emulateKeyLeft" data-button-key="B_LEFT" class="material-symbols-outlined">
                                            arrow_left_alt
                                        </button>
                                        <button id="emulateKeyRight" data-button-key="B_RIGHT" class="material-symbols-outlined">
                                            arrow_right_alt
                                        </button>
                                        <button id="emulateKeyUp" data-button-key="B_UP" class="material-symbols-outlined">
                                            arrow_upward_alt
                                        </button>
                                        <button id="emulateKeyDown" data-button-key="B_DOWN" class="material-symbols-outlined">
                                            arrow_downward_alt
                                        </button>
                                        <button id="emulateKeyPlay" data-button-key="B_ON" class="material-symbols-outlined">
                                            play_arrow
                                        </button>
                                        <button id="emulateKeyStop" data-button-key="B_OFF" class="material-symbols-outlined">
                                            crop_square
                                        </button>
                                        <button id="emulateKeyStopLeft" data-button-key="B_STOPL" class="material-symbols-outlined">
                                            keyboard_tab_rtl
                                        </button>
                                        <button id="emulateKeyStopRight" data-button-key="B_STOPR" class="material-symbols-outlined">
                                            keyboard_tab
                                        </button>
                                        <button id="emulateKeyStopUp" data-button-key="B_STOPU" class="material-symbols-outlined">
                                            vertical_align_top
                                        </button>
                                        <button id="emulateKeyStopDown" data-button-key="B_STOPD" class="material-symbols-outlined">
                                            vertical_align_bottom
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="flexCol outerCol">
                                <div id="otherContainer">
                                    <div id="emulationNewTasksOther">
                                        <button id="emulateKeyZ" data-button-key="B_Z" class="standard-font material-symbols-outlined">
                                            Z
                                        </button>
                                        <button id="emulateKeyX" data-button-key="B_X" class="standard-font material-symbols-outlined">
                                            X
                                        </button>
                                        <button id="emulateKeyB" data-button-key="B_B" class="standard-font material-symbols-outlined">
                                            B
                                        </button>
                                        <button id="emulateKeyA" data-button-key="B_A" class="standard-font material-symbols-outlined">
                                            A
                                        </button>
                                        <button id="emulateKeyAngle" data-button-key="B_DISPL" class="material-symbols-outlined" title="Angle/Taco">
                                            rotate_left
                                        </button>
                                        <button id="emulateKeySteps" data-button-key="B_STEPZ" class="material-symbols-outlined">
                                            signal_cellular_alt
                                        </button>
                                        <button id="emulateKeySettings" data-button-key="B_SETTINGS" class="material-symbols-outlined">
                                            settings
                                        </button>
                                        <button id="emulateKeyReverse" data-button-key="B_REVERSE" class="material-symbols-outlined">
                                            sync_alt
                                        </button>
                                        <button id="emulateKeyMeasure" data-button-key="B_MEASURE" class="material-symbols-outlined">
                                            space_bar
                                        </button>
                                        <button id="emulateKeyPlus" data-button-key="B_PLUS" class="standard-font material-symbols-outlined">
                                            +
                                        </button>
                                        <button id="emulateKeyMinus" data-button-key="B_MINUS" class="standard-font material-symbols-outlined">
                                            -
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <span>
                                Emulated sequence: <i>Tip: Drag to reorder or delete</i>
                            </span>
                        </div>
                        <div class="emulation-modal-pad-border">
                            <div id="emulationNewTasks">
                            </div>
                        </div>
                        <div class="modal-pad-bottom">
                            <div id="emulatedTasksDelete" class="container-wrapper-inner">
                                <span>
                                    Drag here to delete
                                </span>
                            </div>
                            <div id="emulatedButtonListDelete" class="container-wrapper-delete">

                            </div>
                        </div>
                    </div>
                    <div class="modal-pad">Collection to save to:</div>
                    <div>
                        <select id="collectionToSaveTo" name="collectionToSaveTo">
                        </select>
                    </div>
                    <div id="newCollectionNameContainer" style="display: none;">
                        <div class="modal-pad">New Collection Name:</div>
                        <div>
                            <input type="text" id="newCollectionName" name="newCollectionName" placeholder="Enter collection name...">
                        </div>
                    </div>
                    <div class="modal-pad">
                        <button id="saveNewTaskButton">Save</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="helpModal" class="help-modal">
            <div class="help-modal-content">
                <span id="closeHelpModal" class="close-modal">&times;</span>
                <div id="helpText">
                    <div>This tool is designed to be used in conjunction with LatheCode:</div>
                    <div><a href="https://kachurovskiy.github.io/lathecode/ " target="_blank ">https://kachurovskiy.github.io/lathecode/</a></div>
                    <div><strong>Please note that this tool is to be used at your own risk and I cannot gaurentee that
                            it will work. This tool targets my custom fork of the H4 firmware which you can find
                            here:</strong> <a href="https://github.com/Festivejelly/nanoels" target="_blank ">https://github.com/Festivejelly/nanoels</a></div>
                    <hr>
                    <div>How to use:</div>
                    <ul style="list-style-type: disc; padding-left: 20px; ">
                        <li>Use LatheCode to generate the G-code, then paste it into this tool.</li>
                        <li>You can also write the G-code by hand for simple operations such as boring or grooving.
                            <a href="# " id="exampleCode">Click here</a> to load an example.
                        </li>
                        <li>Click "Simulate" to plot the moves onto the canvas.</li>
                        <li>movement lines marked with "; cut" will show in <span class="line red-line"></span><span class="text-red">red</span>.</li>
                        <li>movement lines marked with "; travel" will show in <span class="line green-line"></span><span class="text-green">green</span>.</li>
                        <li>movement lines marked with "; retract" will show in <span class="line orange-line"></span><span class="text-orange">orange</span>.</li>
                        <li>movement lines not marked will default to <span class="line green-line"></span><span class="text-green">green</span>.</li>
                        <li>All other moves will be considered travel moves and will show in green.</li>
                        <li>Any G-code you paste or write can be saved into the browser's local storage. This is useful for saving common operations.</li>
                        <li>When you're ready, you can send the G-code to the Nano ELS H4 by clicking "Send."
                        </li>
                        <li>More functionality to come soon! Version 0.2</li>
                        <li>Please provide feedback, raise issues or make suggestions here: <a href="https://github.com/Festivejelly/LatheGcodeVisualiser " target="_blank ">https://github.com/Festivejelly/LatheGcodeVisualiser</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="zoomModal" class="zoom-modal">
            <div class="zoom-modal-content" style="background-color: #242424;">
                <span id="closeZoomModal" class="close-modal">&times;</span>
                <canvas id="zoomCanvas" width="1600 " height="1200 "></canvas>
                <div id="sliderAndButtonContainer">
                    <div id="zoomSliderContainer" class="innerContainer" style="width: 400px;">
                        <input type="range" id="zoomProgressSlider" min="0" max="100" value="0" style="width: 100%;">
                        <div id="zoomSliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                    </div>
                    <div id="displayOptionsContainerZoom" class="innerContainer">
                        <input type="checkbox" id="showCutsZoom" checked> Show Cut Moves
                        </label>
                        <label>
                            <input type="checkbox" id="showNonCutsZoom" checked>
                            Show Non-Cut Moves
                        </label>
                    </div>
                    <button id="zoomCloseButton">Close</button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>