<!DOCTYPE html>
<html>

<head>
    <title>G-Code Visualizer</title>
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚙️</text></svg>">
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/ace.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <script type="module" crossorigin>
var Bo=Object.defineProperty;var Io=(o,e,n)=>e in o?Bo(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n;var N=(o,e,n)=>Io(o,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))t(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&t(c)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();var X=(o=>(o.GCODE="gcode",o.PLANNER="planner",o.QUICKTASKS="quicktasks",o))(X||{});class xo{constructor(e,n,t,a,r,c,I,p,S,B,P,E,L,d,f,y){this.isConnected=e,this.condition=n,this.error=t,this.progress=a,this.currentLine=r,this.feedRate=c,this.z=I,this.x=p,this.y=S,this.mZ=B,this.mX=P,this.mY=E,this.feed=L,this.rpm=d,this.version=f,this.lastResponse=y}}let Ft=!1;const Ve=class Ve{constructor(){N(this,"listeners",[]);N(this,"activeClient",null);N(this,"port",null);N(this,"readTimeout",0);N(this,"reader",null);N(this,"writer",null);N(this,"isOn",!1);N(this,"waitForOkOrError",!1);N(this,"lines",[]);N(this,"lineIndex",0);N(this,"unparsedResponse","");N(this,"remainingResponse","");N(this,"error","");N(this,"statusReceived",!1);N(this,"currentLine","");N(this,"feedRate",0);N(this,"z",0);N(this,"x",0);N(this,"y",0);N(this,"mZ",0);N(this,"mX",0);N(this,"mY",0);N(this,"feed",0);N(this,"rpm",0);N(this,"isDisconnecting",!1);N(this,"lastStatus",null);N(this,"version","");N(this,"lastResponse","");N(this,"currentCommandListeners",[]);N(this,"remainingStatus","");localStorage.getItem("SenderDebug")==="true"?Ft=!0:(localStorage.getItem("SenderDebug"),Ft=!1)}static getInstance(){return Ve.instance||(Ve.instance=new Ve),Ve.instance}setActiveClient(e){this.activeClient=e,this.log(`Active client set to: ${e}`)}clearActiveClient(){this.activeClient=null,this.log("Active client cleared")}getStatus(){return this.lastStatus=new xo(this.port!==null,this.isOn?"run":"idle",this.error,this.lines.length?this.lineIndex/this.lines.length:0,this.currentLine,this.feedRate,this.z,this.x,this.y,this.mZ,this.mX,this.mY,this.feed,this.rpm,this.version,this.lastResponse),this.lastStatus}getCurrentCommand(){return this.currentLine}addStatusChangeListener(e,n){this.listeners.push({callback:e,client:n})}notifyStatusChange(){this.listeners.forEach(e=>{e.client===this.activeClient?(this.log(`Notifying ${e.client} listener`),e.callback()):this.log(`Skipping ${e.client} listener (not active)`)})}addCurrentCommandListener(e){this.currentCommandListeners.push(e)}notifyCurrentCommand(e){this.currentCommandListeners.forEach(n=>n(e))}setStatus(e){if(e=this.remainingStatus+e,this.remainingStatus="",e.startsWith("<")&&(e=e.substring(1)),e.endsWith(">"))e=e.slice(0,-1);else{this.remainingStatus=e;return}const n=e.split("|");if(n.length>=3){if(this.statusReceived=!0,n[1].startsWith("WPos:")){const t=n[1].substring(5).split(",");this.x=Number(t[0]),this.y=Number(t[1]),this.z=Number(t[2])}if(n[2].startsWith("MPos:")){const t=n[2].substring(5).split(",");this.mX=Number(t[0]),this.mY=Number(t[1]),this.mZ=Number(t[2])}if(n[3].startsWith("FS:")){const t=n[3].substring(3).split(",");this.feed=Number(t[0]),this.rpm=Number(t[1])}n[4].startsWith("Id:")&&(this.version=String(n[4].substring(3)))}this.notifyStatusChange(),lt(`response: ${e}`),this.log(`response: "${e}"`)}log(e,...n){Ft&&console.log(e,...n)}setError(e){this.error=e,lt(e),this.notifyStatusChange()}isConnected(){return this.lastStatus!==null&&this.lastStatus.isConnected}async connect(){try{if(this.setActiveClient("gcode"),this.port)this.closePort();else{if(await this.selectPort(),this.write("!"),await this.askForStatus(),!await Fn(()=>this.statusReceived)){this.setError("Device is not reponding, is it in GCODE mode?");return}this.isDisconnecting=!1,this.isOn=!1,this.setError(""),this.waitForOkOrError=!1,this.unparsedResponse=""}}catch(e){console.error(e)}this.notifyStatusChange()}async disconnect(){this.isDisconnecting=!0,this.port&&this.closePort()}getDisconnectingStatus(){return this.isDisconnecting}async start(e,n){e&&(this.setActiveClient(n),this.isOn=!0,this.lines=e.split(`
`),this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange())}async sendCommand(e,n){this.setActiveClient(n),this.isOn=!0,this.lines=[e],this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange()}async sendCommands(e,n){this.setActiveClient(n),this.isOn=!0,this.lines=e,this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange()}async getPosition(e){if(this.setActiveClient(e),this.statusReceived=!1,await this.write("?"),!await Fn(()=>this.statusReceived))throw new Error("Failed to get position update");return this.notifyStatusChange(),this.getStatus()}async getToolOffsets(e){if(this.setActiveClient(e),this.lastResponse="",await this.sendCommand("#",e),!await wo(()=>this.lastResponse.includes("toolOffsets:")&&this.lastResponse.includes("ok"),50,100))throw new Error("Failed to get tool offsets");return this.stop(),this.lastResponse}async stop(){this.error="",await this.write("!"),this.isOn&&(this.isOn=!1,this.notifyStatusChange(),this.clearActiveClient())}async write(e){if(this.port){if(this.log("command: ",e),!this.port.writable){e!="?"&&this.setError("Port is not writable, try reconnecting the USB and switching to GCODE mode.");return}if(!this.writer)try{const n=new TextEncoderStream;n.readable.pipeTo(this.port.writable),this.writer=n.writable.getWriter()}catch(n){this.setError("Failed to write: "+n);return}await this.writer.write(e)}}async writeCurrentLine(){if(!this.isOn||this.waitForOkOrError)return;if(this.lineIndex>=this.lines.length){this.stop();return}const e=this.lines[this.lineIndex].split(";")[0].trim();if(!e){this.lineIndex++,this.writeCurrentLine();return}this.currentLine=e,this.notifyCurrentCommand(this.currentLine),this.waitForOkOrError=!0,lt(`command: ${e}`),await this.write(e+`
`),await this.readFromPort()}async processResponse(e){this.unparsedResponse=(this.remainingResponse+e).trimStart(),this.remainingResponse="";const n=this.unparsedResponse.split(/\r?\n/).map(t=>t.replace(/\r/g,""));for(let t of n){const a=t.match(/(<[^>]+>)/);if(a&&a.length>1){a.shift();for(const r of a)t=t.replace(r,"");this.setStatus(a.pop())}t.startsWith("error:")?(this.remainingResponse+=t,lt(`response: ${this.remainingResponse}`),this.log(`response: "${this.remainingResponse}"`),this.setError(t),this.remainingResponse="",this.stop()):t.startsWith("ok")||t.endsWith("ok")?(this.remainingResponse+=t,lt(`response: ${this.remainingResponse}`),this.lastResponse=this.remainingResponse,this.log(`response: "${this.remainingResponse}"`),this.remainingResponse="",this.waitForOkOrError=!1,this.lineIndex++,this.notifyStatusChange(),this.isOn&&await this.writeCurrentLine()):this.remainingResponse+=t}this.unparsedResponse=""}async selectPort(){if(this.port&&this.closePort(),navigator.serial?this.port=await navigator.serial.requestPort():(this.error="This browser does not support Serial API, try Chrome or Edge",this.notifyStatusChange()),this.port)try{await this.port.open({baudRate:115200}),this.notifyStatusChange(),this.readSoon()}catch(e){this.setError(`Unable to open port - likely some other app is using it - try closing Arduino IDE.
${e}`),this.closePort()}}async askForStatus(){try{await this.write("?")}catch(e){this.setError(`Device disconnected? ${e}`),this.closePort()}}readSoon(){clearTimeout(this.readTimeout),this.readTimeout=window.setTimeout(()=>this.readFromPort(),200)}async readFromPort(){if(this.port)try{if(!this.port.readable){this.readSoon();return}if(!this.reader){const n=new TextDecoderStream;this.port.readable.pipeTo(n.writable),this.reader=n.readable.getReader()}const{value:e}=await this.reader.read();if(!e){this.readSoon();return}await this.processResponse(e),this.readSoon()}catch(e){this.setError(e.message||String(e)),this.closePort()}}async closePort(){if(this.port){if(clearTimeout(this.readTimeout),this.reader){try{await this.reader.cancel(),this.reader.releaseLock()}catch(e){console.error("Error cancelling reader: ",e)}this.reader=null}if(this.writer){try{await this.writer.close(),this.writer.releaseLock()}catch(e){console.error("Error closing writer: ",e)}this.writer=null}await new Promise(e=>setTimeout(e,500));try{await this.port.close()}catch(e){console.error("Error closing port: ",e)}this.port=null,this.statusReceived=!1,this.z=0,this.x=0,this.feed=0,this.rpm=0}}};N(Ve,"instance",null);let Tt=Ve;function lt(o){var e=we.getSession(),n=e.getLength(),t=new Date().toLocaleTimeString(),a=`[${t}] ${o}
`;e.insert({row:n,column:0},a)}function Fn(o){return new Promise(e=>{let n=0;function t(){o()?e(!0):n>=10?e(!1):(n++,setTimeout(t,100))}t()})}function wo(o,e=50,n=100){return new Promise(t=>{let a=0;function r(){o()?t(!0):a>=e?t(!1):(a++,setTimeout(r,n))}r()})}const So=[{command:"?",description:"Get position and version info"},{command:"#",description:"Display tool offsets"},{command:"!",description:"Stop running Gcode"},{command:"~",description:"Continue running Gcode"},{command:"M17 Y",description:"Enable Y axis"},{command:"M18 Y",description:"Disable Y axis"},{command:"G90",description:"Set to absolute positioning"},{command:"G91",description:"Set to relative positioning"},{command:"G92 X0 Z0",description:"Sets X and Z axis to 0 at current position"},{command:"M905 X0.05 Z0.04",description:"Sets backlash compensation values in mm"},{command:"G28.1",description:"Set machine zero at current position (all axes)"},{command:"G28.1 Z",description:"Set machine zero for Z axis only"},{command:"G28.1 X",description:"Set machine zero for X axis only"},{command:"G28.3 X0 Z0",description:"Set machine coordinates X=0, Z=0 at current position"},{command:"G28.3 Z-12.5",description:"Set machine Z coordinate (accounting for probe length)"},{command:"G28",description:"Move to machine zero (home position)"},{command:"G28 Z",description:"Move Z axis to machine zero only"},{command:"G53 Z-25",description:"Move to machine coordinate Z=-25mm"},{command:"G53 X-10 Z-25",description:"Move to machine coordinates X=-10, Z=-25"}];class Fo{constructor(){N(this,"sendButton");N(this,"sendSingleCommandButton");N(this,"stopButton");N(this,"senderError");N(this,"runProgress");N(this,"runProgressLabel");N(this,"connectButton");N(this,"gcodeResponseContainer");N(this,"jogButtons");N(this,"toolButtons");N(this,"sender");N(this,"singleCommandSender");N(this,"editTools");N(this,"editToolsModal");N(this,"editToolsClose");N(this,"editToolSaveAll");N(this,"fastFeedrateInput");N(this,"slowFeedrateInput");N(this,"moveDistanceInput");N(this,"mposCurrentPositionValue");N(this,"wposCurrentPositionValue");N(this,"getPositionButton");const e=document.getElementById("singleCommandSender");e.placeholder="Type or select G-code command...",e.addEventListener("click",()=>{let d=document.getElementById("gcode-dropdown");if(!d){d=document.createElement("div"),d.id="gcode-dropdown",d.className="gcode-dropdown",So.forEach(({command:y,description:b})=>{const s=document.createElement("div");s.textContent=`${y} - ${b}`,s.className="gcode-option",s.addEventListener("click",()=>{e.value=y,d.remove()}),d.appendChild(s)});const f=e.getBoundingClientRect();d.style.left=f.left+"px",d.style.top=f.bottom+2+"px",d.style.width=f.width+"px",document.body.appendChild(d)}}),document.addEventListener("click",d=>{const f=document.getElementById("gcode-dropdown");f&&!e.contains(d.target)&&!f.contains(d.target)&&f.remove()}),this.senderError=document.querySelector(".senderError"),this.runProgress=document.getElementById("senderProgress"),this.runProgressLabel=document.getElementById("senderProgressLabel"),this.connectButton=document.getElementById("connectButton"),this.gcodeResponseContainer=document.getElementById("gcodeResponseContainer"),this.moveDistanceInput=document.getElementById("moveDistance"),this.fastFeedrateInput=document.getElementById("fastFeedrate"),this.slowFeedrateInput=document.getElementById("slowFeedrate"),this.jogButtons=document.querySelectorAll("#latheControls .jog-btn"),this.toolButtons=document.querySelectorAll("#latheControls .tool-btn"),this.sendButton=document.getElementById("gcodeSenderButton"),this.sendSingleCommandButton=document.getElementById("gcodeSendSingleCommandButton"),this.singleCommandSender=document.getElementById("singleCommandSender"),this.getPositionButton=document.getElementById("getPositionButton"),this.mposCurrentPositionValue=document.getElementById("mposCurrentPositionValue"),this.wposCurrentPositionValue=document.getElementById("wposCurrentPositionValue"),this.sender=Tt.getInstance(),this.sender.addStatusChangeListener(()=>this.handleStatusChange(),X.GCODE),this.getPositionButton.addEventListener("click",async()=>{const d=await this.sender.getPosition(X.GCODE);d&&(this.mposCurrentPositionValue.value=`X${d.mX.toFixed(3)} Y${d.mY.toFixed(3)} Z${d.mZ.toFixed(3)}`,this.wposCurrentPositionValue.value=`X${d.x.toFixed(3)} Y${d.y.toFixed(3)} Z${d.z.toFixed(3)}`)});let n=localStorage.getItem("fastFeedrate"),t=localStorage.getItem("slowFeedrate"),a=localStorage.getItem("moveDistance");n&&(this.fastFeedrateInput.value=n,localStorage.setItem("fastFeedrate",n)),t&&(this.slowFeedrateInput.value=t,localStorage.setItem("slowFeedrate",t)),a&&(this.moveDistanceInput.value=a,localStorage.setItem("moveDistance",a)),this.fastFeedrateInput.addEventListener("change",()=>{localStorage.setItem("fastFeedrate",this.fastFeedrateInput.value)}),this.slowFeedrateInput.addEventListener("change",()=>{localStorage.setItem("slowFeedrate",this.slowFeedrateInput.value)}),this.moveDistanceInput.addEventListener("change",()=>{localStorage.setItem("moveDistance",this.moveDistanceInput.value)}),this.jogButtons.forEach(d=>{d.addEventListener("click",()=>{var v;if(!((v=this.sender)!=null&&v.isConnected())){alert("Please connect to the controller first.");return}let f="",y="",b="",s=!0;d.id=="fastForward"?(f=this.fastFeedrateInput.value,y="X",b=this.moveDistanceInput.value,s=!0):d.id=="slowForward"?(f=this.slowFeedrateInput.value,y="X",b=this.moveDistanceInput.value,s=!0):d.id=="fastBackward"?(f=this.fastFeedrateInput.value,y="X",b=this.moveDistanceInput.value,s=!1):d.id=="slowBackward"?(f=this.slowFeedrateInput.value,y="X",b=this.moveDistanceInput.value,s=!1):d.id=="fastLeft"?(f=this.fastFeedrateInput.value,y="Z",b=this.moveDistanceInput.value,s=!0):d.id=="slowLeft"?(f=this.slowFeedrateInput.value,y="Z",b=this.moveDistanceInput.value,s=!0):d.id=="fastRight"?(f=this.fastFeedrateInput.value,y="Z",b=this.moveDistanceInput.value,s=!1):d.id=="slowRight"?(f=this.slowFeedrateInput.value,y="Z",b=this.moveDistanceInput.value,s=!1):d.id=="fastUp"?(f=this.fastFeedrateInput.value,y="Y",b=this.moveDistanceInput.value,s=!0):d.id=="slowUp"?(f=this.slowFeedrateInput.value,y="Y",b=this.moveDistanceInput.value,s=!0):d.id=="fastDown"?(f=this.fastFeedrateInput.value,y="Y",b=this.moveDistanceInput.value,s=!1):d.id=="slowDown"&&(f=this.slowFeedrateInput.value,y="Y",b=this.moveDistanceInput.value,s=!1);let u=`G0 ${y}${s===!0?"":"-"}${b} F${f}`;if(this.sender){let m=new Array(3);m[0]="G91",m[1]=u,m[2]="G90",this.sender.sendCommands(m,X.GCODE)}})});const r=document.getElementById("toolChange"),c=document.getElementById("toolSelector");r.addEventListener("click",()=>{var f;if(!((f=this.sender)!=null&&f.isConnected())){alert("Please connect to the controller first.");return}let d=new Array(1);d[0]=c.value,this.sender&&this.sender.sendCommands(d,X.GCODE)});const I=document.getElementById("MposZeroZ"),p=document.getElementById("MposZeroX"),S=document.getElementById("MposZeroY"),B=document.getElementById("WposZeroZ"),P=document.getElementById("WposZeroX"),E=document.getElementById("WposZeroY");I.addEventListener("click",()=>{var d;if(!((d=this.sender)!=null&&d.isConnected())){alert("Please connect to the controller first.");return}this.sender.sendCommand("G28.1 Z",X.GCODE)}),p.addEventListener("click",()=>{var d;if(!((d=this.sender)!=null&&d.isConnected())){alert("Please connect to the controller first.");return}this.sender.sendCommand("G28.1 X",X.GCODE)}),S.addEventListener("click",()=>{var d;if(!((d=this.sender)!=null&&d.isConnected())){alert("Please connect to the controller first.");return}this.sender.sendCommand("G28.1 Y",X.GCODE)}),B.addEventListener("click",()=>{var d;if(!((d=this.sender)!=null&&d.isConnected())){alert("Please connect to the controller first.");return}this.sender.sendCommand("G92 Z0",X.GCODE)}),P.addEventListener("click",()=>{var d;if(!((d=this.sender)!=null&&d.isConnected())){alert("Please connect to the controller first.");return}this.sender.sendCommand("G92 X0",X.GCODE)}),E.addEventListener("click",()=>{var d;if(!((d=this.sender)!=null&&d.isConnected())){alert("Please connect to the controller first.");return}this.sender.sendCommand("G92 Y0",X.GCODE)}),this.editTools=document.getElementById("editToolsButton"),this.editToolsModal=document.getElementById("editToolsModal"),this.editToolsClose=document.getElementById("editToolsModalCloseButton"),this.editToolSaveAll=document.getElementById("editToolSaveAll"),this.editTools.addEventListener("click",async()=>{var d;if(!((d=this.sender)!=null&&d.isConnected())){alert("Please connect to the controller first.");return}if(this.editToolsModal.style.display="block",this.sender){const f=document.getElementById("toolOffsetTableBody");f&&(f.innerHTML="");const y=await this.sender.getToolOffsets(X.GCODE);L(y).forEach(s=>{s.tool!=0&&this.addToolRow(s.tool,s.z,s.x,s.w,s.u)}),console.log("Tool Offsets As Response: "+y)}}),this.editToolSaveAll.addEventListener("click",()=>{var b;if(!((b=this.sender)!=null&&b.isConnected())){alert("Please connect to the controller first.");return}const d=document.getElementById("toolOffsetTableBody");if(!d)return;const f=d.children,y=new Array(f.length);for(let s=0;s<f.length;s++){const l=f[s],u=parseInt(l.children[0].children[0].value.replace("T","")),v=parseFloat(l.children[1].children[0].value),m=parseFloat(l.children[2].children[0].value),h=parseFloat(l.children[3].children[0].value),i=parseFloat(l.children[4].children[0].value);y[s]=`G10 P${u} Z${v} X${h} W${m} U${i}`}this.sender&&this.sender.sendCommands(y,X.GCODE)});const L=d=>d.replace("toolOffsets:","").replace("ok","").split("|").map(b=>{const s=b.match(/T(\d+)/),l=s?parseInt(s[1]):0,u=b.match(/Z=(-?\d+\.?\d*)/),v=b.match(/X=(-?\d+\.?\d*)/),m=b.match(/W=(-?\d+\.?\d*)/),h=b.match(/U=(-?\d+\.?\d*)/);return{tool:l,z:u?parseFloat(u[1]):0,x:v?parseFloat(v[1]):0,w:m?parseFloat(m[1]):0,u:h?parseFloat(h[1]):0}}).filter(b=>!isNaN(b.tool));this.editToolsClose.addEventListener("click",()=>{this.editToolsModal.style.display="none"}),this.connectButton.addEventListener("click",async()=>{var f;this.gcodeResponseContainer.style.display="block",!((f=this.sender)!=null&&f.isConnected())&&this.sender&&await this.sender.connect();const d=await this.sender.getPosition(X.GCODE);d&&(this.mposCurrentPositionValue.value=`X${d.mX.toFixed(3)} Y${d.mY.toFixed(3)} Z${d.mZ.toFixed(3)}`,this.wposCurrentPositionValue.value=`X${d.x.toFixed(3)} Y${d.y.toFixed(3)} Z${d.z.toFixed(3)}`)}),this.sendButton.addEventListener("click",()=>{var d;if(!((d=this.sender)!=null&&d.isConnected())){alert("Please connect to the controller first.");return}this.sender&&(this.sendButton.disabled=!0,this.sendSingleCommandButton.disabled=!0,this.jogButtons.forEach(f=>{f.disabled=!0}),this.toolButtons.forEach(f=>{f.disabled=!0}),this.sender.start(te.getValue(),X.GCODE))}),this.sendSingleCommandButton.addEventListener("click",()=>{var d;if(!((d=this.sender)!=null&&d.isConnected())){alert("Please connect to the controller first.");return}this.sender&&(this.sendButton.disabled=!0,this.sendSingleCommandButton.disabled=!0,this.jogButtons.forEach(f=>{f.disabled=!0}),this.toolButtons.forEach(f=>{f.disabled=!0}),this.sender.sendCommand(this.singleCommandSender.value,X.GCODE))}),this.stopButton=document.getElementById("stopButton"),this.stopButton.addEventListener("click",()=>this.sender.stop()),this.stopButton.style.display="none"}addToolRow(e,n,t,a,r){const c=document.getElementById("toolOffsetTableBody");if(!c)return;const I=document.createElement("tr"),p=document.createElement("td");p.className="tool-cell";const S=document.createElement("input");S.type="text",S.value=`T${e}`,S.readOnly=!0,S.className="tool-input",p.appendChild(S);const B=document.createElement("td");B.className="data-cell";const P=document.createElement("input");P.type="number",P.value=n.toString(),P.step="0.001",P.className="input-cell",B.appendChild(P);const E=document.createElement("td");E.className="data-cell";const L=document.createElement("input");L.type="number",L.value=a.toString(),L.step="0.001",L.className="input-cell",E.appendChild(L);const d=document.createElement("td");d.className="data-cell";const f=document.createElement("input");f.type="number",f.value=t.toString(),f.step="0.001",f.className="input-cell",d.appendChild(f);const y=document.createElement("td");y.className="data-cell";const b=document.createElement("input");b.type="number",b.value=r.toString(),b.step="0.001",b.className="input-cell",y.appendChild(b);const s=document.createElement("td");s.className="action-cell";const l=document.createElement("button");l.className="tool-save-button",l.title=`Save Tool T${e} Offsets`,l.innerHTML=`
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="24" height="24">
                <path d="M10 5 L40 5 L45 10 L45 40 L40 45 L10 45 L5 40 L5 10 Z" fill="none" stroke="white" stroke-width="2" />
                <rect x="15" y="5" width="20" height="15" fill="none" stroke="white" stroke-width="2" />
                <circle cx="25" cy="30" r="8" fill="none" stroke="white" stroke-width="2" />
            </svg>
        `,l.addEventListener("click",()=>{const u=f.value,v=P.value,m=L.value,h=b.value,i=`G10 P${e} Z${v} X${u} W${m} U${h}`;this.sender&&this.sender.sendCommand(i,X.GCODE)}),s.appendChild(l),I.append(p,B,E,d,y,s),c.appendChild(I)}handleStatusChange(){if(!this.sender)return;const e=this.sender.getStatus();if(e.isConnected===!1){this.connectButton.innerText="Connect",this.connectButton.disabled=!1,this.connectButton.style.backgroundColor="";return}else this.connectButton.innerText="Connected",this.connectButton.disabled=!0,this.connectButton.style.backgroundColor="green";const n=e.condition==="run";this.runProgress&&(this.runProgress.value=e.progress,this.runProgress.style.display=n?"block":"none",this.runProgressLabel.style.display=n?"block":"none",n?n&&(this.sendButton.style.display="none"):(this.sendButton.disabled=!1,this.sendButton.style.display="inline-block",this.sendSingleCommandButton.disabled=!1,this.jogButtons.forEach(a=>{a.disabled=!1}),this.toolButtons.forEach(a=>{a.disabled=!1}))),this.stopButton&&(this.stopButton.style.display=n?"inline-block":"none");const t=this.sender.getDisconnectingStatus();this.senderError&&!t&&(e.error?(this.senderError.style.display="block",this.senderError.innerText=e.error,this.showError(),this.appendLineToResponseEditor(e.error)):(this.hideError(),this.senderError.innerText=""))}appendLineToResponseEditor(e){var n=we.getSession(),t=n.getLength(),a=new Date().toLocaleTimeString(),r=`[${a}] ${e}
`;n.insert({row:t,column:0},r)}showError(){this.senderError.style.display="block"}hideError(){this.senderError.style.display="none"}}const Po=`; This example shows a boring operation, then an internal grooving operation

G21 ; metric
G18 ; ZX plane
G90 ; absolute positioning
F200
X0 ; zero your tool X on centerline
Z0 ; zero your tool Z at the right edge of the stock
G91 ; relative positioning

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;1mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;2mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;3mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;4mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;5mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;6mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;7mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;8mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;9mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;10mm

Z-10

Z3.25 ; cut
X-5 ; cut

X-1.7 ; cut

X6.7 ; retract
Z-3.25 ; retract
`;function No(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Lo=function(e,n){return Array.prototype.slice.call(e,n)},Do=typeof setImmediate=="function",hn;Do?hn=function(o){setImmediate(o)}:hn=function(o){setTimeout(o,0)};var $o=hn,Oo=$o,Xo=function(e,n,t){e&&Oo(function(){e.apply(t||null,n||[])})},Pn=Lo,Zo=Xo,Mo=function(e,n){var t=n||{},a={};return e===void 0&&(e={}),e.on=function(r,c){return a[r]?a[r].push(c):a[r]=[c],e},e.once=function(r,c){return c._once=!0,e.on(r,c),e},e.off=function(r,c){var I=arguments.length;if(I===1)delete a[r];else if(I===0)a={};else{var p=a[r];if(!p)return e;p.splice(p.indexOf(c),1)}return e},e.emit=function(){var r=Pn(arguments);return e.emitterSnapshot(r.shift()).apply(this,r)},e.emitterSnapshot=function(r){var c=(a[r]||[]).slice(0);return function(){var I=Pn(arguments),p=this||e;if(r==="error"&&t.throws!==!1&&!c.length)throw I.length===1?I[0]:I;return c.forEach(function(B){t.async?Zo(B,I,p):B.apply(p,I),B._once&&e.off(r,B)}),e}},e},co=window.CustomEvent;function qo(){try{var o=new co("cat",{detail:{foo:"bar"}});return o.type==="cat"&&o.detail.foo==="bar"}catch{}return!1}var Go=qo()?co:typeof document<"u"&&typeof document.createEvent=="function"?function(e,n){var t=document.createEvent("CustomEvent");return n?t.initCustomEvent(e,n.bubbles,n.cancelable,n.detail):t.initCustomEvent(e,!1,!1,void 0),t}:function(e,n){var t=document.createEventObject();return t.type=e,n?(t.bubbles=!!n.bubbles,t.cancelable=!!n.cancelable,t.detail=n.detail):(t.bubbles=!1,t.cancelable=!1,t.detail=void 0),t},lo=[],Qt="",Ro=/^on/;for(Qt in window)Ro.test(Qt)&&lo.push(Qt.slice(2));var jo=lo,Ao=Go,Jo=jo,Pt=window.document,uo=Ko,mo=_o,Et=[];window.addEventListener||(uo=Uo,mo=Ho);var zo={add:uo,remove:mo,fabricate:Yo};function Ko(o,e,n,t){return o.addEventListener(e,n,t)}function Uo(o,e,n){return o.attachEvent("on"+e,Wo(o,e,n))}function _o(o,e,n,t){return o.removeEventListener(e,n,t)}function Ho(o,e,n){var t=po(o,e,n);if(t)return o.detachEvent("on"+e,t)}function Yo(o,e,n){var t=Jo.indexOf(e)===-1?r():a();o.dispatchEvent?o.dispatchEvent(t):o.fireEvent("on"+e,t);function a(){var c;return Pt.createEvent?(c=Pt.createEvent("Event"),c.initEvent(e,!0,!0)):Pt.createEventObject&&(c=Pt.createEventObject()),c}function r(){return new Ao(e,{detail:n})}}function Vo(o,e,n){return function(a){var r=a||window.event;r.target=r.target||r.srcElement,r.preventDefault=r.preventDefault||function(){r.returnValue=!1},r.stopPropagation=r.stopPropagation||function(){r.cancelBubble=!0},r.which=r.which||r.keyCode,n.call(o,r)}}function Wo(o,e,n){var t=po(o,e,n)||Vo(o,e,n);return Et.push({wrapper:t,element:o,type:e,fn:n}),t}function po(o,e,n){var t=Qo(o,e,n);if(t){var a=Et[t].wrapper;return Et.splice(t,1),a}}function Qo(o,e,n){var t,a;for(t=0;t<Et.length;t++)if(a=Et[t],a.element===o&&a.type===e&&a.fn===n)return t}var Nn={},es="(?:^|\\s)",ts="(?:\\s|$)";function ho(o){var e=Nn[o];return e?e.lastIndex=0:Nn[o]=e=new RegExp(es+o+ts,"g"),e}function ns(o,e){var n=o.className;n.length?ho(e).test(n)||(o.className+=" "+e):o.className=e}function os(o,e){o.className=o.className.replace(ho(e)," ").trim()}var ss={add:ns,rm:os},as=Mo,ot=zo,Le=ss,it=document,ke=it.documentElement;function is(o,e){var n=arguments.length;n===1&&Array.isArray(o)===!1&&(e=o,o=[]);var t,a,r,c,I,p,S,B,P,E,L,d=null,f,y=e||{};y.moves===void 0&&(y.moves=On),y.accepts===void 0&&(y.accepts=On),y.invalid===void 0&&(y.invalid=G),y.containers===void 0&&(y.containers=o||[]),y.isContainer===void 0&&(y.isContainer=cs),y.copy===void 0&&(y.copy=!1),y.copySortSource===void 0&&(y.copySortSource=!1),y.revertOnSpill===void 0&&(y.revertOnSpill=!1),y.removeOnSpill===void 0&&(y.removeOnSpill=!1),y.direction===void 0&&(y.direction="vertical"),y.ignoreInputTextSelection===void 0&&(y.ignoreInputTextSelection=!0),y.mirrorContainer===void 0&&(y.mirrorContainer=it.body);var b=as({containers:y.containers,start:M,end:j,cancel:me,remove:de,destroy:m,canMove:T,dragging:!1});return y.removeOnSpill===!0&&b.on("over",Me).on("out",St),l(),b;function s(k){return b.containers.indexOf(k)!==-1||y.isContainer(k)}function l(k){var D=k?"remove":"add";ut(ke,D,"mousedown",i),ut(ke,D,"mouseup",se)}function u(k){var D=k?"remove":"add";ut(ke,D,"mousemove",g)}function v(k){var D=k?"remove":"add";ot[D](ke,"selectstart",h),ot[D](ke,"click",h)}function m(){l(!0),se({})}function h(k){f&&k.preventDefault()}function i(k){p=k.clientX,S=k.clientY;var D=Ln(k)!==1||k.metaKey||k.ctrlKey;if(!D){var $=k.target,q=C($);q&&(f=q,u(),k.type==="mousedown"&&(Mn($)?$.focus():k.preventDefault()))}}function g(k){if(f){if(Ln(k)===0){se({});return}if(!(k.clientX!==void 0&&Math.abs(k.clientX-p)<=(y.slideFactorX||0)&&k.clientY!==void 0&&Math.abs(k.clientY-S)<=(y.slideFactorY||0))){if(y.ignoreInputTextSelection){var D=De("clientX",k)||0,$=De("clientY",k)||0,q=it.elementFromPoint(D,$);if(Mn(q))return}var H=f;u(!0),v(),j(),Z(H);var A=rs(r);c=De("pageX",k)-A.left,I=De("pageY",k)-A.top,Le.add(E||r,"gu-transit"),Wt(),fe(k)}}}function C(k){if(!(b.dragging&&t)&&!s(k)){for(var D=k;re(k)&&s(re(k))===!1;)if(y.invalid(k,D)||(k=re(k),!k))return;var $=re(k);if($&&!y.invalid(k,D)){var q=y.moves(k,$,D,dt(k));if(q)return{item:k,source:$}}}}function T(k){return!!C(k)}function M(k){var D=C(k);D&&Z(D)}function Z(k){ct(k.item,k.source)&&(E=k.item.cloneNode(!0),b.emit("cloned",E,k.item,"copy")),a=k.source,r=k.item,B=P=dt(k.item),b.dragging=!0,b.emit("drag",r,a)}function G(){return!1}function j(){if(b.dragging){var k=E||r;ce(k,re(k))}}function ne(){f=!1,u(!0),v(!0)}function se(k){if(ne(),!!b.dragging){var D=E||r,$=De("clientX",k)||0,q=De("clientY",k)||0,H=$n(t,$,q),A=Se(H,$,q);A&&(E&&y.copySortSource||!E||A!==a)?ce(D,A):y.removeOnSpill?de():me()}}function ce(k,D){var $=re(k);E&&y.copySortSource&&D===a&&$.removeChild(r),be(D)?b.emit("cancel",k,a,a):b.emit("drop",k,D,a,P),ae()}function de(){if(b.dragging){var k=E||r,D=re(k);D&&D.removeChild(k),b.emit(E?"cancel":"remove",k,D,a),ae()}}function me(k){if(b.dragging){var D=arguments.length>0?k:y.revertOnSpill,$=E||r,q=re($),H=be(q);H===!1&&D&&(E?q&&q.removeChild(E):a.insertBefore($,B)),H||D?b.emit("cancel",$,a,a):b.emit("drop",$,q,a,P),ae()}}function ae(){var k=E||r;ne(),et(),k&&Le.rm(k,"gu-transit"),L&&clearTimeout(L),b.dragging=!1,d&&b.emit("out",k,d,a),b.emit("dragend",k),a=r=E=B=P=L=d=null}function be(k,D){var $;return D!==void 0?$=D:t?$=P:$=dt(E||r),k===a&&$===B}function Se(k,D,$){for(var q=k;q&&!H();)q=re(q);return q;function H(){var A=s(q);if(A===!1)return!1;var Pe=qe(q,k),Y=Fe(q,Pe,D,$),pe=be(q,Y);return pe?!0:y.accepts(r,q,a,Y)}}function fe(k){if(!t)return;k.preventDefault();var D=De("clientX",k)||0,$=De("clientY",k)||0,q=D-c,H=$-I;t.style.left=q+"px",t.style.top=H+"px";var A=E||r,Pe=$n(t,D,$),Y=Se(Pe,D,$),pe=Y!==null&&Y!==d;(pe||Y===null)&&(J(),d=Y,R());var Q=re(A);if(Y===a&&E&&!y.copySortSource){Q&&Q.removeChild(A);return}var ie,x=qe(Y,Pe);if(x!==null)ie=Fe(Y,x,D,$);else if(y.revertOnSpill===!0&&!E)ie=B,Y=a;else{E&&Q&&Q.removeChild(A);return}(ie===null&&pe||ie!==A&&ie!==dt(A))&&(P=ie,Y.insertBefore(A,ie),b.emit("shadow",A,Y,a));function O(Ne){b.emit(Ne,A,d,a)}function R(){pe&&O("over")}function J(){d&&O("out")}}function Me(k){Le.rm(k,"gu-hide")}function St(k){b.dragging&&Le.add(k,"gu-hide")}function Wt(){if(!t){var k=r.getBoundingClientRect();t=r.cloneNode(!0),t.style.width=Xn(k)+"px",t.style.height=Zn(k)+"px",Le.rm(t,"gu-transit"),Le.add(t,"gu-mirror"),y.mirrorContainer.appendChild(t),ut(ke,"add","mousemove",fe),Le.add(y.mirrorContainer,"gu-unselectable"),b.emit("cloned",t,r,"mirror")}}function et(){t&&(Le.rm(y.mirrorContainer,"gu-unselectable"),ut(ke,"remove","mousemove",fe),re(t).removeChild(t),t=null)}function qe(k,D){for(var $=D;$!==k&&re($)!==k;)$=re($);return $===ke?null:$}function Fe(k,D,$,q){var H=y.direction==="horizontal",A=D!==k?Y():Pe();return A;function Pe(){var Q=k.children.length,ie,x,O;for(ie=0;ie<Q;ie++)if(x=k.children[ie],O=x.getBoundingClientRect(),H&&O.left+O.width/2>$||!H&&O.top+O.height/2>q)return x;return null}function Y(){var Q=D.getBoundingClientRect();return pe(H?$>Q.left+Xn(Q)/2:q>Q.top+Zn(Q)/2)}function pe(Q){return Q?dt(D):D}}function ct(k,D){return typeof y.copy=="boolean"?y.copy:y.copy(k,D)}}function ut(o,e,n,t){var a={mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"},r={mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"},c={mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"};window.navigator.pointerEnabled?ot[e](o,r[n],t):window.navigator.msPointerEnabled?ot[e](o,c[n],t):(ot[e](o,a[n],t),ot[e](o,n,t))}function Ln(o){if(o.touches!==void 0)return o.touches.length;if(o.which!==void 0&&o.which!==0)return o.which;if(o.buttons!==void 0)return o.buttons;var e=o.button;if(e!==void 0)return e&1?1:e&2?3:e&4?2:0}function rs(o){var e=o.getBoundingClientRect();return{left:e.left+Dn("scrollLeft","pageXOffset"),top:e.top+Dn("scrollTop","pageYOffset")}}function Dn(o,e){return typeof window[e]<"u"?window[e]:ke.clientHeight?ke[o]:it.body[o]}function $n(o,e,n){o=o||{};var t=o.className||"",a;return o.className+=" gu-hide",a=it.elementFromPoint(e,n),o.className=t,a}function cs(){return!1}function On(){return!0}function Xn(o){return o.width||o.right-o.left}function Zn(o){return o.height||o.bottom-o.top}function re(o){return o.parentNode===it?null:o.parentNode}function Mn(o){return o.tagName==="INPUT"||o.tagName==="TEXTAREA"||o.tagName==="SELECT"||go(o)}function go(o){return!o||o.contentEditable==="false"?!1:o.contentEditable==="true"?!0:go(re(o))}function dt(o){return o.nextElementSibling||e();function e(){var n=o;do n=n.nextSibling;while(n&&n.nodeType!==1);return n}}function ls(o){return o.targetTouches&&o.targetTouches.length?o.targetTouches[0]:o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:o}function De(o,e){var n=ls(e),t={pageX:"clientX",pageY:"clientY"};return o in t&&!(o in n)&&t[o]in n&&(o=t[o]),n[o]}var us=is;const ds=No(us);let ms=(o=21)=>crypto.getRandomValues(new Uint8Array(o)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),"");class ps{constructor(e){N(this,"apiUrl");this.apiUrl=e}async setItem(e,n){console.log(`[DatabaseService] Saving record - Key: "${e}", Value length: ${n.length} characters`);try{const t=await fetch(`${this.apiUrl}/storage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e,value:n})});t.ok?console.log(`[DatabaseService] Successfully saved record with key: "${e}"`):console.error(`[DatabaseService] Failed to save record - Key: "${e}", Status: ${t.status}`)}catch(t){throw console.error(`[DatabaseService] Error saving record - Key: "${e}", Error:`,t),t}}async getItem(e){var n;console.log(`[DatabaseService] Retrieving record with key: "${e}"`);try{const t=await fetch(`${this.apiUrl}/storage/${e}`);if(t.ok){const a=await t.json();return console.log(`[DatabaseService] Successfully retrieved record - Key: "${e}", Value length: ${((n=a.value)==null?void 0:n.length)||0} characters`),a.value}else return console.log(`[DatabaseService] Record not found - Key: "${e}", Status: ${t.status}`),null}catch(t){return console.error(`[DatabaseService] Error retrieving record - Key: "${e}", Error:`,t),null}}async removeItem(e){console.log(`[DatabaseService] Deleting record with key: "${e}"`);try{const n=await fetch(`${this.apiUrl}/storage/${e}`,{method:"DELETE"});n.ok?console.log(`[DatabaseService] Successfully deleted record with key: "${e}"`):console.error(`[DatabaseService] Failed to delete record - Key: "${e}", Status: ${n.status}`)}catch(n){throw console.error(`[DatabaseService] Error deleting record - Key: "${e}", Error:`,n),n}}async getKeys(e){const n=e?`with prefix "${e}"`:"all keys";console.log(`[DatabaseService] Retrieving keys ${n}`);try{const t=e?`${this.apiUrl}/storage/keys?prefix=${e}`:`${this.apiUrl}/storage/keys`,a=await fetch(t);if(!a.ok)return console.error(`[DatabaseService] Failed to retrieve keys - Status: ${a.status}, ${a.statusText}`),[];const c=(await a.json()).keys||[];return console.log(`[DatabaseService] Successfully retrieved ${c.length} keys ${n}:`,c),c}catch(t){return console.error(`[DatabaseService] Error retrieving keys ${n}:`,t),[]}}}function hs(){const o=window.location.hostname;return o.startsWith("192.168.")||o.startsWith("10.")||o.startsWith("172."),new ps("https://192.168.0.121:3001/api")}const F=hs(),Te=document.getElementById("availableTasks"),oe=document.getElementById("tasksToExecute"),en=document.getElementById("deleteTasks"),gs=document.getElementById("addNewTaskButton"),Ge=document.getElementById("newTaskModal"),fs=document.getElementById("closeNewTaskModal"),Ee=document.getElementById("newTaskType"),Re=document.getElementById("gcodeTaskContainer"),tt=document.getElementById("newTaskGcode"),vs=document.getElementById("saveNewTaskButton"),qn=document.getElementById("newTaskGcodeRepeatable"),mt=document.getElementById("newTaskName"),Gn=document.getElementById("taskTextTitle"),tn=document.getElementById("newTaskDescription");let z;const nt=document.getElementById("connectButton"),ys=document.getElementById("plannerContainer");let Rn=null;const ks=document.getElementById("saveAvailableTaskCollection"),bs=document.getElementById("saveAvailableTaskCollectionButtonModal"),Ts=document.getElementById("loadTaskCollection"),ve=document.getElementById("availableTaskCollections"),le=document.getElementById("collectionToSaveTo"),nn=document.getElementById("newCollectionNameContainer"),Nt=document.getElementById("newCollectionName"),Es=document.getElementById("deleteTaskCollection"),on=document.getElementById("saveCollectionModal"),$e=document.getElementById("saveCollectionModalToSaveTo"),Cs=document.getElementById("saveCollectionModalClose"),Bs=document.getElementById("newCollectionNameModal"),jn=document.getElementById("newCollectionNameContainerModal"),Is=document.getElementById("importAvailableTasks"),xs=document.getElementById("exportAvailableTasks"),sn=document.getElementById("saveJobModal"),ws=document.getElementById("saveJobModalClose"),Ss=document.getElementById("executeJobButton"),Fs=document.getElementById("saveJobButton"),Ps=document.getElementById("newJobButton"),pt=document.getElementById("saveJobNameInput"),_=document.getElementById("saveJobNameSelect"),je=document.getElementById("newJobNameContainer"),ue=document.getElementById("saveProjectNameSelect"),Lt=document.getElementById("saveProjectNameInput"),Dt=document.getElementById("newProjectNameContainer"),ht=document.getElementById("saveJobGroupNameInput"),V=document.getElementById("saveJobGroupNameSelect"),Oe=document.getElementById("newJobGroupNameContainer"),Ns=document.getElementById("saveJobSaveButton"),Ce=document.getElementById("jobLoadSelect"),K=document.getElementById("projectLoadSelect"),he=document.getElementById("groupLoadSelect"),Ls=document.getElementById("loadJobButton"),Ds=document.getElementById("deleteJobButton"),$s=document.getElementById("importJobButton"),Os=document.getElementById("exportJobButton"),an=document.getElementById("exportJobModal"),Xs=document.getElementById("exportJobModalClose"),Zs=document.getElementById("exportJobSaveButton"),Xe=document.getElementById("exportJobProjectNameSelect"),Be=document.getElementById("exportJobGroupNameSelect"),Ae=document.getElementById("exportJobNameSelect"),Ie=[],rn=document.getElementById("manualTaskModal"),$t=document.getElementById("cncTaskModal"),Ms=document.getElementById("cancelManualTask"),Ot=document.getElementById("completeManualTask"),qs=document.getElementById("manualTaskDescription"),Gs=document.getElementById("cncTaskDescription"),Rs=document.getElementById("toolChangeTaskDescription"),An=document.getElementById("cncTaskGcode"),js=document.getElementById("cancelCncTask"),ee=document.getElementById("executeGcode"),ge=document.getElementById("completeCncTask"),As=document.getElementById("manualTaskName"),Js=document.getElementById("cncTaskName"),Xt=document.getElementById("cncTaskSenderProgressLabel"),cn=document.getElementById("cncTaskSenderProgress"),ln=document.getElementById("newTaskToolChangeNewTool"),Je=document.getElementById("toolChangeTaskContainer"),Zt=document.getElementById("toolChangeTaskModal"),Jn=document.getElementById("toolChangeTaskName"),zn=document.getElementById("toolChangeTaskInstructions"),Kn=document.getElementById("toolChangeNewTool"),zs=document.getElementById("cancelToolChange"),Ze=document.getElementById("executeToolChange"),ye=document.getElementById("completeToolChangeTask"),Mt=document.getElementById("jobCancelledModal"),Ks=document.getElementById("jobCancelledCloseButton"),Un=document.getElementById("completeTaskModal"),Us=document.getElementById("completeTaskCloseButton"),_n=document.getElementById("notConnectedModal"),_s=document.getElementById("notConnectedCloseButton"),Hs=document.getElementById("currentGcodeLineContainer"),Ys=document.getElementById("currentGcodeLine"),Vs=document.getElementById("currentFeedrateContainer"),Ws=document.getElementById("currentFeedrate");document.addEventListener("DOMContentLoaded",()=>{z=Tt.getInstance(),z.addStatusChangeListener(()=>r(),X.PLANNER),z.addCurrentCommandListener(a),ys.addEventListener("containerVisible",async()=>{oe.innerHTML="",await b(),await o(),await n();const s=await F.getItem("selectedJob");if(s){const u=JSON.parse(s);Ce.value=u.name}await t(),await B();const l=await e();l&&await p(l),P(),S()}),$e.addEventListener("change",()=>{$e.value==="new"?jn.style.display="block":jn.style.display="none"}),le.addEventListener("change",()=>{le.value==="new"?nn.style.display="block":nn.style.display="none"}),_.addEventListener("change",()=>{_.value==="new"?je.style.display="block":je.style.display="none"}),V.addEventListener("change",()=>{V.value==="new"?Oe.style.display="block":Oe.style.display="none"}),Cs.onclick=function(){on.style.display="none"},ks.onclick=function(){on.style.display="block"},bs.onclick=async function(){let s="";if($e.value==="new"){if(s=Bs.value,s===null||s===""){alert("Please enter a name for the collection");return}}else s=$e.value;const l=await F.getItem("selectedTaskCollection");let u,v;if(l){try{v=JSON.parse(l).name}catch{v=l}const h=await F.getItem(`taskCollection_${v}`);h&&(u=JSON.parse(h),s!==v&&(u.name=s,await F.setItem(`taskCollection_${s}`,JSON.stringify(u))))}const m=document.createElement("option");m.value=s,m.textContent=s,ve.appendChild(m),on.style.display="none",alert(`Collection ${s} saved`),t()},Ts.onclick=async function(){const s=ve.value;await F.setItem("selectedTaskCollection",JSON.stringify({name:s})),B()},Es.onclick=async function(){const s=ve.value;if(s==="default"){alert("You cannot delete the default collection");return}confirm(`Are you sure you want to delete the collection ${s}?`)&&(await F.removeItem(`taskCollection_${s}`),t(),B())},Is.onclick=function(){const s=document.createElement("input");s.type="file",s.accept=".json",s.multiple=!0,s.onchange=async function(l){const u=l.target.files;if(u)for(let v=0;v<u.length;v++){const m=u[v],h=new FileReader;h.onload=async function(i){var C;const g=(C=i.target)==null?void 0:C.result;if(g){const T=JSON.parse(g);for(const M of T){const Z=M.name;await F.getItem(`taskCollection_${Z}`)?window.confirm(`Task collection ${Z} already exists. Do you want to override it?`)&&await F.setItem(`taskCollection_${Z}`,JSON.stringify(M)):await F.setItem(`taskCollection_${Z}`,JSON.stringify(M))}t()}},h.readAsText(m)}},s.click()},xs.onclick=async function(){const s=await F.getKeys("taskCollection_"),l=[];for(const g of s){const C=await F.getItem(g);C&&l.push(JSON.parse(C))}const u=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),v=URL.createObjectURL(u),m=document.createElement("a");m.href=v;const i=new Date().toISOString().split("T")[0];m.download=`availableTasks_${i}.json`,m.click(),URL.revokeObjectURL(v)};async function o(){if(!K||!K.value)return;he.innerHTML="";const s=await F.getItem(`savedProject_${K.value}`);if(!s)return;const l=JSON.parse(s);l.groups.forEach(v=>{const m=document.createElement("option");m.value=v.name,m.textContent=v.name,he.appendChild(m)});const u=await F.getItem("selectedGroup");if(u)try{const v=JSON.parse(u);l.groups.some(h=>h.name===v.name)&&(he.value=v.name)}catch{l.groups.some(m=>m.name===u)&&(he.value=u)}}async function e(){const s=K.value,l=he.value,u=Ce.value;if(!s||!l||!u)return null;const v=await F.getItem(`savedProject_${s}`);if(!v)return null;const h=JSON.parse(v).groups.find(g=>g.name===l);if(!h)return null;const i=h.jobs.find(g=>g.name===u);return i?(i.groupName||(i.groupName=l),i):null}async function n(){if(!K||!K.value)return;Ce.innerHTML="";const s=await F.getItem(`savedProject_${K.value}`);if(!s)return;const l=JSON.parse(s),u=he.value,v=l.groups.find(m=>m.name===u);v&&(v.jobs.forEach(m=>{const h=document.createElement("option");h.value=m.name,h.textContent=m.name,Ce.appendChild(h)}),v.jobs.length>0&&(Ce.value=Ce.options[0].value))}async function t(){ve.innerHTML="",le.innerHTML="",$e.innerHTML="";const s=document.createElement("option");s.value="default",s.textContent="default",ve.appendChild(s),le.appendChild(s.cloneNode(!0)),$e.appendChild(s.cloneNode(!0));const l=await F.getKeys("taskCollection_");l.sort(),l.forEach(m=>{if(m==="taskCollection_default")return;const h=m.replace("taskCollection_",""),i=document.createElement("option");i.value=h,i.textContent=h,ve.appendChild(i),le.appendChild(i.cloneNode(!0)),$e.appendChild(i.cloneNode(!0))});const u=await F.getItem("selectedTaskCollection");if(u){let m;try{m=JSON.parse(u).name}catch{m=u}ve.value=m}const v=document.createElement("option");v.value="new",v.textContent="--new collection--",le.appendChild(v.cloneNode(!0)),$e.appendChild(v.cloneNode(!0))}_s.onclick=function(){_n.style.display="none"};function a(s){if(!z)return;const u=z.getStatus().condition==="run";if(u){if(u){const v=s.match(/F(\d+)/);v&&(Rn=parseInt(v[1],10),Ws.innerText=Rn.toString()),Ys.innerText=s,Vs.style.display="block",Hs.style.display="block"}}}function r(){var u;if(!z)return;const s=z.getStatus();if(s.isConnected===!1){nt.innerText="Connect",nt.disabled=!1,nt.style.backgroundColor="";return}else nt.innerText="Connected",nt.disabled=!0,nt.style.backgroundColor="green";const l=s.condition==="run";l?l&&(ee.disabled=!0,ee.classList.add("disabled-button"),ee.classList.remove("interaction-ready-button"),Ze.disabled=!0,Ze.classList.add("disabled-button"),Ze.classList.remove("interaction-ready-button"),Xt.innerText="Task in progress",ge.classList.remove("interaction-ready-button"),ge.style.display="none",ye.style.display="none",ye.classList.remove("interaction-ready-button")):(ge.style.display="block",ge.disabled=!1,ge.classList.add("interaction-ready-button"),Xt.innerText="Task completed",ye.style.display="block",ye.disabled=!1,ye.classList.add("interaction-ready-button"),((u=ee.attributes.getNamedItem("data-repeatable"))==null?void 0:u.value)==="true"?(ee.disabled=!1,ee.classList.remove("disabled-button"),ee.classList.add("interaction-ready-button"),ee.textContent="Execute Again?"):ee.disabled=!0),cn.value=s.progress,cn.style.display="block",Xt.style.display="block"}const c=ds([Te,oe,en],{copy:(s,l)=>l===Te,accepts:(s,l)=>l===oe||l===en,revertOnSpill:!0,removeOnSpill:!1});c.on("dragend",()=>{P(),S(),I("currentJob")});async function I(s,l="",u=""){const v=oe.querySelectorAll(".task-to-execute"),m={name:"",projectName:"",groupName:"",tasks:[]};if(v.forEach(h=>{const i=h.getAttribute("data-task-id"),g=h.getAttribute("data-collection-name");m.tasks.push({id:i,collectionName:g})}),m.name=s,m.groupName=l,s==="currentJob")await F.setItem(s,JSON.stringify(m));else if(u&&l){let h=await F.getItem(`savedProject_${u}`),i;h?i=JSON.parse(h):i={name:u,groups:[]};let g=i.groups.find(T=>T.name===l);g||(g={name:l,jobs:[]},i.groups.push(g));const C=g.jobs.findIndex(T=>T.name===s);C!==-1?g.jobs[C]={name:s,projectName:u,groupName:l,tasks:m.tasks}:g.jobs.push({name:s,projectName:u,groupName:l,tasks:m.tasks}),await F.setItem(`savedProject_${u}`,JSON.stringify(i))}}async function p(s){let l=s.tasks;const u=[],v=[];for(const h of l)await F.getItem(`taskCollection_${h.collectionName}`)?v.push(h):u.push(h);l=v,await F.setItem("currentJob",JSON.stringify(l)),oe.innerHTML="";for(const h of l){const i=await F.getItem(`taskCollection_${h.collectionName}`);if(i){const C=JSON.parse(i).tasks.find(T=>T.id===h.id);if(C){const T=document.createElement("div");var m="";C.type==="GCODE"?m="gcode":C.type==="MANUAL"?m="manual":C.type==="TOOL_CHANGE"&&(m="tool-change"),T.classList.add(`task-${m}`),T.classList.add("task-to-execute"),T.setAttribute("data-task-id",C.id),T.setAttribute("data-task-name",C.name),T.setAttribute("data-collection-name",h.collectionName),T.textContent=C.name,oe.appendChild(T)}}}u.length>0&&alert(`The following tasks were removed because their collection does not exist: ${u.map(h=>h.id).join(", ")}`)}c.on("drop",async(s,l,u)=>{const v=s.getAttribute("data-task-id"),m=s.getAttribute("data-task-order");if(l===oe)s.classList.remove("available-task"),s.classList.add("task-to-execute"),S();else if(l===en){s.remove();let h=null;if(u===oe)h=oe.querySelector(`[data-task-order="${m}"]`);else if(u===Te&&(h=Te.querySelector(`[data-task-id="${v}"]`),h)){const i=h.getAttribute("data-collection-name"),g=await F.getItem(`taskCollection_${i}`);if(g){const C=JSON.parse(g);C.tasks=C.tasks.filter(T=>T.id!==v),await F.setItem(`taskCollection_${i}`,JSON.stringify(C))}}h&&h.remove()}});function S(){oe.querySelectorAll(".task-to-execute").forEach(l=>{if(l.querySelector("i")){let u=l.querySelector("i");u&&(u.remove(),u=document.createElement("i"),l.classList.contains("task-manual")?(u.className="fas fa-users-cog icon-tooltip",u.setAttribute("data-tooltip","Manual Task")):l.classList.contains("task-gcode")?(u.className="fas fa-code icon-tooltip",u.setAttribute("data-tooltip","Gcode Task")):l.classList.contains("task-tool-change")&&(u.className="fas fa-wrench icon-tooltip",u.setAttribute("data-tooltip","Tool Change Task")),l.appendChild(u))}else{const u=document.createElement("i");l.classList.contains("task-manual")?(u.className="fas fa-users-cog icon-tooltip",u.setAttribute("data-tooltip","Manual Task")):l.classList.contains("task-gcode")?(u.className="fas fa-code icon-tooltip",u.setAttribute("data-tooltip","Gcode Task")):l.classList.contains("task-tool-change")&&(u.className="fas fa-wrench icon-tooltip",u.setAttribute("data-tooltip","Tool Change Task")),l.appendChild(u)}})}async function B(){Te.innerHTML="";let s=await F.getItem("selectedTaskCollection"),l;if(s===null||s==="")l=ve.value,await F.setItem("selectedTaskCollection",JSON.stringify({name:l}));else try{l=JSON.parse(s).name}catch{l=s}const u=await F.getItem(`taskCollection_${l}`);u&&JSON.parse(u).tasks.sort((h,i)=>h.name.localeCompare(i.name)).forEach(h=>{h.id,h.name,h.type,h.description,(h.type==="GCODE"||h.type==="TOOL_CHANGE")&&(h.gcode,h.toolName);var i="";h.type==="GCODE"?i="gcode":h.type==="MANUAL"?i="manual":h.type==="TOOL_CHANGE"&&(i="tool-change");const g=document.createElement("div");g.classList.add(`task-${i}`),g.classList.add("available-task"),g.setAttribute("data-task-type",i),g.setAttribute("data-task-id",h.id.toString()),g.setAttribute("data-task-name",h.name),g.setAttribute("data-collection-name",l||""),g.textContent=h.name;const C=document.createElement("i");C.classList.add("fas","fa-info-circle","fa-fw","show-info","icon-tooltip"),C.setAttribute("data-tooltip","Click for more info..."),g.appendChild(C),Te.appendChild(g)})}function P(){const s=document.getElementById("tasksToExecute");s&&s.querySelectorAll("div").forEach((u,v)=>{const m=u.getAttribute("data-task-name");u.setAttribute("data-task-order",(v+1).toString()),u.textContent=`Task ${v+1}: ${m}`})}Ee.addEventListener("change",()=>{Ee.value==="MANUAL"?(Re.style.display="none",Je.style.display="none"):Ee.value==="TOOL_CHANGE"?(Re.style.display="none",Je.style.display="block"):(Je.style.display="none",Re.style.display="block",tt.placeholder="Enter gcode here...",tt.disabled=!1)}),gs.addEventListener("click",()=>{Ge.style.display="block",Gn.textContent="Add a new task",mt.value="",tn.value="",tt.value="",Nt.value="",Ge.removeAttribute("data-task-id"),le.value="",Ee.value="MANUAL",Re.style.display="none",Je.style.display="none"}),vs.addEventListener("click",async()=>{if(le.value===""){alert("Please select a collection.");return}if(le.value==="new"&&Nt.value===""){alert("Please enter a collection name");return}if(mt.value===""||mt.value===null){alert("Please enter a task name");return}const s=mt.value,l=document.createElement("div");l.classList.add(`task-${Ee.value}`),l.classList.add("available-task");let u;const v=Ge.getAttribute("data-task-id");v?u=v:u=ms(),l.setAttribute("data-task-id",u.toString()),l.setAttribute("data-task-name",s),l.textContent=s;const m=document.createElement("i");m.classList.add("fas","fa-info-circle","fa-fw","show-info","icon-tooltip"),m.setAttribute("data-tooltip","Click for more info..."),l.appendChild(m);const h=Te.querySelector(`[data-task-id="${u}"]`);h&&h.remove(),Te.appendChild(l),Ge.style.display="none";const i={id:u,name:s,type:Ee.value,description:tn.value};Ee.value==="GCODE"?(i.gcode=tt.value,i.isRepeatable=qn.checked):Ee.value==="TOOL_CHANGE"&&(i.gcode=ln.value,i.toolName=ln.value);var g="";if(le.value==="new"){g=Nt.value,Nt.value="",nn.style.display="none";const C={name:g,tasks:[]};C.tasks.push(i),await F.setItem(`taskCollection_${g}`,JSON.stringify(C));const T=document.createElement("option");T.value=g,T.textContent=g,ve.appendChild(T),t()}else{g=le.value;const C=await F.getItem(`taskCollection_${g}`);if(C){const T=JSON.parse(C);T.tasks.find(Z=>Z.id===u)&&(T.tasks=T.tasks.filter(Z=>Z.id!==u)),T.tasks.push(i),await F.setItem(`taskCollection_${g}`,JSON.stringify(T)),ve.value=g}else{const T={name:g,tasks:[]};T.tasks.push(i),await F.setItem(`taskCollection_${g}`,JSON.stringify(T))}}await F.setItem("selectedTaskCollection",JSON.stringify({name:g})),B()}),Te.addEventListener("click",async s=>{const l=s.target;if(l.matches(".show-info")){const v=l.parentNode.getAttribute("data-task-id");let m=null;const h=await F.getItem("selectedTaskCollection");let i;if(h)try{i=JSON.parse(h).name}catch{i=h}const g=await F.getItem(`taskCollection_${i}`);if(g){const T=JSON.parse(g).tasks.find(M=>M.id===v);T&&(m=T)}m&&(Ge.style.display="block",mt.value=m.name,Ee.value=m.type.toString(),tn.value=m.description,le.value=i||"default",Gn.textContent="Edit Task",m.type==="TOOL_CHANGE"?(Je.style.display="block",Re.style.display="none",Jn.textContent=m.name,ln.value=m.toolName||"",zn.textContent=m.description||""):m.type==="GCODE"?(Je.style.display="none",Re.style.display="block",tt.disabled=!1,tt.value=m.gcode||"",qn.checked=m.isRepeatable||!1):m.type==="MANUAL"&&(Je.style.display="none",Re.style.display="none"),v&&Ge.setAttribute("data-task-id",v.toString()))}}),fs.onclick=function(){Ge.style.display="none"},Us.onclick=function(){Un.style.display="none"};function E(){if(Ie.length===0){Un.style.display="block";return}const s=Ie.shift();if(s&&s.type==="MANUAL")As.textContent=`Task ${s.order}: ${s.name}`,qs.value=s.description||"",rn.style.display="block",Ie.length===0?Ot.innerText="Complete Job":Ot.innerText="Next Task -->";else if(s&&s.type==="GCODE"){ee.disabled=!1,Gs.value=s.description||"",ee.classList.remove("disabled-button"),ee.classList.add("interaction-ready-button"),ee.textContent="Execute Gcode",s.isRepeatable?ee.setAttribute("data-repeatable","true"):ee.removeAttribute("data-repeatable"),Js.textContent=`Task ${s.order}: ${s.name}`,An.value=s.gcode??"",$t.style.display="block",Ie.length===0?ge.innerText="Complete Job":ge.innerText="Next Task -->";const l=$t.querySelector(".task-modal-content");l&&(l.style.backgroundColor=""),ge.disabled=!0,ge.style.display="none",cn.style.display="none",Xt.style.display="none"}else s&&s.type==="TOOL_CHANGE"&&(Ze.disabled=!1,Ze.classList.remove("disabled-button"),Ze.classList.add("interaction-ready-button"),Ze.textContent="Execute Tool Change",ye.style.display="none",Zt.style.display="block",Jn.textContent=`Task ${s.order}: ${s.name}`,Kn.value=s.toolName||"",Rs.value=s.description||"",zn.textContent=`Please change the tool to ${s.toolName}`,Zt.style.display="block",Ie.length===0?ye.innerText="Complete Job":ye.innerText="Next Task -->")}Ms.onclick=function(){rn.style.display="none",Ie.length=0,Mt.style.display="block"},js.onclick=function(){$t.style.display="none",Ie.length=0,Mt.style.display="block",z==null||z.stop()},zs.onclick=function(){Zt.style.display="none",Ie.length=0,Mt.style.display="block",z==null||z.stop()},Ot.onclick=function(){Ot.innerText="Next Task -->",rn.style.display="none",E()},ge.onclick=function(){ge.innerText="Next Task -->",$t.style.display="none",E()},ye.onclick=function(){ye.innerText="Next Task -->",Zt.style.display="none",E()},ee.onclick=function(){z&&z.start(An.value,X.PLANNER)},Ze.onclick=function(){z&&z.start(Kn.value,X.PLANNER)},Ks.onclick=function(){Mt.style.display="none"},Ss.onclick=async function(){if(!(z!=null&&z.isConnected())){_n.style.display="block";return}const s=oe.querySelectorAll(".task-to-execute");for(const l of s){const u=l.getAttribute("data-task-id"),v=l.getAttribute("data-task-order"),m=l.getAttribute("data-collection-name"),h=await F.getItem(`taskCollection_${m}`);let i=null;if(h){const C=JSON.parse(h).tasks.find(T=>T.id===u);C&&(i=C)}i&&(i.order=parseInt(v||"0"),Ie.push(i))}E()},Fs.onclick=async function(){sn.style.display="block",ue.innerHTML="",V.innerHTML="",_.innerHTML="",Lt.value="",ht.value="",pt.value="";const s=await F.getKeys("savedProject_");s.sort(),s.length>0&&s.forEach(m=>{const h=m.replace("savedProject_",""),i=document.createElement("option");i.value=h,i.textContent=h,ue.appendChild(i)});const l=document.createElement("option");l.value="new",l.textContent="--new project--",ue.insertBefore(l,ue.firstChild),ue.value="new";const u=document.createElement("option");u.value="new",u.textContent="--new group--",V.insertBefore(u,V.firstChild),V.value="new";const v=document.createElement("option");v.value="new",v.textContent="--new job--",_.insertBefore(v,_.firstChild),_.value="new",Dt.style.display="block",Oe.style.display="block",je.style.display="block",Lt.value="",ht.value="",pt.value=""};async function L(s){V.innerHTML="",_.innerHTML="";const l=await F.getItem(`savedProject_${s}`);if(l){const v=JSON.parse(l);v.groups.forEach(m=>{const h=document.createElement("option");h.value=m.name,h.textContent=m.name,V.appendChild(h)}),v.groups.length>0&&v.groups[0].jobs.forEach(m=>{const h=document.createElement("option");h.value=m.name,h.textContent=m.name,_.appendChild(h)})}const u=document.createElement("option");u.value="new",u.textContent="--new group--",V.insertBefore(u,V.firstChild)}ue.addEventListener("change",async()=>{ue.value==="new"?(Dt.style.display="block",Oe.style.display="block",je.style.display="block",V.innerHTML="",_.innerHTML="",ht.value="",pt.value=""):(Dt.style.display="none",Oe.style.display="none",je.style.display="none",await L(ue.value),await d(ue.value,V.value))}),V.addEventListener("change",()=>{if(V.value==="new"){Oe.style.display="block",_.innerHTML="",je.style.display="block";const s=document.createElement("option");s.value="new",s.textContent="--new job--",_.appendChild(s)}else{Oe.style.display="none";const s=ue.value,l=V.value;s!=="new"&&d(s,l)}});async function d(s,l){_.innerHTML="";const u=await F.getItem(`savedProject_${s}`);if(u){const m=JSON.parse(u).groups.find(i=>i.name===l);m&&m.jobs.forEach(i=>{const g=document.createElement("option");g.value=i.name,g.textContent=i.name,_.appendChild(g),_.value=i.name});const h=document.createElement("option");h.value="new",h.textContent="--new job--",_.insertBefore(h,_.firstChild)}}Ns.onclick=async function(){let s=ue.value==="new"?Lt.value:ue.value,l=V.value==="new"?ht.value:V.value,u=_.value==="new"?pt.value:_.value;if(s===""||s===null){alert("Please enter a name for the project");return}if(l===""||l===null){alert("Please enter a name for the group");return}if(u===""||u===null){alert("Please enter a name for the job");return}let v=!1;const m=await F.getItem(`savedProject_${s}`);if(m){const i=JSON.parse(m).groups.find(g=>g.name===l);i&&(v=i.jobs.some(g=>g.name===u))}v&&!confirm("A job with this name already exists in this group. Do you want to overwrite it?")||(await I(u,l,s),await F.setItem("selectedProject",JSON.stringify({name:s})),await F.setItem("selectedGroup",JSON.stringify({name:l})),await F.setItem("selectedJob",JSON.stringify({name:u})),sn.style.display="none",Dt.style.display="none",Oe.style.display="none",je.style.display="none",Lt.value="",ht.value="",pt.value="",await b(),await o(),await n(),K.value=s,he.value=l,Ce.value=u,alert(`${u} saved`))},Ps.onclick=async function(){await F.setItem("selectedJob",""),await F.setItem("currentJob",""),oe.innerHTML=""},ws.onclick=function(){sn.style.display="none"},Xs.onclick=function(){an.style.display="none"},he.addEventListener("change",async()=>{const s=he.value;await F.setItem("selectedGroup",JSON.stringify({name:s})),n()}),Ls.onclick=async function(){oe.innerHTML="";const s=K.value,l=he.value,u=Ce.value;if(!s||!l||!u){alert("Please select a project, group, and job to load");return}const v=await F.getItem(`savedProject_${s}`);if(!v)return;const h=JSON.parse(v).groups.find(g=>g.name===l);if(!h)return;const i=h.jobs.find(g=>g.name===u);i&&(await p(i),await F.setItem("selectedProject",JSON.stringify({name:s})),await F.setItem("selectedGroup",JSON.stringify({name:l})),await F.setItem("selectedJob",JSON.stringify({name:u})),P(),S())},Ds.onclick=async function(){const s=K.value,l=he.value,u=Ce.value;if(!s||!l||!u){alert("Please select a project, group, and job to delete");return}const v=await F.getItem(`savedProject_${s}`);if(!v)return;const m=JSON.parse(v),h=m.groups.findIndex(g=>g.name===l);if(h===-1)return;const i=m.groups[h];i.jobs=i.jobs.filter(g=>g.name!==u),i.jobs.length===0&&m.groups.splice(h,1),m.groups.length===0?(await F.removeItem(`savedProject_${s}`),await b()):await F.setItem(`savedProject_${s}`,JSON.stringify(m)),await o(),await n(),oe.innerHTML=""},$s.onclick=function(){const s=document.createElement("input");s.type="file",s.accept=".json",s.multiple=!0,s.onchange=function(l){const u=l.target.files;if(u){oe.innerHTML="";const v=Array.from(u).map(m=>new Promise((h,i)=>{const g=new FileReader;g.onload=async function(C){var M;const T=(M=C.target)==null?void 0:M.result;if(T)try{const Z=JSON.parse(T);let G,j,ne;Z.projectName?(G=Z,j=G.projectName,ne=G.groupName):(G=Z,j="Imported",ne=G.groupName||"Legacy",G.projectName=j);let se=await F.getItem(`savedProject_${j}`),ce;se?ce=JSON.parse(se):ce={name:j,groups:[]};let de=ce.groups.find(ae=>ae.name===ne);de||(de={name:ne,jobs:[]},ce.groups.push(de));const me=de.jobs.findIndex(ae=>ae.name===G.name);if(me!==-1){if(!confirm(`A job with name "${G.name}" already exists in project "${j}", group "${ne}". Do you want to overwrite it?`)){h({job:G,projectName:j});return}de.jobs[me]=G}else de.jobs.push(G);await F.setItem(`savedProject_${j}`,JSON.stringify(ce)),await F.setItem("selectedProject",JSON.stringify({name:j})),await F.setItem("selectedGroup",JSON.stringify({name:ne})),await F.setItem("selectedJob",JSON.stringify({name:G.name})),h({job:G,projectName:j})}catch{i(new Error("Invalid JSON format"))}else i(new Error("No contents"))},g.readAsText(m)}));Promise.all(v).then(async m=>{if(m.length>0){const[h]=m;B(),await b(),K&&h&&(K.value=h.projectName),await o(),await n(),h&&h.job&&(p(h.job),S(),P())}}).catch(m=>{console.error("Error importing job:",m),alert("Error importing job: "+m.message)})}},s.click()},Os.onclick=async function(){Be.innerHTML="",Ae.innerHTML="",Xe.innerHTML="";const s=await F.getKeys("savedProject_");if(s.sort(),s.length>0)s.forEach(i=>{const g=i.replace("savedProject_",""),C=document.createElement("option");C.value=g,C.textContent=g,Xe.appendChild(C)});else{alert("No projects found. Please create a project first.");return}const l=await F.getItem("selectedProject"),u=await F.getItem("selectedGroup"),v=await F.getItem("selectedJob");let m=null,h=null;if(l)try{m=JSON.parse(l).name}catch{m=l}if(u)try{h=JSON.parse(u).name}catch{h=u}if(m&&(Xe.value=m),h){const i=await F.getItem(`savedProject_${m}`);i&&JSON.parse(i).groups.forEach(C=>{const T=document.createElement("option");T.value=C.name,T.textContent=C.name,Be.appendChild(T)}),Be.value=h}if(v){const i=JSON.parse(v),g=document.createElement("option");g.value=i.name,g.textContent=i.name,Ae.appendChild(g),Ae.value=i.name}an.style.display="block"},Xe.addEventListener("change",async()=>{const s=Xe.value;await F.setItem("selectedProject",JSON.stringify({name:s})),Be.innerHTML="",Ae.innerHTML="",f()}),Be.addEventListener("change",()=>{y()});async function f(){const s=Xe.value,l=await F.getItem(`savedProject_${s}`);if(l){const u=JSON.parse(l);Be.innerHTML="",u.groups.forEach(v=>{const m=document.createElement("option");m.value=v.name,m.textContent=v.name,Be.appendChild(m)})}}async function y(){const s=Be.value,l=Xe.value,u=await F.getItem(`savedProject_${l}`),v=u?JSON.parse(u).groups.find(m=>m.name===s):null;v&&(Ae.innerHTML="",v.jobs.forEach(m=>{const h=document.createElement("option");h.value=m.name,h.textContent=m.name,Ae.appendChild(h)}))}Zs.onclick=async function(){const s=Xe.value,l=Be.value,u=Ae.value,v=await F.getItem(`savedProject_${s}`);if(!v)return;const h=JSON.parse(v).groups.find(g=>g.name===l);if(!h)return;const i=h.jobs.find(g=>g.name===u);if(i&&i){const g=i.tasks,C={name:i.name,projectName:s,groupName:l,tasks:[]};for(const G of g){const j=await F.getItem(`taskCollection_${G.collectionName}`);if(j){const se=JSON.parse(j).tasks.find(ce=>ce.id===G.id);se&&C.tasks.push({id:se.id,collectionName:G.collectionName})}}const T=new Blob([JSON.stringify(C,null,2)],{type:"application/json"}),M=URL.createObjectURL(T),Z=document.createElement("a");Z.href=M,Z.download=`${C.name}.json`,Z.click(),URL.revokeObjectURL(M),an.style.display="none"}};async function b(){if(!K)return;K.innerHTML="";const s=await F.getKeys("savedProject_");s.sort(),s.forEach(u=>{const v=u.replace("savedProject_",""),m=document.createElement("option");m.value=v,m.textContent=v,K.appendChild(m)});const l=await F.getItem("selectedProject");if(l){let u;try{u=JSON.parse(l).name}catch{u=l}s.includes(`savedProject_${u}`)&&(K.value=u)}}K&&K.addEventListener("change",async()=>{const s=K.value;await F.setItem("selectedProject",JSON.stringify({name:s})),await o(),await n()})});const U=class U{static createThreadSpec(e,n,t,a){return{name:e,nominalDiameter:n,pitch:t,isCoarse:a,getInternalMinorDiameter(){return Number((this.nominalDiameter-1.082532*this.pitch).toFixed(3))},getMajorDiameter(){return this.nominalDiameter},getThreadDepth(r){return Number(r==="External"?(this.pitch*.61343).toFixed(3):(this.pitch*.54127).toFixed(3))},getMinorDiameter(r){return r==="External"?this.nominalDiameter-2*this.getThreadDepth(r):this.getInternalMinorDiameter()},getNumberOfPasses(r,c){var I=this.getThreadDepth(r);console.log(`Total depth for ${this.name} (${r}): ${I.toFixed(3)}mm`),console.log(`Max first pass depth: ${c.toFixed(3)}mm`);for(let p=3;p<=15;p++){let S=(p-1)/p;S=S*S;let B=I*(1-S),P=[],E=0;for(let L=1;L<=p;L++){let d=(p-L)/p;d=d*d;let f=I*(1-d),y=f-E;P.push(y.toFixed(3)),E=f}if(console.log(`${p} passes: [${P.join(", ")}]mm, first pass = ${B.toFixed(3)}mm`),B<=c)return console.log(`✓ Selected ${p} passes`),p}return console.log("No solution found within 15 passes, using 6 as fallback"),6}}}static generateThreadingGcode(e,n,t,a,r){const c=e.getMajorDiameter(),I=e.getMinorDiameter(n);let p,S;return n==="External"?(p=c/2,S=I/2):(p=I/2-.1,S=c/2),p=Math.round(p*1e3)/1e3,S=Math.round(S*1e3)/1e3,`G33 Z${t==="Right"?a:-a} X${-S} P${e.pitch} H${r} R${-p}`}static getThreadSpecByName(e){for(const n of this.threadTypes){const t=n.threads.find(a=>a.name===e);if(t)return t}}static getThreadGroups(){return this.threadTypes.map(e=>e.name)}static getThreadsForGroup(e){const n=this.threadTypes.find(t=>t.name===e);return n?n.threads:[]}};N(U,"threadTypes",[{name:"Metric",threads:[U.createThreadSpec("M3 x 0.35 (Fine)",3,.35,!1),U.createThreadSpec("M3 x 0.5 (Coarse)",3,.5,!0),U.createThreadSpec("M4 x 0.5 (Fine)",4,.5,!1),U.createThreadSpec("M4 x 0.7 (Coarse)",4,.7,!0),U.createThreadSpec("M5 x 0.5 (Fine)",5,.5,!1),U.createThreadSpec("M5 x 0.8 (Coarse)",5,.8,!0),U.createThreadSpec("M6 x 0.75 (Fine)",6,.75,!1),U.createThreadSpec("M6 x 1.0 (Coarse)",6,1,!0),U.createThreadSpec("M8 x 1.0 (Fine)",8,1,!1),U.createThreadSpec("M8 x 1.25 (Coarse)",8,1.25,!0),U.createThreadSpec("M10 x 1.0 (Fine)",10,1,!1),U.createThreadSpec("M10 x 1.5 (Coarse)",10,1.5,!0),U.createThreadSpec("M11 x 1.0 (Fine)",11,1,!1),U.createThreadSpec("M11 x 1.5 (Coarse)",11,1.5,!0),U.createThreadSpec("M12 x 1.25 (Fine)",12,1.25,!1),U.createThreadSpec("M12 x 1.75 (Coarse)",12,1.75,!0)]}]);let rt=U,w,Ht="H4V12FJ";const un={quickTaskFacing:{openButton:document.getElementById("quickTaskFacingButton"),modal:document.getElementById("quickTaskFacingModal"),closeButton:document.getElementById("quickTaskFacingCloseButton"),executeButton:document.getElementById("quickTaskFacingExecuteButton"),stopButton:document.getElementById("quickTaskFacingStopButton"),progressBar:document.getElementById("quickTaskFacingProgressBar"),taskFunction:ko},quickTaskGrooving:{openButton:document.getElementById("quickTaskGroovingButton"),modal:document.getElementById("quickTaskGroovingModal"),closeButton:document.getElementById("quickTaskGroovingCloseButton"),executeButton:document.getElementById("quickTaskGroovingExecuteButton"),stopButton:document.getElementById("quickTaskGroovingStopButton"),progressBar:document.getElementById("quickTaskGroovingProgressBar"),taskFunction:aa},quickTaskProfiling:{openButton:document.getElementById("quickTaskProfilingButton"),modal:document.getElementById("quickTaskProfilingModal"),closeButton:document.getElementById("quickTaskProfilingCloseButton"),executeButton:document.getElementById("quickTaskProfilingExecuteButton"),stopButton:document.getElementById("quickTaskProfilingStopButton"),progressBar:document.getElementById("quickTaskProfilingProgressBar"),taskFunction:yo},quickTaskDrilling:{openButton:document.getElementById("quickTaskDrillingButton"),modal:document.getElementById("quickTaskDrillingModal"),closeButton:document.getElementById("quickTaskDrillingCloseButton"),executeButton:document.getElementById("quickTaskDrillingExecuteButton"),stopButton:document.getElementById("quickTaskDrillingStopButton"),progressBar:document.getElementById("quickTaskDrillingProgressBar"),taskFunction:bo},quickTaskCone:{openButton:document.getElementById("quickTaskConeButton"),modal:document.getElementById("quickTaskConeModal"),closeButton:document.getElementById("quickTaskConeCloseButton"),executeButton:document.getElementById("quickTaskConeExecuteButton"),stopButton:document.getElementById("quickTaskConeStopButton"),progressBar:document.getElementById("quickTaskConeProgressBar"),taskFunction:ia},quickTaskBoring:{openButton:document.getElementById("quickTaskBoringButton"),modal:document.getElementById("quickTaskBoringModal"),closeButton:document.getElementById("quickTaskBoringCloseButton"),executeButton:document.getElementById("quickTaskBoringExecuteButton"),stopButton:document.getElementById("quickTaskBoringStopButton"),progressBar:document.getElementById("quickTaskBoringProgressBar"),taskFunction:To},quickTaskThreading:{openButton:document.getElementById("quickTaskThreadingButton"),modal:document.getElementById("quickTaskThreadingModal"),closeButton:document.getElementById("quickTaskThreadingCloseButton"),executeButton:document.getElementById("quickTaskThreadingExecuteButton"),stopButton:document.getElementById("quickTaskThreadingStopButton"),progressBar:document.getElementById("quickTaskThreadingProgressBar"),taskFunction:Eo},quickTaskToolOffsets:{openButton:document.getElementById("quickTaskToolOffsetsButton"),modal:document.getElementById("quickTaskToolOffsetsModal"),closeButton:document.getElementById("quickTaskToolOffsetsCloseButton"),executeButton:document.getElementById("quickTaskToolOffsetsExecuteButton"),stopButton:document.getElementById("quickTaskToolOffsetsStopButton"),progressBar:document.getElementById("quickTaskToolOffsetsProgressBar"),taskFunction:ra}},gn=document.getElementById("quickTaskFacingTravelFeedRate"),jt=document.getElementById("quickTaskFacingEndDiameter"),At=document.getElementById("quickTaskFacingFeedrate"),ze=document.getElementById("quickTaskFacingCopyToClipboardButton"),kt=document.getElementById("quickTaskFacingUsePecking"),fn=document.getElementById("quickTaskFacingPeckingDepth"),dn=document.getElementById("quickTaskFacingPeckingDepthContainer"),vn=document.getElementById("quickTaskFacingPeckingRetractionRate"),Hn=document.getElementById("quickTaskFacingCurrentPosition"),Qs=document.getElementById("quickTaskFacingRefreshPositionButton"),fo=document.getElementById("quickTaskFacingXStartPosition"),ea=document.getElementById("quickTaskFacingZStartPosition"),Vt=document.getElementById("quickTaskProfilingFinalDiameter"),Ct=document.getElementById("quickTaskProfilingDepth"),yn=document.getElementById("quickTaskProfilingFeedRate"),kn=document.getElementById("quickTaskProfilingRetractFeedRate"),Yt=document.getElementById("quickTaskProfilingDepthPerPass"),We=document.getElementById("quickTaskProfilingFinishingDepth"),Bt=document.getElementById("quickTaskProfilingPasses"),It=document.getElementById("quickTaskProfilingType"),Yn=document.getElementById("quickTaskProfilingFinalDiameterContainer"),Vn=document.getElementById("quickTaskProfilingDepthContainer"),Ke=document.getElementById("quickTaskProfilingCopyToClipboardButton"),ta=document.getElementById("quickTaskProfilingRefreshPositionButton"),Wn=document.getElementById("quickTaskProfilingCurrentPosition"),bn=document.getElementById("quickTaskProfilingXStartPosition"),Tn=document.getElementById("quickTaskProfilingZStartPosition"),En=document.getElementById("quickTaskDrillingDepth"),Jt=document.getElementById("quickTaskDrillingFeedRate"),zt=document.getElementById("quickTaskDrillingRetractFeedRate"),Cn=document.getElementById("quickTaskDrillingPeckCheckbox"),Qn=document.getElementById("quickTaskDrillingPeckingDepthContainer"),na=document.getElementById("quickTaskDrillingPeckingDepth"),Ue=document.getElementById("quickTaskDrillingCopyToClipboardButton"),eo=document.getElementById("quickTaskDrillingCurrentPosition"),oa=document.getElementById("quickTaskDrillingRefreshPositionButton"),Bn=document.getElementById("quickTaskDrillingZStartPosition"),to=document.getElementById("quickTaskThreadingType"),xe=document.getElementById("quickTaskThreadingSize"),sa=document.getElementById("quickTaskThreadingDirection"),vo=document.getElementById("quickTaskThreadingExternalOrInternal"),In=document.getElementById("quickTaskThreadingLength"),bt=document.getElementById("quickTaskThreadingPasses"),_e=document.getElementById("quickTaskThreadingCopyToClipboardButton"),qt=document.getElementById("quickTaskThreadingMaxFirstPassDepth"),xn=document.getElementById("quickTaskBoringDepth"),xt=document.getElementById("quickTaskBoringDepthOfCut"),Kt=document.getElementById("quickTaskBoringFeedRate"),Ut=document.getElementById("quickTaskBoringRetractFeedRate"),st=document.getElementById("quickTaskBoringType"),no=document.getElementById("quickTaskBoringFinalDiameterContainer"),oo=document.getElementById("quickTaskBoringDepthOfCutContainer"),at=document.getElementById("quickTaskBoringFinalDiameter"),Sn=document.getElementById("quickTaskBoringDepthPerPass"),Qe=document.getElementById("quickTaskBoringFinishingDepth"),wt=document.getElementById("quickTaskBoringPasses"),He=document.getElementById("quickTaskBoringCopyToClipboardButton"),so=document.getElementById("quickTaskBoringRefreshPositionButton"),mn=document.getElementById("quickTaskBoringCurrentPosition"),ao=document.getElementById("quickTaskBoringXStartPosition"),io=document.getElementById("quickTaskBoringZStartPosition"),wn=document.getElementById("quickTaskToolOffsetsProbeDiameter"),_t=document.getElementById("quickTaskToolOffsetsToolNumber"),ro=document.getElementById("quickTaskToolOffsetsToolType"),Gt=document.getElementById("quickTaskToolOffsetsOffsetX"),Rt=document.getElementById("quickTaskToolOffsetsOffsetZ");document.addEventListener("DOMContentLoaded",()=>{let o;w=Tt.getInstance(),w.addStatusChangeListener(()=>h(),X.QUICKTASKS);const e=document.getElementById("connectButton"),n=i=>i.replace("toolOffsets:","").replace("ok","").split("|").map(T=>{const M=T.match(/T(\d+)/),Z=M?parseInt(M[1]):0,G=T.match(/Z=(-?\d+\.?\d*)/),j=T.match(/X=(-?\d+\.?\d*)/),ne=T.match(/W=(-?\d+\.?\d*)/),se=T.match(/U=(-?\d+\.?\d*)/);return{tool:Z,z:G?parseFloat(G[1]):0,x:j?parseFloat(j[1]):0,w:ne?parseFloat(ne[1]):0,u:se?parseFloat(se[1]):0}}).filter(T=>!isNaN(T.tool));Object.keys(un).forEach(i=>{const g=un[i];un[i].openButton.addEventListener("click",async()=>{if(!(w!=null&&w.isConnected()))alert("Please connect to the machine first");else{if(o=g,i==="quickTaskCone"||i==="quickTaskGrooving"?alert("Not Yet Implemented, coming soon!"):g.modal.style.display="block",i==="quickTaskProfiling"){const T=await(w==null?void 0:w.getPosition(X.QUICKTASKS)),M=T==null?void 0:T.x,Z=T==null?void 0:T.z;Wn.value=`X: ${M.toFixed(3)} Z: ${Z.toFixed(3)}`,bn.value=M.toFixed(3),Tn.value=Z.toFixed(3)}if(i==="quickTaskFacing"){const T=await(w==null?void 0:w.getPosition(X.QUICKTASKS)),M=T==null?void 0:T.x,Z=T==null?void 0:T.z;Hn.value=`X: ${M.toFixed(3)} Z: ${Z.toFixed(3)}`,fo.value=M.toFixed(3),ea.value=Z.toFixed(3)}if(i==="quickTaskBoring"){const T=await(w==null?void 0:w.getPosition(X.QUICKTASKS)),M=T==null?void 0:T.x,Z=T==null?void 0:T.z;mn.value=`X: ${M.toFixed(3)} Z: ${Z.toFixed(3)}`,ao.value=M.toFixed(3),io.value=Z.toFixed(3)}if(i==="quickTaskDrilling"){const T=await(w==null?void 0:w.getPosition(X.QUICKTASKS)),M=T==null?void 0:T.x,Z=T==null?void 0:T.z;eo.value=`X: ${M.toFixed(3)} Z: ${Z.toFixed(3)}`,Bn.value=Z.toFixed(3)}if(i==="quickTaskToolOffsets"){const T=await w.getToolOffsets(X.GCODE),M=n(T);if(_t.innerHTML="",M.length>0){for(let Z=1;Z<=M.length-1;Z++){const G=document.createElement("option");G.value=`T${Z}`,G.textContent=`T${Z}`,_t.appendChild(G)}_t.value="T1"}}}}),g.executeButton.addEventListener("click",()=>{g.taskFunction()}),g.stopButton.addEventListener("click",()=>{w==null||w.stop()}),g.closeButton.addEventListener("click",()=>{g.modal.style.display="none"})});const t=()=>{(Ct.value||at)&&yn.value&&kn.value&&Bt.value&&Yt.value&&We.value?(o.executeButton.disabled=!1,o.executeButton.classList.remove("disabled-button"),o.executeButton.classList.add("interaction-ready-button"),Ke.disabled=!1,Ke.classList.remove("disabled-button"),Ke.classList.add("interaction-ready-button")):(o.executeButton.disabled=!0,o.executeButton.classList.add("disabled-button"),o.executeButton.classList.remove("interaction-ready-button"),Ke.disabled=!0,Ke.classList.add("disabled-button"),Ke.classList.remove("interaction-ready-button"))};ta.addEventListener("click",async()=>{const i=await(w==null?void 0:w.getPosition(X.QUICKTASKS)),g=i==null?void 0:i.x,C=i==null?void 0:i.z;Wn.value=`X: ${g.toFixed(3)} Z: ${C.toFixed(3)}`,bn.value=g.toFixed(3),Tn.value=C.toFixed(3)}),It.addEventListener("change",()=>{It.value==="Absolute"?(Vn.style.display="none",Yn.style.display="block"):(Vn.style.display="block",Yn.style.display="none"),gt(),ft(),t()}),Vt.addEventListener("input",()=>{gt(),ft(),t()}),Ct.addEventListener("input",()=>{gt(),ft(),t()}),Bt.addEventListener("input",()=>{ft(),t()}),Yt.addEventListener("input",()=>{gt(),t()}),We.addEventListener("input",()=>{gt(),ft(),t()}),Ke.addEventListener("click",()=>yo(!0));const a=()=>{jt.value&&Number(At.value)>0?(o.executeButton.disabled=!1,o.executeButton.classList.remove("disabled-button"),o.executeButton.classList.add("interaction-ready-button"),ze.disabled=!1,ze.classList.remove("disabled-button"),ze.classList.add("interaction-ready-button")):(o.executeButton.disabled=!0,o.executeButton.classList.add("disabled-button"),o.executeButton.classList.remove("interaction-ready-button"),ze.disabled=!0,ze.classList.add("disabled-button"),ze.classList.remove("interaction-ready-button"))};Qs.addEventListener("click",async()=>{const i=await(w==null?void 0:w.getPosition(X.QUICKTASKS)),g=i==null?void 0:i.x,C=i==null?void 0:i.z;Hn.value=`X: ${g.toFixed(3)} Z: ${C.toFixed(3)}`}),jt.addEventListener("input",a),At.addEventListener("input",a),gn.addEventListener("input",a),ze.addEventListener("click",()=>ko(!0)),fn.addEventListener("input",a),vn.addEventListener("input",a),kt.addEventListener("change",()=>{kt.checked?dn.style.display="block":dn.style.display="none"});const r=localStorage.getItem("facingFeedrate");r!==null&&(At.value=r);const c=localStorage.getItem("facingEndDiameter");c!==null&&(jt.value=c);const I=localStorage.getItem("facingTravelFeedRate");I!==null&&(gn.value=I);const p=localStorage.getItem("facingPeckingDepth");p!==null&&(fn.value=p);const S=localStorage.getItem("facingPeckingRetractionRate");S!==null&&(vn.value=S);const B=localStorage.getItem("facingUsePecking");B!==null&&(kt.checked=B==="true",dn.style.display=kt.checked?"block":"none");const P=()=>{const i=st.value,g=xn.value&&Kt.value&&Ut.value&&wt.value&&Qe.value;let C=!1;i==="Absolute"?C=!!at.value:C=!!xt.value,g&&C?(o.executeButton.disabled=!1,o.executeButton.classList.remove("disabled-button"),o.executeButton.classList.add("interaction-ready-button"),He.disabled=!1,He.classList.remove("disabled-button"),He.classList.add("interaction-ready-button")):(o.executeButton.disabled=!0,o.executeButton.classList.add("disabled-button"),o.executeButton.classList.remove("interaction-ready-button"),He.disabled=!0,He.classList.add("disabled-button"),He.classList.remove("interaction-ready-button"))};so.addEventListener("click",async()=>{const i=await(w==null?void 0:w.getPosition(X.QUICKTASKS)),g=i==null?void 0:i.x,C=i==null?void 0:i.z;mn.value=`X: ${g.toFixed(3)} Z: ${C.toFixed(3)}`,ao.value=g.toFixed(3),io.value=C.toFixed(3)}),xn.addEventListener("input",P),Kt.addEventListener("input",P),Ut.addEventListener("input",P),so.addEventListener("click",async()=>{const i=await(w==null?void 0:w.getPosition(X.QUICKTASKS)),g=i==null?void 0:i.x,C=i==null?void 0:i.z;mn.value=`X: ${g.toFixed(3)} Z: ${C.toFixed(3)}`}),st.addEventListener("change",()=>{st.value==="Absolute"?(no.style.display="block",oo.style.display="none"):(no.style.display="none",oo.style.display="block"),vt(),yt(),P()}),at.addEventListener("input",()=>{vt(),yt(),P()}),xt.addEventListener("input",()=>{vt(),yt(),P()}),wt.addEventListener("input",()=>{yt(),P()}),Sn.addEventListener("input",()=>{vt(),P()}),Qe.addEventListener("input",()=>{vt(),yt(),P()}),He.addEventListener("click",()=>To(!0)),Cn.addEventListener("change",()=>{Cn.checked?Qn.style.display="block":Qn.style.display="none"});const E=()=>{En.value&&Jt.value&&zt.value?(o.executeButton.disabled=!1,o.executeButton.classList.remove("disabled-button"),o.executeButton.classList.add("interaction-ready-button"),Ue.disabled=!1,Ue.classList.remove("disabled-button"),Ue.classList.add("interaction-ready-button")):(o.executeButton.disabled=!0,o.executeButton.classList.add("disabled-button"),o.executeButton.classList.remove("interaction-ready-button"),Ue.disabled=!0,Ue.classList.add("disabled-button"),Ue.classList.remove("interaction-ready-button"))};oa.addEventListener("click",async()=>{const i=await(w==null?void 0:w.getPosition(X.QUICKTASKS)),g=i==null?void 0:i.x,C=i==null?void 0:i.z;eo.value=`X: ${g.toFixed(3)} Z: ${C.toFixed(3)}`,Bn.value=C.toFixed(3)}),En.addEventListener("input",E),Jt.addEventListener("input",E),zt.addEventListener("input",E),Ue.addEventListener("click",()=>bo(!0)),xe.addEventListener("change",()=>{L()}),qt.addEventListener("input",()=>{L(),f()});const L=()=>{const i=rt.getThreadSpecByName(xe.value),g=vo.value;var C=qt.value?parseFloat(qt.value):.3;if(!i){bt.value="";return}const T=i.getNumberOfPasses(g,C);bt.value=T.toString()},d=()=>{const i=to.value,g=rt.getThreadsForGroup(i);xe.innerHTML='<option value="">Select Thread Size</option>',g.length>0?(g.sort((C,T)=>C.nominalDiameter!==T.nominalDiameter?C.nominalDiameter-T.nominalDiameter:C.pitch-T.pitch).forEach(C=>{const T=document.createElement("option");T.value=C.name,T.textContent=C.name,xe.appendChild(T)}),xe.disabled=!1):xe.disabled=!0},f=()=>{xe.value&&In.value&&bt.value&&qt.value?(o.executeButton.disabled=!1,o.executeButton.classList.remove("disabled-button"),o.executeButton.classList.add("interaction-ready-button"),_e.disabled=!1,_e.classList.remove("disabled-button"),_e.classList.add("interaction-ready-button")):(_e.disabled=!0,_e.classList.add("disabled-button"),_e.classList.remove("interaction-ready-button"),o.executeButton.disabled=!0,o.executeButton.classList.add("disabled-button"),o.executeButton.classList.remove("interaction-ready-button"))};xe.addEventListener("change",f),In.addEventListener("input",f),bt.addEventListener("input",f),to.addEventListener("change",d),_e.addEventListener("click",()=>Eo(!0)),d();const y=localStorage.getItem("probeDiameter");y!==null&&(wn.value=y);const b=localStorage.getItem("drillingRetractFeedRate");b!==null&&(zt.value=b);const s=localStorage.getItem("boringRetractFeedrate");s!==null&&(Ut.value=s);const l=localStorage.getItem("profilingRetractFeedrate");l!==null&&(kn.value=l);const u=localStorage.getItem("drillingFeedRate");u!==null&&(Jt.value=u);const v=localStorage.getItem("boringFeedRate");v!==null&&(Kt.value=v);const m=localStorage.getItem("profilingFeedRate");m!==null&&(yn.value=m);function h(){if(!w)return;const i=w.getStatus();if(i.isConnected===!1){e.innerText="Connect",e.disabled=!1,e.style.backgroundColor="";return}else e.innerText="Connected",e.disabled=!0,e.style.backgroundColor="green";const g=i.condition==="run";if(!g)o.executeButton.style.display="flex",o.stopButton.style.display="none",o.progressBar.value=0,o.progressBar.parentElement.style.display="none";else if(g){o.executeButton.style.display="none",o.stopButton.style.display="inline-block",o.progressBar.parentElement.style.display="block";const C=i.progress;o.progressBar.value=C}}});async function yo(o=!1){const e=parseFloat(bn.value),n=parseFloat(Tn.value);if(isNaN(e)||isNaN(n)){alert("Please enter a valid starting position");return}const t=Number(parseFloat(document.getElementById("quickTaskProfilingLength").value).toFixed(3)),a=parseInt(Bt.value,10),r=Number(parseFloat(yn.value).toFixed(3)),c=Number(parseFloat(kn.value).toFixed(3)),I=It.value;localStorage.setItem("profilingRetractFeedrate",c.toString()),localStorage.setItem("profilingFeedRate",r.toString());const p=[];p.push("G90"),p.push(`G0 X${e} Z${n} F${c} ; move to start position`),p.push("G91");let S=0,B=0;I==="Absolute"?(S=-Number(parseFloat(Vt.value).toFixed(3))/2,B=Math.abs(S-e),B=Number(B.toFixed(3))):B=Number(parseFloat(Ct.value).toFixed(3));let P=Number(parseFloat(We.value).toFixed(3));P>B&&(P=B);const E=Number((B-P).toFixed(3));let L=0;a>1?(P>0?L=E/(a-1):L=E/a,L=Number(L.toFixed(3))):a===1&&(L=E);let d=0,f=0;a>1&&P>0?f=a-1:f=a;for(let b=0;b<f;b++){let s=L;p.push(`G1 X${s} F${r} ; roughing cut ${b+1}`),p.push(`G1 Z${t} F${r} ; cut`),p.push(`G1 X-0.2 F${c} ; retract`),p.push(`G1 Z-${t} F${c} ; retract`),p.push(`G1 X0.2 F${c} ; travel`),d+=s,d=Number(d.toFixed(3))}let y=0;if(I==="Absolute"){const b=Number((e+d).toFixed(3));y=Number(Math.abs(S-b).toFixed(3))}else y=P;if(y>.001&&(p.push(`G1 X${y} F${r} ; finishing cut`),p.push(`G1 Z${t} F${r} ; cut`),p.push(`G1 X-0.2 F${c} ; retract`),p.push(`G1 Z-${t} F${c} ; retract`)),p.push("G90"),p.push(`G0 X${e} Z${n} F${c} ; move to final position`),p.push("G91"),o){navigator.clipboard.writeText(p.join(`
`)).then(()=>{alert("G-code copied to clipboard")}).catch(()=>{alert("Failed to copy G-code to clipboard")});return}w==null||w.sendCommands(p,X.QUICKTASKS)}async function gt(){const o=await(w==null?void 0:w.getPosition(X.QUICKTASKS)),e=o==null?void 0:o.x;let n=0,t;if(It.value==="Absolute"){const p=-Number(parseFloat(Vt.value).toFixed(3))/2;t=Math.abs(p-e),t=Number(t.toFixed(3))}else t=Number(parseFloat(Ct.value).toFixed(3));n=Number(parseFloat(Yt.value).toFixed(3));let a=Number(parseFloat(We.value).toFixed(3));a>t&&(a=t,We.value=a.toFixed(3));const r=Number((t-a).toFixed(3));let c=1;n>0&&(c=Math.ceil(r/n)+1),Bt.value=c.toString()}async function ft(){const o=await(w==null?void 0:w.getPosition(X.QUICKTASKS)),e=o==null?void 0:o.x;let n;if(It.value==="Absolute"){const p=-Number(parseFloat(Vt.value).toFixed(3))/2;n=Math.abs(p-e),n=Number(n.toFixed(3))}else n=Number(parseFloat(Ct.value).toFixed(3));const t=parseInt(Bt.value,10);let a=Number(parseFloat(We.value).toFixed(3));a>n&&(a=n,We.value=a.toFixed(3));const r=Number((n-a).toFixed(3));let c=0;t>1?(a>0?c=r/(t-1):c=r/t,c=Number(c.toFixed(3))):c=n,Yt.value=c.toFixed(3)}async function ko(o=!1){let e=[];const n=Number(parseFloat(fo.value).toFixed(3)),t=Math.abs(n)*2,a=Number(parseFloat(jt.value).toFixed(3)),r=Number(parseFloat(At.value).toFixed(3)),c=Number(parseFloat(gn.value).toFixed(3)),I=kt.checked,p=Number(parseFloat(fn.value).toFixed(3)),S=Number(parseFloat(vn.value).toFixed(3));localStorage.setItem("facingFeedrate",r.toString()),localStorage.setItem("facingPeckingDepth",p.toString()),localStorage.setItem("facingEndDiameter",a.toString()),localStorage.setItem("facingTravelFeedRate",c.toString()),localStorage.setItem("facingPeckingRetractionRate",S.toString()),localStorage.setItem("facingUsePecking",I.toString()),e.push("G90"),e.push(`G0 X${n} F${c} ; move to start position`),e.push("G91");const B=t/2,P=a/2,E=Math.abs(B-P);if(I){const L=Math.ceil(E/p),d=E/L;let f=0;for(let y=0;y<L;y++){if(e.push(`G0 X${d} F${r} ; cut`),f+=d,f=Number(f.toFixed(3)),f>=E){e.push(`G1 X-${f} F${c} ; retract to start position`);break}(y+1)%S===0?(e.push(`G1 X-${f} F${c} ; retract to start position`),e.push(`G1 X${f} F${c} ; travel back to cut position`)):(e.push(`G1 X-${d} F${c} ; retract short distance`),e.push(`G1 X${d} F${r} ; travel back to surface`))}}else e.push(`G1 X${E} F${r} ; cut`),e.push(`G1 X-${E} F${c} ; retract to start position`);if(o){navigator.clipboard.writeText(e.join(`
`)).then(()=>{alert("G-code copied to clipboard")}).catch(()=>{alert("Failed to copy G-code to clipboard")});return}w==null||w.sendCommands(e,X.QUICKTASKS)}function bo(o=!1){const e=parseFloat(En.value),n=parseFloat(Jt.value),t=Cn.checked;let a=parseFloat(na.value);const r=parseFloat(zt.value),c=50,I=3,p=3;let S=!1,B=0;const P=parseFloat(Bn.value);if(isNaN(P)){alert("Please enter a valid starting Z position");return}localStorage.setItem("drillingRetractFeedRate",r.toString()),localStorage.setItem("drillingFeedRate",n.toString());let E=[];if(E.push("G90"),E.push(`G0 X0 Z${P} F${r} ; move to start position`),E.push("G91"),t){let L=!1,d=0;for(;!L;){if(E.push(`G1 Z${a} F${n}`),B++,d+=a,B===I?(E.push(`G1 Z-${d+p} F${r}`),S=!0,B=0):E.push(`G1 Z-${d} F${r}`),d>=e){L=!0;break}else d+a>e&&(a=e-d);S?(E.push(`G1 Z${d+p-.2} F${r}`),E.push(`G1 Z${.2} F${c}`),S=!1):(E.push(`G1 Z${d-.2} F${r}`),E.push(`G1 Z${.2} F${c}`))}}else E.push(`G1 Z${e} F${n}`),E.push(`G1 Z-${e} F${r}`);if(o){navigator.clipboard.writeText(E.join(`
`)).then(()=>{alert("G-code copied to clipboard")}).catch(()=>{alert("Failed to copy G-code to clipboard")});return}w==null||w.sendCommands(E,X.QUICKTASKS)}function aa(){alert("Not Yet Implemented")}function ia(){alert("Not Yet Implemented")}async function To(o=!1){const e=await(w==null?void 0:w.getPosition(X.QUICKTASKS)),n=e==null?void 0:e.x,t=Number(parseFloat(xn.value).toFixed(3)),a=Number(parseFloat(Kt.value).toFixed(3)),r=st.value,c=parseInt(wt.value,10),I=Number(parseFloat(Ut.value).toFixed(3));localStorage.setItem("boringRetractFeedrate",I.toString()),localStorage.setItem("boringFeedRate",a.toString());const p=[];p.push("G91");let S=0,B=0;r==="Absolute"?(S=-Number(parseFloat(at.value).toFixed(3))/2,B=Math.abs(n-S),B=Number(B.toFixed(3))):B=Number(parseFloat(xt.value).toFixed(3));let P=Number(parseFloat(Qe.value).toFixed(3));P>B&&(P=B);const E=Number((B-P).toFixed(3));let L=0;c>1?(P>0?L=E/(c-1):L=E/c,L=Number(L.toFixed(3))):c===1&&(L=E);let d=0,f=0;c>1&&P>0?f=c-1:f=c;for(let b=0;b<f;b++){let s=L;p.push(`G1 X-${s} F${a} ; roughing cut ${b+1}`),p.push(`G1 Z${t} F${a} ; cut`),p.push(`G0 X0.2 F${I} ; retract`),p.push(`G0 Z-${t} F${I} ; retract`),p.push(`G0 X-0.2 F${I} ; travel`),d+=s,d=Number(d.toFixed(3))}let y=0;if(r==="Absolute"){const b=Number((n-d).toFixed(3));y=Number(Math.abs(b-S).toFixed(3))}else y=P;if(y>.001&&(p.push(`G1 X-${y} F${a} ; finishing cut`),p.push(`G1 Z${t} F${a} ; cut`),p.push(`G0 X0.2 F${I} ; retract`),p.push(`G0 Z-${t} F${I} ; retract`)),p.push("G90"),o){navigator.clipboard.writeText(p.join(`
`)).then(()=>{alert("G-code copied to clipboard")}).catch(()=>{alert("Failed to copy G-code to clipboard")});return}w==null||w.sendCommands(p,X.QUICKTASKS)}async function vt(){const o=await(w==null?void 0:w.getPosition(X.QUICKTASKS)),e=o==null?void 0:o.x;let n;if(st.value==="Absolute"){const p=-Number(parseFloat(at.value).toFixed(3))/2;n=Math.abs(e-p),n=Number(n.toFixed(3))}else n=Number(parseFloat(xt.value).toFixed(3));const t=Number(parseFloat(Sn.value).toFixed(3));let a=Number(parseFloat(Qe.value).toFixed(3));a>n&&(a=n,Qe.value=a.toFixed(3));const r=Number((n-a).toFixed(3));let c=1;t>0&&(c=Math.ceil(r/t)+1),wt.value=c.toString()}async function yt(){const o=await(w==null?void 0:w.getPosition(X.QUICKTASKS)),e=o==null?void 0:o.x;let n;if(st.value==="Absolute"){const p=-Number(parseFloat(at.value).toFixed(3))/2;n=Math.abs(e-p),n=Number(n.toFixed(3))}else n=Number(parseFloat(xt.value).toFixed(3));const t=parseInt(wt.value,10);let a=Number(parseFloat(Qe.value).toFixed(3));a>n&&(a=n,Qe.value=a.toFixed(3));const r=Number((n-a).toFixed(3));let c=0;t>1?(a>0?c=r/(t-1):c=r/t,c=Number(c.toFixed(3))):c=n,Sn.value=c.toFixed(3)}function Eo(o=!1){const e=w==null?void 0:w.getStatus();if(!e||!e.isConnected){alert("Please connect to the machine first");return}else if(e.version!==Ht){alert(`Threading is only supported on ${Ht} controllers. Please see the help page for more information.`);return}else{const n=xe.value;if(n===""){alert("Please select a thread size");return}const t=sa.value,a=vo.value,r=parseFloat(In.value),c=parseInt(bt.value,10),I=rt.getThreadSpecByName(n),p=rt.generateThreadingGcode(I,a,t,r,c);if(o){navigator.clipboard.writeText(p).then(()=>{alert("G-code copied to clipboard")}).catch(()=>{alert("Failed to copy G-code to clipboard")});return}const S=[];S.push("G90"),S.push(p),w==null||w.sendCommands(S,X.QUICKTASKS)}}function ra(){const o=w==null?void 0:w.getStatus();if(!o||!o.isConnected){alert("Please connect to the machine first");return}else if(o.version!==Ht){alert(`Tool offsets is only supported on ${Ht} controllers. Please see the help page for more information.`);return}let e=_t.value;if(e===""){alert("Please enter a tool number");return}if(e[0]==="T"&&(e=e.substring(1)),parseInt(e,10)===0){alert("T0 is the primary tool and cannot be modified");return}let n="XZ";if(Gt.value===""&&(n=n.replace("X","")),Rt.value===""&&(n=n.replace("Z","")),n===""){alert("Please enter X and/or Z values");return}localStorage.setItem("probeDiameter",wn.value);let t=[];const a=parseFloat(wn.value)/2;if(ro.value.startsWith("External")){const r={x:parseFloat(Gt.value),z:parseFloat(Rt.value),radius:a,toolType:"External"},c=pn(r);n==="X"?t.push(`G10 P${e} X${c.x}`):n==="Z"?t.push(`G10 P${e} Z${c.z}`):t.push(`G10 P${e} X${c.x} Z${c.z}`)}else if(ro.value.startsWith("Internal")){const r={x:parseFloat(Gt.value),z:parseFloat(Rt.value),radius:a,toolType:"Internal"},c=pn(r);n==="X"?t.push(`G10 P${e} X${c.x}`):n==="Z"?t.push(`G10 P${e} Z${c.z}`):t.push(`G10 P${e} X${c.x} Z${c.z}`)}else{const r={x:parseFloat(Gt.value),z:parseFloat(Rt.value),radius:a,toolType:"Drill"},c=pn(r);n==="X"?t.push(`G10 P${e} X${c.x}`):n==="Z"?t.push(`G10 P${e} Z${c.z}`):t.push(`G10 P${e} X${c.x} Z${c.z}`)}w==null||w.sendCommands(t,X.QUICKTASKS),alert(`Tool offsets for T${e} have been set`)}function pn(o){let e;switch(o.toolType){case"Drill":e=-o.x;break;case"Internal":e=-(o.x-o.radius);break;case"External":e=-(o.x- -o.radius);break}const n=-o.z,t=a=>Math.round(a*1e3)/1e3;return{x:t(e),z:t(n)}}const ca="#DC143C",la="#6B8E23",ua="#FFA500",da="#242424",Ye=5;class ma{constructor(){N(this,"currentX",0);N(this,"currentZ",0);N(this,"absX",0);N(this,"absZ",0);N(this,"previousCanvasX",0);N(this,"previousCanvasZ",0);N(this,"canvasX",0);N(this,"canvasZ",0);N(this,"ctx",null);N(this,"stockDiameterInMM",0);N(this,"isBoringOperation",!1);N(this,"hasOperationType",!1)}parseGCode(e){let n=!1;const t=[],a={z:0,x:0};let r=0,c=!1;return this.isBoringOperation=!1,this.hasOperationType=!1,e.split(`
`).forEach((p,S)=>{const B=this.determineMovementType(p);this.hasOperationType||(p.toLowerCase().includes("; op type boring")||p.toLowerCase().includes("; op type drilling")?(this.isBoringOperation=!0,this.hasOperationType=!0):(p.toLowerCase().includes("; op type turning")||p.toLowerCase().includes("; op type profiling")||p.toLowerCase().includes("; op type facing"))&&(this.isBoringOperation=!1,this.hasOperationType=!0));const P={isRelative:n,movementType:B},E=p.match(/([GXYZF])([0-9.-]+)/g);if(!c&&p.includes(";")){const d=p.substring(p.indexOf(";")),f=[/stock\s+d(?:iameter)?\s*[=:]?\s*(\d+\.?\d*)(?:mm)?/i,/stock\s+(?:diameter|dia|diam)?\s*[=:]?\s*(\d+\.?\d*)(?:mm)?/i,/diameter\s*[=:]?\s*(\d+\.?\d*)(?:mm)?/i,/dia\s*[=:]?\s*(\d+\.?\d*)(?:mm)?/i];for(const y of f){const b=d.match(y);if(b&&b[1]){r=parseFloat(b[1]),c=!0,this.stockDiameterInMM=r;break}}}E==null||E.forEach(d=>{const f=parseFloat(d.slice(1));switch(d[0]){case"G":f===90&&(P.isRelative=!1,n=!1),f===91&&(P.isRelative=!0,n=!0);break;case"X":P.x=parseFloat(f.toFixed(3)),n?a.x=parseFloat((a.x+f).toFixed(3)):(a.x=parseFloat(f.toFixed(3)),c||(r=Math.abs(a.x)*2,this.stockDiameterInMM=r,c=!0));break;case"Z":P.z=parseFloat(f.toFixed(3)),n?a.z=parseFloat((a.z+f).toFixed(3)):a.z=parseFloat(f.toFixed(3));break}});const L={...P,lineNumber:S+1,originalLine:p,absolutePosition:{...a}};(P.z!==void 0||P.x!==void 0)&&t.push(L)}),t}determineMovementType(e){const n=e.toLowerCase(),t=n.includes(";")?n.substring(n.indexOf(";")).trim():"";return t.includes("cut")||t.includes("rough")||t.includes("finish")||t.includes("facing")||t.includes("turn")?0:t.includes("retract")||t.includes("return")||t.includes("safe")?2:1}calculateDynamicScaleFactor(e,n){let t=0,a=0,r=e.find(b=>!b.isRelative),c=r&&r.x?r.x:0,I=r&&r.z?r.z:0;const p=5;e.forEach(b=>{b.x!==void 0&&(b.isRelative?(c+=b.x,c<a&&(a=c)):b.x<a&&(a=b.x)),b.z!==void 0&&(b.isRelative?(I+=b.z,I>t&&(t=I)):b.z>t&&(t=b.z))});const S=this.stockDiameterInMM/2,B=Math.max(Math.abs(a),S),P=Math.abs(t),E=n.height/2-p,L=n.width-p-Ye,d=E/B,f=L/P;return Math.min(d,f)}draw(e,n,t,a,r=!0,c=!0){if(this.ctx=e.getContext("2d"),!this.ctx)return;this.ctx.clearRect(0,0,e.width,e.height),this.currentX=0,this.currentZ=0,this.absX=0,this.absZ=0,this.previousCanvasX=e.height/2,this.previousCanvasZ=e.width-Ye;let I=this.stockDiameterInMM;const p=document.createElement("canvas");p.width=e.width,p.height=e.height,this.drawStockOnCanvas(p,I,t);const S=a!==void 0?Math.min(a+1,n.length):n.length;for(let B=0;B<S;B++)n[B].isRelative?(this.currentX+=n[B].x??0,this.currentZ+=n[B].z??0):(this.currentX=n[B].x??this.absX,this.currentZ=n[B].z??this.absZ,this.absX=this.currentX,this.absZ=this.currentZ),this.canvasX=e.height/2-this.currentX*t,this.canvasZ=e.width-this.currentZ*t-Ye,r&&this.removeStockMaterial(p,t),this.previousCanvasX=this.canvasX,this.previousCanvasZ=this.canvasZ;this.ctx.drawImage(p,0,0),this.currentX=0,this.currentZ=0,this.absX=0,this.absZ=0,this.previousCanvasX=e.height/2,this.previousCanvasZ=e.width-Ye,this.drawReferenceLines(e);for(let B=0;B<S;B++)this.drawLinesCommand(e,n[B],t,B===(a??-1),r,c)}drawStockOnCanvas(e,n,t){const a=e.getContext("2d");if(!a)return;a.lineWidth=2;let r=n*t/2;const c=0,I=e.height/2-r,p=n*t,S=e.width;a.beginPath(),a.rect(c,I,S,p),a.fillStyle="lightgrey",a.fill(),a.strokeStyle="#666666",a.stroke()}drawReferenceLines(e){const n=e.getContext("2d");n&&(n.beginPath(),n.moveTo(0,e.height/2),n.lineTo(e.width,e.height/2),n.strokeStyle="blue",n.setLineDash([5,5]),n.stroke(),n.beginPath(),n.moveTo(e.width-Ye,0),n.lineTo(e.width-Ye,e.height),n.strokeStyle="#888888",n.setLineDash([5,5]),n.stroke(),n.setLineDash([]))}removeStockMaterial(e,n){const t=e.getContext("2d");if(!t)return;const a=()=>{const c=2*n;if(this.isBoringOperation){const I=this.canvasZ-this.previousCanvasZ,p=this.canvasX-this.previousCanvasX,S=Math.sqrt(I*I+p*p);t.globalCompositeOperation="destination-out",t.fillStyle="black";const B=e.height/2,E=Math.abs(this.currentX)*n,L=B-E;let d;if(n!==0){const y=(e.height/2-this.previousCanvasX)/-n;d=Math.abs(y)*n}else d=E;const f=B-d;S<.001||Math.abs(I)<.001?(t.beginPath(),t.rect(this.canvasZ,L,c,E),t.fill()):(t.beginPath(),t.moveTo(this.previousCanvasZ,f),t.lineTo(this.canvasZ,L),t.lineTo(this.canvasZ+c,L),t.lineTo(this.previousCanvasZ+c,f),t.closePath(),t.fill(),t.beginPath(),t.moveTo(this.previousCanvasZ,f),t.lineTo(this.canvasZ,L),t.lineTo(this.canvasZ,B),t.lineTo(this.previousCanvasZ,B),t.closePath(),t.fill(),t.beginPath(),t.moveTo(this.canvasZ+c,L),t.lineTo(this.previousCanvasZ+c,f),t.lineTo(this.previousCanvasZ+c,B),t.lineTo(this.canvasZ+c,B),t.closePath(),t.fill()),t.globalCompositeOperation="source-over"}else{const I=this.canvasZ-this.previousCanvasZ,p=this.canvasX-this.previousCanvasX,S=Math.sqrt(I*I+p*p);t.globalCompositeOperation="destination-out",t.fillStyle="black",S<.001||Math.abs(I)<.001?(t.beginPath(),t.rect(this.canvasZ,this.canvasX,c,e.height-this.canvasX),t.fill()):(t.beginPath(),t.moveTo(this.previousCanvasZ,this.previousCanvasX),t.lineTo(this.canvasZ,this.canvasX),t.lineTo(this.canvasZ+c,this.canvasX),t.lineTo(this.previousCanvasZ+c,this.previousCanvasX),t.closePath(),t.fill(),t.beginPath(),t.moveTo(this.previousCanvasZ,this.previousCanvasX),t.lineTo(this.canvasZ,this.canvasX),t.lineTo(this.canvasZ,e.height),t.lineTo(this.previousCanvasZ,e.height),t.closePath(),t.fill(),t.beginPath(),t.moveTo(this.canvasZ+c,this.canvasX),t.lineTo(this.previousCanvasZ+c,this.previousCanvasX),t.lineTo(this.previousCanvasZ+c,e.height),t.lineTo(this.canvasZ+c,e.height),t.closePath(),t.fill()),t.globalCompositeOperation="source-over"}};a(),t.save(),t.scale(1,-1),t.translate(0,-e.height),a(),t.restore()}drawLinesCommand(e,n,t,a,r,c){if(this.ctx=e.getContext("2d"),!this.ctx)return;this.ctx.lineWidth=2,n.isRelative?(this.currentX+=n.x??0,this.currentZ+=n.z??0):(this.currentX=n.x??this.absX,this.currentZ=n.z??this.absZ,this.absX=this.currentX,this.absZ=this.currentZ),this.canvasX=e.height/2-this.currentX*t,this.canvasZ=e.width-this.currentZ*t-Ye;let I="";if((n.movementType==0&&r||n.movementType==1&&c||n.movementType==2&&c)&&(this.ctx.beginPath(),I=n.movementType==0?ca:n.movementType==1?la:ua,this.ctx.moveTo(this.previousCanvasZ,this.previousCanvasX),this.ctx.lineTo(this.canvasZ,this.canvasX),a?(this.ctx.strokeStyle=I,this.ctx.setLineDash([5,5]),this.ctx.lineDashOffset=0,this.ctx.stroke(),this.ctx.strokeStyle=da,this.ctx.setLineDash([5,5]),this.ctx.lineDashOffset=-5,this.ctx.stroke()):(this.ctx.strokeStyle=I,this.ctx.setLineDash([]),this.ctx.stroke()),a)){let p=this.canvasZ-this.previousCanvasZ,S=this.canvasX-this.previousCanvasX,B=Math.atan2(S,p);this.ctx.save(),this.ctx.translate(this.previousCanvasZ,this.previousCanvasX),this.ctx.rotate(B+Math.PI/2),this.ctx.beginPath(),this.ctx.moveTo(0,-5),this.ctx.lineTo(-5,5),this.ctx.lineTo(5,5),this.ctx.closePath(),this.ctx.fillStyle="green",this.ctx.fill(),this.ctx.restore(),this.ctx.beginPath(),this.ctx.rect(this.canvasZ-3,this.canvasX-3,6,6),this.ctx.fillStyle="red",this.ctx.fill()}this.previousCanvasX=this.canvasX,this.previousCanvasZ=this.canvasZ}}const W=ace.edit("gcodeEditor"),we=ace.edit("gcodeResponseEditor"),te=ace.edit("gcodeSenderEditor");document.addEventListener("DOMContentLoaded",()=>{new Fo;const o=new ma;let e=[];const n=document.getElementById("gcodeCanvas"),t=document.getElementById("zoomCanvas"),a=document.getElementById("fileInput"),r=document.getElementById("simulateButton"),c=document.getElementById("showCuts"),I=document.getElementById("showNonCuts"),p=document.getElementById("showCutsZoom"),S=document.getElementById("showNonCutsZoom"),B=document.getElementById("sliderLabel"),P=document.getElementById("zoomSliderLabel"),E=document.getElementById("progressSlider"),L=document.getElementById("zoomProgressSlider"),d=document.getElementById("sliderContainer"),f=document.getElementById("displayOptionsContainer"),y=document.getElementById("clearButton"),b=document.getElementById("saveGCodeName"),s=document.getElementById("loadGCodeSelect"),l=document.getElementById("loadGCodeButton"),u=document.getElementById("saveGCodeButton"),v=document.getElementById("deleteGCodeButton"),m=document.getElementById("gcodeSenderContainer"),h=document.getElementById("exampleCode"),i=document.getElementById("helpModal"),g=document.getElementById("helpButton"),C=document.getElementById("closeHelpModal"),T=document.getElementById("zoomModal"),M=document.getElementById("zoomButton"),Z=document.getElementById("closeZoomModal"),G=document.getElementById("zoomCloseButton"),j=document.getElementById("simulationTab"),ne=document.getElementById("controlTab"),se=document.getElementById("quickTasksTab"),ce=document.getElementById("plannerTab"),de=document.getElementById("helpTab"),me=document.getElementById("connectionContainer"),ae=document.getElementById("simulationContainer"),be=document.getElementById("controlsContainer"),Se=document.getElementById("quickTasksContainer"),fe=document.getElementById("plannerContainer"),Me=document.getElementById("helpContainer"),St=document.querySelectorAll("#latheControls .increment-btn"),Wt=document.getElementById("moveDistance");localStorage.getItem("helpModalShown")||(i.style.display="block",localStorage.setItem("helpModalShown","true")),St.forEach(function(x){x.addEventListener("click",function(){St.forEach(function(R){R.classList.remove("active")}),this.classList.add("active");var O=this.dataset.increment;Wt.value=O,localStorage.setItem("moveDistance",O)})}),j.addEventListener("click",()=>{ae.style.display="flex",be.style.display="none",Se.style.display="none",fe.style.display="none",me.style.display="none",Me.style.display="none"}),ne.addEventListener("click",()=>{ae.style.display="none",be.style.display="flex",Se.style.display="none",fe.style.display="none",me.style.display="block",Me.style.display="none"}),se.addEventListener("click",()=>{ae.style.display="none",be.style.display="none",Se.style.display="flex",fe.style.display="none",me.style.display="block",Me.style.display="none"}),ce.addEventListener("click",()=>{ae.style.display="none",be.style.display="none",Se.style.display="none",fe.style.display="flex",me.style.display="block",Me.style.display="none";const x=new Event("containerVisible");fe.dispatchEvent(x)}),de.addEventListener("click",()=>{ae.style.display="none",be.style.display="none",Se.style.display="none",fe.style.display="none",me.style.display="none",Me.style.display="flex"}),t.width=window.visualViewport.width-100,t.height=window.visualViewport.height-150,window.addEventListener("resize",function(){t.width=window.visualViewport.width-100,t.height=window.visualViewport.height-150,L.value=L.min,ct(t)}),M.onclick=function(){T.style.display="block",ct(t)},Z.onclick=function(){T.style.display="none"},G.onclick=function(){T.style.display="none"},g.onclick=function(){i.style.display="block"},C.onclick=function(){i.style.display="none"},window.onclick=function(x){x.target==i&&(i.style.display="none"),x.target==T&&(T.style.display="none")},u.addEventListener("click",()=>k()),l.addEventListener("click",()=>D()),v.addEventListener("click",()=>$()),q(),W.setTheme("ace/theme/github_dark"),W.session.setMode("ace/mode/plain_text"),W.setShowPrintMargin(!1);const et=document.querySelector("#gcodeEditor textarea");et&&(et.setAttribute("id","gcodeEditor-textarea"),et.setAttribute("aria-label","G-Code Editor - Enter your G-code here"),et.setAttribute("role","textbox")),te.setTheme("ace/theme/github_dark"),te.session.setMode("ace/mode/plain_text"),te.setShowPrintMargin(!1);const qe=document.querySelector("#gcodeSenderEditor textarea");qe&&(qe.setAttribute("id","gcodeSenderEditor-textarea"),qe.setAttribute("aria-label","G-Code Sender - Enter G-code to send to CNC machine"),qe.setAttribute("role","textbox")),h.addEventListener("click",()=>ie()),we.setTheme("ace/theme/monokai"),we.session.setMode("ace/mode/text"),we.setReadOnly(!0),we.setShowPrintMargin(!1);const Fe=document.querySelector("#gcodeResponseEditor textarea");Fe&&(Fe.setAttribute("id","gcodeResponseEditor-textarea"),Fe.setAttribute("aria-label","G-Code Response Display - Shows responses from CNC machine"),Fe.setAttribute("role","log"),Fe.setAttribute("aria-live","polite")),we.getSession().on("change",()=>{setTimeout(()=>{var x=we.getSession().getLength();we.scrollToLine(x,!0,!0,function(){})},0)}),te.on("focus",()=>{te.getValue()==="Paste your gcode here or click choose file to upload"&&te.setValue("")}),H(),E.oninput=()=>{const x=Math.floor(parseInt(E.value));if(x<e.length){const O=e[x];let R=o.calculateDynamicScaleFactor(e,n);o.draw(n,e,R,x,c.checked,I.checked),A(O)}},L.oninput=()=>{const x=Math.floor(parseInt(L.value));if(x<e.length){const O=e[x];let R=o.calculateDynamicScaleFactor(e,t);o.draw(t,e,R,x,p.checked,S.checked),Pe(O)}},y.addEventListener("click",()=>{te.setValue(""),W.setValue(""),H();const x=n.getContext("2d");x&&(x.clearRect(0,0,n.width,n.height),a.value="",E.value="0",L.value="0",d.style.display="none",f.style.display="none")}),a.addEventListener("change",x=>{if(x.target instanceof HTMLInputElement&&x.target.files&&x.target.files.length>0){const O=x.target.files[0];O&&Y(O)}}),r.addEventListener("click",()=>{ct(n)});function ct(x){if(!x)return;const O=W.getValue();if(O){e=o.parseGCode(O);let R=o.calculateDynamicScaleFactor(e,x);o.draw(x,e,R,void 0,c.checked,I.checked),d.style.display="block",f.style.display="block",c.addEventListener("change",pe),I.addEventListener("change",pe),p.addEventListener("change",Q),S.addEventListener("change",Q),E.max=(e.length-1).toString(),E.value=E.min,L.max=(e.length-1).toString(),L.value=L.min,m.style.display="block"}}function k(){const x=b.value.trim();if(!x)return;const O=`gCode-${x}`;localStorage.setItem(O,W.getValue()),q(O),b.value=""}function D(){const x=s.value,O=localStorage.getItem(x);O&&(W.setValue(O),te.setValue(O))}function $(){const x=s.value;localStorage.removeItem(x),q()}function q(x){s.innerHTML="";let O=!1;for(let R=0;R<localStorage.length;R++){const J=localStorage.key(R);if(J&&J!=="latheCode"&&J.startsWith("gCode-")){O=!0;const Ne=document.createElement("option"),Co=J.replace("gCode-","");Ne.value=J,Ne.textContent=Co,s.appendChild(Ne),J===x&&(Ne.selected=!0)}}if(O){const R=Array.from(s.options).sort((J,Ne)=>J.text.localeCompare(Ne.text));s.innerHTML="",R.forEach(J=>{s.appendChild(J)})}else{const R=document.createElement("option");R.textContent="No items saved",R.disabled=!0,s.appendChild(R)}}function H(){const x=W.getValue(),O=te.getValue();x===""&&(W.setValue("Paste your gcode here or click choose file to upload"),W.gotoLine(1,0),W.on("focus",function(){W.getValue()==="Paste your gcode here or click choose file to upload"&&W.setValue("")})),O===""&&(te.setValue("Paste your gcode here or click choose file to upload"),te.gotoLine(1,0),te.on("focus",function(){te.getValue()==="Paste your gcode here or click choose file to upload"&&te.setValue("")}))}function A(x){var O,R,J;(x==null?void 0:x.lineNumber)!==void 0?(W.gotoLine(x.lineNumber,0,!0),B.innerHTML=`Line:${x.lineNumber}<br>${x==null?void 0:x.originalLine}<br>Abs: X${((O=x.absolutePosition)==null?void 0:O.x)??0} &lpar;Dia: ${(((R=x.absolutePosition)==null?void 0:R.x)??0)*2}&rpar; Z${(J=x.absolutePosition)==null?void 0:J.z}`||""):B.innerHTML=""}function Pe(x){var O,R,J;(x==null?void 0:x.lineNumber)!==void 0?(W.gotoLine(x.lineNumber,0,!0),P.innerHTML=`Line:${x.lineNumber}<br>${x==null?void 0:x.originalLine}<br>Abs: X${(O=x.absolutePosition)==null?void 0:O.x} &lpar;Dia: ${(((R=x.absolutePosition)==null?void 0:R.x)??0)*2}&rpar; Z${(J=x.absolutePosition)==null?void 0:J.z}`||""):P.innerHTML=""}function Y(x){const O=new FileReader;O.onload=R=>{const J=R.target.result;W.setValue(J),te.setValue(J)},O.readAsText(x)}function pe(){p.checked=c.checked,S.checked=I.checked,E.value="0";const x=o.calculateDynamicScaleFactor(e,n);o.draw(n,e,x,void 0,c.checked,I.checked)}function Q(){c.checked=p.checked,I.checked=S.checked,L.value="0";const x=o.calculateDynamicScaleFactor(e,t);o.draw(t,e,x,void 0,p.checked,S.checked)}function ie(){W.setValue(Po)}});

</script>
  <style>
:root{font-family:Inter,system-ui,Avenir,Helvetica,Arial,sans-serif;line-height:1.5;font-weight:400;color-scheme:light dark;color:#ffffffde;background-color:#202124;font-synthesis:none;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}a{font-weight:500;color:#646cff;text-decoration:inherit}a:hover{color:#535bf2}h1{font-size:3.2em;line-height:1.1}table{width:100%;display:flex;flex-direction:column}thead,tr{display:flex;width:100%}th:first-child,td:first-child{flex:0 0 60px}th:last-child,td:last-child{flex:0 0 60px}th:not(:first-child):not(:last-child),td:not(:first-child):not(:last-child){flex:1}hr{width:100%;border:none;border-top:1px solid #ffffff;margin:10px 0}#app{max-width:1280px;margin:0 auto;padding:2rem;text-align:center}.logo{height:6em;padding:1.5em;will-change:filter;transition:filter .3s}.logo:hover{filter:drop-shadow(0 0 2em #646cffaa)}.logo.vanilla:hover{filter:drop-shadow(0 0 2em #3178c6aa)}.card{padding:2em}.read-the-docs{color:#888}button{border-radius:3px;padding:.6em 1.2em;font-size:1em;font-weight:500;font-family:inherit;background-color:#1a1a1a;cursor:pointer;transition:background-color .25s;border:2px solid white;color:#fff}button:hover{background-color:#646cff}button:focus,button:focus-visible{outline:4px auto -webkit-focus-ring-color}input[readonly]{cursor:not-allowed;background-color:#2f4f4f;border-color:#767676}.disabled-button{background-color:red;cursor:not-allowed}.interaction-ready-button{background-color:green}.interaction-ready-warn-button{background-color:red}.icon-container{width:60px;height:50px;padding:5px 10px}.icon-container svg{width:100%;height:100%}#simulationContainer{display:flex;flex-direction:column;width:800px;max-width:1280px;text-align:center}.main-container{display:flex;width:100%}#interactiveComponentsContainer,#controlsContainer,#quickTasksContainer{display:flex;flex-direction:column;width:800px;max-width:1280px;text-align:center}button.quick-tasks-innercontainer{display:flex;align-items:center;cursor:pointer;background:none;border:none;padding:0;margin:5px 0;border:1px solid #ccc;border-radius:5px;background-color:#333;flex-direction:column;justify-content:center;width:100%;box-sizing:border-box}button.quick-tasks-innercontainer:hover{background-color:#6c5ce7}button.execute{padding:0 10px;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;margin:0 auto}input.quick-task-summary{width:auto;box-sizing:border-box}.tooltip-icon{display:inline-flex;margin-left:5px;cursor:help;color:#fff;font-weight:700;font-size:16px;position:relative;width:18px;height:18px;border:2px solid #ffffff;border-radius:50%;align-items:center;justify-content:center;text-align:center;vertical-align:middle}.tooltip-icon:hover:after{content:attr(data-tooltip);position:absolute;background-color:#333;color:#fff;padding:5px;border-radius:5px;white-space:nowrap;z-index:10;top:100%;left:50%;transform:translate(-50%)}.quick-tasks-subinnercontainer{display:flex;flex-direction:row}.controls-container,.connection-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;border:1px solid #ccc}.canvas-container{display:flex;flex-direction:column;align-items:center;margin:5px;border:1px solid #ccc}.canvas-wrapper{display:flex;flex-direction:column;align-items:center}.innerContainer{margin:5px;align-items:center;width:auto}.modal-pad{padding-top:10px}.modal-pad-bottom{padding-bottom:10px}.modal-pad-bottom-flex{padding-bottom:10px;flex:1;display:flex;flex-direction:column}.emulation-modal-pad-border{padding:10px;border:2px dashed green;min-height:40px}.innerContainer.toolbar{display:flex;align-items:center;gap:5px;padding:2px}#saveGCodeNameInput,#loadGCodeSelect{flex-grow:1}#gcodeCanvas{border-bottom:1px solid #ccc;background-color:#242424}#gcodeInput{position:relative;background:transparent;width:100%;height:240px;font-family:monospace;font-size:13px;line-height:1.5;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}#gcodeContainer{position:relative;width:100%}#gcodeSenderContainer{display:block}.save-group,.load-group,.import-export-group{display:flex;flex-direction:row;align-items:center;gap:10px}.toolbar input[type=text],.toolbar select{max-width:200px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem;font-size:1rem;line-height:1.5}input[type=file]::file-selector-button{border:2px solid #6c5ce7;padding:.2em .4em;border-radius:.2em;background-color:#1a1a1a;transition:.25s}input[type=file]::-ms-browse:hover{background-color:#646cff}input[type=file]::-webkit-file-upload-button:hover{background-color:#646cff}input[type=file]::file-selector-button:hover{background-color:#646cff}.bottom-container{margin:5px}#gcodeResponseContainer{border:1px solid #ccc;width:100%;display:flex;flex-direction:column;align-items:center;margin-top:5px}.senderError{display:none;color:#fff;background-color:red;padding:10px;border-radius:5px;animation:flashError 1s infinite}@keyframes flashError{0%,to{opacity:1}50%{opacity:0}}#helpText li{margin-bottom:10px}#helpText a{color:#f95959}.help-modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.help-modal-content{position:relative;background-color:#242424;margin:15% auto;padding:20px;border:2px solid #6c5ce7;width:30%}.zoom-modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#242424}.zoom-modal-content{display:flex;flex-direction:column;align-items:center;margin:10px auto;padding:20px;border:1px solid #888}.close-modal{position:absolute;top:0;right:0;padding-right:10px;cursor:pointer;font-size:35px}#sliderAndButtonContainer{display:flex;justify-content:center;align-items:center;gap:10px;flex-direction:column}.text-red{color:#dc143c}.text-green{color:#6b8e23}.text-orange{color:orange}.line{display:inline-block;vertical-align:middle;width:20px;height:2px;margin-right:5px}.red-line{border-top:2px solid #DC143C}.green-line{border-top:2px solid #6B8E23}.orange-line{border-top:2px solid #FFA500}#latheControls #jogControls{display:grid;grid-template-columns:repeat(12,60px);grid-template-rows:repeat(7,60px);justify-content:center;align-items:center;place-items:center}#latheControls .jog-btn{width:50px;height:50px;border-radius:5px;cursor:pointer;background-color:#f0ad4e;display:flex;justify-content:center;align-items:center;text-align:center;line-height:50px;font-size:24px;padding:0}#latheControls .tool-btn{width:50px;height:50px;border-radius:5px;cursor:pointer;background-color:#379126;display:flex;justify-content:center;align-items:center;text-align:center;line-height:20px;font-size:12px;padding:0}#latheControls .tool-btn:hover{background-color:#6c5ce7}#latheControls .zero-btn{width:50px;height:50px;border-radius:5px;cursor:pointer;display:flex;justify-content:center;align-items:center;text-align:center;line-height:20px;font-size:12px;padding:0}#latheControls .zero-btn:hover{background-color:#6c5ce7}#latheControls .wpos-btn{background-color:#268591}#latheControls .mpos-btn{background-color:#915b26}.zero-btn,.zero-labels{grid-column:var(--col);grid-row:var(--row)}#latheControls .tool{background-color:#f0ad4e;border:none}#latheControls .tool-selected{background-color:#6c5ce7;border:2px solid white}#latheControls .fast{background-color:#2196f3}#latheControls .slow{background-color:#4caf50}#latheControls .jog-btn:hover{background-color:#6c5ce7}.jog-btn,.jog-labels{grid-column:var(--col);grid-row:var(--row)}.tool-label{grid-column:var(--col) / span 2;grid-row:var(--row);font-size:18px;align-self:end}.tool-select{width:100px;height:50px;border-radius:5px;cursor:pointer;background-color:#004b8b;text-align:center;font-size:20px;padding:0 16px 0 0;appearance:none;-webkit-appearance:none;-moz-appearance:none;border:none;display:flex;justify-content:center;align-items:center;border:2px solid white;grid-column:var(--col) / span 2;grid-row:var(--row);background-image:url("data:image/svg+xml;utf8,<svg fill='white' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");background-repeat:no-repeat;background-position:right -8px center;background-size:30px}.tool-select:after{content:"▼";position:absolute;right:5px;top:50%;transform:translateY(-50%);font-size:12px;pointer-events:none}.tool-select option{background-color:#202124;color:#ffffffde;text-align:center}.tool-select:focus{outline:none;box-shadow:0 0 3px #f0ad4e}.tool-edit{width:100px;height:50px;border-radius:5px;cursor:pointer;background-color:#004b8b;text-align:center;font-size:18px;appearance:none;-webkit-appearance:none;-moz-appearance:none;border:none;display:flex;justify-content:center;align-items:center;border:2px solid white;grid-column:var(--col) / span 2;grid-row:var(--row)}.tool-btn{grid-column:var(--col);grid-row:var(--row)}.tool-save-button{padding:0;border:none;background:none;cursor:pointer;display:flex;align-items:center;justify-content:center;width:100%}.tool-save-button:hover{background-color:#0000001a;border-radius:3px}.tool-cell{flex:0 0 60px;padding:4px;border-bottom:1px solid #444}.data-cell{flex:1;padding:4px;border-bottom:1px solid #444}.action-cell{flex:0 0 60px;padding:4px;border-bottom:1px solid #444}.position-displays{display:flex;flex-direction:column;gap:5px}.positionLocation{display:flex;align-items:center;gap:10px;justify-content:center}.tool-cell input{width:100%;padding:4px;text-align:center;background-color:#333;border:1px solid #444}.data-cell input{width:100%;padding:4px;text-align:right;border:1px solid #444}.menu ul{list-style-type:none;padding:0}.menu li{cursor:pointer;padding:10px;background-color:#242424;border-bottom:1px solid #6c5ce7}.menu li:hover{background-color:#6c5ce7}.content{margin-left:200px;padding:20px}#senderProgressContainer{display:flex;justify-content:center;align-items:center}#senderProgressLabel{margin-right:10px}.innerContentCentre{display:flex;justify-content:center;align-items:center;margin:10px}#gcodeSenderContainer{position:relative;width:100%}#latheControls #incrementControls{display:flex;justify-content:center;gap:10px;margin:20px 0}#latheControls .increment-btn{padding:5px 10px;border:1px solid #ccc;background-color:#3a3d3d;border-radius:5px;cursor:pointer;transition:background-color .3s}#latheControls .increment-btn:hover,#latheControls .increment-btn.active{background-color:#6c5ce7}.control-inputs input[type=text]{max-width:200px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem}.control-inputs label{display:block;margin-right:5px}.sender-inputs input[type=text]{max-width:350px;min-width:350px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem}.gcode-dropdown{position:absolute;max-height:200px;overflow-y:auto;border:1px solid #ccc;background:var(--background-color, #fff);z-index:1000;border-radius:4px;box-shadow:0 2px 4px #0000001a}.gcode-option{padding:8px 12px;cursor:pointer;color:inherit;background-color:#202124}.gcode-option:hover{filter:brightness(1.2)}#latheControls label{white-space:nowrap;margin-right:10px;display:inline-block;min-width:120px}#plannerContainer{display:flex;flex-direction:column;width:800px;max-width:1280px;text-align:center}.planner-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;border:1px solid #ccc}.planner-container h1{margin:10px 0}.planner-guidance{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:10px;text-align:center}.planner-guidance span{display:block;margin:10px 0;text-align:left}#taskContainer{display:flex;justify-content:space-between;align-items:start;padding:20px}.container-wrapper{padding:10px}.container-wrapper-inner{padding:5px 0}.container-wrapper-outer{border:1px solid #ccc;border-radius:5px;margin:10px;background-color:#333}.container-wrapper-delete{min-height:50px;display:flex;justify-content:center;align-items:center;border:2px dashed red}#availableTasks{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;align-items:start;min-width:450px}#availableTasks .span-2-rows{grid-row:span 3;height:100%}#availableTasks div{box-sizing:border-box;padding:5px}#tasksToExecute{min-height:50px;padding:5px;border:2px dashed green}#tasksToExecute div{margin:5px}.task-to-execute{text-align:left}.task-to-execute i{text-align:left;margin-left:5px;cursor:help}.available-task{width:150px;-webkit-user-select:none;user-select:none}.available-task i{margin-left:5px;cursor:help}.task-manual{background-color:#4c956c}.task-gcode{background-color:#386e97}.task-tool-change{background-color:#e74c3c}.emulate-noselect{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#emulationInnerContainer{display:flex;flex-direction:row;justify-content:center;align-items:center;height:100%}#emulationNewTasksMovement{display:grid;grid-template-columns:repeat(9,40px);grid-template-rows:repeat(3,40px);gap:3px;align-items:center;justify-items:center}#emulationNewTasksNumbers,#emulationNewTasksOther{display:grid;grid-template-columns:repeat(2,40px);grid-template-rows:repeat(6,40px);gap:3px;align-items:center;justify-items:center}#emulationNewTasksMode{display:grid;grid-template-columns:repeat(8,40px);grid-template-rows:repeat(1,40px);gap:3px;align-items:center;justify-items:center}#movementContainer,#modeContainer{width:100%;display:flex;justify-content:center;align-items:center;margin:5px;padding:5px}#emulateKeyUp{grid-area:1 / 2}#emulateKeyDown{grid-area:3 / 2}#emulateKeyLeft{grid-area:2 / 1}#emulateKeyRight{grid-area:2 / 3}#emulateKeyPlay{grid-area:1 / 5}#emulateKeyStop{grid-area:3 / 5}#emulateKeyStopUp{grid-area:1 / 8}#emulateKeyStopDown{grid-area:3 / 8}#emulateKeyStopLeft{grid-area:2 / 7}#emulateKeyStopRight{grid-area:2 / 9}#emulationNewTasksMode button.material-symbols-outlined{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksMode button:hover{background-color:#18a79b}#emulationNewTasksMode button:focus,#emulationNewTasksMode button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksMovement button.material-symbols-outlined{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksMovement button:hover{background-color:#18a79b}#emulationNewTasksMovement button:focus,#emulationNewTasksMovement button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksNumbers button{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700;font-family:monospace}#emulationNewTasksNumbers button:hover{background-color:#18a79b}#emulationNewTasksNumbers button:focus,#emulationNewTasksNumbers button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksOther button{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksOther button:hover{background-color:#18a79b}#emulationNewTasksOther button:focus,#emulationNewTasksOther button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}.emulated-button-list{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700!important}.standard-font{font-family:monospace!important}#emulationNewTasks{list-style-type:none;display:grid;grid-template-columns:repeat(11,1fr);grid-auto-rows:auto;gap:10px;padding:0;margin:0}#emulateKeySteps{transform:scaleX(-1)}.flexCol{display:flex;flex-direction:column;align-items:center;justify-content:center}.outerCol{padding-top:15px}.middleCol{align-self:flex-start}.task-container{margin:5px}.task-container>div,.gu-mirror{transition:opacity .4s ease-in-out}.task-container>div{padding:5px;cursor:move;cursor:grab;cursor:-moz-grab;cursor:-webkit-grab;display:flex;align-items:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.gu-mirror{padding:5px;text-align:center;cursor:grabbing;cursor:-moz-grabbing;cursor:-webkit-grabbing}.task-container .ex-moved{background-color:#e74c3c}.task-container.ex-over{background-color:#ffffff4d}.planner-save-text{max-width:none!important}.planner-save-button{flex:auto}.planner-load-select{max-width:none!important}.planner-load-delete-buttons{width:50%}.planner-saving-label{text-wrap:nowrap}.no-marge{margin:0}.task-modal{z-index:9999;display:none;position:fixed;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.task-modal-content{position:relative;background-color:#242424;margin:15% auto;padding:20px;border:2px solid #6c5ce7;max-width:600px;min-width:600px;display:flex;flex-direction:column}.task-modal-manual{border:5px solid #4c956c}.task-modal-gcode{border:5px solid #386e97}.task-modal-tool-change{border:5px solid #e74c3c}.full-width-textarea{width:100%;box-sizing:border-box;resize:vertical}.center-modal{text-align:center}.left-modal{text-align:left!important;display:block}.icon-tooltip{position:relative;cursor:pointer}.icon-tooltip:after{content:attr(data-tooltip);position:absolute;bottom:100%;left:50%;transform:translate(-50%);white-space:nowrap;z-index:1;background-color:#000;color:#fff;padding:5px;border-radius:4px;opacity:0;visibility:hidden;transition:opacity .2s,visibility .2s}.icon-tooltip:hover:after{opacity:1;visibility:visible}.threading-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;width:800px;max-width:1280px;text-align:center;border:1px solid #ccc}.gu-mirror{position:fixed!important;margin:0!important;z-index:9999!important;opacity:.8}.gu-hide{display:none!important}.gu-unselectable{-webkit-user-select:none!important;-moz-user-select:none!important;-ms-user-select:none!important;user-select:none!important}.gu-transit{opacity:.2}

</style>
</head>

<body>

    <div id="mainContainer" class="main-container">
        <div class="menu">
            <ul>
                <li id="simulationTab">Simulation</li>
                <li id="controlTab">Control</li>
                <li id="quickTasksTab">Quick Tasks</li>
                <li id="plannerTab">Planner</li>
                <li id="helpTab">Help</li>
            </ul>
        </div>

        <div id="simulationContainer" class="main-container">
            <div id="simulationContent" class="controls-container">
                <div id="gcodeContainer" style="position: relative;">
                    <div id="gcodeEditor" style="height: 200px; width: 100%;"></div>
                </div>
                <div class="innerContainer">
                    <input type="file" id="fileInput" accept=".txt,.gcode">
                </div>
                <div class="innerContainer">
                    <button id="simulateButton">Simulate</button>
                    <button id="clearButton">Clear</button>
                    <button id="helpButton">How to use</button>
                </div>


                <div class="innerContainer" id="loadAndSave">
                    <hr>
                    <div class="innerContainer toolbar">
                        <input type="text" id="saveGCodeName" placeholder="name of save"></input>
                        <button id="saveGCodeButton" title="Save GCode to local browser storage">Save local</button>
                    </div>
                    <div class="innerContainer toolbar">
                        <select id="loadGCodeSelect"></select>
                        <button id="loadGCodeButton" title="Load GCode from local browser storage">Load</button>
                        <button id="deleteGCodeButton" title="Delete GCode from local browser storage">Delete</button>
                    </div>
                    <hr>
                </div>
            </div>

            <div class="canvas-container">
                <canvas id="gcodeCanvas" width="785" height="600"></canvas>
                <div id="sliderContainer" class="innerContainer" style="display: none; width: 400px;">
                    <input type="range" id="progressSlider" min="0" max="100" value="0" style="width: 100%;">
                    <div id="sliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                </div>
                <div id="displayOptionsContainer" class="innerContainer" style="display: none;">
                    <label>
                        <input type="checkbox" id="showStock" checked> Show Stock
                    </label>
                    <label>
                        <input type="checkbox" id="showCuts" checked> Show Cut Moves
                    </label>
                    <label>
                        <input type="checkbox" id="showNonCuts" checked>
                        Show Non-Cut Moves
                    </label>
                </div>
                <div id="sliderContainer" class="innerContainer" style="display: none; width: 400px;">
                    <input type="range" id="progressSlider" min="0" max="100" value="0" style="width: 100%;">
                    <div id="sliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                </div>
                <div class="innerContainer"><button id="zoomButton" title="Zoom in">Zoom In</button></div>
            </div>

        </div>

        <div id="interactiveComponentsContainer" class="main-container">
            <div id="connectionContainer" class="connection-container" style="display: none;">
                <div class="innerContainer">
                    <button id="connectButton" title="Connect to Nano ELS H4">Connect</button>
                </div>
            </div>
            <div id="controlsContainer" class="main-container" style="display: none;">
                <div id="controlsContent" class="controls-container">

                    <div id="latheControls">
                        <div id="jogControls">

                            <span id="toolText" class="tool-label" style="--col: 1; --row: 1">Current Tool</span>

                            <!-- Tools -->
                            <select class="tool-select" style="--col: 1; --row: 2" id="toolSelector">
                                <option value="T0">T0</option>
                                <option value="T1">T1</option>
                                <option value="T2">T2</option>
                                <option value="T3">T3</option>
                                <option value="T4">T4</option>
                                <option value="T5">T5</option>
                                <option value="T6">T6</option>
                                <option value="T7">T7</option>
                                <option value="T8">T8</option>
                                <option value="T9">T9</option>
                                <option value="T10">T10</option>
                                <option value="T11">T11</option>
                                <option value="T12">T12</option>
                                <option value="T13">T13</option>
                                <option value="T14">T14</option>
                                <option value="T15">T15</option>
                                <option value="T16">T16</option>
                                <option value="T17">T17</option>
                                <option value="T18">T18</option>
                                <option value="T19">T19</option>
                                <option value="T20">T20</option>
                                <option value="T21">T21</option>
                                <option value="T22">T22</option>
                                <option value="T23">T23</option>
                                <option value="T24">T24</option>
                                <option value="T25">T25</option>
                                <option value="T26">T26</option>
                                <option value="T27">T27</option>
                                <option value="T28">T28</option>
                                <option value="T29">T29</option>
                            </select>

                            <button class="tool-edit" style="--col: 1; --row: 3;" id="editToolsButton">Edit
                                Tools</button>

                            <button class="tool-btn change-tool" style="--col: 3; --row: 2;" id="toolChange">Change
                                Tool</button>

                            <span id="jogText" class="jog-labels" style="--col: 7; --row: 1">X</span>
                            <span id="fastText" class="jog-labels" style="--col: 6; --row: 2">Fast</span>
                            <span id="slowText" class="jog-labels" style="--col: 6; --row: 3">Slow</span>
                            <button class="arrow fast jog-btn" style="--col: 7; --row: 2" id="fastForward">
                                <i class="fas fa-arrow-up"></i></button>
                            <button class="arrow fast jog-btn" style="--col: 7; --row: 6" id="fastBackward">
                                <i class="fas fa-arrow-down"></i></button>
                            <span id="jogText" class="jog-labels" style="--col: 4; --row: 4">Z</span>
                            <button class="arrow fast jog-btn" style="--col: 5; --row: 4" id="fastLeft">
                                <i class="fas fa-arrow-left"></i></button>
                            <button class="arrow fast jog-btn" style="--col: 9; --row: 4" id="fastRight">
                                <i class="fas fa-arrow-right"></i></button>
                            <button class="arrow slow jog-btn" style="--col: 7; --row: 3" id="slowForward">
                                <i class="fas fa-arrow-up"></i></button>
                            <button class="arrow slow jog-btn" style="--col: 7; --row: 5" id="slowBackward">
                                <i class="fas fa-arrow-down"></i></button>
                            <button class="arrow slow jog-btn" style="--col: 6; --row: 4" id="slowLeft">
                                <i class="fas fa-arrow-left"></i></button>
                            <button class="arrow slow jog-btn" style="--col: 8; --row: 4" id="slowRight">
                                <i class="fas fa-arrow-right"></i></button>
                            <span id="jogText" class="jog-labels" style="--col: 11; --row: 1">Y</span>
                            <button class="arrow fast jog-btn" style="--col: 11; --row: 2" id="fastUp">
                                <i class="fas fa-arrow-up"></i></button>
                            <button class="arrow fast jog-btn" style="--col: 11; --row: 6" id="fastDown">
                                <i class="fas fa-arrow-down"></i></button>
                            <button class="arrow slow jog-btn" style="--col: 11; --row: 3" id="slowUp">
                                <i class="fas fa-arrow-up"></i></button>
                            <button class="arrow slow jog-btn" style="--col: 11; --row: 5" id="slowDown">
                                <i class="fas fa-arrow-down"></i></button>

                            <!-- Zeroing -->
                            <button class="zero-btn mpos-btn" style="--col: 1; --row: 5" id="MposZeroZ">MPOS Zero Z</button>
                            <button class="zero-btn mpos-btn" style="--col: 1; --row: 6" id="MposZeroX">MPOS Zero X</button>
                            <button class="zero-btn mpos-btn" style="--col: 1; --row: 7" id="MposZeroY">MPOS Zero Y</button>

                            <button class="zero-btn wpos-btn" style="--col: 2; --row: 5" id="WposZeroZ">WPOS Zero Z</button>
                            <button class="zero-btn wpos-btn" style="--col: 2; --row: 6" id="WposZeroX">WPOS Zero X</button>
                            <button class="zero-btn wpos-btn" style="--col: 2; --row: 7" id="WposZeroY">WPOS Zero Y</button>

                        </div>
                        <div class="positionLocation">
                            <div class="position-displays">
                                <div id="mposLocation">
                                    <span id="mposCurrentPosition">MPOS:</span>
                                    <input id="mposCurrentPositionValue" readonly value="X0 Y0 Z0"></input>
                                </div>
                                <div id="wposLocation">
                                    <span id="wposCurrentPosition">WPOS:</span>
                                    <input id="wposCurrentPositionValue" readonly value="X0 Y0 Z0"></input>
                                </div>
                            </div>
                            <div id="positionButtonContainer">
                                <button id="getPositionButton" title="Get current position from controller">Get Position</button>
                            </div>
                        </div>
                        <div id="incrementControls">
                            <button class="increment-btn" data-increment="0.001">0.001</button>
                            <button class="increment-btn" data-increment="0.01">0.01</button>
                            <button class="increment-btn" data-increment="0.1">0.1</button>
                            <button class="increment-btn active" data-increment="1">1</button>
                            <button class="increment-btn" data-increment="10">10</button>
                        </div>
                        <div id="feedrateControls" class="innerContentCentre control-inputs">
                            <label for="fastFeedrate">Fast Feedrate:</label>
                            <input type="text" id="fastFeedrate" name="fastFeedrate" value="200">
                            <label for="slowFeedrate">Slow Feedrate:</label>
                            <input type="text" id="slowFeedrate" name="slowFeedrate" value="50">
                        </div>
                        <div id="distanceControl" class="innerContentCentre control-inputs">
                            <label for="moveDistance">Move Distance (mm):</label>
                            <input type="text" id="moveDistance" name="moveDistance" value="1">
                        </div>
                    </div>

                    <div id="gcodeResponseContainer" style="display: none;">
                        <div id="gcodeResponseHeader">GCode Responses</div>
                        <div id="gcodeResponseEditor" style="height: 200px; width: 100%;"></div>
                        <div class="senderError" style="display: none;"></div>
                        <div id="senderProgressContainer">
                            <span id="senderProgressLabel" style="display: none;">Progress...</span>
                            <progress id="senderProgress" max="1" style="display: none;"></progress>
                        </div>
                    </div>
                </div>
                <div class="controls-container">
                    <div class="innerContainer control-inputs">
                        <div class="innerContentCentre control-inputs">
                            <span>Send single command</span>
                        </div>
                        <div class="innerContentCentre sender-inputs">
                            <input id="singleCommandSender" type="text" name="singleCommandSender" autocomplete="off"></input>
                            <div class="innerContentCentre control-inputs">
                                <button id="gcodeSendSingleCommandButton" title="Send GCode to CNC">Send</button>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="controls-container">
                    <div id="gcodeSenderContainer" style="position: relative;">
                        <span>Send multi line commands</span>
                        <div id="gcodeSenderEditor" style="height: 200px; width: 100%;"></div>
                    </div>
                    <div class="innerContainer">
                        <button id="gcodeSenderButton" title="Send GCode to CNC">Send</button>
                        <button id="stopButton" style="display: none;">Stop</button>
                    </div>
                </div>
            </div>
            <div id="quickTasksContainer" class="main-container" style="display: none;">
                <div id="quickTasksContent" class="controls-container">
                    <div class="innerContainer">
                        <h1>Quick Tasks</h1>
                        <button id="quickTaskFacingButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- L-shape -->
                                        <path d="M5 45 L35 45 L35 5" fill="none" stroke="white" stroke-width="3" />

                                        <!-- Arrow stem -->
                                        <line x1="50" y1="45" x2="50" y2="10" stroke="white" stroke-width="3" />

                                        <!-- Arrow head -->
                                        <path d="M42 17 L50 5 L58 17 Z" fill="white" />
                                    </svg>
                                </div>
                                <p>Facing / Parting</p>
                            </div>
                        </button>
                        <button id="quickTaskProfilingButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Rotated L-shape -->
                                        <path d="M55 5 L5 5 L5 35" fill="none" stroke="white" stroke-width="3" />

                                        <!-- Arrow stem -->
                                        <line x1="22" y1="30" x2="50" y2="30" stroke="white" stroke-width="3" />

                                        <!-- Arrow head (filled) -->
                                        <path d="M22 22 L10 30 L22 38 Z" fill="white" />
                                    </svg>
                                </div>
                                <p>Profiling</p>
                            </div>
                        </button>
                        <button id="quickTaskDrillingButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Top and bottom horizontal lines -->
                                        <line x1="5" y1="18" x2="50" y2="18" stroke="white" stroke-width="2"></line>
                                        <line x1="5" y1="32" x2="50" y2="32" stroke="white" stroke-width="2"></line>
                                        
                                        <!-- Pointed tip at left -->
                                        <line x1="5" y1="18" x2="0" y2="25" stroke="white" stroke-width="2"></line>
                                        <line x1="5" y1="32" x2="0" y2="25" stroke="white" stroke-width="2"></line>
                                        
                                        <!-- Diagonal flute lines -->
                                        <line x1="10" y1="18" x2="15" y2="32" stroke="white" stroke-width="2"></line>
                                        <line x1="20" y1="18" x2="25" y2="32" stroke="white" stroke-width="2"></line>
                                        <line x1="30" y1="18" x2="35" y2="32" stroke="white" stroke-width="2"></line>
                                        <line x1="40" y1="18" x2="45" y2="32" stroke="white" stroke-width="2"></line>
                                    </svg>
                                </div>
                                <p>Drilling</p>
                            </div>
                        </button>
                        <button id="quickTaskBoringButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Correctly rotated squared U-shape (90° clockwise) -->
                                        <path d="M55 5 L5 5 L5 45 L55 45" fill="none" stroke="white" stroke-width="3" />

                                        <!-- Arrow stem -->
                                        <line x1="22" y1="25" x2="42" y2="25" stroke="white" stroke-width="3" />

                                        <!-- Arrow head (filled) -->
                                        <path d="M22 17 L10 25 L22 33 Z" fill="white" />
                                    </svg>
                                </div>
                                <p>Boring</p>
                            </div>
                        </button>
                        <button id="quickTaskGroovingButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 60">
                                        <!-- U-shape rotated correctly (facing up) -->
                                        <path d="M5 55 L5 5 L45 5 L45 55" fill="none" stroke="white" stroke-width="3" />

                                        <!-- Arrow stem -->
                                        <line x1="25" y1="45" x2="25" y2="15" stroke="white" stroke-width="3" />

                                        <!-- Arrow head (filled) -->
                                        <path d="M17 22 L25 10 L33 22 Z" fill="white" />
                                    </svg>
                                </div>
                                <p>Grooving</p>
                            </div>
                        </button>

                        <button id="quickTaskConeButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Sideways trapezoid -->
                                        <path d="M10 5 L50 15 L50 35 L10 45 Z" fill="none" stroke="white"
                                            stroke-width="3" />
                                    </svg>
                                </div>
                                <p>Cone</p>
                            </div>
                        </button>

                        <button id="quickTaskThreadingButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Background rectangle -->
                                        <!--<rect x="0" y="7.5" width="60" height="35" fill="#e0e0e0"></rect> -->

                                        <!-- Thread lines -->
                                        <line x1="6" y1="41.7" x2="18" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <line x1="15" y1="41.7" x2="27" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <line x1="24" y1="41.7" x2="36" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <line x1="33" y1="41.7" x2="45" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <line x1="42" y1="41.7" x2="54" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <!-- Corrected start of thread -->
                                        <line x1="-3" y1="41.7" x2="9" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <!-- Corrected end of thread -->
                                        <line x1="51" y1="41.7" x2="63" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                    </svg>
                                </div>
                                <p>Threading</p>
                            </div>
                        </button>
                        <button id="quickTaskToolOffsetsButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Left arrow (pointing up) - thicker shaft -->
                                        <line x1="7.5" y1="45" x2="7.5" y2="10" stroke="white" stroke-width="3" />
                                        <path d="M4 13 L7.5 7.5 L11 13 Z" fill="white" />

                                        <!-- Bottom arrow (pointing right) - thicker shaft -->
                                        <line x1="6" y1="44" x2="50" y2="44" stroke="white" stroke-width="3" />
                                        <path d="M48 40.5 L53.5 44 L48 47.5 Z" fill="white" />

                                        <!-- Gear shifted up 1 unit -->
                                        <path
                                            d="M28 9 L31 9 L32.5 13 L35 14.5 L39 11.5 L40.5 14 L38 18 L39.5 20.5 L43.5 22 L43.5 25 L39.5 26.5 L38 29 L40.5 33 L39 35.5 L35 32.5 L32.5 34 L31 38 L28 38 L26.5 34 L24 32.5 L20 35.5 L18.5 33 L21 29 L19.5 26.5 L15.5 25 L15.5 22 L19.5 20.5 L21 18 L18.5 14 L20 11.5 L24 14.5 L26.5 13 L28 9 M29.5 18 A5 5 0 0 0 29.5 29 A5 5 0 0 0 29.5 18"
                                            fill="white" />
                                    </svg>
                                </div>
                                <p>Tool Offsets</p>
                            </div>
                        </button>
                    </div>
                </div>
            </div>

            <div id="plannerContainer" class="main-container" style="display: none;">
                <div id="plannerContent" class="planner-container">
                    <div class="innerContainer">
                        <h1>Planner</h1>
                        <div class="planner-guidance">
                            <span>Use this tool to create a job of tasks to execute. This can be manual or gcode.
                                When you click execute the job wizard will execute the tasks one after another. Each
                                task
                                with require confirmation to start.</span>
                        </div>
                    </div>
                    <div id="taskContainer">
                        <div class="container-wrapper-outer">
                            <div class="container-wrapper">
                                <h2>Current Job</h2>
                                <span>Drag an available task to below</span>
                                <div id="tasksToExecute" class="task-container">
                                </div>
                            </div>
                            <div class="container-wrapper">
                                <button id="executeJobButton">Execute Job</button>
                            </div>
                            <hr>
                            <div class="container-wrapper">
                                <div class="innerContainer" id="loadAndSaveJob">
                                    <div class="innerContainer toolbar">
                                        <button id="saveJobButton" class="planner-save-button" title="Save Job to local browser storage">Save
                                            Job</button>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <button id="newJobButton" class="planner-save-button" title="Create a new job">New
                                            Job</button>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <button id="loadJobButton" class="planner-load-delete-buttons" title="Load Job from local browser storage">Load</button>
                                        <button id="deleteJobButton" class="planner-load-delete-buttons" title="Delete Job from local browser storage">Delete</button>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <span class="planner-saving-label">Project:</span>
                                        <select id="projectLoadSelect" class="planner-load-select">
                                        </select>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <span class="planner-saving-label">Group:</span>
                                        <select id="groupLoadSelect" class="planner-load-select">
                                        </select>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <span class="planner-saving-label">Job:</span>
                                        <select id="jobLoadSelect" class="planner-load-select">
                                        </select>
                                    </div>
                                    <div class="container-wrapper-inner">
                                        <hr>
                                    </div>
                                    <span class="planner-saving-label">Import and export Job to JSON</span>
                                    <div class="innerContainer toolbar">
                                        <button id="importJobButton" class="planner-load-delete-buttons" title="Import Job from JSON file">Import</button>
                                        <button id="exportJobButton" class="planner-load-delete-buttons" title="Export Job to JSON">Export</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="container-wrapper-outer">
                            <div class="container-wrapper">
                                <h2>Available Tasks</h2>
                                <div id="availableTasks" class="task-container">
                                </div>
                            </div>
                            <div class="container-wrapper">
                                <div class="container-wrapper-inner">
                                    <span>Drag here to delete</span>
                                </div>
                                <div id="deleteTasks" class="container-wrapper-delete">
                                </div>
                            </div>
                            <div class="container-wrapper">
                                <button id="addNewTaskButton">Add New Task</button>
                            </div>
                            <div class="container-wrapper-inner">
                                <hr class="no-marge">
                            </div>
                            <div class="container-wrapper">
                                <div class="innerContainer" id="loadAndSaveAvailableTasks">
                                    <div><span>Task Collections</span></div>
                                    <div class="innerContainer toolbar">
                                        <button id='saveAvailableTaskCollection' class="planner-save-button" title="Save Task to local browser storage">Save tasks to a collection
                                            <i class="far fa-save show-info icon-tooltip"
                                                data-tooltip="Save to local machine"></i>
                                        </button>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <select id="availableTaskCollections" class="planner-load-select">
                                            <option value="" disabled>Select your option</option>
                                        </select>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <button id="loadTaskCollection" class="planner-load-delete-buttons" title="Load selected collection">Load collection</button>
                                        <button id="deleteTaskCollection" class="planner-load-delete-buttons" title="Delete selected collection">Delete collection</button>
                                    </div>
                                    <div class="container-wrapper-inner">
                                        <hr>
                                    </div>
                                    <span class="planner-saving-label">Import and export tasks via JSON</span>
                                    <div class="innerContainer toolbar">
                                        <button id="importAvailableTasks" class="planner-load-delete-buttons" title="Import tasks from JSON file">Import</button>
                                        <button id="exportAvailableTasks" class="planner-load-delete-buttons" title="Export tasks to JSON">Export</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="helpContainer" class="main-container" style="display: none;">
                <div id="helpContent" class="controls-container">
                    <div class="innerContainer">
                        <h1>Help Page</h1>
                        <p>Some functionality offered by this tool is not present on the Nano ELS h4/h5 controller by default such as gcode threading and tool offsets. Please see my custom firmware page to download my fork of the firmware: </p>
                        <p><a href="https://github.com/Festivejelly/nanoels/blob/main/h4/h4.ino" target="_blank">Github
                                Repo</a></p>
                    </div>
                </div>
            </div>

        </div>

        <!-------------------------------- Modals------------------------------->
        <!-- Edit Tool Modal -->
        <div id="editToolsModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Edit Tools</h2>
                <div class="modal-pad-bottom-flex">
                    <div class="modal-pad-bottom-flex">
                        <table class="table-auto flex-1">
                            <thead>
                                <tr class="flex w-full">
                                    <th class="flex-none w-16 p-1 text-left border-b">
                                        Tool
                                    </th>
                                    <th class="flex-1 p-1 text-left border-b">
                                        <div class="leading-tight">
                                            Z Position<br>Offset
                                        </div>
                                    </th>
                                    <th class="flex-1 p-1 text-left border-b">
                                        <div class="leading-tight">
                                            Z Cut<br>Compensation
                                        </div>
                                    </th>
                                    <th class="flex-1 p-1 text-left border-b">
                                        <div class="leading-tight">
                                            X Position<br>Offset
                                        </div>
                                    </th>
                                    <th class="flex-1 p-1 text-left border-b">
                                        <div class="leading-tight">
                                            X Cut<br>Compensation
                                        </div>
                                    </th>
                                    <th class="flex-none w-16 p-1 text-left border-b">
                                        Action
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="toolOffsetTableBody">
                                <!-- Rows will be dynamically inserted here -->
                            </tbody>
                        </table>
                    </div>
                    <div class="modal-pad-bottom-flex">
                        <button id="editToolSaveAll" class="execute" title="Save Offsets for tool">
                            <div class="icon-container">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50">
                                    <!-- Outer disk shape -->
                                    <path d="M10 5 L40 5 L45 10 L45 40 L40 45 L10 45 L5 40 L5 10 Z" fill="none"
                                        stroke="white" stroke-width="2" />

                                    <!-- Inner rectangle (disk label) -->
                                    <rect x="15" y="5" width="20" height="15" fill="none" stroke="white"
                                        stroke-width="2" />

                                    <!-- Center circle (represents disk hole) -->
                                    <circle cx="25" cy="30" r="8" fill="none" stroke="white" stroke-width="2" />
                                </svg>
                            </div>
                            <Span>Save All</Span>
                        </button>
                    </div>
                </div>
                <div class="modal-pad">
                    <button id="editToolsModalCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Facing Modal-->
        <div id="quickTaskFacingModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Facing / Parting</h2>
                <div class="modal-pad-bottom">
                    <span id="quickTaskFacingDescription" class="left-modal">This task will perform a facing or parting operation based off of your current position to the centreline</span>
                </div>
                <div class="modal-pad-bottom">
                    <!-- Current position -->
                    <label for="quickTaskFacingCurrentPosition">Current Position</label>
                    <input type="text" id="quickTaskFacingCurrentPosition" name="quickTaskFacingCurrentPosition" placeholder="0" readonly>
                    <button id="quickTaskFacingRefreshPositionButton" title="Refresh current position">Refresh</button>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskFacingXStartPosition">Start Position X (Radius mm)</label>
                    <input type="text" id="quickTaskFacingXStartPosition" name="quickTaskFacingXStartPosition" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingZStartPosition">Start Position Z</label>
                    <input type="text" id="quickTaskFacingZStartPosition" name="quickTaskFacingZStartPosition" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <hr>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskFacingFeedrate">Feed Rate (mm/m)</label>
                    <input type="text" id="quickTaskFacingFeedrate" name="quickTaskFacingFeedrate" placeholder="10" value="10">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskFacingTravelFeedRate">Travel/Retract Feed Rate (mm/m)</label>
                    <input type="text" id="quickTaskFacingTravelFeedRate" name="quickTaskFacingTravelFeedRate" placeholder="200" value="200">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskFacingUsePecking">Use pecking?</label>
                    <input type="checkbox" id="quickTaskFacingUsePecking" name="quickTaskFacingUsePecking" checked>
                </div>
                <div id="quickTaskFacingPeckingDepthContainer">
                    <div class="modal-pad-bottom">
                        <label for="quickTaskFacingPeckingDepth">Depth per peck (mm)</label>
                        <input type="text" id="quickTaskFacingPeckingDepth" name="quickTaskFacingPeckingDepth" placeholder="0.5" value="0.5">
                    </div>
                    <div class="modal-pad-bottom">
                        <label for="quickTaskFacingPeckingRetractionRate">Fully retract tool after this many cuts</label>
                        <input type="number" id="quickTaskFacingPeckingRetractionRate" name="quickTaskFacingPeckingRetractionRate" placeholder="3" value="3" min="1" step="1" oninput="this.value = this.value.replace(/[^0-9]/g, ''); if(this.value === '') this.value = '1';">
                    </div>
                </div>
                <div class="modal-pad-bottom">
                    <hr>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskFacingEndDiameter">End Diameter (mm)
                          <span class="tooltip-icon"
                            data-tooltip="Default is centreline which is 0">?</span>
                    </label>
                    <input type="text" id="quickTaskFacingEndDiameter" name="quickTaskFacingEndDiameter" placeholder="0" value="0">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskFacingExecuteButton" class="execute interaction-ready-button" title="Execute facing command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="white" />
                        </svg>
                    </button>
                    <button id="quickTaskFacingStopButton" class="execute interaction-ready-warn-button" title="Stop facing command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="white" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskFacingCopyToClipboardButton" class="interaction-ready-button" title="Copy command to clipboard">
                        Copy command<br>to clipboard
                    </button>
                </div>
                <div class="modal-pad-bottom" style="display: none;">
                    <span id="quickTaskFacingLabel">Execution in progress...</span>
                    <progress id="quickTaskFacingProgressBar" max="1"></progress>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskFacingCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Profiling Modal-->
        <div id="quickTaskProfilingModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Profiling Quick Task</h2>
                <div class="modal-pad-bottom">
                    <!-- Current position -->
                    <label for="quickTaskProfilingCurrentPosition">Current Position</label>
                    <input type="text" id="quickTaskProfilingCurrentPosition" name="quickTaskProfilingCurrentPosition" placeholder="0" readonly>
                    <button id="quickTaskProfilingRefreshPositionButton" title="Refresh current position">Refresh</button>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingXStartPosition">Start Position X (Radius mm)</label>
                    <input type="text" id="quickTaskProfilingXStartPosition" name="quickTaskProfilingXStartPosition" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingZStartPosition">Start Position Z</label>
                    <input type="text" id="quickTaskProfilingZStartPosition" name="quickTaskProfilingZStartPosition" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <hr>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingLength">Length to profile (mm)</label>
                    <input type="text" id="quickTaskProfilingLength" name="quickTaskProfilingLength" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingFeedRate">Cutting Feed rate</label>
                    <input type="text" id="quickTaskProfilingFeedRate" name="quickTaskProfilingFeedRate" placeholder="100">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingRetractFeedRate">Retract Feed rate</label>
                    <input type="text" id="quickTaskProfilingRetractFeedRate" name="quickTaskProfilingRetractFeedRate" placeholder="200" value="200">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingType">Profiling Type
                        <span class="tooltip-icon"
                            data-tooltip="Absolute cuts to a specified diameter. Relative cuts to a specified depth.">?</span>
                    </label>
                    <select id="quickTaskProfilingType" name="quickTaskProfilingType">
                        <option value="Absolute" selected>Absolute</option>
                        <option value="Relative">Relative</option>
                    </select>
                </div>
                <div class="modal-pad-bottom" id="quickTaskProfilingFinalDiameterContainer">
                    <label for="quickTaskProfilingFinalDiameter">Final Diameter</label>
                    <input type="number" id="quickTaskProfilingFinalDiameter" name="quickTaskProfilingFinalDiameter" placeholder="1">
                </div>
                <div class="modal-pad-bottom" id="quickTaskProfilingDepthContainer" style="display: none;">
                    <label for="quickTaskProfilingDepth">Depth of cut (mm)</label>
                    <input type="number" id="quickTaskProfilingDepth" name="quickTaskProfilingDepth" placeholder="1">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingPasses">Passes
                        <span class="tooltip-icon" data-tooltip="This value is calculated">?</span>
                    </label>
                    <input type="number" id="quickTaskProfilingPasses" name="quickTaskProfilingPasses" placeholder="4" value="4" min="1" step="1">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingDepthPerPass">Depth Per Pass (mm)
                        <span class="tooltip-icon"
                            data-tooltip="This value might get adjusted if the depth isnt devisible exactly by this value">?</span>
                    </label>
                    <input type="number" id="quickTaskProfilingDepthPerPass" name="quickTaskProfilingDepthPerPass" placeholder="0.2" value="0.2">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingFinishingDepth">Depth of finishing pass (mm)
                    </label>
                    <input type="number" id="quickTaskProfilingFinishingDepth" name="quickTaskProfilingFinishingDepth" placeholder="0.1" value="0.1">
                </div>
                <div class="modal-pad-bottom">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskProfilingExecuteButton" class="execute disabled-button" title="Execute profiling command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="white" />
                        </svg>
                    </button>
                    <button id="quickTaskProfilingStopButton" class="execute interaction-ready-warn-button" title="Stop profiling command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="white" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskProfilingCopyToClipboardButton" class="disabled-button" title="Copy command to clipboard" disabled>
                        Copy command<br>to clipboard
                    </button>
                </div>
                <div class="modal-pad-bottom" style="display: none;">
                    <span id="quickTaskProfilingLabel">Execution in progress...</span>
                    <progress id="quickTaskProfilingProgressBar" max="1"></progress>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskProfilingCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Drilling Modal-->
        <div id="quickTaskDrillingModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Drilling Task</h2>
                <div class="modal-pad-bottom">
                    <span id="quickTaskDrillingDescription" class="left-modal">This task will perform a drilling operation from the centreline</span>
                </div>
                <div class="modal-pad-bottom">
                    <!-- Current position -->
                    <label for="quickTaskDrillingCurrentPosition">Current Position</label>
                    <input type="text" id="quickTaskDrillingCurrentPosition" name="quickTaskDrillingCurrentPosition" placeholder="0" readonly>
                    <button id="quickTaskDrillingRefreshPositionButton" title="Refresh current position">Refresh</button>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskDrillingZStartPosition">Start Position Z</label>
                    <input type="text" id="quickTaskDrillingZStartPosition" name="quickTaskDrillingZStartPosition" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <hr>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskDrillingDepth">Drilling Depth (mm)</label>
                    <input type="text" id="quickTaskDrillingDepth" name="quickTaskDrillingDepth" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskDrillingFeedRate">Drilling Feed Rate</label>
                    <input type="text" id="quickTaskDrillingFeedRate" name="quickTaskDrillingFeedRate" placeholder="50" value="50">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskDrillingRetractFeedRate">Retract Feed Rate</label>
                    <input type="text" id="quickTaskDrillingRetractFeedRate" name="quickTaskDrillingRetractFeedRate" placeholder="200" value="200">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskDrillingPeckCheckbox">Peck Drilling</label>
                    <input type="checkbox" id="quickTaskDrillingPeckCheckbox" name="quickTaskDrillingPeckCheckbox" value="Pecking">
                </div>

                <div class="modal-pad-bottom" id="quickTaskDrillingPeckingDepthContainer" style="display: none;">
                    <label for="quickTaskDrillingPeckingDepth">Pecking Depth (mm)</label>
                    <input type="text" id="quickTaskDrillingPeckingDepth" name="quickTaskDrillingPeckingDepth" placeholder="2" value="2">
                </div>

                <div class="modal-pad-bottom">
                    <button id="quickTaskDrillingExecuteButton" class="execute disabled-button" title="Execute drilling command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="white" />
                        </svg>
                    </button>
                    <button id="quickTaskDrillingStopButton" class="execute interaction-ready-warn-button" title="Stop drilling command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="white" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskDrillingCopyToClipboardButton" class="disabled-button" title="Copy command to clipboard" disabled>
                        Copy command<br>to clipboard
                    </button>
                </div>
                <div class="modal-pad-bottom" style="display: none;">
                    <span id="quickTaskDrillingLabel">Execution in progress...</span>
                    <progress id="quickTaskDrillingProgressBar" max="1"></progress>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskDrillingCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Boring Modal-->
        <div id="quickTaskBoringModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Boring Quick Task</h2>
                <div class="modal-pad-bottom">
                    <!-- Current position -->
                    <label for="quickTaskBoringCurrentPosition">Current Position</label>
                    <input type="text" id="quickTaskBoringCurrentPosition" name="quickTasBoringCurrentPosition" placeholder="0" readonly>
                    <button id="quickTaskBoringRefreshPositionButton" title="Refresh current position">Refresh</button>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskBoringXStartPosition">Start Position X (Radius mm)</label>
                    <input type="text" id="quickTaskBoringXStartPosition" name="quickTaskBoringXStartPosition" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskBoringZStartPosition">Start Position Z</label>
                    <input type="text" id="quickTaskBoringZStartPosition" name="quickTaskBoringZStartPosition" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <hr>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskBoringDepth">Boring Hole Depth (mm)</label>
                    <input type="text" id="quickTaskBoringDepth" name="quickTaskBoringDepth" placeholder="50">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskBoringFeedRate">Cut Feed Rate</label>
                    <input type="text" id="quickTaskBoringFeedRate" name="quickTaskBoringFeedRate" placeholder="100">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskBoringRetractFeedRate">Retract Feed Rate</label>
                    <input type="text" id="quickTaskBoringRetractFeedRate" name="quickTaskBoringRetractFeedRate" placeholder="200" value="200">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskBoringType">Boring Type
                        <span class="tooltip-icon"
                            data-tooltip="Absolute cuts to a specified diameter. Relative cuts to a specified depth.">?</span>
                    </label>
                    <select id="quickTaskBoringType" name="quickTaskBoringType">
                        <option value="Absolute" selected>Absolute</option>
                        <option value="Relative">Relative</option>
                    </select>
                </div>
                <div class="modal-pad-bottom" id="quickTaskBoringFinalDiameterContainer">
                    <label for="quickTaskBoringFinalDiameter">Final Diameter</label>
                    <input type="number" id="quickTaskBoringFinalDiameter" name="quickTaskBoringFinalDiameter" placeholder="1">
                </div>
                <div class="modal-pad-bottom" id="quickTaskBoringDepthOfCutContainer" style="display: none;">
                    <label for="quickTaskBoringDepthOfCut">Depth of cut (mm)</label>
                    <input type="number" id="quickTaskBoringDepthOfCut" name="quickTaskBoringDepthOfCut" placeholder="1">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskBoringPasses">Passes
                        <span class="tooltip-icon" data-tooltip="This value is calculated">?</span>
                    </label>
                    <input type="number" id="quickTaskBoringPasses" name="quickTaskBoringPasses" placeholder="1" value="4" min="1" step="1">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskBoringDepthPerPass">Max Depth Per Pass (mm)
                        <span class="tooltip-icon"
                            data-tooltip="This value might get adjusted if the depth isnt devisible exactly by this value">?</span>
                    </label>
                    <input type="number" id="quickTaskBoringDepthPerPass" name="quickTaskBoringDepthPerPass" placeholder="0.2" value="0.2">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskBoringFinishingDepth">Depth of finishing pass (mm)
                    </label>
                    <input type="number" id="quickTaskBoringFinishingDepth" name="quickTaskBoringFinishingDepth" placeholder="0.1" value="0.1">
                </div>
                <div class="modal-pad-bottom">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskBoringExecuteButton" class="execute disabled-button" title="Execute Boring command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="white" />
                        </svg>
                    </button>
                    <button id="quickTaskBoringStopButton" class="execute interaction-ready-warn-button" title="Stop boring command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="white" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskBoringCopyToClipboardButton" class="disabled-button" title="Copy command to clipboard" disabled>
                        Copy command<br>to clipboard
                    </button>
                </div>
                <div class="modal-pad-bottom" style="display: none;">
                    <span id="quickTaskBoringProgressBarLabel">Execution in progress...</span>
                    <progress id="quickTaskBoringProgressBar" max="1"></progress>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskBoringCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Grooving Modal-->
        <div id="quickTaskGroovingModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Grooving Modal</h2>
                <div class="modal-pad-bottom">
                    <label for="quickTaskGroovingDepth">Depth of groove in mm:</label>
                    <input type="text" id="quickTaskGroovingDepth" name="quickTaskGroovingDepth" placeholder="50">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskGroovingWidth">Width of groove in mm:</label>
                    <input type="text" id="quickTaskGroovingWidth" name="quickTaskGroovingWidth" placeholder="50">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskGroovingFeedRate">Cut Feed rate</label>
                    <input type="text" id="quickTaskGroovingFeedRate" name="quickTaskGroovingFeedRate" placeholder="200" value="200">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskGroovingRetractFeedRate">Retract Feed rate</label>
                    <input type="text" id="quickTaskGroovingRetractFeedRate" name="quickTaskGroovingRetractFeedRate" placeholder="200" value="200">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskGroovingExecuteButton" class="execute" title="Execute grooving command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="green" />
                        </svg>
                    </button>
                    <button id="quickTaskGroovingStopButton" class="execute interaction-ready-warn-button" title="Stop grooving command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="red" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskGroovingCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Cone Modal-->
        <div id="quickTaskConeModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Quick Task: Cone</h2>
                <div class="modal-pad-bottom">
                    <label for="coneStartingDepth">Starting Depth (radius mm)</label>
                    <input type="text" id="coneStartingDepth" name="coneStartingDepth" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <label for="coneEndingDepth">Ending Depth (radius mm)</label>
                    <input type="text" id="coneEndingDepth" name="coneEndingDepth" placeholder="0.2">
                </div>
                <div class="modal-pad-bottom">
                    <label for="coneInternalExternal">External or Internal</label>
                    <select id="coneInternalExternal" name="coneInternalExternal">
                        <option value="External">External</option>
                        <option value="Internal">Internal</option>
                    </select>
                </div>
                <div class="modal-pad-bottom">
                    <label for="coneLength">Length</label>
                    <input type="text" id="coneLength" name="coneLength" placeholder="1">
                </div>
                <div class="modal-pad-bottom">
                    <label for="conePasses">Passes</label>
                    <input type="text" id="conePasses" name="conePasses" placeholder="1">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskConeExecuteButton" class="execute" title="Execute cone command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="green" />
                        </svg>
                    </button>
                    <button id="quickTaskConeStopButton" class="execute interaction-ready-warn-button" title="Stop cone command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="red" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskConeCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Threading Modal-->
        <div id="quickTaskThreadingModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Threading Quick Task</h2>

                <div class="modal-pad-bottom">
                    <span id="quickTaskThreadingDescription">The threading task will automatically cut a thread based on the outer diameter spec of the thread.<br>
                        The beginning of the thread length will start from your current position</span>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskThreadingExternalOrInternal">External or Internal</label>
                    <select id="quickTaskThreadingExternalOrInternal" name="quickTaskThreadingExternalOrInternal">
                        <option value="External" selected>External</option>
                        <option value="Internal">Internal</option>
                    </select>
                </div>

                <div class="modal-pad-bottom">
                    <label for="quickTaskThreadingType">Threading Type</label>
                    <select id="quickTaskThreadingType" name="quickTaskThreadingType">
                        <option value="Metric" selected>Metric</option>
                        <option value="UNC">UNC</option>
                        <option value="Custom" disabled>Custom</option>
                    </select>
                </div>

                <div class="modal-pad-bottom">
                    <label for="quickTaskThreadingSize">Thread Size</label>
                    <select id="quickTaskThreadingSize" name="quickTaskThreadingSize" disabled>
                        <option value="">Select Thread Size</option>
                    </select>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskThreadingDirection">Thread Direction</label>
                    <select id="quickTaskThreadingDirection" name="quickTaskThreadingDirection">
                        <option value="Right" selected>Right handed thread</option>
                        <option value="Left">Left handed thread</option>
                    </select>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskThreadingMaxFirstPassDepth">Max first pass depth (mm)
                        <span class="tooltip-icon"
                        data-tooltip="The max depth of the first pass default is 0.3mm">?</span>
                    </label>
                    <input type="text" id="quickTaskThreadingMaxFirstPassDepth" name="quickTaskThreadingMaxFirstPassDepth" placeholder="0.3" value="0.3">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskThreadingLength">Thread Length (mm)</label>
                    <input type="text" id="quickTaskThreadingLength" name="quickTaskThreadingLength" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskThreadingPasses">Number of passes
                        <span class="tooltip-icon"
                        data-tooltip="Automatically calculated based on 0.1mm per pass. But you can set your own passes.">?</span>
                    </label>
                    <input type="text" id="quickTaskThreadingPasses" name="quickTaskThreadingPasses" placeholder="5">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskThreadingExecuteButton" class="execute disabled-button" title="Execute threading command" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="white" />
                        </svg>
                    </button>
                    <button id="quickTaskThreadingStopButton" class="execute interaction-ready-warn-button" title="Stop threading command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="white" />
                        </svg>
                    </button>
                    <div class="modal-pad">
                        <button id="quickTaskThreadingCopyToClipboardButton" class="disabled-button" title="Copy command to clipboard" disabled>
                            Copy command<br>to clipboard
                        </button>
                    </div>
                    <div class="modal-pad-bottom" style="display: none;">
                        <span id="quickTaskThreadingProgressBarLabel">Execution in progress...</span>
                        <progress id="quickTaskThreadingProgressBar" max="1"></progress>
                    </div>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskThreadingCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Tool offsets Modal-->
        <div id="quickTaskToolOffsetsModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Tool offsets wizard</h2>

                <div class="modal-pad-bottom">
                    <p>Before setting offsets be sure your primary tool (T0 which should be a grooving tool) has been zero'ed on your centre line and Z reference. See this video guide: link</p>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskToolOffsetsToolNumber">Tool Number (eg T1)</label>
                    <select type="text" id="quickTaskToolOffsetsToolNumber" name="quickTaskToolOffsetsToolNumber" placeholder="T1">
                    </select>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskToolOffsetsToolType">Tool Type
                        <span class="tooltip-icon"
                            data-tooltip="External tools touch off on front of probe, Internal on the rear.">?</span>
                    </label>
                    <select id="quickTaskToolOffsetsToolType" name="toolOffsetsToolType">
                        <option value="External-Profiling" selected>External: Profiling</option>
                        <option value="External-Facing">External: Facing</option>
                        <option value="External-Grooving">External: Grooving</option>
                        <option value="External-Threading">External: Threading</option>
                        <option value="External-Other">External: Other</option>
                        <option value="Internal-Boring">Internal: Boring</option>
                        <option value="Internal-Grooving">Internal: Grooving</option>
                        <option value="Internal-Threading">Internal: Threading</option>S
                        <option value="Internal-Other">Internal: Other</option>
                        <option value="Drill">Drill</option>
                    </select>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskToolOffsetsOffsetX">X Value</label>
                    <input type="text" id="quickTaskToolOffsetsOffsetX" name="quickTaskToolOffsetsOffsetX" placeholder="0">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskToolOffsetsOffsetZ">Z Value</label>
                    <input type="text" id="quickTaskToolOffsetsOffsetZ" name="quickTaskToolOffsetsOffsetZ" placeholder="0">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskToolOffsetsProbeDiameter">Probe diameter</label>
                    <input type="text" id="quickTaskToolOffsetsProbeDiameter" name="quickTaskToolOffsetsProbeDiameter" placeholder="5">
                </div>
                <div class="modal-pad-bottom">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskToolOffsetsExecuteButton" class="execute" title="Set tool offset">
                        <Span>Set Tool Offset</Span>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="green" />
                        </svg>
                    </button>
                    <button id="quickTaskToolOffsetsStopButton" class="execute interaction-ready-warn-button" title="Stop gcode" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="red" />
                        </svg>
                    </button>
                    <div class="modal-pad-bottom" style="display: none;">
                        <span id="quickTaskToolOffsetsLabel">Execution in progress...</span>
                        <progress id="quickTaskToolOffsetsProgressBar" max="1"></progress>
                    </div>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskToolOffsetsCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Not Connected warning -->
        <div id="notConnectedModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Not Connected</h2>
                <div class="modal-pad-bottom">
                    <span>Please connect to the controller before executing jobs</span>
                </div>
                <div class="modal-pad">
                    <button id="notConnectedCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Manual Task Modal -->
        <div id="manualTaskModal" class="task-modal">
            <div class="task-modal-content task-modal-manual">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-users-cog icon-tooltip" data-tooltip="Manual Task" style="font-size: inherit;"></i>
                    <h2 style="margin: 0;">Manual Task</h2>
                </div>
                <hr>
                <div>
                    <span id="manualTaskName"></span>
                </div>
                <div class="modal-pad">
                    <textarea id="manualTaskDescription" name="manualTaskDescription" class="full-width-textarea" rows="4" cols="50" disabled></textarea>
                </div>
                <div class="modal-pad">
                    <button id="cancelManualTask">Cancel</button>
                    <button id="completeManualTask" class="interaction-ready-button">Next Task --></button>
                </div>
            </div>
        </div>
        <!-- Gcode Task Modal -->
        <div id="cncTaskModal" class="task-modal">
            <div class="task-modal-content task-modal-gcode">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-code icon-tooltip" data-tooltip="Gcode Task" style="font-size: inherit;"></i>
                    <h2 style="margin: 0;">Gcode Task</h2>
                </div>
                <hr>
                <div>
                    <span id="cncTaskName"></span>
                </div>
                <hr>
                <div>
                    <span>Description:</span>
                </div>
                <div class="modal-pad">
                    <textarea id="cncTaskDescription" name="cncTaskDescription" class="full-width-textarea" rows="4" cols="50" disabled></textarea>
                </div>
                <div>
                    <span>Gcode:</span>
                </div>
                <div class="modal-pad">
                    <textarea id="cncTaskGcode" name="cncTaskGcode" class="full-width-textarea" rows="12" cols="50" disabled></textarea>
                </div>
                <div class="modal-pad">
                    <button id="cancelCncTask">Cancel</button>
                    <button id="executeGcode">Execute Gcode</button>
                </div>
                <div class="modal-pad">
                    <button id="completeCncTask" disabled>Next Task --></button>
                </div>
                <div id="currentGcodeLineContainer" class="modal-pad">
                    <span id="currentGcodeLineLabel">Current Gcode Line:</span>
                    <span id="currentGcodeLine"></span>
                </div>
                <div id="currentFeedrateContainer" class="modal-pad">
                    <span id="currentFeedrateLabel">Current Feedrate:</span>
                    <span id="currentFeedrate"></span>
                </div>
                <div id="cncTaskSenderProgressContainer" class="modal-pad">
                    <span id="cncTaskSenderProgressLabel">Execution in progress...</span>
                    <progress id="cncTaskSenderProgress" max="1"></progress>
                </div>
            </div>
        </div>
        <!-- Tool Change Task Modal -->
        <div id="toolChangeTaskModal" class="task-modal">
            <div class="task-modal-content task-modal-tool-change">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-wrench icon-tooltip" data-tooltip="Tool Change Task" style="font-size: inherit;"></i>
                    <h2 style="margin: 0;">Tool Change Task</h2>
                </div>
                <hr>
                <div>
                    <span id="toolChangeTaskName"></span>
                </div>
                <hr>
                <div>
                    <span>Description:</span>
                </div>
                <div class="modal-pad">
                    <textarea id="toolChangeTaskDescription" name="toolChangeTaskDescription" class="full-width-textarea" rows="4" cols="50" disabled></textarea>
                </div>
                <div>
                    <span>Tool change info:</span>
                </div>
                <div class="modal-pad">
                    <span>New Tool:</span>
                    <input type="text" id="toolChangeNewTool" name="newTool" readonly>
                </div>
                <div class="modal-pad">
                    <span>Instructions:</span>
                    <!-- Instructions will be dynamically set -->
                    <span id="toolChangeTaskInstructions"></span>
                </div>
                <div class="modal-pad">
                    <button id="cancelToolChange">Cancel</button>
                    <button id="executeToolChange">Execute tool change</button>
                </div>
                <div class="modal-pad">
                    <button id="completeToolChangeTask" disabled>Next Task --></button>
                </div>
            </div>
        </div>
        <!-- All tasks Complete Modal -->
        <div id="completeTaskModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>All Tasks Complete</h2>
                <div class="modal-pad">
                    <button id="completeTaskCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Job Cancelled Modal -->
        <div id="jobCancelledModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Job Cancelled</h2>
                <div>
                    <button id="jobCancelledCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Save Job Modal -->
        <div id="saveJobModal" class="task-modal">
            <div class="task-modal-content">
                <span id="saveJobModalClose" class="close-modal">&times;</span>
                <h2>Save Job</h2>
                <hr>
                <div class="modal-pad">Project:</div>
                <div>
                    <select id="saveProjectNameSelect">
                    </select>
                </div>
                <div id="newProjectNameContainer" style="display: none;">
                    <div class="modal-pad">New project name:</div>
                    <div>
                        <input id="saveProjectNameInput" type="text" class="planner-save-text" placeholder="Name of Project"></input>
                    </div>
                </div>
                <div class="modal-pad">Group name:</div>
                <div>
                    <select id="saveJobGroupNameSelect">
                    </select>
                </div>
                <div id="newJobGroupNameContainer" style="display: none;">
                    <div class="modal-pad">New group name:</div>
                    <div>
                        <input id="saveJobGroupNameInput" type="text" class="planner-save-text" placeholder="Name of Group"></input>
                    </div>
                </div>
                <div class="modal-pad">Name of Job:</div>
                <div>
                    <select id="saveJobNameSelect">
                    </select>
                </div>
                <div id="newJobNameContainer" style="display: none;">
                    <div class="modal-pad">New Job name:</div>
                    <div>
                        <input id="saveJobNameInput" type="text" class="planner-save-text" placeholder="Name of Job"></input>
                    </div>
                </div>
                <div class="modal-pad">
                    <button id="saveJobSaveButton">Save</button>
                </div>
            </div>
        </div>
        <!-- export Job Modal -->
        <div id="exportJobModal" class="task-modal">
            <div class="task-modal-content">
                <span id="exportJobModalClose" class="close-modal">&times;</span>
                <h2>Export Job</h2>
                <hr>
                <div class="modal-pad">Project:</div>
                <div>
                    <select id="exportJobProjectNameSelect">
                    </select>
                </div>
                <div class="modal-pad">Group:</div>
                <div>
                    <select id="exportJobGroupNameSelect">
                    </select>
                </div>
                <div class="modal-pad">Job:</div>
                <div>
                    <select id="exportJobNameSelect">
                    </select>
                </div>
                <div class="modal-pad">
                    <button id="exportJobSaveButton">Save</button>
                </div>
            </div>
        </div>
        <!-- Save Collection -->
        <div id="saveCollectionModal" class="task-modal">
            <div class="task-modal-content">
                <span id="saveCollectionModalClose" class="close-modal">&times;</span>
                <div>
                    <div>Which collection would you like to save the tasks to?</div>
                    <div class="modal-pad">
                        <select id="saveCollectionModalToSaveTo" name="collectionToSaveToModal">
                        </select>
                    </div>
                    <div id="newCollectionNameContainerModal" style="display: none;">
                        <div class="modal-pad">New Collection Name:</div>
                        <div>
                            <input type="text" id="newCollectionNameModal" name="newCollectionNameModal" placeholder="Enter collection name...">
                        </div>
                    </div>

                    <div class="modal-pad">
                        <button id="saveAvailableTaskCollectionButtonModal">Save</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- new task modal-->
        <div id="newTaskModal" class="task-modal">
            <div class="task-modal-content">
                <span id="closeNewTaskModal" class="close-modal">&times;</span>
                <div id="newTaskHelpText">
                    <h2 id="taskTextTitle">Add a new task</h2>
                    <hr>
                    <div class="modal-pad">Task Name:</div>
                    <div>
                        <input type="text" id="newTaskName" name="newTaskName" class="full-width-textarea" placeholder="Enter task name...">
                    </div>
                    <div class="modal-pad">Task Type:</div>
                    <div>
                        <select id="newTaskType" name="newTaskType">
                            <option value="MANUAL">Manual</option>
                            <option value="GCODE">GCode</option>
                            <option value="TOOL_CHANGE">Tool Change</option>
                        </select>
                    </div>
                    <div class="modal-pad">Task Description:</div>
                    <div>
                        <textarea id="newTaskDescription" name="newTaskDescription" class="full-width-textarea" rows="8" cols="50" placeholder="Enter Description..."></textarea>
                    </div>
                    <div id="gcodeTaskContainer" style="display:none">
                        <div class="modal-pad">Task GCode:</div>
                        <div>
                            <textarea id="newTaskGcode" name="newTaskGcode" class="full-width-textarea" rows="8" cols="50" placeholder="Disabled for manual tasks" disabled></textarea>
                        </div>

                        <div class="modal-pad">

                            <label for="newTaskGcodeRepeatable">
                                <input type="checkbox" id="newTaskGcodeRepeatable" name="newTaskGcodeRepeatable">
                                Check to make task repeatable
                            </label>
                        </div>
                    </div>
                    <hr>
                    <div id="toolChangeTaskContainer" style="display:none">
                        <div class="modal-pad">Tool name:</div>
                        <div>
                            <input type="text" id="newTaskToolChangeNewTool" name="newTaskToolChangeNewTool" placeholder="Enter new tool number..." pattern="T\d+" title="Must be in format T followed by numbers (e.g., T0, T12)" maxlength="4" oninput="this.value = this.value.replace(/[^T0-9]/g, '').replace(/^(?!T).*/, '').replace(/T.*?(\d+).*/, 'T$1')">
                        </div>
                    </div>
                    <div class="modal-pad">Collection to save to:</div>
                    <div>
                        <select id="collectionToSaveTo" name="collectionToSaveTo">
                        </select>
                    </div>
                    <div id="newCollectionNameContainer" style="display: none;">
                        <div class="modal-pad">New Collection Name:</div>
                        <div>
                            <input type="text" id="newCollectionName" name="newCollectionName" placeholder="Enter collection name...">
                        </div>
                    </div>
                    <div class="modal-pad">
                        <button id="saveNewTaskButton">Save</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="helpModal" class="help-modal">
            <div class="help-modal-content">
                <span id="closeHelpModal" class="close-modal">&times;</span>
                <div id="helpText">
                    <div>This tool is designed to be used in conjunction with LatheCode:</div>
                    <div><a href="https://kachurovskiy.github.io/lathecode/" target="_blank">https://kachurovskiy.github.io/lathecode/</a></div>
                    <div><strong>Please note that this tool is to be used at your own risk and I cannot gaurentee that
                            it will work. This tool targets my custom fork of the H4 firmware which you can find
                            here:</strong> <a href="https://github.com/Festivejelly/nanoels" target="_blank">https://github.com/Festivejelly/nanoels</a></div>
                    <hr>
                    <div>How to use:</div>
                    <ul style="list-style-type: disc; padding-left: 20px;">
                        <li>Use LatheCode to generate the G-code, then paste it into this tool.</li>
                        <li>You can also write the G-code by hand for simple operations such as boring or grooving.
                            <a href="#" id="exampleCode">Click here</a> to load an example.
                        </li>
                        <li>Click"Simulate" to plot the moves onto the canvas.</li>
                        <li>movement lines marked with"; cut" will show in <span class="line red-line"></span><span class="text-red">red</span>.</li>
                        <li>movement lines marked with"; travel" will show in <span class="line green-line"></span><span class="text-green">green</span>.</li>
                        <li>movement lines marked with"; retract" will show in <span class="line orange-line"></span><span class="text-orange">orange</span>.</li>
                        <li>movement lines not marked will default to <span class="line green-line"></span><span class="text-green">green</span>.</li>
                        <li>All other moves will be considered travel moves and will show in green.</li>
                        <li>Any G-code you paste or write can be saved into the browser's local storage. This is useful for saving common operations.</li>
                        <li>When you're ready, you can send the G-code to the Nano ELS H4 by clicking"Send."
                        </li>
                        <li>More functionality to come soon! Version 0.2</li>
                        <li>Please provide feedback, raise issues or make suggestions here: <a href="https://github.com/Festivejelly/LatheGcodeVisualiser" target="_blank">https://github.com/Festivejelly/LatheGcodeVisualiser</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="zoomModal" class="zoom-modal">
            <div class="zoom-modal-content" style="background-color: #242424;">
                <span id="closeZoomModal" class="close-modal">&times;</span>
                <canvas id="zoomCanvas" width="1600" height="1200"></canvas>
                <div id="sliderAndButtonContainer">
                    <div id="zoomSliderContainer" class="innerContainer" style="width: 400px;">
                        <input type="range" id="zoomProgressSlider" min="0" max="100" value="0" style="width: 100%;">
                        <div id="zoomSliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                    </div>
                    <div id="displayOptionsContainerZoom" class="innerContainer">
                        <label>
                            <input type="checkbox" id="showCutsZoom" checked> Show Cut Moves
                        </label>
                        <label>
                            <input type="checkbox" id="showNonCutsZoom" checked>
                            Show Non-Cut Moves
                        </label>
                    </div>
                    <button id="zoomCloseButton">Close</button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>