<!DOCTYPE html>
<html>

<head>
    <title>G-Code Visualizer</title>
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/ace.js"></script>
  <script type="module" crossorigin>
(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))b(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const f of s.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&b(f)}).observe(document,{childList:!0,subtree:!0});function m(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function b(t){if(t.ep)return;t.ep=!0;const s=m(t);fetch(t.href,s)}})();const D="#DC143C",G="#6B8E23";document.addEventListener("DOMContentLoaded",()=>{const l=document.getElementById("gcodeCanvas"),i=l.getContext("2d"),m=document.getElementById("fileInput"),b=document.getElementById("simulateButton"),t=document.getElementById("showCuts"),s=document.getElementById("showNonCuts"),f=document.getElementById("sliderLabel"),u=document.getElementById("progressSlider"),S=document.getElementById("sliderContainer"),N=document.getElementById("displayOptionsContainer"),X=document.getElementById("clearButton"),h=ace.edit("gcodeEditor");h.setTheme("ace/theme/github_dark"),h.session.setMode("ace/mode/plain_text");let L=0,E=0,w=0,x=0,B=0,I=0,M=20,r=[];X.addEventListener("click",()=>{h.setValue(""),i&&i.clearRect(0,0,l.width,l.height),u.value="0",S.style.display="none",N.style.display="none"}),m.addEventListener("change",e=>{if(e.target instanceof HTMLInputElement&&e.target.files&&e.target.files.length>0){const n=e.target.files[0];n&&k(n)}}),b.addEventListener("click",()=>{const e=h.getValue();e&&(z(e),R(r),S.style.display="block",N.style.display="block",u.max=r.length.toString(),u.value=u.min,t.addEventListener("change",O),s.addEventListener("change",O),u.oninput=()=>{if(!i)return;const n=Math.floor(parseInt(u.value));if(n<r.length){const a=r[n];R(r,n),Z(a)}})});function Z(e){(e==null?void 0:e.lineNumber)!==void 0?(h.gotoLine(e.lineNumber,0,!0),f.innerHTML=`Line:${e.lineNumber}<br>${e==null?void 0:e.originalLine}`||""):f.innerHTML=""}function k(e){const n=new FileReader;n.onload=a=>{const c=a.target.result;h.setValue(c)},n.readAsText(e)}function z(e){const n=[];let a=!1;return r=[],e.split(`
`).forEach((g,v)=>{const o={isRelative:a,isCut:g.includes("; cut")},y=g.match(/([GXYZF])([0-9.-]+)/g);if(y==null||y.forEach(d=>{const p=parseFloat(d.slice(1));switch(d[0]){case"G":p===90&&(o.isRelative=!1),p===91&&(o.isRelative=!0);break;case"X":o.x=p;break;case"Z":o.z=p;break}}),o.x!==void 0||o.z!==void 0){const d={...o,lineNumber:v+1,originalLine:g};n.push(d),o.isRelative&&r.push(d)}a=o.isRelative}),M=F(r,l.width,l.height),n}function O(){u.value="0",R(r,r.length)}function F(e,n,a){let c=0,g=0,v=0,o=0;e.forEach(C=>{C.isRelative&&(C.x!==void 0&&(c+=C.x),C.z!==void 0&&(g+=C.z)),v=Math.max(v,Math.abs(c)),o=Math.max(o,Math.abs(g))});const y=v,d=o;let p=40;const P=n/y,V=a/d;return Math.min(P,V,p)}function R(e,n){if(!i)return;i.clearRect(0,0,l.width,l.height),L=0,E=0,w=l.height,x=l.width;const a=n!==void 0?Math.min(n+1,e.length):e.length;for(let c=0;c<a;c++)T(e[c])}function T(e){i&&(i.lineWidth=2,e.isRelative&&(L+=e.x??0,E+=e.z??0),B=l.height-L*M,I=l.width-E*M,(e.isCut&&t.checked||!e.isCut&&s.checked)&&(i.beginPath(),i.strokeStyle=e.isCut?D:G,i.moveTo(x,w),i.lineTo(I,B),i.stroke()),w=B,x=I)}});

</script>
  <style>
:root{font-family:Inter,system-ui,Avenir,Helvetica,Arial,sans-serif;line-height:1.5;font-weight:400;color-scheme:light dark;color:#ffffffde;background-color:#242424;font-synthesis:none;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}a{font-weight:500;color:#646cff;text-decoration:inherit}a:hover{color:#535bf2}body{place-items:center;display:grid}h1{font-size:3.2em;line-height:1.1}#app{max-width:1280px;margin:0 auto;padding:2rem;text-align:center}.logo{height:6em;padding:1.5em;will-change:filter;transition:filter .3s}.logo:hover{filter:drop-shadow(0 0 2em #646cffaa)}.logo.vanilla:hover{filter:drop-shadow(0 0 2em #3178c6aa)}.card{padding:2em}.read-the-docs{color:#888}button{border-radius:3px;border:1px solid transparent;padding:.6em 1.2em;font-size:1em;font-weight:500;font-family:inherit;background-color:#1a1a1a;cursor:pointer;transition:border-color .25s}button:hover{border-color:#646cff}button:focus,button:focus-visible{outline:4px auto -webkit-focus-ring-color}@media (prefers-color-scheme: light){:root{color:#213547;background-color:#fff}a:hover{color:#747bff}button{background-color:#f9f9f9}}.innerContainer{margin:5px;align-items:center;width:auto}#controlsContainer{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:0 auto;width:800px;max-width:1280px;text-align:center}#gcodeCanvas{border:0px}#gcodeInput{position:relative;background:transparent;width:100%;height:240px;font-family:monospace;font-size:13px;line-height:1.5;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}#gcodeContainer{position:relative;width:100%;margin:5px}#backdrop{position:absolute;width:100%;background-color:#add8e6;opacity:.5;pointer-events:none;display:none}

</style>
</head>

<body>
    <canvas id="gcodeCanvas" width="800" height="600" style="background-color: #b4b4b4;"></canvas>
    <br />

    <div id="controlsContainer">
        <div id="gcodeContainer" style="position: relative;">
            <div id="gcodeEditor" style="height: 200px; width: 100%;"></div>
            <!-- <textarea id="gcodeInput" rows="10" cols="50" placeholder="Enter G-Code here"
                style="position: relative; background: transparent;"></textarea> -->
        </div>

        <div class="innerContainer">
            <button id="simulateButton">Simulate</button>
            <button id="clearButton">Clear</button>
            <input type="file" id="fileInput" accept=".txt,.gcode">
        </div>
        <div id="sliderContainer" class="innerContainer" style="display: none; width: 400px;">
            <input type="range" id="progressSlider" min="0" max="100" value="0" style="width: 100%;">
            <div id="sliderLabel" style="text-align: center;"></div>
        </div>
        <div id="displayOptionsContainer" class="innerContainer" style="display: none;">
            <input type="checkbox" id="showCuts" checked> Show Cut Moves
            </label>
            <label>
                <input type="checkbox" id="showNonCuts" checked>
                Show Non-Cut Moves
            </label>
        </div>
    </div>
</body>

</html>