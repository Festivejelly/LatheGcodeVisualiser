<!DOCTYPE html>
<html>

<head>
    <title>G-Code Visualizer</title>
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/ace.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <script type="module" crossorigin>
var vn=Object.defineProperty;var yn=(n,e,t)=>e in n?vn(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var x=(n,e,t)=>(yn(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const g of r.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&s(g)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();var K=(n=>(n.GCODE="gcode",n.PLANNER="planner",n.QUICKTASKS="quicktasks",n))(K||{});class kn{constructor(e,t,s,i,r,g,h,y,L,T,f){this.isConnected=e,this.condition=t,this.error=s,this.progress=i,this.currentLine=r,this.feedRate=g,this.z=h,this.x=y,this.feed=L,this.rpm=T,this.version=f}}const Ge=class Ge{constructor(){x(this,"listeners",[]);x(this,"activeClient",null);x(this,"port",null);x(this,"readTimeout",0);x(this,"reader",null);x(this,"writer",null);x(this,"isOn",!1);x(this,"waitForOkOrError",!1);x(this,"lines",[]);x(this,"lineIndex",0);x(this,"unparsedResponse","");x(this,"error","");x(this,"statusReceived",!1);x(this,"currentLine","");x(this,"feedRate",0);x(this,"z",0);x(this,"x",0);x(this,"feed",0);x(this,"rpm",0);x(this,"isDisconnecting",!1);x(this,"lastStatus",null);x(this,"version","");x(this,"currentCommandListeners",[]);x(this,"remainingStatus","");x(this,"remainingResponse","")}static getInstance(){return Ge.instance||(Ge.instance=new Ge),Ge.instance}setActiveClient(e){this.activeClient=e,console.log(`Active client set to: ${e}`)}clearActiveClient(){this.activeClient=null,console.log("Active client cleared")}getStatus(){return this.lastStatus=new kn(this.port!==null,this.isOn?"run":"idle",this.error,this.lines.length?this.lineIndex/this.lines.length:0,this.currentLine,this.feedRate,this.z,this.x,this.feed,this.rpm,this.version),this.lastStatus}getCurrentCommand(){return this.currentLine}addStatusChangeListener(e,t){this.listeners.push({callback:e,client:t})}notifyStatusChange(){this.listeners.forEach(e=>{e.client===this.activeClient?(console.debug(`Notifying ${e.client} listener`),e.callback()):console.debug(`Skipping ${e.client} listener (not active)`)})}addCurrentCommandListener(e){this.currentCommandListeners.push(e)}notifyCurrentCommand(e){this.currentCommandListeners.forEach(t=>t(e))}setStatus(e){if(e=this.remainingStatus+e,this.remainingStatus="",e.startsWith("<")&&(e=e.substring(1)),e.endsWith(">"))e=e.slice(0,-1);else{this.remainingStatus=e;return}const t=e.split("|");if(t.length>=3){if(this.statusReceived=!0,t[1].startsWith("WPos:")){const s=t[1].substring(5).split(",");this.z=Number(s[2]),this.x=Number(s[0])}if(t[2].startsWith("FS:")){const s=t[2].substring(3).split(",");this.feed=Number(s[0]),this.rpm=Number(s[1])}t[3].startsWith("Id:")&&(this.version=String(t[3].substring(3)))}this.notifyStatusChange(),Ue(`response: ${e}`),console.log(`response: "${e}"`)}setError(e){this.error=e,Ue(e),this.notifyStatusChange()}isConnected(){return this.lastStatus!==null&&this.lastStatus.isConnected}async connect(){try{if(this.setActiveClient("gcode"),this.port)this.closePort();else{if(await this.selectPort(),this.write("!"),await this.askForStatus(),!await _t(()=>this.statusReceived)){this.setError("Device is not reponding, is it in GCODE mode?");return}this.isDisconnecting=!1,this.isOn=!1,this.setError(""),this.waitForOkOrError=!1,this.unparsedResponse=""}}catch(e){console.log(e)}this.notifyStatusChange()}async disconnect(){this.isDisconnecting=!0,this.port&&this.closePort()}getDisconnectingStatus(){return this.isDisconnecting}async start(e,t){e&&(this.setActiveClient(t),this.isOn=!0,this.lines=e.split(`
`),this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange())}async sendCommand(e,t){this.setActiveClient(t),this.isOn=!0,this.lines=[e],this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange()}async sendCommands(e,t){this.setActiveClient(t),this.isOn=!0,this.lines=e,this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange()}async getPosition(e){if(this.setActiveClient(e),this.statusReceived=!1,await this.write("?"),!await _t(()=>this.statusReceived))throw new Error("Failed to get position update");return this.notifyStatusChange(),this.getStatus()}async stop(){await this.write("!"),this.isOn&&(this.isOn=!1,this.notifyStatusChange(),this.clearActiveClient())}async write(e){if(this.port){if(console.log("command: ",e),!this.port.writable){e!="?"&&this.setError("Port is not writable, try reconnecting the USB and switching to GCODE mode.");return}if(!this.writer)try{const t=new TextEncoderStream;t.readable.pipeTo(this.port.writable),this.writer=t.writable.getWriter()}catch(t){this.setError("Failed to write: "+t);return}await this.writer.write(e)}}async writeCurrentLine(){if(!this.isOn||this.waitForOkOrError)return;if(this.lineIndex>=this.lines.length){this.stop();return}const e=this.lines[this.lineIndex].split(";")[0].trim();if(!e){this.lineIndex++,this.writeCurrentLine();return}this.currentLine=e,this.notifyCurrentCommand(this.currentLine),this.waitForOkOrError=!0,console.log(`command: "${e}"`),Ue(`command: ${e}`),await this.write(e+`
`),await this.readFromPort()}async processResponse(e){this.unparsedResponse=(this.remainingResponse+e).trimStart(),this.remainingResponse="";const t=this.unparsedResponse.split(/\r?\n/).map(s=>s.replace(/\r/g,""));for(let s of t){const i=s.match(/(<[^>]+>)/);if(i&&i.length>1){i.shift();for(const r of i)s=s.replace(r,"");this.setStatus(i.pop())}s.startsWith("error:")?(this.remainingResponse+=s,Ue(`response: ${this.remainingResponse}`),console.log(`response: "${this.remainingResponse}"`),this.setError(s),this.remainingResponse="",this.stop()):s.startsWith("ok")?(this.remainingResponse+=s,Ue(`response: ${this.remainingResponse}`),console.log(`response: "${this.remainingResponse}"`),this.remainingResponse="",this.waitForOkOrError=!1,this.lineIndex++,this.notifyStatusChange(),this.isOn&&await this.writeCurrentLine()):this.remainingResponse+=s}this.unparsedResponse=""}async selectPort(){if(this.port&&this.closePort(),navigator.serial?this.port=await navigator.serial.requestPort():(this.error="This browser does not support Serial API, try Chrome or Edge",this.notifyStatusChange()),this.port)try{await this.port.open({baudRate:115200}),this.notifyStatusChange(),this.readSoon()}catch(e){this.setError(`Unable to open port - likely some other app is using it - try closing Arduino IDE.
${e}`),this.closePort()}}async askForStatus(){try{await this.write("?")}catch(e){this.setError(`Device disconnected? ${e}`),this.closePort()}}readSoon(){clearTimeout(this.readTimeout),this.readTimeout=window.setTimeout(()=>this.readFromPort(),200)}async readFromPort(){if(this.port)try{if(!this.port.readable){this.readSoon();return}if(!this.reader){const t=new TextDecoderStream;this.port.readable.pipeTo(t.writable),this.reader=t.readable.getReader()}const{value:e}=await this.reader.read();if(!e){this.readSoon();return}await this.processResponse(e),this.readSoon()}catch(e){this.setError(e.message||String(e)),this.closePort()}}async closePort(){if(this.port){if(clearTimeout(this.readTimeout),this.reader){try{await this.reader.cancel(),this.reader.releaseLock()}catch(e){console.error("Error cancelling reader: ",e)}this.reader=null}if(this.writer){try{await this.writer.close(),this.writer.releaseLock()}catch(e){console.error("Error closing writer: ",e)}this.writer=null}await new Promise(e=>setTimeout(e,500));try{await this.port.close()}catch(e){console.error("Error closing port: ",e)}this.port=null,this.statusReceived=!1,this.z=0,this.x=0,this.feed=0,this.rpm=0}}};x(Ge,"instance",null);let ot=Ge;function Ue(n){var e=Ee.getSession(),t=e.getLength(),s=new Date().toLocaleTimeString(),i=`[${s}] ${n}
`;e.insert({row:t,column:0},i)}function _t(n){return new Promise(e=>{let t=0;function s(){n()?e(!0):t>=10?e(!1):(t++,setTimeout(s,100))}s()})}class bn{constructor(){x(this,"sendButton");x(this,"sendSingleCommandButton");x(this,"stopButton");x(this,"senderError");x(this,"runProgress");x(this,"runProgressLabel");x(this,"connectButton");x(this,"gcodeResponseContainer");x(this,"jogButtons");x(this,"toolButtons");x(this,"sender");x(this,"singleCommandSender");x(this,"minimumVersion");this.minimumVersion="H4V12FJ";let e,t,s;this.senderError=document.querySelector(".senderError"),this.runProgress=document.getElementById("senderProgress"),this.runProgressLabel=document.getElementById("senderProgressLabel"),this.connectButton=document.getElementById("connectButton"),this.gcodeResponseContainer=document.getElementById("gcodeResponseContainer"),s=document.getElementById("moveDistance"),e=document.getElementById("fastFeedrate"),t=document.getElementById("slowFeedrate"),this.jogButtons=document.querySelectorAll("#latheControls .jog-btn"),this.toolButtons=document.querySelectorAll("#latheControls .tool-btn"),this.sendButton=document.getElementById("gcodeSenderButton"),this.sendSingleCommandButton=document.getElementById("gcodeSendSingleCommandButton"),this.singleCommandSender=document.getElementById("singleCommandSender"),this.sender=ot.getInstance(),this.sender.addStatusChangeListener(()=>this.handleStatusChange(),K.GCODE),this.jogButtons.forEach(i=>{i.addEventListener("click",()=>{var f;if(!((f=this.sender)!=null&&f.isConnected())){alert("Please connect to the controller first.");return}let r="",g="",h="",y=!0;i.id=="fastForward"?(r=e.value,g="X",h=s.value,y=!0):i.id=="slowForward"?(r=t.value,g="X",h=s.value,y=!0):i.id=="fastBackward"?(r=e.value,g="X",h=s.value,y=!1):i.id=="slowBackward"?(r=t.value,g="X",h=s.value,y=!1):i.id=="fastLeft"?(r=e.value,g="Z",h=s.value,y=!0):i.id=="slowLeft"?(r=t.value,g="Z",h=s.value,y=!0):i.id=="fastRight"?(r=e.value,g="Z",h=s.value,y=!1):i.id=="slowRight"&&(r=t.value,g="Z",h=s.value,y=!1);let T=`${g}${y===!0?"":"-"}${h} F${r}`;if(this.sender){let v=new Array(3);v[0]="G91",v[1]=T,v[2]="G90",this.sender.sendCommands(v,K.GCODE)}})}),this.toolButtons.forEach(i=>{i.addEventListener("click",()=>{var L;if(!((L=this.sender)!=null&&L.isConnected())){alert("Please connect to the controller first.");return}if(this.sender.getStatus().version!=this.minimumVersion){alert(`This feature is only available on firmware version ${this.minimumVersion} or later. Please see help tab for more information.`);return}let r=i.id,g=r.replace("tool","T");document.querySelectorAll("#latheControls .tool-btn").forEach(function(T){T.id!=r?T.classList.remove("tool-selected"):T.classList.add("tool-selected")});let y=new Array(1);y[0]=g,this.sender&&this.sender.sendCommands(y,K.GCODE)})}),this.connectButton.addEventListener("click",()=>{var i;this.gcodeResponseContainer.style.display="block",!((i=this.sender)!=null&&i.isConnected())&&this.sender&&this.sender.connect()}),this.sendButton.addEventListener("click",()=>{var i;if(!((i=this.sender)!=null&&i.isConnected())){alert("Please connect to the controller first.");return}this.sender&&(this.sendButton.disabled=!0,this.sendSingleCommandButton.disabled=!0,this.jogButtons.forEach(r=>{r.disabled=!0}),this.toolButtons.forEach(r=>{r.disabled=!0}),this.sender.start(Z.getValue(),K.GCODE))}),this.sendSingleCommandButton.addEventListener("click",()=>{var i;if(!((i=this.sender)!=null&&i.isConnected())){alert("Please connect to the controller first.");return}this.sender&&(this.sendButton.disabled=!0,this.sendSingleCommandButton.disabled=!0,this.jogButtons.forEach(r=>{r.disabled=!0}),this.toolButtons.forEach(r=>{r.disabled=!0}),this.sender.sendCommand(this.singleCommandSender.value,K.GCODE))}),this.stopButton=document.getElementById("stopButton"),this.stopButton.addEventListener("click",()=>this.sender.stop()),this.stopButton.style.display="none"}hide(){}handleStatusChange(){if(!this.sender)return;const e=this.sender.getStatus();if(e.isConnected===!1){this.connectButton.innerText="Connect",this.connectButton.disabled=!1,this.connectButton.style.backgroundColor="";return}else this.connectButton.innerText="Connected",this.connectButton.disabled=!0,this.connectButton.style.backgroundColor="green";const t=e.condition==="run";this.runProgress&&(this.runProgress.value=e.progress,this.runProgress.style.display=t?"block":"none",this.runProgressLabel.style.display=t?"block":"none",t?t&&(this.sendButton.style.display="none"):(this.sendButton.disabled=!1,this.sendButton.style.display="inline-block",this.sendSingleCommandButton.disabled=!1,this.jogButtons.forEach(i=>{i.disabled=!1}),this.toolButtons.forEach(i=>{i.disabled=!1}))),this.stopButton&&(this.stopButton.style.display=t?"inline-block":"none");const s=this.sender.getDisconnectingStatus();this.senderError&&!s&&(e.error?(this.senderError.style.display="block",this.senderError.innerText=e.error,this.showError(),this.appendLineToResponseEditor(e.error)):(this.hideError(),this.senderError.innerText=""))}appendLineToResponseEditor(e){var t=Ee.getSession(),s=t.getLength(),i=new Date().toLocaleTimeString(),r=`[${i}] ${e}
`;t.insert({row:s,column:0},r)}showError(){this.senderError.style.display="block"}hideError(){this.senderError.style.display="none"}}const En=`; This example shows a boring operation, then an internal grooving operation

G21 ; metric
G18 ; ZX plane
G90 ; absolute positioning
F200
X0 ; zero your tool X on centerline
Z0 ; zero your tool Z at the right edge of the stock
G91 ; relative positioning

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;1mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;2mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;3mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;4mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;5mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;6mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;7mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;8mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;9mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;10mm

Z-10

Z3.25 ; cut
X-5 ; cut

X-1.7 ; cut

X6.7 ; retract
Z-3.25 ; retract
`;function Bn(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Cn=function(e,t){return Array.prototype.slice.call(e,t)},Tn=typeof setImmediate=="function",Ft;Tn?Ft=function(n){setImmediate(n)}:Ft=function(n){setTimeout(n,0)};var Sn=Ft,In=Sn,wn=function(e,t,s){e&&In(function(){e.apply(s||null,t||[])})},Jt=Cn,xn=wn,Nn=function(e,t){var s=t||{},i={};return e===void 0&&(e={}),e.on=function(r,g){return i[r]?i[r].push(g):i[r]=[g],e},e.once=function(r,g){return g._once=!0,e.on(r,g),e},e.off=function(r,g){var h=arguments.length;if(h===1)delete i[r];else if(h===0)i={};else{var y=i[r];if(!y)return e;y.splice(y.indexOf(g),1)}return e},e.emit=function(){var r=Jt(arguments);return e.emitterSnapshot(r.shift()).apply(this,r)},e.emitterSnapshot=function(r){var g=(i[r]||[]).slice(0);return function(){var h=Jt(arguments),y=this||e;if(r==="error"&&s.throws!==!1&&!g.length)throw h.length===1?h[0]:h;return g.forEach(function(T){s.async?xn(T,h,y):T.apply(y,h),T._once&&e.off(r,T)}),e}},e},sn=window.CustomEvent;function Ln(){try{var n=new sn("cat",{detail:{foo:"bar"}});return n.type==="cat"&&n.detail.foo==="bar"}catch{}return!1}var On=Ln()?sn:typeof document<"u"&&typeof document.createEvent=="function"?function(e,t){var s=document.createEvent("CustomEvent");return t?s.initCustomEvent(e,t.bubbles,t.cancelable,t.detail):s.initCustomEvent(e,!1,!1,void 0),s}:function(e,t){var s=document.createEventObject();return s.type=e,t?(s.bubbles=!!t.bubbles,s.cancelable=!!t.cancelable,s.detail=t.detail):(s.bubbles=!1,s.cancelable=!1,s.detail=void 0),s},an=[],Et="",Pn=/^on/;for(Et in window)Pn.test(Et)&&an.push(Et.slice(2));var Mn=an,Dn=On,$n=Mn,mt=window.document,rn=Fn,ln=_n,st=[];window.addEventListener||(rn=Gn,ln=Jn);var Xn={add:rn,remove:ln,fabricate:qn};function Fn(n,e,t,s){return n.addEventListener(e,t,s)}function Gn(n,e,t){return n.attachEvent("on"+e,Rn(n,e,t))}function _n(n,e,t,s){return n.removeEventListener(e,t,s)}function Jn(n,e,t){var s=cn(n,e,t);if(s)return n.detachEvent("on"+e,s)}function qn(n,e,t){var s=$n.indexOf(e)===-1?r():i();n.dispatchEvent?n.dispatchEvent(s):n.fireEvent("on"+e,s);function i(){var g;return mt.createEvent?(g=mt.createEvent("Event"),g.initEvent(e,!0,!0)):mt.createEventObject&&(g=mt.createEventObject()),g}function r(){return new Dn(e,{detail:t})}}function An(n,e,t){return function(i){var r=i||window.event;r.target=r.target||r.srcElement,r.preventDefault=r.preventDefault||function(){r.returnValue=!1},r.stopPropagation=r.stopPropagation||function(){r.cancelBubble=!0},r.which=r.which||r.keyCode,t.call(n,r)}}function Rn(n,e,t){var s=cn(n,e,t)||An(n,e,t);return st.push({wrapper:s,element:n,type:e,fn:t}),s}function cn(n,e,t){var s=Zn(n,e,t);if(s){var i=st[s].wrapper;return st.splice(s,1),i}}function Zn(n,e,t){var s,i;for(s=0;s<st.length;s++)if(i=st[s],i.element===n&&i.type===e&&i.fn===t)return s}var qt={},jn="(?:^|\\s)",zn="(?:\\s|$)";function un(n){var e=qt[n];return e?e.lastIndex=0:qt[n]=e=new RegExp(jn+n+zn,"g"),e}function Vn(n,e){var t=n.className;t.length?un(e).test(t)||(n.className+=" "+e):n.className=e}function Hn(n,e){n.className=n.className.replace(un(e)," ").trim()}var Un={add:Vn,rm:Hn},Kn=Nn,Re=Xn,Se=Un,Ze=document,le=Ze.documentElement;function Yn(n,e){var t=arguments.length;t===1&&Array.isArray(n)===!1&&(e=n,n=[]);var s,i,r,g,h,y,L,T,f,v,$,R=null,ee,o=e||{};o.moves===void 0&&(o.moves=jt),o.accepts===void 0&&(o.accepts=jt),o.invalid===void 0&&(o.invalid=it),o.containers===void 0&&(o.containers=n||[]),o.isContainer===void 0&&(o.isContainer=Qn),o.copy===void 0&&(o.copy=!1),o.copySortSource===void 0&&(o.copySortSource=!1),o.revertOnSpill===void 0&&(o.revertOnSpill=!1),o.removeOnSpill===void 0&&(o.removeOnSpill=!1),o.direction===void 0&&(o.direction="vertical"),o.ignoreInputTextSelection===void 0&&(o.ignoreInputTextSelection=!0),o.mirrorContainer===void 0&&(o.mirrorContainer=Ze.body);var a=Kn({containers:o.containers,start:Y,end:Oe,cancel:Ce,remove:Be,destroy:k,canMove:G,dragging:!1});return o.removeOnSpill===!0&&a.on("over",ct).on("out",yt),l(),a;function c(d){return a.containers.indexOf(d)!==-1||o.isContainer(d)}function l(d){var E=d?"remove":"add";Ke(le,E,"mousedown",C),Ke(le,E,"mouseup",je)}function u(d){var E=d?"remove":"add";Ke(le,E,"mousemove",I)}function p(d){var E=d?"remove":"add";Re[E](le,"selectstart",b),Re[E](le,"click",b)}function k(){l(!0),je({})}function b(d){ee&&d.preventDefault()}function C(d){y=d.clientX,L=d.clientY;var E=At(d)!==1||d.metaKey||d.ctrlKey;if(!E){var S=d.target,O=M(S);O&&(ee=O,u(),d.type==="mousedown"&&(Ht(S)?S.focus():d.preventDefault()))}}function I(d){if(ee){if(At(d)===0){je({});return}if(!(d.clientX!==void 0&&Math.abs(d.clientX-y)<=(o.slideFactorX||0)&&d.clientY!==void 0&&Math.abs(d.clientY-L)<=(o.slideFactorY||0))){if(o.ignoreInputTextSelection){var E=Ie("clientX",d)||0,S=Ie("clientY",d)||0,O=Ze.elementFromPoint(E,S);if(Ht(O))return}var P=ee;u(!0),p(),Oe(),W(P);var X=Wn(r);g=Ie("pageX",d)-X.left,h=Ie("pageY",d)-X.top,Se.add(v||r,"gu-transit"),Pe(),me(d)}}}function M(d){if(!(a.dragging&&s)&&!c(d)){for(var E=d;U(d)&&c(U(d))===!1;)if(o.invalid(d,E)||(d=U(d),!d))return;var S=U(d);if(S&&!o.invalid(d,E)){var O=o.moves(d,S,E,Ye(d));if(O)return{item:d,source:S}}}}function G(d){return!!M(d)}function Y(d){var E=M(d);E&&W(E)}function W(d){ze(d.item,d.source)&&(v=d.item.cloneNode(!0),a.emit("cloned",v,d.item,"copy")),i=d.source,r=d.item,T=f=Ye(d.item),a.dragging=!0,a.emit("drag",r,i)}function it(){return!1}function Oe(){if(a.dragging){var d=v||r;lt(d,U(d))}}function rt(){ee=!1,u(!0),p(!0)}function je(d){if(rt(),!!a.dragging){var E=v||r,S=Ie("clientX",d)||0,O=Ie("clientY",d)||0,P=Zt(s,S,O),X=de(P,S,O);X&&(v&&o.copySortSource||!v||X!==i)?lt(E,X):o.removeOnSpill?Be():Ce()}}function lt(d,E){var S=U(d);v&&o.copySortSource&&E===i&&S.removeChild(r),ue(E)?a.emit("cancel",d,i,i):a.emit("drop",d,E,i,f),ce()}function Be(){if(a.dragging){var d=v||r,E=U(d);E&&E.removeChild(d),a.emit(v?"cancel":"remove",d,E,i),ce()}}function Ce(d){if(a.dragging){var E=arguments.length>0?d:o.revertOnSpill,S=v||r,O=U(S),P=ue(O);P===!1&&E&&(v?O&&O.removeChild(v):i.insertBefore(S,T)),P||E?a.emit("cancel",S,i,i):a.emit("drop",S,O,i,f),ce()}}function ce(){var d=v||r;rt(),Me(),d&&Se.rm(d,"gu-transit"),$&&clearTimeout($),a.dragging=!1,R&&a.emit("out",d,R,i),a.emit("dragend",d),i=r=v=T=f=$=R=null}function ue(d,E){var S;return E!==void 0?S=E:s?S=f:S=Ye(v||r),d===i&&S===T}function de(d,E,S){for(var O=d;O&&!P();)O=U(O);return O;function P(){var X=c(O);if(X===!1)return!1;var Te=fe(O,d),J=pe(O,Te,E,S),se=ue(O,J);return se?!0:o.accepts(r,O,i,J)}}function me(d){if(!s)return;d.preventDefault();var E=Ie("clientX",d)||0,S=Ie("clientY",d)||0,O=E-g,P=S-h;s.style.left=O+"px",s.style.top=P+"px";var X=v||r,Te=Zt(s,E,S),J=de(Te,E,S),se=J!==null&&J!==R;(se||J===null)&&(bt(),R=J,kt());var q=U(X);if(J===i&&v&&!o.copySortSource){q&&q.removeChild(X);return}var j,ge=fe(J,Te);if(ge!==null)j=pe(J,ge,E,S);else if(o.revertOnSpill===!0&&!v)j=T,J=i;else{v&&q&&q.removeChild(X);return}(j===null&&se||j!==X&&j!==Ye(X))&&(f=j,J.insertBefore(X,j),a.emit("shadow",X,J,i));function ae(ut){a.emit(ut,X,R,i)}function kt(){se&&ae("over")}function bt(){R&&ae("out")}}function ct(d){Se.rm(d,"gu-hide")}function yt(d){a.dragging&&Se.add(d,"gu-hide")}function Pe(){if(!s){var d=r.getBoundingClientRect();s=r.cloneNode(!0),s.style.width=zt(d)+"px",s.style.height=Vt(d)+"px",Se.rm(s,"gu-transit"),Se.add(s,"gu-mirror"),o.mirrorContainer.appendChild(s),Ke(le,"add","mousemove",me),Se.add(o.mirrorContainer,"gu-unselectable"),a.emit("cloned",s,r,"mirror")}}function Me(){s&&(Se.rm(o.mirrorContainer,"gu-unselectable"),Ke(le,"remove","mousemove",me),U(s).removeChild(s),s=null)}function fe(d,E){for(var S=E;S!==d&&U(S)!==d;)S=U(S);return S===le?null:S}function pe(d,E,S,O){var P=o.direction==="horizontal",X=E!==d?J():Te();return X;function Te(){var q=d.children.length,j,ge,ae;for(j=0;j<q;j++)if(ge=d.children[j],ae=ge.getBoundingClientRect(),P&&ae.left+ae.width/2>S||!P&&ae.top+ae.height/2>O)return ge;return null}function J(){var q=E.getBoundingClientRect();return se(P?S>q.left+zt(q)/2:O>q.top+Vt(q)/2)}function se(q){return q?Ye(E):E}}function ze(d,E){return typeof o.copy=="boolean"?o.copy:o.copy(d,E)}}function Ke(n,e,t,s){var i={mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"},r={mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"},g={mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"};window.navigator.pointerEnabled?Re[e](n,r[t],s):window.navigator.msPointerEnabled?Re[e](n,g[t],s):(Re[e](n,i[t],s),Re[e](n,t,s))}function At(n){if(n.touches!==void 0)return n.touches.length;if(n.which!==void 0&&n.which!==0)return n.which;if(n.buttons!==void 0)return n.buttons;var e=n.button;if(e!==void 0)return e&1?1:e&2?3:e&4?2:0}function Wn(n){var e=n.getBoundingClientRect();return{left:e.left+Rt("scrollLeft","pageXOffset"),top:e.top+Rt("scrollTop","pageYOffset")}}function Rt(n,e){return typeof window[e]<"u"?window[e]:le.clientHeight?le[n]:Ze.body[n]}function Zt(n,e,t){n=n||{};var s=n.className||"",i;return n.className+=" gu-hide",i=Ze.elementFromPoint(e,t),n.className=s,i}function Qn(){return!1}function jt(){return!0}function zt(n){return n.width||n.right-n.left}function Vt(n){return n.height||n.bottom-n.top}function U(n){return n.parentNode===Ze?null:n.parentNode}function Ht(n){return n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.tagName==="SELECT"||dn(n)}function dn(n){return!n||n.contentEditable==="false"?!1:n.contentEditable==="true"?!0:dn(U(n))}function Ye(n){return n.nextElementSibling||e();function e(){var t=n;do t=t.nextSibling;while(t&&t.nodeType!==1);return t}}function eo(n){return n.targetTouches&&n.targetTouches.length?n.targetTouches[0]:n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:n}function Ie(n,e){var t=eo(e),s={pageX:"clientX",pageY:"clientY"};return n in s&&!(n in t)&&s[n]in t&&(n=s[n]),t[n]}var to=Yn;const Ut=Bn(to);class mn{static getButtonName(e){const t=this.buttons.find(s=>s.id===e);return t?t.name:""}static createKeyPressEvent(e,t){const s=this.buttons.find(r=>r.id===e);if(!s)throw new Error(`No button found with id: ${e}`);let i=s.number;return i&=127,t&&(i|=128),i}}x(mn,"buttons",[{name:"arrow_left_alt",id:"B_LEFT",number:57},{name:"arrow_right_alt",id:"B_RIGHT",number:37},{name:"arrow_upward_alt",id:"B_UP",number:47},{name:"arrow_downward_alt",id:"B_DOWN",number:67},{name:"+",id:"B_MINUS",number:5},{name:"-",id:"B_PLUS",number:64},{name:"play_arrow",id:"B_ON",number:17},{name:"crop_square",id:"B_OFF",number:27},{name:"keyboard_tab_rtl",id:"B_STOPL",number:7},{name:"keyboard_tab",id:"B_STOPR",number:15},{name:"vertical_align_top",id:"B_STOPU",number:6},{name:"vertical_align_bottom",id:"B_STOPD",number:16},{name:"rotate_left",id:"B_DISPL",number:14},{name:"signal_cellular_alt",id:"B_STEP",number:24},{name:"settings",id:"B_SETTINGS",number:34},{name:"space_bar",id:"B_MEASURE",number:54},{name:"sync_alt",id:"B_REVERSE",number:44},{name:"1",id:"B_0",number:51},{name:"2",id:"B_1",number:41},{name:"3",id:"B_2",number:61},{name:"4",id:"B_3",number:31},{name:"5",id:"B_4",number:2},{name:"6",id:"B_5",number:21},{name:"7",id:"B_6",number:12},{name:"8",id:"B_7",number:11},{name:"9",id:"B_8",number:22},{name:"10",id:"B_9",number:1},{name:"backspace",id:"B_BACKSPACE",number:32},{name:"manufacturing",id:"B_MODE_GEARS",number:42},{name:"reply",id:"B_MODE_TURN",number:52},{name:"turn_slight_left",id:"B_MODE_FACE",number:62},{name:"arrow_forward_ios",id:"B_MODE_CONE",number:3},{name:"publish",id:"B_MODE_CUT",number:13},{name:"home_improvement_and_tools",id:"B_MODE_THREAD",number:23},{name:"M",id:"B_MODE_OTHER",number:33},{name:"X",id:"B_X",number:53},{name:"Z",id:"B_Z",number:43},{name:"A",id:"B_A",number:4},{name:"B",id:"B_B",number:63}]);let no=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");const ve=document.getElementById("availableTasks"),V=document.getElementById("tasksToExecute"),Bt=document.getElementById("deleteTasks"),oo=document.getElementById("addNewTaskButton"),$e=document.getElementById("newTaskModal"),so=document.getElementById("closeNewTaskModal"),ye=document.getElementById("newTaskType"),Je=document.getElementById("gcodeTaskContainer"),Q=document.getElementById("newTaskGcode"),qe=document.getElementById("emulationOuterContainer"),ao=document.getElementById("saveNewTaskButton"),We=document.getElementById("newTaskName"),Kt=document.getElementById("taskTextTitle"),Ct=document.getElementById("newTaskDescription");let H;const Ae=document.getElementById("connectButton"),io=document.getElementById("plannerContainer");let Yt=null;const ro=document.getElementById("saveAvailableTaskCollection"),lo=document.getElementById("saveAvailableTaskCollectionButtonModal"),co=document.getElementById("loadTaskCollection"),ke=document.getElementById("availableTaskCollections"),oe=document.getElementById("collectionToSaveTo"),Wt=document.getElementById("newCollectionNameContainer"),Tt=document.getElementById("newCollectionName"),uo=document.getElementById("deleteTaskCollection"),St=document.getElementById("saveCollectionModal"),we=document.getElementById("saveCollectionModalToSaveTo"),mo=document.getElementById("saveCollectionModalClose"),fo=document.getElementById("newCollectionNameModal"),Qt=document.getElementById("newCollectionNameContainerModal"),po=document.getElementById("importAvailableTasks"),go=document.getElementById("exportAvailableTasks"),It=document.getElementById("saveJobModal"),ho=document.getElementById("saveJobModalClose"),vo=document.getElementById("executeJobButton"),yo=document.getElementById("saveJobButton"),ko=document.getElementById("newJobButton"),wt=document.getElementById("saveJobNameInput"),xe=document.getElementById("saveJobNameSelect"),ft=document.getElementById("newJobNameContainer"),xt=document.getElementById("saveJobGroupNameInput"),Ne=document.getElementById("saveJobGroupNameSelect"),pt=document.getElementById("newJobGroupNameContainer"),bo=document.getElementById("saveJobSaveButton"),Qe=document.getElementById("jobLoadSelect"),re=document.getElementById("groupLoadSelect"),Eo=document.getElementById("loadJobButton"),Bo=document.getElementById("deleteJobButton"),Co=document.getElementById("importJobButton"),To=document.getElementById("exportJobButton"),Nt=document.getElementById("exportJobModal"),So=document.getElementById("exportJobModalClose"),Io=document.getElementById("exportJobSaveButton"),et=document.getElementById("exportJobGroupNameSelect"),Lt=document.getElementById("exportJobNameSelect"),tt=[],Ot=document.getElementById("manualTaskModal"),gt=document.getElementById("cncTaskModal"),wo=document.getElementById("cancelManualTask"),xo=document.getElementById("completeManualTask"),No=document.getElementById("manualTaskInstructions"),en=document.getElementById("cncTaskGcode"),Lo=document.getElementById("cancelCncTask"),Xe=document.getElementById("executeGcode"),Le=document.getElementById("completeCncTask"),Oo=document.getElementById("manualTaskName"),Po=document.getElementById("cncTaskName"),ht=document.getElementById("cncTaskSenderProgressLabel"),Pt=document.getElementById("cncTaskSenderProgress"),Mt=document.getElementById("jobCancelledModal"),Mo=document.getElementById("jobCancelledCloseButton"),tn=document.getElementById("completeTaskModal"),Do=document.getElementById("completeTaskCloseButton"),nn=document.getElementById("notConnectedModal"),$o=document.getElementById("notConnectedCloseButton"),Xo=document.getElementById("currentGcodeLineContainer"),Fo=document.getElementById("currentGcodeLine"),Go=document.getElementById("currentFeedrateContainer"),_o=document.getElementById("currentFeedrate"),Jo=document.getElementById("emulationInnerContainer"),be=document.getElementById("emulationNewTasks"),Dt=document.getElementById("emulatedButtonListDelete"),qo=document.getElementById("emulationTaskModal");document.addEventListener("DOMContentLoaded",()=>{H=ot.getInstance(),H.addStatusChangeListener(()=>g(),K.PLANNER),H.addCurrentCommandListener(r),io.addEventListener("containerVisible",()=>{V.innerHTML="",i(),v(),f(),e(),s();const o=t();T(o),$()}),we.addEventListener("change",()=>{we.value==="new"?Qt.style.display="block":Qt.style.display="none"}),oe.addEventListener("change",()=>{oe.value==="new"?Wt.style.display="block":Wt.style.display="none"}),xe.addEventListener("change",()=>{xe.value==="new"?ft.style.display="block":ft.style.display="none"}),Ne.addEventListener("change",()=>{Ne.value==="new"?pt.style.display="block":pt.style.display="none"}),mo.onclick=function(){St.style.display="none"},ro.onclick=function(){St.style.display="block"},lo.onclick=function(){let o="";if(we.value==="new"){if(o=fo.value,o===null||o===""){alert("Please enter a name for the collection");return}}else o=we.value;const a=localStorage.getItem("selectedTaskCollection");let c;if(a){const u=localStorage.getItem(`taskCollection_${a}`);u&&(c=JSON.parse(u),o!==a&&(c.name=o,localStorage.setItem(`taskCollection_${o}`,JSON.stringify(c))))}const l=document.createElement("option");l.value=o,l.textContent=o,ke.appendChild(l),St.style.display="none",alert(`Collection ${o} saved`),i()},co.onclick=function(){const o=ke.value;localStorage.setItem("selectedTaskCollection",o),v()},uo.onclick=function(){const o=ke.value;if(o==="default"){alert("You cannot delete the default collection");return}confirm(`Are you sure you want to delete the collection ${o}?`)&&(localStorage.removeItem(`taskCollection_${o}`),i(),v())},po.onclick=function(){const o=document.createElement("input");o.type="file",o.accept=".json",o.multiple=!0,o.onchange=async function(a){const c=a.target.files;if(c)for(let l=0;l<c.length;l++){const u=c[l],p=new FileReader;p.onload=function(k){var C;const b=(C=k.target)==null?void 0:C.result;b&&(JSON.parse(b).forEach(M=>{const G=M.name;localStorage.getItem(`taskCollection_${G}`)?window.confirm(`Task collection ${G} already exists. Do you want to override it?`)&&localStorage.setItem(`taskCollection_${G}`,JSON.stringify(M)):localStorage.setItem(`taskCollection_${G}`,JSON.stringify(M))}),i())},p.readAsText(u)}},o.click()},go.onclick=function(){const o=Object.keys(localStorage).filter(b=>b.includes("taskCollection_")),a=[];o.forEach(b=>{const C=localStorage.getItem(b);C&&a.push(JSON.parse(C))});const c=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),l=URL.createObjectURL(c),u=document.createElement("a");u.href=l;const k=new Date().toISOString().split("T")[0];u.download=`availableTasks_${k}.json`,u.click(),URL.revokeObjectURL(l)},Jo.addEventListener("click",function(o){const a=o.target;if(a.tagName==="BUTTON"){const c=a.id;n(c)}});function n(o){const a=document.getElementById(o),c=a==null?void 0:a.cloneNode(!0);c.classList.add("emulated-button-list"),c.removeAttribute("id");const l="emulated-"+Date.now();c.setAttribute("data-emulated-id",l),be==null||be.appendChild(c)}function e(){re.innerHTML="",Object.keys(localStorage).filter(c=>c.includes("savedGroup_")).sort().forEach(c=>{const l=c.replace("savedGroup_",""),u=document.createElement("option");u.value=l,u.textContent=l,re.appendChild(u)});const a=localStorage.getItem("selectedGroup");a&&(re.value=a)}function t(){const o=re.value,a=Qe.value,c=localStorage.getItem(`savedGroup_${o}`);if(c){const u=JSON.parse(c).jobs.find(p=>p.name===a);return u?(u.groupName||(u.groupName=o),u):(console.warn(`Job with name ${a} not found.`),null)}return null}function s(){Qe.innerHTML="";const o=re.value,a=localStorage.getItem(`savedGroup_${o}`);let c=[];a&&(c=JSON.parse(a).jobs.map(u=>u.name)),c.forEach(l=>{const u=document.createElement("option");u.value=l,u.textContent=l,Qe.appendChild(u)})}function i(){ke.innerHTML="",oe.innerHTML="",we.innerHTML="";const o=document.createElement("option");o.value="default",o.textContent="default",ke.appendChild(o),oe.appendChild(o.cloneNode(!0)),we.appendChild(o.cloneNode(!0)),Object.keys(localStorage).filter(u=>u.includes("taskCollection_")).sort().forEach(u=>{if(u==="taskCollection_default")return;const p=u.replace("taskCollection_",""),k=document.createElement("option");k.value=p,k.textContent=p,ke.appendChild(k),oe.appendChild(k.cloneNode(!0)),we.appendChild(k.cloneNode(!0))});const c=localStorage.getItem("selectedTaskCollection");c&&(ke.value=c);const l=document.createElement("option");l.value="new",l.textContent="--new collection--",oe.appendChild(l.cloneNode(!0)),we.appendChild(l.cloneNode(!0))}$o.onclick=function(){nn.style.display="none"};function r(o){if(!H)return;const c=H.getStatus().condition==="run";if(c){if(c){const l=o.match(/F(\d+)/);l&&(Yt=parseInt(l[1],10),_o.innerText=Yt.toString()),Fo.innerText=o,Go.style.display="block",Xo.style.display="block"}}}function g(){if(!H)return;const o=H.getStatus();if(o.isConnected===!1){Ae.innerText="Connect",Ae.disabled=!1,Ae.style.backgroundColor="";return}else Ae.innerText="Connected",Ae.disabled=!0,Ae.style.backgroundColor="green";const a=o.condition==="run";a?a&&(Xe.disabled=!0,Xe.classList.add("disabled-button"),Xe.classList.remove("interaction-ready-button"),Le.classList.remove("interaction-ready-button"),ht.innerText="Task in progress",Le.style.display="none"):(Le.style.display="block",Le.disabled=!1,Le.classList.add("interaction-ready-button"),ht.innerText="Task completed"),Pt.value=o.progress,Pt.style.display="block",ht.style.display="block"}Ut([be,Dt],{copy:!1,accepts:(o,a)=>a===Dt||a===be,revertOnSpill:!0,removeOnSpill:!1}).on("drop",(o,a)=>{if(a===Dt){o.remove();const c=o.getAttribute("data-emulated-id"),l=be.querySelector(`[data-emulated-id="${c}"]`);l&&l.remove()}});const y=Ut([ve,V,Bt],{copy:(o,a)=>a===ve,accepts:(o,a)=>a===V||a===Bt,revertOnSpill:!0,removeOnSpill:!1});y.on("dragend",()=>{$(),f(),L("currentJob")});function L(o,a=""){const c=V.querySelectorAll(".task-to-execute"),l={name:"",groupName:"",tasks:[]};if(c.forEach(u=>{const p=u.getAttribute("data-task-id"),k=u.getAttribute("data-collection-name");l.tasks.push({id:p,collectionName:k})}),l.name=o,l.groupName=a,o==="currentJob")localStorage.setItem(o,JSON.stringify(l));else if(a){let u=localStorage.getItem(`savedGroup_${a}`);if(u||(localStorage.setItem(`savedGroup_${a}`,JSON.stringify({jobs:[]})),u=localStorage.getItem(`savedGroup_${a}`)),u){let p=u?JSON.parse(u):null;p.jobs.push({name:o,tasks:l.tasks}),localStorage.setItem(`savedGroup_${a}`,JSON.stringify(p))}}}function T(o){let a=o.tasks;const c=[];a=a.filter(l=>localStorage.getItem(`taskCollection_${l.collectionName}`)?!0:(c.push(l),!1)),localStorage.setItem("currentJob",JSON.stringify(a)),V.innerHTML="",a.forEach(l=>{const u=localStorage.getItem(`taskCollection_${l.collectionName}`);if(u){const k=JSON.parse(u).tasks.find(b=>b.id===l.id);if(k){const b=document.createElement("div");b.classList.add(`task-${k.type}`),b.classList.add("task-to-execute"),b.setAttribute("data-task-id",k.id),b.setAttribute("data-task-name",k.name),b.setAttribute("data-collection-name",l.collectionName),b.textContent=k.name,V.appendChild(b)}}}),c.length>0&&alert(`The following tasks were removed because their collection does not exist: ${c.map(l=>l.id).join(", ")}`),localStorage.setItem("loadedJob",JSON.stringify({name:o.name,groupName:o.groupName}))}y.on("drop",(o,a,c)=>{const l=o.getAttribute("data-task-id"),u=o.getAttribute("data-task-order");if(a===V)o.classList.remove("available-task"),o.classList.add("task-to-execute"),f();else if(a===Bt){o.remove();let p=null;if(c===V)p=V.querySelector(`[data-task-order="${u}"]`);else if(c===ve&&(p=ve.querySelector(`[data-task-id="${l}"]`),p)){const k=p.getAttribute("data-collection-name"),b=localStorage.getItem(`taskCollection_${k}`);if(b){const C=JSON.parse(b);C.tasks=C.tasks.filter(I=>I.id!==l),localStorage.setItem(`taskCollection_${k}`,JSON.stringify(C))}}p&&p.remove()}});function f(){V.querySelectorAll(".task-to-execute").forEach(a=>{if(a.querySelector("i")){let c=a.querySelector("i");c&&(c.remove(),c=document.createElement("i"),a.classList.contains("task-manual")?(c.className="fas fa-users-cog icon-tooltip",c.setAttribute("data-tooltip","Manual Task")):a.classList.contains("task-gcode")?(c.className="fas fa-code icon-tooltip",c.setAttribute("data-tooltip","Gcode Task")):a.classList.contains("task-emulation")&&(c.className="far fa-keyboard icon-tooltip",c.setAttribute("data-tooltip","Emulation Task")),a.appendChild(c))}else{const c=document.createElement("i");a.classList.contains("task-manual")?(c.className="fas fa-users-cog icon-tooltip",c.setAttribute("data-tooltip","Manual Task")):a.classList.contains("task-gcode")?(c.className="fas fa-code icon-tooltip",c.setAttribute("data-tooltip","Gcode Task")):a.classList.contains("task-emulation")&&(c.className="far fa-keyboard icon-tooltip",c.setAttribute("data-tooltip","Emulation Task")),a.appendChild(c)}})}function v(){ve.innerHTML="";let o=localStorage.getItem("selectedTaskCollection");(o===null||o==="")&&(o=ke.value,localStorage.setItem("selectedTaskCollection",o));const a=localStorage.getItem(`taskCollection_${o}`);a&&JSON.parse(a).tasks.forEach(l=>{l.id,l.name,l.type,l.description,l.gcode&&l.gcode,l.buttonKeys&&l.buttonKeys;const u=document.createElement("div");u.classList.add(`task-${l.type}`),u.classList.add("available-task"),u.setAttribute("data-task-id",l.id.toString()),u.setAttribute("data-task-name",l.name),u.setAttribute("data-collection-name",o||""),u.textContent=l.name;const p=document.createElement("i");p.classList.add("fas","fa-info-circle","fa-fw","show-info","icon-tooltip"),p.setAttribute("data-tooltip","Click for more info..."),u.appendChild(p),ve.appendChild(u)})}function $(){const o=document.getElementById("tasksToExecute");o&&o.querySelectorAll("div").forEach((c,l)=>{const u=c.getAttribute("data-task-name");c.setAttribute("data-task-order",(l+1).toString()),c.textContent=`Task ${l+1}: ${u}`})}ye.addEventListener("change",()=>{ye.value==="manual"?(Q.disabled=!0,Q.placeholder="Disabled for manual tasks",Q.value="",Je.style.display="none",qe.style.display="none"):ye.value==="emulation"?(Q.disabled=!0,Q.placeholder="Disabled for emulation tasks",Q.value="",Je.style.display="none",qe.style.display="block"):(qe.style.display="none",Je.style.display="block",Q.placeholder="Enter gcode here...",Q.disabled=!1)}),oo.addEventListener("click",()=>{$e.style.display="block",Kt.textContent="Add a new task",We.value="",Ct.value="",Q.value="",Tt.value="",$e.removeAttribute("data-task-id"),oe.value=""}),ao.addEventListener("click",()=>{if(oe.value===""){alert("Please select a collection.");return}if(oe.value==="new"&&Tt.value===""){alert("Please enter a collection name");return}if(We.value===""||We.value===null){alert("Please enter a task name");return}const o=We.value,a=document.createElement("div");a.classList.add(`task-${ye.value}`),a.classList.add("available-task");let c;const l=$e.getAttribute("data-task-id");l?c=l:c=no(),a.setAttribute("data-task-id",c.toString()),a.setAttribute("data-task-name",o),a.textContent=o;const u=document.createElement("i");u.classList.add("fas","fa-info-circle","fa-fw","show-info","icon-tooltip"),u.setAttribute("data-tooltip","Click for more info..."),a.appendChild(u);const p=ve.querySelector(`[data-task-id="${c}"]`);p&&p.remove(),ve.appendChild(a),$e.style.display="none";let k="";ye.value==="emulation"&&(be.querySelectorAll(".emulated-button-list").forEach(I=>{const M=I.getAttribute("data-button-key");k+=M+","}),k.length>0&&(k=k.slice(0,-1)));const b={id:c,name:o,type:ye.value,description:Ct.value};if(ye.value==="gcode"&&(b.gcode=Q.value),ye.value==="emulation"&&(b.buttonKeys=k),oe.value==="new"){const C=Tt.value,I={name:C,tasks:[]};I.tasks.push(b),localStorage.setItem(`taskCollection_${C}`,JSON.stringify(I));const M=document.createElement("option");M.value=C,M.textContent=C,ke.appendChild(M),i()}else{const C=oe.value,I=localStorage.getItem(`taskCollection_${C}`);if(I){const M=JSON.parse(I);M.tasks.find(Y=>Y.id===c)&&(M.tasks=M.tasks.filter(Y=>Y.id!==c)),M.tasks.push(b),localStorage.setItem(`taskCollection_${C}`,JSON.stringify(M))}else{const M={name:C,tasks:[]};M.tasks.push(b),localStorage.setItem(`taskCollection_${C}`,JSON.stringify(M))}}v()}),ve.addEventListener("click",o=>{const a=o.target;if(a.matches(".show-info")){const l=a.parentNode.getAttribute("data-task-id");let u=null;const p=localStorage.getItem("selectedTaskCollection"),k=localStorage.getItem(`taskCollection_${p}`);if(k){const C=JSON.parse(k).tasks.find(I=>I.id===l);C&&(u=C)}u&&($e.style.display="block",We.value=u.name,ye.value=u.type,Ct.value=u.description,Q.value=u.gcode||"",oe.value=p||"default",Kt.textContent="Edit Task",u.type==="emulation"?(qe.style.display="block",Je.style.display="none",be.innerHTML="",(u.buttonKeys??"").split(",").forEach(C=>{const I=document.createElement("button");I.classList.add("emulated-button-list"),I.classList.add("material-symbols-outlined"),I.setAttribute("data-button-key",C),I.textContent=mn.getButtonName(C),I.textContent.length===1&&I.classList.add("standard-font"),be.appendChild(I)})):u.type==="gcode"?(qe.style.display="none",Je.style.display="block",Q.disabled=!1,Q.placeholder="Enter gcode here..."):(qe.style.display="none",Je.style.display="none"),l&&$e.setAttribute("data-task-id",l.toString()))}}),so.onclick=function(){$e.style.display="none"},Do.onclick=function(){tn.style.display="none"};function R(){if(tt.length===0){tn.style.display="block";return}const o=tt.shift();if(o&&o.type==="manual")Oo.textContent=`Task ${o.order}: ${o.name}`,No.value=o.description,Ot.style.display="block";else if(o&&o.type==="gcode"){Xe.disabled=!1,Xe.classList.remove("disabled-button"),Xe.classList.add("interaction-ready-button"),Po.textContent=`Task ${o.order}: ${o.name}`,en.value=o.gcode??"",gt.style.display="block";const a=gt.querySelector(".task-modal-content");a&&(a.style.backgroundColor=""),Le.disabled=!0,Le.style.display="none",Pt.style.display="none",ht.style.display="none"}else o&&o.type==="emulation"&&(qo.style.display="block")}wo.onclick=function(){Ot.style.display="none",tt.length=0,Mt.style.display="block"},Lo.onclick=function(){gt.style.display="none",tt.length=0,Mt.style.display="block",H==null||H.stop()},xo.onclick=function(){Ot.style.display="none",R()},Le.onclick=function(){gt.style.display="none",R()},Xe.onclick=function(){H&&H.start(en.value,K.PLANNER)},Mo.onclick=function(){Mt.style.display="none"},vo.onclick=function(){if(!(H!=null&&H.isConnected())){nn.style.display="block";return}V.querySelectorAll(".task-to-execute").forEach(a=>{const c=a.getAttribute("data-task-id"),l=a.getAttribute("data-task-order"),u=a.getAttribute("data-collection-name"),p=localStorage.getItem(`taskCollection_${u}`);let k=null;if(p){const C=JSON.parse(p).tasks.find(I=>I.id===c);C&&(k=C)}k&&(k.order=parseInt(l||"0"),tt.push(k))}),R()},yo.onclick=function(){It.style.display="block",Ne.innerHTML="",xe.innerHTML="",xt.value="",wt.value="";const o=localStorage.getItem("loadedJob");if(o){const l=JSON.parse(o).name,u=JSON.parse(o).groupName,p=document.createElement("option");p.value=u,p.textContent=u,Ne.appendChild(p);const k=document.createElement("option");k.value=l,k.textContent=l,xe.appendChild(k)}else{const l=Object.keys(localStorage).filter(u=>u.startsWith("savedGroup_")).sort();if(l.length>0){l.forEach(k=>{const b=k.replace("savedGroup_",""),C=document.createElement("option");C.value=b,C.textContent=b,Ne.appendChild(C)});const u=l[0],p=localStorage.getItem(u);p&&JSON.parse(p).jobs.forEach(b=>{const C=document.createElement("option");C.value=b.name,C.textContent=b.name,xe.appendChild(C)})}else pt.style.display="block",ft.style.display="block"}const a=document.createElement("option");a.value="new",a.textContent="--new group--",Ne.appendChild(a);const c=document.createElement("option");c.value="new",c.textContent="--new job--",xe.appendChild(c)},ko.onclick=function(){localStorage.setItem("loadedJob",""),localStorage.setItem("currentJob",""),V.innerHTML=""},bo.onclick=function(){let o=Ne.value==="new"?xt.value:Ne.value,a=xe.value==="new"?wt.value:xe.value;if(o===""||o===null){alert("Please enter a name for the group");return}if(a===""||a===null){alert("Please enter a name for the job");return}const c=localStorage.getItem(`savedGroup_${o}`);c&&JSON.parse(c).jobs.find(p=>p.name===a)&&!confirm("A job with this name in this group already exists. Do you want to overwrite it?")||(L(a,o),localStorage.setItem("loadedJob",JSON.stringify({name:a,groupName:o})),It.style.display="none",pt.style.display="none",ft.style.display="none",wt.value="",xt.value="",e(),s(),alert(`${a} saved`))},ho.onclick=function(){It.style.display="none"},So.onclick=function(){Nt.style.display="none"},re.addEventListener("change",()=>{const o=re.value;localStorage.setItem("selectedGroup",o),s()}),Eo.onclick=function(){V.innerHTML="";const o=re.value,a=Qe.value,c=localStorage.getItem(`savedGroup_${o}`),l=c?JSON.parse(c).jobs.find(u=>u.name===a):null;l&&(l.tasks.forEach(p=>{const k=localStorage.getItem(`taskCollection_${p.collectionName}`);if(k){const C=JSON.parse(k).tasks.find(I=>I.id===p.id);if(C){const I=document.createElement("div");I.classList.add(`task-${C.type}`),I.classList.add("task-to-execute"),I.setAttribute("data-task-id",C.id.toString()),I.setAttribute("data-task-name",C.name),I.setAttribute("data-collection-name",p.collectionName),I.textContent=C.name,V.appendChild(I)}}}),localStorage.setItem("currentJob",JSON.stringify(l.tasks))),localStorage.setItem("loadedJob",JSON.stringify({name:a,groupName:o})),$(),f()},Bo.onclick=function(){const o=Qe.value,a=re.value,c=localStorage.getItem(`savedGroup_${a}`);if(c){const l=JSON.parse(c);l.jobs=l.jobs.filter(u=>u.name!==o),l.jobs.length===0?(localStorage.removeItem(`savedGroup_${a}`),e(),re.selectedIndex=0):(localStorage.setItem(`savedGroup_${a}`,JSON.stringify(l)),e())}s(),f(),$()},Co.onclick=function(){const o=document.createElement("input");o.type="file",o.accept=".json",o.multiple=!0,o.onchange=function(a){const c=a.target.files;if(c){V.innerHTML="";const l=Array.from(c).map(u=>new Promise((p,k)=>{const b=new FileReader;b.onload=function(C){var M;const I=(M=C.target)==null?void 0:M.result;if(I){const G=JSON.parse(I);localStorage.setItem("loadedJob",JSON.stringify({name:G.name,groupName:G.groupName}));let Y=localStorage.getItem(`savedGroup_${G.groupName}`),W=JSON.parse(Y);if(W){if(W.jobs.find(Oe=>Oe.name===G.name)&&!confirm("A job with this name in this group already exists. Do you want to overwrite it?"))return}else W={jobs:[]};W.jobs.push({name:G.name,tasks:G.tasks}),localStorage.setItem(`savedGroup_${G.groupName}`,JSON.stringify(W)),p({job:G})}else k(new Error("No contents"))},b.readAsText(u)}));Promise.all(l).then(u=>{const[p]=u;v(),e(),s(),T(p.job),f(),$()}).catch(u=>{console.error("Error reading files:",u)})}},o.click()},To.onclick=function(){et.innerHTML="",Object.keys(localStorage).filter(a=>a.includes("savedGroup_")).sort().forEach(a=>{const c=a.replace("savedGroup_",""),l=document.createElement("option");l.value=c,l.textContent=c,et.appendChild(l)}),ee(),Nt.style.display="block"},et.addEventListener("change",()=>{ee()});function ee(){const o=et.value,a=localStorage.getItem(`savedGroup_${o}`);if(a){const c=JSON.parse(a);Lt.innerHTML="",c.jobs.forEach(l=>{const u=document.createElement("option");u.value=l.name,u.textContent=l.name,Lt.appendChild(u)})}}Io.onclick=function(){const o=et.value,a=Lt.value,c=localStorage.getItem(`savedGroup_${o}`),l=c?JSON.parse(c).jobs.find(u=>u.name===a):null;if(l){const u=l.tasks,p={name:l.name,groupName:o,tasks:[]};u.forEach(I=>{const M=localStorage.getItem(`taskCollection_${I.collectionName}`);if(M){const Y=JSON.parse(M).tasks.find(W=>W.id===I.id);Y&&p.tasks.push({id:Y.id,collectionName:I.collectionName})}});const k=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),b=URL.createObjectURL(k),C=document.createElement("a");C.href=b,C.download=`${p.name}.json`,C.click(),URL.revokeObjectURL(b),Nt.style.display="none"}}});const _=class _{static createThreadSpec(e,t,s,i){return{name:e,nominalDiameter:t,pitch:s,isCoarse:i,getInternalMajorDiameter(){return Number((this.nominalDiameter-1.082532*this.pitch).toFixed(3))},getExternalMajorDiameter(){return this.nominalDiameter},getThreadDepth(r){return Number(r==="External"?(this.pitch*.61343).toFixed(3):(this.pitch*.54127).toFixed(3))},getMajorDiameter(r){return r==="External"?this.getExternalMajorDiameter():this.getInternalMajorDiameter()}}}static generateThreadingGcode(e,t,s,i){const r=e.getThreadDepth(t),g=e.getMajorDiameter(t);let h,y;return t==="External"?(h=g/2,y=h-r,y=Math.round(y*1e3)/1e3):(h=g/2-r,h=Math.round(h*1e3)/1e3,y=g/2),`G33 Z${s==="Right"?i:-i} X${-y} P${e.pitch} R${-h}`}static getThreadSpecByName(e){for(const t of this.threadTypes){const s=t.threads.find(i=>i.name===e);if(s)return s}}static getThreadGroups(){return this.threadTypes.map(e=>e.name)}static getThreadsForGroup(e){const t=this.threadTypes.find(s=>s.name===e);return t?t.threads:[]}};x(_,"threadTypes",[{name:"Metric",threads:[_.createThreadSpec("M3 x 0.35 (Fine)",3,.35,!1),_.createThreadSpec("M3 x 0.5 (Coarse)",3,.5,!0),_.createThreadSpec("M4 x 0.5 (Fine)",4,.5,!1),_.createThreadSpec("M4 x 0.7 (Coarse)",4,.7,!0),_.createThreadSpec("M5 x 0.5 (Fine)",5,.5,!1),_.createThreadSpec("M5 x 0.8 (Coarse)",5,.8,!0),_.createThreadSpec("M6 x 0.75 (Fine)",6,.75,!1),_.createThreadSpec("M6 x 1.0 (Coarse)",6,1,!0),_.createThreadSpec("M8 x 1.0 (Fine)",8,1,!1),_.createThreadSpec("M8 x 1.25 (Coarse)",8,1.25,!0),_.createThreadSpec("M10 x 1.0 (Fine)",10,1,!1),_.createThreadSpec("M10 x 1.5 (Coarse)",10,1.5,!0),_.createThreadSpec("M11 x 1.0 (Fine)",11,1,!1),_.createThreadSpec("M11 x 1.5 (Coarse)",11,1.5,!0),_.createThreadSpec("M12 x 1.25 (Fine)",12,1.25,!1),_.createThreadSpec("M12 x 1.75 (Coarse)",12,1.75,!0)]}]);let at=_,N,vt="H4V12FJ";const $t={quickTaskFacing:{openButton:document.getElementById("quickTaskFacingButton"),modal:document.getElementById("quickTaskFacingModal"),closeButton:document.getElementById("quickTaskFacingCloseButton"),executeButton:document.getElementById("quickTaskFacingExecuteButton"),stopButton:document.getElementById("quickTaskFacingStopButton"),progressBar:document.getElementById("quickTaskFacingProgressBar"),taskFunction:zo},quickTaskGrooving:{openButton:document.getElementById("quickTaskGroovingButton"),modal:document.getElementById("quickTaskGroovingModal"),closeButton:document.getElementById("quickTaskGroovingCloseButton"),executeButton:document.getElementById("quickTaskGroovingExecuteButton"),stopButton:document.getElementById("quickTaskGroovingStopButton"),progressBar:document.getElementById("quickTaskGroovingProgressBar"),taskFunction:Vo},quickTaskProfiling:{openButton:document.getElementById("quickTaskProfilingButton"),modal:document.getElementById("quickTaskProfilingModal"),closeButton:document.getElementById("quickTaskProfilingCloseButton"),executeButton:document.getElementById("quickTaskProfilingExecuteButton"),stopButton:document.getElementById("quickTaskProfilingStopButton"),progressBar:document.getElementById("quickTaskProfilingProgressBar"),taskFunction:jo},quickTaskCone:{openButton:document.getElementById("quickTaskConeButton"),modal:document.getElementById("quickTaskConeModal"),closeButton:document.getElementById("quickTaskConeCloseButton"),executeButton:document.getElementById("quickTaskConeExecuteButton"),stopButton:document.getElementById("quickTaskConeStopButton"),progressBar:document.getElementById("quickTaskConeProgressBar"),taskFunction:Ho},quickTaskBoring:{openButton:document.getElementById("quickTaskBoringButton"),modal:document.getElementById("quickTaskBoringModal"),closeButton:document.getElementById("quickTaskBoringCloseButton"),executeButton:document.getElementById("quickTaskBoringExecuteButton"),stopButton:document.getElementById("quickTaskBoringStopButton"),progressBar:document.getElementById("quickTaskBoringProgressBar"),taskFunction:Uo},quickTaskThreading:{openButton:document.getElementById("quickTaskThreadingButton"),modal:document.getElementById("quickTaskThreadingModal"),closeButton:document.getElementById("quickTaskThreadingCloseButton"),executeButton:document.getElementById("quickTaskThreadingExecuteButton"),stopButton:document.getElementById("quickTaskThreadingStopButton"),progressBar:document.getElementById("quickTaskThreadingProgressBar"),taskFunction:Ko},quickTaskToolOffsets:{openButton:document.getElementById("quickTaskToolOffsetsButton"),modal:document.getElementById("quickTaskToolOffsetsModal"),closeButton:document.getElementById("quickTaskToolOffsetsCloseButton"),executeButton:document.getElementById("quickTaskToolOffsetsExecuteButton"),stopButton:document.getElementById("quickTaskToolOffsetsStopButton"),progressBar:document.getElementById("quickTaskToolOffsetsProgressBar"),taskFunction:Yo}},on=document.getElementById("quickTaskThreadingType"),nt=document.getElementById("quickTaskThreadingSize"),Ao=document.getElementById("quickTaskThreadingDirection"),Ro=document.getElementById("quickTaskThreadingExternalOrInternal"),Zo=document.getElementById("quickTaskThreadingLength");document.addEventListener("DOMContentLoaded",()=>{let n;N=ot.getInstance(),N.addStatusChangeListener(()=>L(),K.QUICKTASKS);const e=document.getElementById("connectButton");Object.keys($t).forEach(T=>{const f=$t[T];$t[T].openButton.addEventListener("click",()=>{N!=null&&N.isConnected()?(n=f,f.modal.style.display="block"):alert("Please connect to the machine first")}),f.executeButton.addEventListener("click",()=>{f.taskFunction()}),f.stopButton.addEventListener("click",()=>{N==null||N.stop()}),f.closeButton.addEventListener("click",()=>{f.modal.style.display="none"})});const t=localStorage.getItem("probeDiameter");t&&(document.getElementById("toolOffsetsProbeDiameter").value=t);const s=document.getElementById("quickTaskFacingMovementType");s.addEventListener("change",()=>{s.value==="Absolute"?document.getElementById("quickTaskFacingDepthContainer").style.display="none":document.getElementById("quickTaskFacingDepthContainer").style.display="block"});const i=document.getElementById("quickTaskProfilingType");i.addEventListener("change",()=>{i.value==="Absolute"?(document.getElementById("quickTaskProfilingDepthContainer").style.display="none",document.getElementById("quickTaskProfilingFinalDiameterContainer").style.display="block"):(document.getElementById("quickTaskProfilingDepthContainer").style.display="block",document.getElementById("quickTaskProfilingFinalDiameterContainer").style.display="none")});const r=document.getElementById("quickTaskProfilingFinalDiameter"),g=document.getElementById("quickTaskProfilingDepth");r&&r.addEventListener("input",()=>h("Absolute")),g&&g.addEventListener("input",()=>h("Relative"));async function h(T){const f=await(N==null?void 0:N.getPosition(K.QUICKTASKS)),v=f==null?void 0:f.x,$=document.getElementById("quickTaskProfilingDepthPerPass"),R=document.getElementById("quickTaskProfilingFinishingDepth"),ee=document.getElementById("quickTaskProfilingPasses");let o;if(T==="Absolute"){const b=document.getElementById("quickTaskProfilingFinalDiameter");o=Math.abs(v- -parseFloat(b.value)/2)}else{const b=document.getElementById("quickTaskProfilingDepth");o=Math.abs(v- -parseFloat(b.value))}const a=parseFloat($.value),c=parseFloat(R.value);if(a<=0||c<=0){console.error("Invalid pass depths");return}const l=o-c,u=Math.floor(l/a);if(u<=0){console.error("Depth too small for main passes");return}const p=(l/u).toFixed(3);$.value=p;const k=u+1;ee.value=k.toString()}const y=()=>{const T=on.value,f=at.getThreadsForGroup(T);nt.innerHTML='<option value="">Select Thread Size</option>',f.length>0?(f.sort((v,$)=>v.nominalDiameter!==$.nominalDiameter?v.nominalDiameter-$.nominalDiameter:v.pitch-$.pitch).forEach(v=>{const $=document.createElement("option");$.value=v.name,$.textContent=v.name,nt.appendChild($)}),nt.disabled=!1):nt.disabled=!0};on.addEventListener("change",y),y();function L(){if(!N)return;const T=N.getStatus();if(T.isConnected===!1){e.innerText="Connect",e.disabled=!1,e.style.backgroundColor="";return}else e.innerText="Connected",e.disabled=!0,e.style.backgroundColor="green";const f=T.condition==="run";if(!f)n.executeButton.style.display="flex",n.stopButton.style.display="none",n.progressBar.value=0,n.progressBar.parentElement.style.display="none";else if(f){n.executeButton.style.display="none",n.stopButton.style.display="inline-block",n.progressBar.parentElement.style.display="block";const v=T.progress;n.progressBar.value=v}}});function jo(){const n=parseFloat(document.getElementById("quickTaskProfilingLength").value),e=parseInt(document.getElementById("quickTaskProfilingPasses").value,10),t=parseFloat(document.getElementById("quickTaskProfilingFeedRate").value),s=200,i=document.getElementById("quickTaskProfilingDepth"),r=document.getElementById("quickTaskProfilingFinalDiameter"),g=document.getElementById("quickTaskProfilingType").value,h=N==null?void 0:N.getStatus().x,y=N==null?void 0:N.getStatus().z,L=[];if(g==="Absolute"){L.push("G91");const T=parseFloat(r.value)/2,f=(h-T)/e;for(let v=0;v<e;v++)L.push(`G1 X${f} F${t}`),L.push(`G1 Z${n} F${t}`),L.push(`G1 X-${f} F${s}`),L.push(`G1 Z-${n} F${s}`),L.push(`G1 X${f} F${s}`)}else{L.push("G91");const T=h-parseFloat(i.value)/e;for(let f=0;f<e;f++)L.push(`G1 X${T} F${t}`),L.push(`G1 Z${n} F${t}`),L.push(`G1 X-${T} F${s}`),L.push(`G1 Z-${n} F${s}`),L.push(`G1 X${T} F${s}`)}L.push("G90"),L.push(`G0 Z${y} X${h} F${s}`),N==null||N.sendCommands(L,K.QUICKTASKS)}function zo(){const n=document.getElementById("quickTaskFacingFeedRate"),e=document.getElementById("quickTaskFacingMovementType");let t=[];const s=N==null?void 0:N.getStatus().x;if(e.value==="Absolute")t.push("G90"),t.push(`G1 X0 F${n.value}`),t.push(`G1 X${s} F${n.value}`),t.push("G91");else{const i=document.getElementById("quickTaskFacingDepth");t.push("G91"),t.push(`G1 X${i.value} F${n.value}`),t.push(`G1 X-${i.value} F${n.value}`),t.push("G90")}N==null||N.sendCommands(t,K.QUICKTASKS)}function Vo(){alert("Not Yet Implemented")}function Ho(){alert("Not Yet Implemented")}function Uo(){alert("Not Yet Implemented")}function Ko(){const n=N==null?void 0:N.getStatus();if(!n||!n.isConnected){alert("Please connect to the machine first");return}else if(n.version!==vt){alert(`Threading is only supported on ${vt} controllers. Please see the help page for more information.`);return}else{const e=nt.value;if(e===""){alert("Please select a thread size");return}const t=Ao.value,s=Ro.value,i=parseFloat(Zo.value),r=at.getThreadSpecByName(e),g=at.generateThreadingGcode(r,s,t,i),h=[];h.push("G90"),h.push(g),N==null||N.sendCommands(h,K.QUICKTASKS)}}function Yo(){const n=N==null?void 0:N.getStatus();if(!n||!n.isConnected){alert("Please connect to the machine first");return}else if(n.version!==vt){alert(`Tool offsets is only supported on ${vt} controllers. Please see the help page for more information.`);return}let t=document.getElementById("toolOffsetsToolNumber").value;if(t===""){alert("Please enter a tool number");return}if(t[0]==="T"&&(t=t.substring(1)),parseInt(t,10)===0){alert("T0 is the primary tool and cannot be modified");return}const s=document.getElementById("toolOffsetsToolType"),i=document.getElementById("toolOffsetsXValue"),r=document.getElementById("toolOffsetsZValue"),g=document.getElementById("toolOffsetsProbeDiameter");let h="XZ";if(i.value===""&&(h=h.replace("X","")),r.value===""&&(h=h.replace("Z","")),h===""){alert("Please enter X and/or Z values");return}localStorage.setItem("probeDiameter",g.value);let y=[];const L=parseFloat(g.value)/2;if(s.value.startsWith("External")){const T={x:parseFloat(i.value),z:parseFloat(r.value),radius:L,toolType:"External"},f=Xt(T);h==="X"?y.push(`G10 P${t} X${f.x}`):h==="Z"?y.push(`G10 P${t} Z${f.z}`):y.push(`G10 P${t} X${f.x} Z${f.z}`)}else if(s.value.startsWith("Internal")){const T={x:parseFloat(i.value),z:parseFloat(r.value),radius:L,toolType:"Internal"},f=Xt(T);h==="X"?y.push(`G10 P${t} X${f.x}`):h==="Z"?y.push(`G10 P${t} Z${f.z}`):y.push(`G10 P${t} X${f.x} Z${f.z}`)}else{const T={x:parseFloat(i.value),z:parseFloat(r.value),radius:L,toolType:"Drill"},f=Xt(T);h==="X"?y.push(`G10 P${t} X${f.x}`):h==="Z"?y.push(`G10 P${t} Z${f.z}`):y.push(`G10 P${t} X${f.x} Z${f.z}`)}N==null||N.sendCommands(y,K.QUICKTASKS)}function Xt(n){let e;switch(n.toolType){case"Drill":e=-n.x;break;case"Internal":e=-(n.x-n.radius);break;case"External":e=-(n.x- -n.radius);break}const t=-n.z,s=i=>Math.round(i*1e3)/1e3;return{x:s(e),z:s(t)}}const A=ace.edit("gcodeEditor"),Ee=ace.edit("gcodeResponseEditor"),Z=ace.edit("gcodeSenderEditor");let Fe={z:0,x:0};const Wo="#DC143C",Qo="#6B8E23",es="#FFA500",ts="#242424";document.addEventListener("DOMContentLoaded",()=>{new bn;const n=document.getElementById("gcodeCanvas"),e=document.getElementById("zoomCanvas");let t=null;const s=document.getElementById("fileInput"),i=document.getElementById("simulateButton"),r=document.getElementById("showCuts"),g=document.getElementById("showNonCuts"),h=document.getElementById("showCutsZoom"),y=document.getElementById("showNonCutsZoom"),L=document.getElementById("sliderLabel"),T=document.getElementById("zoomSliderLabel"),f=document.getElementById("progressSlider"),v=document.getElementById("zoomProgressSlider"),$=document.getElementById("sliderContainer"),R=document.getElementById("displayOptionsContainer"),ee=document.getElementById("clearButton"),o=document.querySelector(".saveGCodeNameInput"),a=document.querySelector(".loadGCodeSelect"),c=document.querySelector(".loadGCodeButton"),l=document.querySelector(".saveGCodeButton"),u=document.querySelector(".deleteGCodeButton"),p=document.getElementById("gcodeSenderContainer"),k=document.getElementById("exampleCode"),b=document.getElementById("helpModal"),C=document.getElementById("helpButton"),I=document.getElementById("closeHelpModal"),M=document.getElementById("zoomModal"),G=document.getElementById("zoomButton"),Y=document.getElementById("closeZoomModal"),W=document.getElementById("zoomCloseButton"),it=document.getElementById("simulationTab"),Oe=document.getElementById("controlTab"),rt=document.getElementById("quickTasksTab"),je=document.getElementById("plannerTab"),lt=document.getElementById("helpTab"),Be=document.getElementById("connectionContainer"),Ce=document.getElementById("simulationContainer"),ce=document.getElementById("controlsContainer"),ue=document.getElementById("quickTasksContainer"),de=document.getElementById("plannerContainer"),me=document.getElementById("helpContainer"),ct=document.querySelectorAll("#latheControls .increment-btn"),yt=document.getElementById("moveDistance");localStorage.getItem("helpModalShown")||(b.style.display="block",localStorage.setItem("helpModalShown","true")),ct.forEach(function(m){m.addEventListener("click",function(){ct.forEach(function(w){w.classList.remove("active")}),this.classList.add("active");var B=this.dataset.increment;yt.value=B,console.log("Jog increment set to:",B)})}),it.addEventListener("click",()=>{Ce.style.display="flex",ce.style.display="none",ue.style.display="none",de.style.display="none",Be.style.display="none",me.style.display="none"}),Oe.addEventListener("click",()=>{Ce.style.display="none",ce.style.display="flex",ue.style.display="none",de.style.display="none",Be.style.display="block",me.style.display="none"}),rt.addEventListener("click",()=>{Ce.style.display="none",ce.style.display="none",ue.style.display="flex",de.style.display="none",Be.style.display="block",me.style.display="none"}),je.addEventListener("click",()=>{Ce.style.display="none",ce.style.display="none",ue.style.display="none",de.style.display="flex",Be.style.display="block",me.style.display="none";const m=new Event("containerVisible");de.dispatchEvent(m)}),lt.addEventListener("click",()=>{Ce.style.display="none",ce.style.display="none",ue.style.display="none",de.style.display="none",Be.style.display="none",me.style.display="flex"}),e.width=window.visualViewport.width-100,e.height=window.visualViewport.height-150,window.addEventListener("resize",function(){e.width=window.visualViewport.width-100,e.height=window.visualViewport.height-150,v.value=v.min,X(e)}),G.onclick=function(){M.style.display="block",X(e)},Y.onclick=function(){M.style.display="none"},W.onclick=function(){M.style.display="none"},C.onclick=function(){b.style.display="block"},I.onclick=function(){b.style.display="none"},window.onclick=function(m){m.target==b&&(b.style.display="none"),m.target==M&&(M.style.display="none")},l.addEventListener("click",()=>Te()),c.addEventListener("click",()=>J()),u.addEventListener("click",()=>se()),q(),A.setTheme("ace/theme/github_dark"),A.session.setMode("ace/mode/plain_text"),A.setShowPrintMargin(!1),Z.setTheme("ace/theme/github_dark"),Z.session.setMode("ace/mode/plain_text"),Z.setShowPrintMargin(!1),k.addEventListener("click",()=>pn()),Ee.setTheme("ace/theme/monokai"),Ee.session.setMode("ace/mode/text"),Ee.setReadOnly(!0),Ee.setShowPrintMargin(!1),Ee.getSession().on("change",()=>{setTimeout(()=>{var m=Ee.getSession().getLength();Ee.scrollToLine(m,!0,!0,function(){})},0)}),Z.on("focus",()=>{Z.getValue()==="Paste your gcode here or click choose file to upload"&&Z.setValue("")}),j();let Pe=0,Me=0,fe=0,pe=0,ze=0,d=0,E=5,S=0,O=0,P=[];f.oninput=()=>{const m=Math.floor(parseInt(f.value));if(m<P.length){const B=P[m];let w=Ve(P,n);He(n,P,w,m),ge(B)}},v.oninput=()=>{const m=Math.floor(parseInt(v.value));if(m<P.length){const B=P[m];let w=Ve(P,e);He(e,P,w,m),ae(B)}},ee.addEventListener("click",()=>{Z.setValue(""),A.setValue(""),j();const m=n.getContext("2d");m&&(m.clearRect(0,0,n.width,n.height),s.value="",f.value="0",v.value="0",$.style.display="none",R.style.display="none")}),s.addEventListener("change",m=>{if(m.target instanceof HTMLInputElement&&m.target.files&&m.target.files.length>0){const B=m.target.files[0];B&&kt(B)}}),i.addEventListener("click",()=>{X(n)});function X(m){if(!m)return;const B=A.getValue();if(B){bt(B);let w=Ve(P,m);He(m,P,w),$.style.display="block",R.style.display="block",r.addEventListener("change",ut),g.addEventListener("change",ut),h.addEventListener("change",Gt),y.addEventListener("change",Gt),f.max=(P.length-1).toString(),f.value=f.min,v.max=(P.length-1).toString(),v.value=v.min,p.style.display="block"}}function Te(){const m=o.value.trim();if(!m)return;const B=`gCode-${m}`;localStorage.setItem(B,A.getValue()),q(B),o.value=""}function J(){const m=a.value,B=localStorage.getItem(m);B&&(A.setValue(B),Z.setValue(B))}function se(){const m=a.value;localStorage.removeItem(m),q()}function q(m){a.innerHTML="";let B=!1;for(let w=0;w<localStorage.length;w++){const D=localStorage.key(w);if(D&&D!=="latheCode"&&D.startsWith("gCode-")){B=!0;const F=document.createElement("option"),z=D.replace("gCode-","");F.value=D,F.textContent=z,a.appendChild(F),D===m&&(F.selected=!0)}}if(B){const w=Array.from(a.options).sort((D,F)=>D.text.localeCompare(F.text));a.innerHTML="",w.forEach(D=>{a.appendChild(D)})}else{const w=document.createElement("option");w.textContent="No items saved",w.disabled=!0,a.appendChild(w)}}function j(){const m=A.getValue(),B=Z.getValue();m===""&&(A.setValue("Paste your gcode here or click choose file to upload"),A.gotoLine(1,0),A.on("focus",function(){A.getValue()==="Paste your gcode here or click choose file to upload"&&A.setValue("")})),B===""&&(Z.setValue("Paste your gcode here or click choose file to upload"),Z.gotoLine(1,0),Z.on("focus",function(){Z.getValue()==="Paste your gcode here or click choose file to upload"&&Z.setValue("")}))}function ge(m){var B,w,D;(m==null?void 0:m.lineNumber)!==void 0?(A.gotoLine(m.lineNumber,0,!0),L.innerHTML=`Line:${m.lineNumber}<br>${m==null?void 0:m.originalLine}<br>Abs: X${((B=m.absolutePosition)==null?void 0:B.x)??0} &lpar;Dia: ${(((w=m.absolutePosition)==null?void 0:w.x)??0)*2}&rpar; Z${(D=m.absolutePosition)==null?void 0:D.z}`||""):L.innerHTML=""}function ae(m){var B,w,D;(m==null?void 0:m.lineNumber)!==void 0?(A.gotoLine(m.lineNumber,0,!0),T.innerHTML=`Line:${m.lineNumber}<br>${m==null?void 0:m.originalLine}<br>Abs: X${(B=m.absolutePosition)==null?void 0:B.x} &lpar;Dia: ${(((w=m.absolutePosition)==null?void 0:w.x)??0)*2}&rpar; Z${(D=m.absolutePosition)==null?void 0:D.z}`||""):T.innerHTML=""}function kt(m){const B=new FileReader;B.onload=w=>{const D=w.target.result;A.setValue(D),Z.setValue(D)},B.readAsText(m)}function bt(m){const B=[];let w=!1;return P=[],m.split(`
`).forEach((F,z)=>{const he=F.includes("; cut")?0:F.includes("; retract")?2:1,te={isRelative:w,movementType:he},De=F.match(/([GXYZF])([0-9.-]+)/g);De==null||De.forEach(dt=>{const ie=parseFloat(dt.slice(1));switch(dt[0]){case"G":ie===90&&(te.isRelative=!1,w=!1),ie===91&&(te.isRelative=!0,w=!0);break;case"X":te.x=parseFloat(ie.toFixed(3)),w?Fe.x=parseFloat((Fe.x+ie).toFixed(3)):Fe.x=parseFloat(ie.toFixed(3));break;case"Z":te.z=parseFloat(ie.toFixed(3)),w?Fe.z=parseFloat((Fe.z+ie).toFixed(3)):Fe.z=parseFloat(ie.toFixed(3));break}});const _e={...te,lineNumber:z+1,originalLine:F,absolutePosition:{...Fe}};(te.z!==void 0||te.x!==void 0)&&P.push(_e),B.push(_e)}),B}function ut(){h.checked=r.checked,y.checked=g.checked,f.value="0";const m=Ve(P,n);He(n,P,m,P.length)}function Gt(){r.checked=h.checked,g.checked=y.checked,v.value="0";const m=Ve(P,e);He(e,P,m,P.length)}function Ve(m,B){let w=0,D=0,F=m.find(ne=>!ne.isRelative),z=F&&F.x?F.x:0,he=F&&F.z?F.z:0;const te=5;m.forEach(ne=>{ne.x!==void 0&&(ne.isRelative?(z+=ne.x,z<D&&(D=z)):ne.x<D&&(D=ne.x)),ne.z!==void 0&&(ne.isRelative?(he+=ne.z,he>w&&(w=he)):ne.z>w&&(w=ne.z))});const De=Math.abs(D),_e=Math.abs(w),dt=B.height/2-te,ie=B.width-te-E,gn=dt/De,hn=ie/_e;return Math.min(gn,hn)}function He(m,B,w,D){if(t=m.getContext("2d"),!t)return;t.clearRect(0,0,m.width,m.height),Pe=0,Me=0,ze=0,d=0,fe=0,pe=0,fe=m.height/2,pe=m.width-E;const F=D!==void 0?Math.min(D+1,B.length):B.length;for(let z=0;z<F;z++)fn(m,B[z],w,z===D)}function fn(m,B,w,D){if(t=m.getContext("2d"),!t)return;let F=r.checked||h.checked,z=g.checked||y.checked;t.lineWidth=2,B.isRelative?(Pe+=B.x??0,Me+=B.z??0):(Pe=B.x??ze,Me=B.z??d,ze=Pe,d=Me),S=m.height/2-Pe*w,O=m.width-Me*w-E;let he="";if((B.movementType==0&&F||B.movementType==1&&z||B.movementType==2&&z)&&(t.beginPath(),he=B.movementType==0?Wo:B.movementType==1?Qo:es,t.moveTo(pe,fe),t.lineTo(O,S),D?(t.strokeStyle=he,t.setLineDash([5,5]),t.lineDashOffset=0,t.stroke(),t.strokeStyle=ts,t.setLineDash([5,5]),t.lineDashOffset=-5,t.stroke()):(t.strokeStyle=he,t.setLineDash([]),t.stroke()),D)){let te=O-pe,De=S-fe,_e=Math.atan2(De,te);t.save(),t.translate(pe,fe),t.rotate(_e+Math.PI/2),t.beginPath(),t.moveTo(0,-5),t.lineTo(-5,5),t.lineTo(5,5),t.closePath(),t.fillStyle="green",t.fill(),t.restore(),t.beginPath(),t.rect(O-3,S-3,6,6),t.fillStyle="red",t.fill()}fe=S,pe=O}function pn(){A.setValue(En)}});

</script>
  <style>
:root{font-family:Inter,system-ui,Avenir,Helvetica,Arial,sans-serif;line-height:1.5;font-weight:400;color-scheme:light dark;color:#ffffffde;background-color:#202124;font-synthesis:none;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}a{font-weight:500;color:#646cff;text-decoration:inherit}a:hover{color:#535bf2}h1{font-size:3.2em;line-height:1.1}#app{max-width:1280px;margin:0 auto;padding:2rem;text-align:center}.logo{height:6em;padding:1.5em;will-change:filter;transition:filter .3s}.logo:hover{filter:drop-shadow(0 0 2em #646cffaa)}.logo.vanilla:hover{filter:drop-shadow(0 0 2em #3178c6aa)}.card{padding:2em}.read-the-docs{color:#888}button{border-radius:3px;padding:.6em 1.2em;font-size:1em;font-weight:500;font-family:inherit;background-color:#1a1a1a;cursor:pointer;transition:background-color .25s;border:2px solid white;color:#fff}button:hover{background-color:#646cff}button:focus,button:focus-visible{outline:4px auto -webkit-focus-ring-color}input[readonly]{cursor:not-allowed;background-color:#2f4f4f;border-color:#767676}.disabled-button{background-color:red;cursor:not-allowed}.interaction-ready-button{background-color:green}.icon-container{width:60px;height:50px;padding:5px 10px}.icon-container svg{width:100%;height:100%}#simulationContainer{display:flex;flex-direction:column;width:800px;max-width:1280px;text-align:center}.main-container{display:flex;width:100%}#interactiveComponentsContainer,#controlsContainer,#quickTasksContainer{display:flex;flex-direction:column;width:800px;max-width:1280px;text-align:center}button.quick-tasks-innercontainer{display:flex;align-items:center;cursor:pointer;background:none;border:none;padding:0;margin:5px 0;border:1px solid #ccc;border-radius:5px;background-color:#333;flex-direction:column;justify-content:center;width:100%;box-sizing:border-box}button.quick-tasks-innercontainer:hover{background-color:#6c5ce7}button.execute{padding:0 10px;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;margin:0 auto}input.quick-task-summary{width:auto;box-sizing:border-box}.tooltip-icon{display:inline-flex;margin-left:5px;cursor:help;color:#fff;font-weight:700;font-size:16px;position:relative;width:18px;height:18px;border:2px solid #ffffff;border-radius:50%;align-items:center;justify-content:center;text-align:center;vertical-align:middle}.tooltip-icon:hover:after{content:attr(data-tooltip);position:absolute;background-color:#333;color:#fff;padding:5px;border-radius:5px;white-space:nowrap;z-index:10;top:100%;left:50%;transform:translate(-50%)}.quick-tasks-subinnercontainer{display:flex;flex-direction:row}.controls-container,.connection-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;border:1px solid #ccc}.canvas-container{display:flex;flex-direction:column;align-items:center;margin:5px;border:1px solid #ccc}.canvas-wrapper{display:flex;flex-direction:column;align-items:center}.innerContainer{margin:5px;align-items:center;width:auto}.modal-pad{padding-top:10px}.modal-pad-bottom{padding-bottom:10px}.emulation-modal-pad-border{padding:10px;border:2px dashed green;min-height:40px}.innerContainer.toolbar{display:flex;align-items:center;gap:5px;padding:2px}.saveGCodeNameInput,.loadGCodeSelect{flex-grow:1}#gcodeCanvas{border-bottom:1px solid #ccc;background-color:#242424}#gcodeInput{position:relative;background:transparent;width:100%;height:240px;font-family:monospace;font-size:13px;line-height:1.5;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}#gcodeContainer{position:relative;width:100%}#gcodeSenderContainer{display:block}.save-group,.load-group,.import-export-group{display:flex;flex-direction:row;align-items:center;gap:10px}.toolbar input[type=text],.toolbar select{max-width:200px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem;font-size:1rem;line-height:1.5}input[type=file]::file-selector-button{border:2px solid #6c5ce7;padding:.2em .4em;border-radius:.2em;background-color:#1a1a1a;transition:.25s}input[type=file]::-ms-browse:hover{background-color:#646cff}input[type=file]::-webkit-file-upload-button:hover{background-color:#646cff}input[type=file]::file-selector-button:hover{background-color:#646cff}.bottom-container{margin:5px}#gcodeResponseContainer{border:1px solid #ccc;width:100%;display:flex;flex-direction:column;align-items:center;margin-top:5px}.senderError{display:none;color:#fff;background-color:red;padding:10px;border-radius:5px;animation:flashError 1s infinite}@keyframes flashError{0%,to{opacity:1}50%{opacity:0}}#helpText li{margin-bottom:10px}#helpText a{color:#f95959}.help-modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.help-modal-content{position:relative;background-color:#242424;margin:15% auto;padding:20px;border:2px solid #6c5ce7;width:30%}.zoom-modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#242424}.zoom-modal-content{display:flex;flex-direction:column;align-items:center;margin:10px auto;padding:20px;border:1px solid #888}.close-modal{position:absolute;top:0;right:0;padding-right:10px;cursor:pointer;font-size:35px}#sliderAndButtonContainer{display:flex;justify-content:center;align-items:center;gap:10px;flex-direction:column}.text-red{color:#dc143c}.text-green{color:#6b8e23}.text-orange{color:orange}.line{display:inline-block;vertical-align:middle;width:20px;height:2px;margin-right:5px}.red-line{border-top:2px solid #DC143C}.green-line{border-top:2px solid #6B8E23}.orange-line{border-top:2px solid #FFA500}#latheControls #jogControls{display:grid;grid-template-columns:repeat(10,60px);grid-template-rows:repeat(6,60px);justify-content:center;align-items:center;place-items:center}#latheControls .jog-btn,#latheControls .tool-btn{width:50px;height:50px;border-radius:5px;cursor:pointer;background-color:#f0ad4e;display:flex;justify-content:center;align-items:center;text-align:center;line-height:50px;font-size:24px;padding:0}#latheControls .tool{background-color:#f0ad4e;border:none}#latheControls .tool-selected{background-color:#6c5ce7;border:2px solid white}#latheControls .fast{background-color:#f0ad4e}#latheControls .slow{background-color:#5bc0de}#latheControls .jog-btn:hover{background-color:#6c5ce7}#jogText{grid-column:6;grid-row:1}#fastForward{grid-column:6;grid-row:2}#fastText{grid-column:5;grid-row:2}#slowText{grid-column:5;grid-row:3}#fastLeft{grid-column:4;grid-row:4}#fastBackward{grid-column:6;grid-row:6}#fastRight{grid-column:8;grid-row:4}#slowForward{grid-column:6;grid-row:3}#slowLeft{grid-column:5;grid-row:4}#slowBackward{grid-column:6;grid-row:5}#slowRight{grid-column:7;grid-row:4}#toolText{grid-column:1;grid-row:1}#tool0{grid-column:1;grid-row:2}#tool1{grid-column:1;grid-row:3}#tool2{grid-column:1;grid-row:4}#tool3{grid-column:1;grid-row:5}#tool4{grid-column:1;grid-row:6}#tool5{grid-column:2;grid-row:2}#tool6{grid-column:2;grid-row:3}#tool7{grid-column:2;grid-row:4}#tool8{grid-column:2;grid-row:5}#tool9{grid-column:2;grid-row:6}.menu ul{list-style-type:none;padding:0}.menu li{cursor:pointer;padding:10px;background-color:#242424;border-bottom:1px solid #6c5ce7}.menu li:hover{background-color:#6c5ce7}.content{margin-left:200px;padding:20px}#senderProgressContainer{display:flex;justify-content:center;align-items:center}#senderProgressLabel{margin-right:10px}.innerContentCentre{display:flex;justify-content:center;align-items:center;margin:10px}#gcodeSenderContainer{position:relative;width:100%}#latheControls #incrementControls{display:flex;justify-content:center;gap:10px;margin:20px 0}#latheControls .increment-btn{padding:5px 10px;border:1px solid #ccc;background-color:#f0ad4e;border-radius:5px;cursor:pointer;transition:background-color .3s}#latheControls .increment-btn:hover,#latheControls .increment-btn.active{background-color:#6c5ce7}.control-inputs input[type=text]{max-width:200px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem}.control-inputs label{display:block;margin-right:5px}.sender-inputs input[type=text]{max-width:350px;min-width:350px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem}#latheControls label{white-space:nowrap;margin-right:10px;display:inline-block;min-width:120px}#plannerContainer{display:flex;flex-direction:column;width:800px;max-width:1280px;text-align:center}.planner-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;border:1px solid #ccc}.planner-container h1{margin:10px 0}.planner-guidance{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:10px;text-align:center}.planner-guidance span{display:block;margin:10px 0;text-align:left}#taskContainer{display:flex;justify-content:space-between;align-items:start;padding:20px}.container-wrapper{padding:10px}.container-wrapper-inner{padding:5px 0}.container-wrapper-outer{border:1px solid #ccc;border-radius:5px;margin:10px;background-color:#333}.container-wrapper-delete{min-height:50px;display:flex;justify-content:center;align-items:center;border:2px dashed red}#availableTasks{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;align-items:start;min-width:450px}#availableTasks .span-2-rows{grid-row:span 3;height:100%}#availableTasks div{box-sizing:border-box;padding:5px}#tasksToExecute{min-height:50px;padding:5px;border:2px dashed green}#tasksToExecute div{margin:5px}.task-to-execute{text-align:left}.task-to-execute i{text-align:left;margin-left:5px;cursor:help}.available-task{width:150px;-webkit-user-select:none;user-select:none}.available-task i{margin-left:5px;cursor:help}.task-manual{background-color:#4c956c}.task-gcode{background-color:#386e97}.task-emulation{background-color:#e74c3c}.emulate-noselect{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#emulationInnerContainer{display:flex;flex-direction:row;justify-content:center;align-items:center;height:100%}#emulationNewTasksMovement{display:grid;grid-template-columns:repeat(9,40px);grid-template-rows:repeat(3,40px);gap:3px;align-items:center;justify-items:center}#emulationNewTasksNumbers,#emulationNewTasksOther{display:grid;grid-template-columns:repeat(2,40px);grid-template-rows:repeat(6,40px);gap:3px;align-items:center;justify-items:center}#emulationNewTasksMode{display:grid;grid-template-columns:repeat(8,40px);grid-template-rows:repeat(1,40px);gap:3px;align-items:center;justify-items:center}#movementContainer,#modeContainer{width:100%;display:flex;justify-content:center;align-items:center;margin:5px;padding:5px}#emulateKeyUp{grid-area:1 / 2}#emulateKeyDown{grid-area:3 / 2}#emulateKeyLeft{grid-area:2 / 1}#emulateKeyRight{grid-area:2 / 3}#emulateKeyPlay{grid-area:1 / 5}#emulateKeyStop{grid-area:3 / 5}#emulateKeyStopUp{grid-area:1 / 8}#emulateKeyStopDown{grid-area:3 / 8}#emulateKeyStopLeft{grid-area:2 / 7}#emulateKeyStopRight{grid-area:2 / 9}#emulationNewTasksMode button.material-symbols-outlined{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksMode button:hover{background-color:#18a79b}#emulationNewTasksMode button:focus,#emulationNewTasksMode button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksMovement button.material-symbols-outlined{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksMovement button:hover{background-color:#18a79b}#emulationNewTasksMovement button:focus,#emulationNewTasksMovement button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksNumbers button{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700;font-family:monospace}#emulationNewTasksNumbers button:hover{background-color:#18a79b}#emulationNewTasksNumbers button:focus,#emulationNewTasksNumbers button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksOther button{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksOther button:hover{background-color:#18a79b}#emulationNewTasksOther button:focus,#emulationNewTasksOther button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}.emulated-button-list{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700!important}.standard-font{font-family:monospace!important}#emulationNewTasks{list-style-type:none;display:grid;grid-template-columns:repeat(11,1fr);grid-auto-rows:auto;gap:10px;padding:0;margin:0}#emulateKeySteps{transform:scaleX(-1)}.flexCol{display:flex;flex-direction:column;align-items:center;justify-content:center}.outerCol{padding-top:15px}.middleCol{align-self:flex-start}.task-container{margin:5px}.task-container>div,.gu-mirror{transition:opacity .4s ease-in-out}.task-container>div{padding:5px;cursor:move;cursor:grab;cursor:-moz-grab;cursor:-webkit-grab;display:flex;align-items:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.gu-mirror{padding:5px;text-align:center;cursor:grabbing;cursor:-moz-grabbing;cursor:-webkit-grabbing}.task-container .ex-moved{background-color:#e74c3c}.task-container.ex-over{background-color:#ffffff4d}.planner-save-text{max-width:none!important}.planner-save-button{flex:auto}.planner-load-select{max-width:none!important}.planner-load-delete-buttons{width:50%}.planner-saving-label{text-wrap:nowrap}.no-marge{margin:0}.task-modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.task-modal-content{position:relative;background-color:#242424;margin:15% auto;padding:20px;border:2px solid #6c5ce7;max-width:600px;min-width:600px}.center-modal{text-align:center}.icon-tooltip{position:relative;cursor:pointer}.icon-tooltip:after{content:attr(data-tooltip);position:absolute;bottom:100%;left:50%;transform:translate(-50%);white-space:nowrap;z-index:1;background-color:#000;color:#fff;padding:5px;border-radius:4px;opacity:0;visibility:hidden;transition:opacity .2s,visibility .2s}.icon-tooltip:hover:after{opacity:1;visibility:visible}.threading-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;width:800px;max-width:1280px;text-align:center;border:1px solid #ccc}.gu-mirror{position:fixed!important;margin:0!important;z-index:9999!important;opacity:.8}.gu-hide{display:none!important}.gu-unselectable{-webkit-user-select:none!important;-moz-user-select:none!important;-ms-user-select:none!important;user-select:none!important}.gu-transit{opacity:.2}

</style>
</head>

<body>

    <div id="mainContainer" class="main-container">
        <div class="menu">
            <ul>
                <li id="simulationTab">Simulation</li>
                <li id="controlTab">Control</li>
                <li id="quickTasksTab">Quick Tasks</li>
                <li id="plannerTab">Planner</li>
                <li id="helpTab">Help</li>
            </ul>
        </div>

        <div id="simulationContainer" class="main-container">
            <div id="simulationContent" class="controls-container">
                <div id="gcodeContainer" style="position: relative;">
                    <div id="gcodeEditor" style="height: 200px; width: 100%;"></div>
                </div>
                <div class="innerContainer">
                    <input type="file" id="fileInput" accept=".txt,.gcode">
                </div>
                <div class="innerContainer">
                    <button id="simulateButton">Simulate</button>
                    <button id="clearButton">Clear</button>
                    <button id="helpButton">How to use</button>
                </div>


                <div class="innerContainer" id="loadAndSave">


                    <hr>
                    <div class="innerContainer toolbar">
                        <input type="text" class="saveGCodeNameInput" placeholder="name of save"></input>
                        <button class="saveGCodeButton" title="Save GCode to local browser storage">Save local</button>
                    </div>
                    <div class="innerContainer toolbar">
                        <select class="loadGCodeSelect"></select>
                        <button class="loadGCodeButton" title="Load GCode from local browser storage">Load</button>
                        <button class="deleteGCodeButton" title="Delete GCode from local browser storage">Delete</button>
                    </div>
                    <hr>
                </div>
            </div>

            <div class="canvas-container">
                <canvas id="gcodeCanvas" width="785" height="600"></canvas>
                <div id="sliderContainer" class="innerContainer" style="display: none; width: 400px;">
                    <input type="range" id="progressSlider" min="0" max="100" value="0" style="width: 100%;">
                    <div id="sliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                </div>
                <div id="displayOptionsContainer" class="innerContainer" style="display: none;">
                    <input type="checkbox" id="showCuts" checked> Show Cut Moves
                    </label>
                    <label>
                        <input type="checkbox" id="showNonCuts" checked>
                        Show Non-Cut Moves
                    </label>
                </div>
                <div id="sliderContainer" class="innerContainer" style="display: none; width: 400px;">
                    <input type="range" id="progressSlider" min="0" max="100" value="0" style="width: 100%;">
                    <div id="sliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                </div>
                <div class="innerContainer"><button id="zoomButton" title="Zoom in">Zoom In</button></div>
            </div>

        </div>

        <div id="interactiveComponentsContainer" class="main-container">
            <div id="connectionContainer" class="connection-container" style="display: none;">
                <div class="innerContainer">
                    <button id="connectButton" title="Connect to Nano ELS H4">Connect</button>
                </div>
            </div>
            <div id="controlsContainer" class="main-container" style="display: none;">
                <div id="controlsContent" class="controls-container">

                    <div id="latheControls">
                        <div id="jogControls">
                            <span id="fastText">Fast</span>
                            <span id="slowText">Slow</span>
                            <span id="toolText">Tool</span>

                            <!-- Tools -->
                            <button class="tool-btn tool-selected" id="tool0">T0</button>
                            <button class="tool-btn" id="tool1">T1</button>
                            <button class="tool-btn" id="tool2">T2</button>
                            <button class="tool-btn" id="tool3">T3</button>
                            <button class="tool-btn" id="tool4">T4</button>
                            <button class="tool-btn" id="tool5">T5</button>
                            <button class="tool-btn" id="tool6">T6</button>
                            <button class="tool-btn" id="tool7">T7</button>
                            <button class="tool-btn" id="tool8">T8</button>
                            <button class="tool-btn" id="tool9">T9</button>

                            <span id="jogText">Move</span>
                            <!-- Fast arrows -->
                            <button class="arrow fast jog-btn" id="fastForward"><i class="fas fa-arrow-up"></i></button>
                            <button class="arrow fast jog-btn" id="fastBackward"><i
                                    class="fas fa-arrow-down"></i></button>
                            <button class="arrow fast jog-btn" id="fastLeft"><i class="fas fa-arrow-left"></i></button>
                            <button class="arrow fast jog-btn" id="fastRight"><i
                                    class="fas fa-arrow-right"></i></button>
                            <!-- Slow arrows -->
                            <button class="arrow slow jog-btn" id="slowForward"><i class="fas fa-arrow-up"></i></button>
                            <button class="arrow slow jog-btn" id="slowBackward"><i
                                    class="fas fa-arrow-down"></i></button>
                            <button class="arrow slow jog-btn" id="slowLeft"><i class="fas fa-arrow-left"></i></button>
                            <button class="arrow slow jog-btn" id="slowRight"><i
                                    class="fas fa-arrow-right"></i></button>
                        </div>
                        <div id="incrementControls">
                            <button class="increment-btn" data-increment="0.01">0.01</button>
                            <button class="increment-btn" data-increment="0.1">0.1</button>
                            <button class="increment-btn active" data-increment="1">1</button>
                            <button class="increment-btn" data-increment="10">10</button>
                        </div>
                        <div id="feedrateControls" class="innerContentCentre control-inputs">
                            <label for="fastFeedrate">Fast Feedrate:</label>
                            <input type="text" id="fastFeedrate" name="fastFeedrate" value="200">
                            <label for="slowFeedrate">Slow Feedrate:</label>
                            <input type="text" id="slowFeedrate" name="slowFeedrate" value="50">
                        </div>
                        <div id="distanceControl" class="innerContentCentre control-inputs">
                            <label for="moveDistance">Move Distance (mm):</label>
                            <input type="text" id="moveDistance" name="moveDistance" value="1">
                        </div>
                    </div>

                    <div id="gcodeResponseContainer" style="display: none;">
                        <div id="gcodeResponseHeader">GCode Responses</div>
                        <div id="gcodeResponseEditor" style="height: 200px; width: 100%;"></div>
                        <div class="senderError" style="display: none;"></div>
                        <div id="senderProgressContainer">
                            <span id="senderProgressLabel" style="display: none;">Progress...</span>
                            <progress id="senderProgress" max="1" style="display: none;"></progress>
                        </div>
                    </div>
                </div>
                <div class="controls-container">
                    <div class="innerContainer control-inputs">
                        <div class="innerContentCentre control-inputs">
                            <span>Send single command</span>
                        </div>
                        <div class="innerContentCentre sender-inputs">
                            <input id="singleCommandSender" type="text" name="singleCommandSender"></input>
                        </div>
                        <div class="innerContentCentre control-inputs">
                            <button id="gcodeSendSingleCommandButton" title="Send GCode to CNC">Send</button>
                        </div>
                    </div>
                </div>
                <div class="controls-container">
                    <div id="gcodeSenderContainer" style="position: relative;">
                        <span>Send multi line commands</span>
                        <div id="gcodeSenderEditor" style="height: 200px; width: 100%;"></div>
                    </div>
                    <div class="innerContainer">
                        <button id="gcodeSenderButton" title="Send GCode to CNC">Send</button>
                        <button id="stopButton" style="display: none;">Stop</button>
                    </div>
                </div>
            </div>
            <div id="quickTasksContainer" class="main-container" style="display: none;">
                <div id="quickTasksContent" class="controls-container">
                    <div class="innerContainer">
                        <h1>Quick Tasks</h1>
                        <button id="quickTaskFacingButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- L-shape -->
                                        <path d="M5 45 L35 45 L35 5" fill="none" stroke="white" stroke-width="3" />

                                        <!-- Arrow stem -->
                                        <line x1="50" y1="45" x2="50" y2="10" stroke="white" stroke-width="3" />

                                        <!-- Arrow head -->
                                        <path d="M42 17 L50 5 L58 17 Z" fill="white" />
                                    </svg>
                                </div>
                                <p>Facing</p>
                            </div>

                        </button>
                        <button id="quickTaskGroovingButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 60">
                                        <!-- U-shape rotated correctly (facing up) -->
                                        <path d="M5 55 L5 5 L45 5 L45 55" fill="none" stroke="white" stroke-width="3" />

                                        <!-- Arrow stem -->
                                        <line x1="25" y1="45" x2="25" y2="15" stroke="white" stroke-width="3" />

                                        <!-- Arrow head (filled) -->
                                        <path d="M17 22 L25 10 L33 22 Z" fill="white" />
                                    </svg>
                                </div>
                                <p>Grooving</p>
                            </div>
                        </button>
                        <button id="quickTaskProfilingButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Rotated L-shape -->
                                        <path d="M55 5 L5 5 L5 35" fill="none" stroke="white" stroke-width="3" />

                                        <!-- Arrow stem -->
                                        <line x1="22" y1="30" x2="50" y2="30" stroke="white" stroke-width="3" />

                                        <!-- Arrow head (filled) -->
                                        <path d="M22 22 L10 30 L22 38 Z" fill="white" />
                                    </svg>
                                </div>
                                <p>Profiling</p>
                            </div>
                        </button>
                        <button id="quickTaskConeButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Sideways trapezoid -->
                                        <path
                                            d="M10 5 L50 15 L50 35 L10 45 Z"
                                            fill="none"
                                            stroke="white"
                                            stroke-width="3"
                                        />
                                    </svg>
                                </div>
                                <p>Cone</p>
                            </div>
                        </button>
                        <button id="quickTaskBoringButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Correctly rotated squared U-shape (90 clockwise) -->
                                        <path d="M55 5 L5 5 L5 45 L55 45" fill="none" stroke="white" stroke-width="3" />

                                        <!-- Arrow stem -->
                                        <line x1="22" y1="25" x2="42" y2="25" stroke="white" stroke-width="3" />

                                        <!-- Arrow head (filled) -->
                                        <path d="M22 17 L10 25 L22 33 Z" fill="white" />
                                    </svg>
                                </div>
                                <p>Boring</p>
                            </div>
                        </button>
                        <button id="quickTaskThreadingButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Background rectangle -->
                                        <!--<rect x="0" y="7.5" width="60" height="35" fill="#e0e0e0"></rect> -->

                                        <!-- Thread lines -->
                                        <line x1="6" y1="41.7" x2="18" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <line x1="15" y1="41.7" x2="27" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <line x1="24" y1="41.7" x2="36" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <line x1="33" y1="41.7" x2="45" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <line x1="42" y1="41.7" x2="54" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <!-- Corrected start of thread -->
                                        <line x1="-3" y1="41.7" x2="9" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                        <!-- Corrected end of thread -->
                                        <line x1="51" y1="41.7" x2="63" y2="8.3" stroke="white" stroke-width="5"
                                            stroke-linecap="round"></line>
                                    </svg>
                                </div>
                                <p>Threading</p>
                            </div>
                        </button>
                        <button id="quickTaskToolOffsetsButton" class="quick-tasks-innercontainer">
                            <div class="quick-tasks-subinnercontainer">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 50">
                                        <!-- Left arrow (pointing up) - thicker shaft -->
                                        <line x1="7.5" y1="45" x2="7.5" y2="10" stroke="white" stroke-width="3"/>
                                        <path d="M4 13 L7.5 7.5 L11 13 Z" fill="white"/>
                                        
                                        <!-- Bottom arrow (pointing right) - thicker shaft -->
                                        <line x1="6" y1="44" x2="50" y2="44" stroke="white" stroke-width="3"/>
                                        <path d="M48 40.5 L53.5 44 L48 47.5 Z" fill="white"/>
                                        
                                        <!-- Gear shifted up 1 unit -->
                                        <path d="M28 9 L31 9 L32.5 13 L35 14.5 L39 11.5 L40.5 14 L38 18 L39.5 20.5 L43.5 22 L43.5 25 L39.5 26.5 L38 29 L40.5 33 L39 35.5 L35 32.5 L32.5 34 L31 38 L28 38 L26.5 34 L24 32.5 L20 35.5 L18.5 33 L21 29 L19.5 26.5 L15.5 25 L15.5 22 L19.5 20.5 L21 18 L18.5 14 L20 11.5 L24 14.5 L26.5 13 L28 9 M29.5 18 A5 5 0 0 0 29.5 29 A5 5 0 0 0 29.5 18" fill="white"/>
                                    </svg>
                                </div>
                                <p>Tool Offsets</p>
                            </div>
                        </button>
                    </div>
                </div>
            </div>

            <div id="plannerContainer" class="main-container" style="display: none;">
                <div id="plannerContent" class="planner-container">
                    <div class="innerContainer">
                        <h1>Planner</h1>
                        <div class="planner-guidance">
                            <span>Use this tool to create a job of tasks to execute. This can be manual, gcode, button
                                press
                                emulation or a
                                combination
                                of them.
                                When you click execute the job wizard will execute the tasks one after another. Each
                                task
                                with require confirmation to start.</span>
                        </div>
                    </div>
                    <div id="taskContainer">
                        <div class="container-wrapper-outer">
                            <div class="container-wrapper">
                                <h2>Current Job</h2>
                                <span>Drag an available task to below</span>
                                <div id="tasksToExecute" class="task-container">
                                </div>
                            </div>
                            <div class="container-wrapper">
                                <button id="executeJobButton">Execute Job</button>
                            </div>
                            <hr>
                            <div class="container-wrapper">
                                <div class="innerContainer" id="loadAndSaveJob">
                                    <div class="innerContainer toolbar">
                                        <button id="saveJobButton" class="planner-save-button" title="Save Job to local browser storage">Save
                                            Job</button>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <button id="newJobButton" class="planner-save-button" title="Create a new job">New
                                            Job</button>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <button id="loadJobButton" class="planner-load-delete-buttons" title="Load Job from local browser storage">Load</button>
                                        <button id="deleteJobButton" class="planner-load-delete-buttons" title="Delete Job from local browser storage">Delete</button>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <span class="planner-saving-label">Group:</span>
                                        <select id="groupLoadSelect" class="planner-load-select">
                                        </select>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <span class="planner-saving-label">Job:</span>
                                        <select id="jobLoadSelect" class="planner-load-select">
                                        </select>
                                    </div>
                                    <div class="container-wrapper-inner">
                                        <hr>
                                    </div>
                                    <span class="planner-saving-label">Import and export Job to JSON</span>
                                    <div class="innerContainer toolbar">
                                        <button id="importJobButton" class="planner-load-delete-buttons" title="Import Job from JSON file">Import</button>
                                        <button id="exportJobButton" class="planner-load-delete-buttons" title="Export Job to JSON">Export</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="container-wrapper-outer">
                            <div class="container-wrapper">
                                <h2>Available Tasks</h2>
                                <div id="availableTasks" class="task-container">
                                </div>
                            </div>
                            <div class="container-wrapper">
                                <div class="container-wrapper-inner">
                                    <span>Drag here to delete</span>
                                </div>
                                <div id="deleteTasks" class="container-wrapper-delete">
                                </div>
                            </div>
                            <div class="container-wrapper">
                                <button id="addNewTaskButton">Add New Task</button>
                            </div>
                            <div class="container-wrapper-inner">
                                <hr class="no-marge">
                            </div>
                            <div class="container-wrapper">
                                <div class="innerContainer" id="loadAndSaveAvailableTasks">
                                    <div><span>Task Collections</span></div>
                                    <div class="innerContainer toolbar">
                                        <button id='saveAvailableTaskCollection' class="planner-save-button" title="Save Task to local browser storage">Save tasks to a collection
                                            <i class="far fa-save show-info icon-tooltip"
                                                data-tooltip="Save to local machine"></i>
                                        </button>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <select id="availableTaskCollections" class="planner-load-select">
                                            <option value="" disabled>Select your option</option>
                                        </select>
                                    </div>
                                    <div class="innerContainer toolbar">
                                        <button id="loadTaskCollection" class="planner-load-delete-buttons" title="Load selected collection">Load collection</button>
                                        <button id="deleteTaskCollection" class="planner-load-delete-buttons" title="Delete selected collection">Delete collection</button>
                                    </div>
                                    <div class="container-wrapper-inner">
                                        <hr>
                                    </div>
                                    <span class="planner-saving-label">Import and export tasks via JSON</span>
                                    <div class="innerContainer toolbar">
                                        <button id="importAvailableTasks" class="planner-load-delete-buttons" title="Import tasks from JSON file">Import</button>
                                        <button id="exportAvailableTasks" class="planner-load-delete-buttons" title="Export tasks to JSON">Export</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="helpContainer" class="main-container" style="display: none;">
                <div id="helpContent" class="controls-container">
                    <div class="innerContainer">
                        <h1>Help Page</h1>
                        <p>Some functionality offered by this tool is not present on the Nano ELS h4/h5 controller by default such as gcode threading and tool offsets. Please see my custom firmware page to download my fork of the firmware: </p>
                        <p><a href="https://github.com/Festivejelly/nanoels/blob/main/h4/h4.ino" target="_blank">Github Repo</a></p>
                    </div>
                </div>
            </div>

        </div>

        <!-- Quick Task Facing Modal-->
        <div id="quickTaskFacingModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Facing Modal</h2>
                <div class="modal-pad-bottom">
                    <label for="quickTaskFacingFeedRate">Facing Feed Rate (mm per minute):</label>
                    <input type="text" id="quickTaskFacingFeedRate" name="quickTaskFacingFeedRate" placeholder="100">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskFacingMovementType">Movement Type
                        <span class="tooltip-icon" data-tooltip="Absolute cuts all the way to the centre line. Relative cuts to a specific depth.">?</span>
                    </label>
                    <select id="quickTaskFacingMovementType" name="quickTaskFacingMovementType">
                        <option value="Absolute" selected>Absolute</option>
                        <option value="Relative">Relative</option>
                    </select>
                </div>
                <div class="modal-pad-bottom" id="quickTaskFacingDepthContainer" style="display: none;">
                    <label for="quickTaskFacingDepth">Facing Cutting Depth (mm)</label>
                    <input type="text" id="quickTaskFacingDepth" name="quickTaskFacingDepth" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskFacingExecuteButton" class="execute" title="Execute facing command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="green" />
                        </svg>
                    </button>
                    <button id="quickTaskFacingStopButton" class="execute" title="Stop facing command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="red" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad-bottom" style="display: none;">
                    <span id="quickTaskFacingLabel">Execution in progress...</span>
                    <progress id="quickTaskFacingProgressBar" max="1"></progress>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskFacingCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Grooving Modal-->
        <div id="quickTaskGroovingModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Grooving Modal</h2>
                <div class="modal-pad-bottom">
                    <label for="groovingDepth">Depth of groove in mm:</label>
                    <input type="text" id="groovingDepth" name="groovingDepth" placeholder="50">
                </div>
                <div class="modal-pad-bottom">
                    <label for="groovingWidth">Width of groove in mm:</label>
                    <input type="text" id="groovingWidth" name="groovingWidth" placeholder="50">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskGroovingExecuteButton" class="execute" title="Execute grooving command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="green" />
                        </svg>
                    </button>
                    <button id="quickTaskGroovingStopButton" class="execute" title="Stop grooving command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="red" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskGroovingCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Profiling Modal-->
        <div id="quickTaskProfilingModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Profiling Modal</h2>
                <div class="modal-pad-bottom">
                    <label for="profilingLength">Length to profile (mm)</label>
                    <input type="text" id="profilingLength" name="profilingLength" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingFeedRate">Feed rate</label>
                    <input type="text" id="quickTaskProfilingFeedRate" name="quickTaskProfilingFeedRate" placeholder="100">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingType">Profiling Type
                        <span class="tooltip-icon" data-tooltip="Absolute cuts to a specified diameter. Relative cuts to a specified depth.">?</span>
                    </label>
                    <select id="quickTaskProfilingType" name="quickTaskProfilingType">
                        <option value="Absolute" selected>Absolute</option>
                        <option value="Relative">Relative</option>
                    </select>
                </div>
                <div class="modal-pad-bottom" id="quickTaskProfilingFinalDiameterContainer">
                    <label for="quickTaskProfilingFinalDiameter">Final Diameter</label>
                    <input type="number" id="quickTaskProfilingFinalDiameter" name="quickTaskProfilingFinalDiameter" placeholder="1">
                </div>
                <div class="modal-pad-bottom" id="quickTaskProfilingDepthContainer" style="display: none;">
                    <label for="quickTaskProfilingDepth">Depth (mm)</label>
                    <input type="number" id="quickTaskProfilingDepth" name="quickTaskProfilingDepth" placeholder="1">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingDepthPerPass">Depth Per Pass (mm)
                        <span class="tooltip-icon" data-tooltip="This value might get adjusted if the depth isnt devisible exactly by this value">?</span>
                    </label>
                    <input type="number" id="quickTaskProfilingDepthPerPass" name="quickTaskProfilingDepthPerPass" placeholder="0.2" value="0.2">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingFinishingDepth">Depth of finishing pass (mm)
                    </label>
                    <input type="number" id="quickTaskProfilingFinishingDepth" name="quickTaskProfilingFinishingDepth" placeholder="0.1" value="0.1">
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskProfilingPasses">Passes
                        <span class="tooltip-icon" data-tooltip="This value is calculated">?</span>
                    </label>
                    <input type="number" id="quickTaskProfilingPasses" name="quickTaskProfilingPasses" placeholder="1" readonly>
                </div>
                <div class="modal-pad-bottom">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskProfilingExecuteButton" class="execute" title="Execute profiling command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="green" />
                        </svg>
                    </button>
                    <button id="quickTaskProfilingStopButton" class="execute" title="Stop profiling command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="red" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad-bottom" style="display: none;">
                    <span id="quickTaskProfilingLabel">Execution in progress...</span>
                    <progress id="quickTaskProfilingProgressBar" max="1"></progress>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskProfilingCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Cone Modal-->
        <div id="quickTaskConeModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Quick Task: Cone</h2>
                <div class="modal-pad-bottom">
                    <label for="coneStartingDepth">Starting Depth (radius mm)</label>
                    <input type="text" id="coneStartingDepth" name="coneStartingDepth" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <label for="coneEndingDepth">Ending Depth (radius mm)</label>
                    <input type="text" id="coneEndingDepth" name="coneEndingDepth" placeholder="0.2">
                </div>
                <div class="modal-pad-bottom">
                    <label for="coneInternalExternal">External or Internal</label>
                    <select id="coneInternalExternal" name="coneInternalExternal">
                        <option value="External">External</option>
                        <option value="Internal">Internal</option>
                    </select>
                </div>
                <div class="modal-pad-bottom">
                    <label for="coneLength">Length</label>
                    <input type="text" id="coneLength" name="coneLength" placeholder="1">
                </div>
                <div class="modal-pad-bottom">
                    <label for="conePasses">Passes</label>
                    <input type="text" id="conePasses" name="conePasses" placeholder="1">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskConeExecuteButton" class="execute" title="Execute cone command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="green" />
                        </svg>
                    </button>
                    <button id="quickTaskConeStopButton" class="execute" title="Stop cone command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="red" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskConeCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Boring Modal-->
        <div id="quickTaskBoringModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Boring Modal</h2>
                <div class="modal-pad-bottom">
                    <label for="boringDepth">Boring Depth (mm)</label>
                    <input type="text" id="boringDepth" name="boringDepth" placeholder="50">
                </div>
                <div class="modal-pad-bottom">
                    <label for="peckingDepth">Pecking Depth (mm)</label>
                    <input type="text" id="peckingDepth" name="peckingDepth" placeholder="50">
                </div>
                <div class="modal-pad-bottom">
                    <span>Quick Task Summary</span>
                </div>
                <div class="modal-pad-bottom">
                    <input type="text" id="boringQuickTaskSummary" class="quick-task-summary" name="boringQuickTaskSummary" placeholder="" disabled>
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskBoringExecuteButton" class="execute" title="Execute Boring command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="green" />
                        </svg>
                    </button>
                    <button id="quickTaskBoringStopButton" class="execute" title="Stop boring command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="red" />
                        </svg>
                    </button>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskBoringCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Threading Modal-->
        <div id="quickTaskThreadingModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Threading Modal</h2>

                <div class="modal-pad-bottom">
                    <label for="quickTaskThreadingExternalOrInternal">External or Internal</label>
                    <select id="quickTaskThreadingExternalOrInternal" name="quickTaskThreadingExternalOrInternal">
                        <option value="External" selected>External</option>
                        <option value="Internal">Internal</option>
                    </select>
                </div>

                <div class="modal-pad-bottom">
                    <label for="quickTaskThreadingType">Threading Type</label>
                    <select id="quickTaskThreadingType" name="quickTaskThreadingType">
                        <option value="Metric" selected>Metric</option>
                        <option value="UNC">UNC</option>
                        <option value="Custom" disabled>Custom</option>
                    </select>
                </div>

                <div class="modal-pad-bottom">
                    <label for="quickTaskThreadingSize">Thread Size</label>
                    <select id="quickTaskThreadingSize" name="quickTaskThreadingSize" disabled>
                        <option value="">Select Thread Size</option>
                    </select>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskThreadingDirection">Thread Direction</label>
                    <select id="quickTaskThreadingDirection" name="quickTaskThreadingDirection">
                        <option value="Right" selected>Right handed thread</option>
                        <option value="Left">Left handed thread</option>
                    </select>
                </div>
                <div class="modal-pad-bottom">
                    <label for="quickTaskThreadingLength">Thread Length (mm)</label>
                    <input type="text" id="quickTaskThreadingLength" name="quickTaskThreadingLength" placeholder="10">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskThreadingExecuteButton" class="execute" title="Execute threading command">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="green" />
                        </svg>
                    </button>
                    <button id="quickTaskThreadingStopButton" class="execute" title="Stop threading command" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="red" />
                        </svg>
                    </button>
                    <div class="modal-pad-bottom" style="display: none;">
                        <span id="quickTaskThreadingProgressBarLabel">Execution in progress...</span>
                        <progress id="quickTaskThreadingProgressBar" max="1"></progress>
                    </div>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskThreadingCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Quick Task Tool offsets Modal-->
        <div id="quickTaskToolOffsetsModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Tool offsets wizard</h2>

                <div class="modal-pad-bottom">
                    <p>Before setting offsets be sure your primary tool (T0 which should be a grooving tool) has been zero'ed on your centre line and Z reference. See this video guide: link</p>
                </div>
                <div class="modal-pad-bottom">
                    <label for="toolOffsetsToolNumber">Tool Number (eg T1)</label>
                    <input type="text" id="toolOffsetsToolNumber" name="toolOffsetsToolNumber" placeholder="T1">
                </div>
                <div class="modal-pad-bottom">
                    <label for="toolOffsetsToolType">Tool Type
                        <span class="tooltip-icon" data-tooltip="External tools touch off on front of probe, Internal on the rear.">?</span>
                    </label>
                    <select id="toolOffsetsToolType" name="toolOffsetsToolType">
                        <option value="External-Profiling" selected>External: Profiling</option>
                        <option value="External-Facing">External: Facing</option>
                        <option value="External-Grooving">External: Grooving</option>
                        <option value="External-Threading">External: Threading</option>
                        <option value="External-Other">External: Other</option>
                        <option value="Internal-Boring">Internal: Boring</option>
                        <option value="Internal-Grooving">Internal: Grooving</option>
                        <option value="Internal-Threading">Internal: Threading</option>
                        <option value="Internal-Other">Internal: Other</option>
                        <option value="Drill">Drill</option>
                    </select>
                </div>
                <div class="modal-pad-bottom">
                    <label for="toolOffsetsXValue">X Value</label>
                    <input type="text" id="toolOffsetsXValue" name="toolOffsetsXValue" placeholder="0">
                </div>
                <div class="modal-pad-bottom">
                    <label for="toolOffsetsZValue">Z Value</label>
                    <input type="text" id="toolOffsetsZValue" name="toolOffsetsZValue" placeholder="0">
                </div>
                <div class="modal-pad-bottom">
                    <label for="toolOffsetsProbeDiameter">Probe diameter</label>
                    <input type="text" id="toolOffsetsProbeDiameter" name="toolOffsetsProbeDiameter" placeholder="5">
                </div>
                <div class="modal-pad-bottom">
                </div>
                <div class="modal-pad-bottom">
                    <button id="quickTaskToolOffsetsExecuteButton" class="execute" title="Set tool offset">
                        <Span>Set Tool Offset</Span>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M8 5v14l11-7z" fill="green" />
                        </svg>
                    </button>
                    <button id="quickTaskToolOffsetsStopButton" class="execute" title="Stop gcode" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48">
                            <path d="M6 6h12v12H6z" fill="red" />
                        </svg>
                    </button>
                    <div class="modal-pad-bottom" style="display: none;">
                        <span id="quickTaskToolOffsetsLabel">Execution in progress...</span>
                        <progress id="quickTaskToolOffsetsProgressBar" max="1"></progress>
                    </div>
                </div>
                <div class="modal-pad">
                    <button id="quickTaskToolOffsetsCloseButton">Close</button>
                </div>
            </div>
        </div>

        <!-- Not Connected warning -->
        <div id="notConnectedModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Not Connected</h2>
                <div class="modal-pad-bottom">
                    <span>Please connect to the controller before executing jobs</span>
                </div>
                <div class="modal-pad">
                    <button id="notConnectedCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Manual Task Modal -->
        <div id="manualTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>Manual Task Instructions</h2>
                <hr>
                <div>
                    <span id="manualTaskName"></span>
                </div>
                <div class="modal-pad">
                    <textarea id="manualTaskInstructions" name="manualTaskInstructions" rows="4" cols="50" disabled></textarea>
                </div>
                <div class="modal-pad">
                    <button id="cancelManualTask">Cancel</button>
                    <button id="completeManualTask" class="interaction-ready-button">Next Task --></button>
                </div>
            </div>
        </div>
        <!-- Gcode Task Modal -->
        <div id="cncTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>CNC Task Gcode</h2>
                <hr>
                <div>
                    <span id="cncTaskName"></span>
                </div>
                <div class="modal-pad">
                    <textarea id="cncTaskGcode" name="cncTaskGcode" rows="4" cols="50" disabled></textarea>
                </div>
                <div class="modal-pad">
                    <button id="cancelCncTask">Cancel</button>
                    <button id="executeGcode">Execute Gcode</button>
                </div>
                <div class="modal-pad">
                    <button id="completeCncTask" disabled>Next Task --></button>
                </div>
                <div id="currentGcodeLineContainer" class="modal-pad">
                    <span id="currentGcodeLineLabel">Current Gcode Line:</span>
                    <span id="currentGcodeLine"></span>
                </div>
                <div id="currentFeedrateContainer" class="modal-pad">
                    <span id="currentFeedrateLabel">Current Feedrate:</span>
                    <span id="currentFeedrate"></span>
                </div>
                <div id="cncTaskSenderProgressContainer" class="modal-pad">
                    <span id="cncTaskSenderProgressLabel">Execution in progress...</span>
                    <progress id="cncTaskSenderProgress" max="1"></progress>
                </div>
            </div>
        </div>
        <!-- key Emulation Task Modal -->
        <div id="emulationTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>Key Emulation Task</h2>
                <hr>
                <div>
                    <span id="emulationTaskName"></span>
                </div>
                <div class="modal-pad">
                    <ul id="emulationExecutionTasks">
                        <!-- List items will be added here -->
                    </ul>
                    <div class="modal-pad">
                        <button id="completeEmulationTask" disabled>Mark Complete</button>
                    </div>
                    <div id="emulationTaskSenderProgressContainer" class="modal-pad">
                        <span id="emulationTaskSenderProgressLabel">Execution in progress...</span>
                        <progress id="emulationTaskSenderProgress" max="1"></progress>
                    </div>
                </div>
            </div>
        </div>
        <!-- All tasks Complete Modal -->
        <div id="completeTaskModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>All Tasks Complete</h2>
                <div class="modal-pad">
                    <button id="completeTaskCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Job Cancelled Modal -->
        <div id="jobCancelledModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Job Cancelled</h2>
                <div>
                    <button id="jobCancelledCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Save Job Modal -->
        <div id="saveJobModal" class="task-modal">
            <div class="task-modal-content">
                <span id="saveJobModalClose" class="close-modal">&times;</span>
                <h2>Save Job</h2>
                <hr>
                <div class="modal-pad">Job Group Name:</div>
                <div>
                    <select id="saveJobGroupNameSelect">
                    </select>
                </div>
                <div id="newJobGroupNameContainer" style="display: none;">
                    <div class="modal-pad">New Job Group name:</div>
                    <div>
                        <input id="saveJobGroupNameInput" type="text" class="planner-save-text" placeholder="Name of Group"></input>
                    </div>
                </div>
                <div class="modal-pad">Name of Job:</div>
                <div>
                    <select id="saveJobNameSelect">
                    </select>
                </div>
                <div id="newJobNameContainer" style="display: none;">
                    <div class="modal-pad">New Job name:</div>
                    <div>
                        <input id="saveJobNameInput" type="text" class="planner-save-text" placeholder="Name of Job"></input>
                    </div>
                </div>
                <div class="modal-pad">
                    <button id="saveJobSaveButton">Save</button>
                </div>
            </div>
        </div>
        <!-- export Job Modal -->
        <div id="exportJobModal" class="task-modal">
            <div class="task-modal-content">
                <span id="exportJobModalClose" class="close-modal">&times;</span>
                <h2>Export Job</h2>
                <hr>
                <div class="modal-pad">Job Group:</div>
                <div>
                    <select id="exportJobGroupNameSelect">
                    </select>
                </div>
                <div class="modal-pad">Job:</div>
                <div>
                    <select id="exportJobNameSelect">
                    </select>
                </div>
                <div class="modal-pad">
                    <button id="exportJobSaveButton">Save</button>
                </div>
            </div>
        </div>
        <!-- Save Collection -->
        <div id="saveCollectionModal" class="task-modal">
            <div class="task-modal-content">
                <span id="saveCollectionModalClose" class="close-modal">&times;</span>
                <div>
                    <div>Which collection would you like to save the tasks to?</div>
                    <div class="modal-pad">
                        <select id="saveCollectionModalToSaveTo" name="collectionToSaveToModal">
                        </select>
                    </div>
                    <div id="newCollectionNameContainerModal" style="display: none;">
                        <div class="modal-pad">New Collection Name:</div>
                        <div>
                            <input type="text" id="newCollectionNameModal" name="newCollectionNameModal" placeholder="Enter collection name...">
                        </div>
                    </div>

                    <div class="modal-pad">
                        <button id="saveAvailableTaskCollectionButtonModal">Save</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- new task modal-->
        <div id="newTaskModal" class="task-modal">
            <div class="task-modal-content">
                <span id="closeNewTaskModal" class="close-modal">&times;</span>
                <div id="newTaskHelpText">
                    <h2 id="taskTextTitle">Add a new task</h2>
                    <hr>
                    <div class="modal-pad">Task Name:</div>
                    <div>
                        <input type="text" id="newTaskName" name="newTaskName" placeholder="Enter task name...">
                    </div>
                    <div class="modal-pad">Task Type:</div>
                    <div>
                        <select id="newTaskType" name="newTaskType">
                            <option value="manual">Manual</option>
                            <option value="gcode">GCode</option>
                            <option value="emulation" disabled>Key Emulation</option>
                        </select>
                    </div>
                    <div class="modal-pad">Task Description:</div>
                    <div>
                        <textarea id="newTaskDescription" name="newTaskDescription" rows="4" cols="50" placeholder="Enter Description..."></textarea>
                    </div>
                    <div id="gcodeTaskContainer" style="display:none">
                        <div class="modal-pad">Task GCode:</div>
                        <div>
                            <textarea id="newTaskGcode" name="newTaskGcode" rows="4" cols="50" placeholder="Disabled for manual tasks" disabled></textarea>
                        </div>
                    </div>
                    <div id="emulationOuterContainer" class="emulate-noselect" style="display:none">
                        <div>
                            <span>Use built in controller functions by emulating button presses
                                Simply click the buttons you want to emulate to build up a sequence which will be
                                displayed at the bottom. Each emulated press will have a 500ms delay between them.
                                <br>
                                <br>
                                <i>Tip: Hover over the buttons for a description.</i>
                            </span>
                        </div>
                        <div id="emulationInnerContainer">
                            <div class="flexCol outerCol">
                                <div id="numberContainer">
                                    <div id="emulationNewTasksNumbers">
                                        <button id="emulateKey9" data-button-key="B_9" class="standard-font material-symbols-outlined">
                                            9
                                        </button>
                                        <button id="emulateKey8" data-button-key="B_8" class="standard-font material-symbols-outlined">
                                            8
                                        </button>
                                        <button id="emulateKey7" data-button-key="B_7" class="standard-font material-symbols-outlined">
                                            7
                                        </button>
                                        <button id="emulateKey6" data-button-key="B_6" class="standard-font material-symbols-outlined">
                                            6
                                        </button>
                                        <button id="emulateKey5" data-button-key="B_5" class="standard-font material-symbols-outlined">
                                            5
                                        </button>
                                        <button id="emulateKey4" data-button-key="B_4" class="standard-font material-symbols-outlined">
                                            4
                                        </button>
                                        <button id="emulateKey3" data-button-key="B_3" class="standard-font material-symbols-outlined">
                                            3
                                        </button>
                                        <button id="emulateKey2" data-button-key="B_2" class="standard-font material-symbols-outlined">
                                            2
                                        </button>
                                        <button id="emulateKey1" data-button-key="B_1" class="standard-font material-symbols-outlined">
                                            1
                                        </button>
                                        <button id="emulateKey0" data-button-key="B_0" class="standard-font material-symbols-outlined">
                                            0
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="flexCol middleCol">
                                <div id="modeContainer">
                                    <div id="emulationNewTasksMode">
                                        <button id="emulateKeyBack" data-button-key="B_BACKSPACE" class="material-symbols-outlined">
                                            backspace
                                        </button>
                                        <button id="emulateKeyGearbox" data-button-key="B_MODE_GEARS" class="material-symbols-outlined">
                                            manufacturing
                                        </button>
                                        <button id="emulateKeyTurning" data-button-key="B_MODE_TURN" class="material-symbols-outlined">
                                            reply
                                        </button>
                                        <button id="emulateKeyFacing" data-button-key="B_MODE_FACE" class="material-symbols-outlined">
                                            turn_slight_left
                                        </button>
                                        <button id="emulateKeyCone" data-button-key="B_MODE_CONE" class="material-symbols-outlined">
                                            arrow_forward_ios
                                        </button>
                                        <button id="emulateKeyParting" data-button-key="B_MODE_CUT" class="material-symbols-outlined">
                                            publish
                                        </button>
                                        <button id="emulateKeyThreading" data-button-key="B_MODE_THREAD" class="material-symbols-outlined">
                                            home_improvement_and_tools
                                        </button>
                                        <button id="emulateKeyMode" data-button-key="B_MODE_OTHER" class="standard-font material-symbols-outlined">
                                            M
                                        </button>
                                    </div>
                                </div>
                                <div id="movementContainer">
                                    <div id="emulationNewTasksMovement">
                                        <button id="emulateKeyLeft" data-button-key="B_LEFT" class="material-symbols-outlined">
                                            arrow_left_alt
                                        </button>
                                        <button id="emulateKeyRight" data-button-key="B_RIGHT" class="material-symbols-outlined">
                                            arrow_right_alt
                                        </button>
                                        <button id="emulateKeyUp" data-button-key="B_UP" class="material-symbols-outlined">
                                            arrow_upward_alt
                                        </button>
                                        <button id="emulateKeyDown" data-button-key="B_DOWN" class="material-symbols-outlined">
                                            arrow_downward_alt
                                        </button>
                                        <button id="emulateKeyPlay" data-button-key="B_ON" class="material-symbols-outlined">
                                            play_arrow
                                        </button>
                                        <button id="emulateKeyStop" data-button-key="B_OFF" class="material-symbols-outlined">
                                            crop_square
                                        </button>
                                        <button id="emulateKeyStopLeft" data-button-key="B_STOPL" class="material-symbols-outlined">
                                            keyboard_tab_rtl
                                        </button>
                                        <button id="emulateKeyStopRight" data-button-key="B_STOPR" class="material-symbols-outlined">
                                            keyboard_tab
                                        </button>
                                        <button id="emulateKeyStopUp" data-button-key="B_STOPU" class="material-symbols-outlined">
                                            vertical_align_top
                                        </button>
                                        <button id="emulateKeyStopDown" data-button-key="B_STOPD" class="material-symbols-outlined">
                                            vertical_align_bottom
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="flexCol outerCol">
                                <div id="otherContainer">
                                    <div id="emulationNewTasksOther">
                                        <button id="emulateKeyZ" data-button-key="B_Z" class="standard-font material-symbols-outlined">
                                            Z
                                        </button>
                                        <button id="emulateKeyX" data-button-key="B_X" class="standard-font material-symbols-outlined">
                                            X
                                        </button>
                                        <button id="emulateKeyB" data-button-key="B_B" class="standard-font material-symbols-outlined">
                                            B
                                        </button>
                                        <button id="emulateKeyA" data-button-key="B_A" class="standard-font material-symbols-outlined">
                                            A
                                        </button>
                                        <button id="emulateKeyAngle" data-button-key="B_DISPL" class="material-symbols-outlined" title="Angle/Taco">
                                            rotate_left
                                        </button>
                                        <button id="emulateKeySteps" data-button-key="B_STEPZ" class="material-symbols-outlined">
                                            signal_cellular_alt
                                        </button>
                                        <button id="emulateKeySettings" data-button-key="B_SETTINGS" class="material-symbols-outlined">
                                            settings
                                        </button>
                                        <button id="emulateKeyReverse" data-button-key="B_REVERSE" class="material-symbols-outlined">
                                            sync_alt
                                        </button>
                                        <button id="emulateKeyMeasure" data-button-key="B_MEASURE" class="material-symbols-outlined">
                                            space_bar
                                        </button>
                                        <button id="emulateKeyPlus" data-button-key="B_PLUS" class="standard-font material-symbols-outlined">
                                            +
                                        </button>
                                        <button id="emulateKeyMinus" data-button-key="B_MINUS" class="standard-font material-symbols-outlined">
                                            -
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <span>
                                Emulated sequence: <i>Tip: Drag to reorder or delete</i>
                            </span>
                        </div>
                        <div class="emulation-modal-pad-border">
                            <div id="emulationNewTasks">
                            </div>
                        </div>
                        <div class="modal-pad-bottom">
                            <div id="emulatedTasksDelete" class="container-wrapper-inner">
                                <span>
                                    Drag here to delete
                                </span>
                            </div>
                            <div id="emulatedButtonListDelete" class="container-wrapper-delete">

                            </div>
                        </div>
                    </div>
                    <div class="modal-pad">Collection to save to:</div>
                    <div>
                        <select id="collectionToSaveTo" name="collectionToSaveTo">
                        </select>
                    </div>
                    <div id="newCollectionNameContainer" style="display: none;">
                        <div class="modal-pad">New Collection Name:</div>
                        <div>
                            <input type="text" id="newCollectionName" name="newCollectionName" placeholder="Enter collection name...">
                        </div>
                    </div>
                    <div class="modal-pad">
                        <button id="saveNewTaskButton">Save</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="helpModal" class="help-modal">
            <div class="help-modal-content">
                <span id="closeHelpModal" class="close-modal">&times;</span>
                <div id="helpText">
                    <div>This tool is designed to be used in conjunction with LatheCode:</div>
                    <div><a href="https://kachurovskiy.github.io/lathecode/" target="_blank">https://kachurovskiy.github.io/lathecode/</a></div>
                    <div><strong>Please note that this tool is to be used at your own risk and I cannot gaurentee that
                            it will work. This tool targets my custom fork of the H4 firmware which you can find
                            here:</strong> <a href="https://github.com/Festivejelly/nanoels" target="_blank">https://github.com/Festivejelly/nanoels</a></div>
                    <hr>
                    <div>How to use:</div>
                    <ul style="list-style-type: disc; padding-left: 20px;">
                        <li>Use LatheCode to generate the G-code, then paste it into this tool.</li>
                        <li>You can also write the G-code by hand for simple operations such as boring or grooving.
                            <a href="#" id="exampleCode">Click here</a> to load an example.
                        </li>
                        <li>Click"Simulate" to plot the moves onto the canvas.</li>
                        <li>movement lines marked with"; cut" will show in <span class="line red-line"></span><span class="text-red">red</span>.</li>
                        <li>movement lines marked with"; travel" will show in <span class="line green-line"></span><span class="text-green">green</span>.</li>
                        <li>movement lines marked with"; retract" will show in <span class="line orange-line"></span><span class="text-orange">orange</span>.</li>
                        <li>movement lines not marked will default to <span class="line green-line"></span><span class="text-green">green</span>.</li>
                        <li>All other moves will be considered travel moves and will show in green.</li>
                        <li>Any G-code you paste or write can be saved into the browser's local storage. This is useful for saving common operations.</li>
                        <li>When you're ready, you can send the G-code to the Nano ELS H4 by clicking"Send."
                        </li>
                        <li>More functionality to come soon! Version 0.2</li>
                        <li>Please provide feedback, raise issues or make suggestions here: <a href="https://github.com/Festivejelly/LatheGcodeVisualiser" target="_blank">https://github.com/Festivejelly/LatheGcodeVisualiser</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="zoomModal" class="zoom-modal">
            <div class="zoom-modal-content" style="background-color: #242424;">
                <span id="closeZoomModal" class="close-modal">&times;</span>
                <canvas id="zoomCanvas" width="1600" height="1200"></canvas>
                <div id="sliderAndButtonContainer">
                    <div id="zoomSliderContainer" class="innerContainer" style="width: 400px;">
                        <input type="range" id="zoomProgressSlider" min="0" max="100" value="0" style="width: 100%;">
                        <div id="zoomSliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                    </div>
                    <div id="displayOptionsContainerZoom" class="innerContainer">
                        <input type="checkbox" id="showCutsZoom" checked> Show Cut Moves
                        </label>
                        <label>
                            <input type="checkbox" id="showNonCutsZoom" checked>
                            Show Non-Cut Moves
                        </label>
                    </div>
                    <button id="zoomCloseButton">Close</button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>