<!DOCTYPE html>
<html>

<head>
    <title>G-Code Visualizer</title>
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/ace.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <script type="module" crossorigin>
var tn=Object.defineProperty;var nn=(n,e,t)=>e in n?tn(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var B=(n,e,t)=>(nn(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const d of r)if(d.type==="childList")for(const y of d.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&a(y)}).observe(document,{childList:!0,subtree:!0});function t(r){const d={};return r.integrity&&(d.integrity=r.integrity),r.referrerPolicy&&(d.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?d.credentials="include":r.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function a(r){if(r.ep)return;r.ep=!0;const d=t(r);fetch(r.href,d)}})();class on{constructor(e,t,a,r,d,y,I,L,M,O){this.isConnected=e,this.condition=t,this.error=a,this.progress=r,this.currentLine=d,this.feedRate=y,this.z=I,this.x=L,this.feed=M,this.rpm=O}}const Ie=class Ie{constructor(){B(this,"listeners",[]);B(this,"port",null);B(this,"readTimeout",0);B(this,"reader",null);B(this,"writer",null);B(this,"isOn",!1);B(this,"waitForOkOrError",!1);B(this,"lines",[]);B(this,"lineIndex",0);B(this,"unparsedResponse","");B(this,"error","");B(this,"statusReceived",!1);B(this,"currentLine","");B(this,"feedRate",0);B(this,"z",0);B(this,"x",0);B(this,"feed",0);B(this,"rpm",0);B(this,"isDisconnecting",!1);B(this,"lastStatus",null);B(this,"currentCommandListeners",[]);B(this,"remainingStatus","");B(this,"remainingResponse","")}static getInstance(){return Ie.instance||(Ie.instance=new Ie),Ie.instance}getStatus(){return this.lastStatus=new on(this.port!==null,this.isOn?"run":"idle",this.error,this.lines.length?this.lineIndex/this.lines.length:0,this.currentLine,this.feedRate,this.z,this.x,this.feed,this.rpm),this.lastStatus}getCurrentCommand(){return this.currentLine}addStatusChangeListener(e){this.listeners.push(e)}notifyStatusChange(){this.listeners.forEach(e=>e())}addCurrentCommandListener(e){this.currentCommandListeners.push(e)}notifyCurrentCommand(e){this.currentCommandListeners.forEach(t=>t(e))}setStatus(e){if(e=this.remainingStatus+e,this.remainingStatus="",e.startsWith("<")&&(e=e.substring(1)),e.endsWith(">"))e=e.slice(0,-1);else{this.remainingStatus=e;return}const t=e.split("|");if(t.length>=3){if(this.statusReceived=!0,t[1].startsWith("WPos:")){const a=t[1].substring(5).split(",");this.z=Number(a[2]),this.x=Number(a[0])}if(t[2].startsWith("FS:")){const a=t[2].substring(3).split(",");this.feed=Number(a[0]),this.rpm=Number(a[1])}}this.notifyStatusChange(),$e(`response: ${e}`),console.log(`response: "${e}"`)}setError(e){this.error=e,$e(e),this.notifyStatusChange()}isConnected(){return this.lastStatus!==null&&this.lastStatus.isConnected}async connect(){try{if(this.port)this.closePort();else{if(await this.selectPort(),this.write("!"),await this.askForStatus(),!await sn(()=>this.statusReceived)){this.setError("Device is not reponding, is it in GCODE mode?");return}this.isDisconnecting=!1,this.isOn=!1,this.setError(""),this.waitForOkOrError=!1,this.unparsedResponse=""}}catch(e){console.log(e)}this.notifyStatusChange()}async disconnect(){this.isDisconnecting=!0,this.port&&this.closePort()}getDisconnectingStatus(){return this.isDisconnecting}async start(e){e&&(this.isOn=!0,this.lines=e.split(`
`),this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange())}async sendCommand(e){this.isOn=!0,this.lines=[e],this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange()}async sendCommands(e){this.isOn=!0,this.lines=e,this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange()}async stop(){await this.write("!"),this.isOn&&(this.isOn=!1,this.notifyStatusChange())}async write(e){if(this.port){if(console.log("command: ",e),!this.port.writable){e!="?"&&this.setError("Port is not writable, try reconnecting the USB and switching to GCODE mode.");return}if(!this.writer)try{const t=new TextEncoderStream;t.readable.pipeTo(this.port.writable),this.writer=t.writable.getWriter()}catch(t){this.setError("Failed to write: "+t);return}await this.writer.write(e)}}async writeCurrentLine(){if(!this.isOn||this.waitForOkOrError)return;if(this.lineIndex>=this.lines.length){this.stop();return}const e=this.lines[this.lineIndex].split(";")[0].trim();if(!e){this.lineIndex++,this.writeCurrentLine();return}this.currentLine=e,this.notifyCurrentCommand(this.currentLine),this.waitForOkOrError=!0,console.log(`command: "${e}"`),$e(`command: ${e}`),await this.write(e+`
`),await this.readFromPort()}async processResponse(e){this.unparsedResponse=(this.remainingResponse+e).trimStart(),this.remainingResponse="";const t=this.unparsedResponse.split(`
`);for(let a of t){const r=a.match(/(<[^>]+>)/);if(r&&r.length>1){r.shift();for(const d of r)a=a.replace(d,"");this.setStatus(r.pop())}a.startsWith("error:")?(this.remainingResponse+=a,$e(`response: ${this.remainingResponse}`),console.log(`response: "${this.remainingResponse}"`),this.setError(a),this.remainingResponse="",this.stop()):a.startsWith("ok")?(this.remainingResponse+=a,$e(`response: ${this.remainingResponse}`),console.log(`response: "${this.remainingResponse}"`),this.remainingResponse="",this.waitForOkOrError=!1,this.lineIndex++,this.notifyStatusChange(),this.isOn&&await this.writeCurrentLine()):this.remainingResponse+=a}this.unparsedResponse=""}async selectPort(){if(this.port&&this.closePort(),navigator.serial?this.port=await navigator.serial.requestPort():(this.error="This browser does not support Serial API, try Chrome or Edge",this.notifyStatusChange()),this.port)try{await this.port.open({baudRate:115200}),this.notifyStatusChange(),this.readSoon()}catch(e){this.setError(`Unable to open port - likely some other app is using it - try closing Arduino IDE.
${e}`),this.closePort()}}async askForStatus(){try{await this.write("?")}catch(e){this.setError(`Device disconnected? ${e}`),this.closePort()}}readSoon(){clearTimeout(this.readTimeout),this.readTimeout=window.setTimeout(()=>this.readFromPort(),200)}async readFromPort(){if(this.port)try{if(!this.port.readable){this.readSoon();return}if(!this.reader){const t=new TextDecoderStream;this.port.readable.pipeTo(t.writable),this.reader=t.readable.getReader()}const{value:e}=await this.reader.read();if(!e){this.readSoon();return}await this.processResponse(e),this.readSoon()}catch(e){this.setError(e.message||String(e)),this.closePort()}}async closePort(){if(this.port){if(clearTimeout(this.readTimeout),this.reader){try{await this.reader.cancel(),this.reader.releaseLock()}catch(e){console.error("Error cancelling reader: ",e)}this.reader=null}if(this.writer){try{await this.writer.close(),this.writer.releaseLock()}catch(e){console.error("Error closing writer: ",e)}this.writer=null}await new Promise(e=>setTimeout(e,500));try{await this.port.close()}catch(e){console.error("Error closing port: ",e)}this.port=null,this.statusReceived=!1,this.z=0,this.x=0,this.feed=0,this.rpm=0}}};B(Ie,"instance",null);let at=Ie;function $e(n){var e=ue.getSession(),t=e.getLength(),a=new Date().toLocaleTimeString(),r=`[${a}] ${n}
`;e.insert({row:t,column:0},r)}function sn(n){return new Promise(e=>{let t=0;function a(){n()?e(!0):t>=10?e(!1):(t++,setTimeout(a,100))}a()})}class an{constructor(){B(this,"sendButton");B(this,"sendSingleCommandButton");B(this,"stopButton");B(this,"senderError");B(this,"runProgress");B(this,"runProgressLabel");B(this,"connectButton");B(this,"isConnected",!1);B(this,"gcodeResponseContainer");B(this,"jogButtons");B(this,"toolButtons");B(this,"sender");B(this,"singleCommandSender");let e,t,a;this.senderError=document.querySelector(".senderError"),this.runProgress=document.getElementById("senderProgress"),this.runProgressLabel=document.getElementById("senderProgressLabel"),this.connectButton=document.getElementById("connectButton"),this.gcodeResponseContainer=document.getElementById("gcodeResponseContainer"),a=document.getElementById("moveDistance"),e=document.getElementById("fastFeedrate"),t=document.getElementById("slowFeedrate"),this.jogButtons=document.querySelectorAll("#latheControls .jog-btn"),this.toolButtons=document.querySelectorAll("#latheControls .tool-btn"),this.sendButton=document.getElementById("gcodeSenderButton"),this.sendSingleCommandButton=document.getElementById("gcodeSendSingleCommandButton"),this.singleCommandSender=document.getElementById("singleCommandSender"),this.sender=at.getInstance(),this.sender.addStatusChangeListener(()=>this.handleStatusChange()),this.jogButtons.forEach(r=>{r.addEventListener("click",()=>{if(!this.isConnected){alert("Please connect to the controller first.");return}let d="",y="",I="",L=!0;r.id=="fastForward"?(d=e.value,y="X",I=a.value,L=!0):r.id=="slowForward"?(d=t.value,y="X",I=a.value,L=!0):r.id=="fastBackward"?(d=e.value,y="X",I=a.value,L=!1):r.id=="slowBackward"?(d=t.value,y="X",I=a.value,L=!1):r.id=="fastLeft"?(d=e.value,y="Z",I=a.value,L=!0):r.id=="slowLeft"?(d=t.value,y="Z",I=a.value,L=!0):r.id=="fastRight"?(d=e.value,y="Z",I=a.value,L=!1):r.id=="slowRight"&&(d=t.value,y="Z",I=a.value,L=!1);let O=`${y}${L===!0?"":"-"}${I} F${d}`;if(this.sender){let x=new Array(3);x[0]="G91",x[1]=O,x[2]="G90",this.sender.sendCommands(x)}})}),this.toolButtons.forEach(r=>{r.addEventListener("click",()=>{if(!this.isConnected){alert("Please connect to the controller first.");return}let d=r.id,y=d.replace("tool","T");document.querySelectorAll("#latheControls .tool-btn").forEach(function(M){M.id!=d?M.classList.remove("tool-selected"):M.classList.add("tool-selected")});let L=new Array(1);L[0]=y,this.sender&&this.sender.sendCommands(L)})}),this.connectButton.addEventListener("click",()=>{this.gcodeResponseContainer.style.display="block",!this.isConnected&&this.sender&&this.sender.connect()}),this.sendButton.addEventListener("click",()=>{if(!this.isConnected){alert("Please connect to the controller first.");return}this.sender&&(this.sendButton.disabled=!0,this.sendSingleCommandButton.disabled=!0,this.jogButtons.forEach(r=>{r.disabled=!0}),this.toolButtons.forEach(r=>{r.disabled=!0}),this.sender.start(D.getValue()))}),this.sendSingleCommandButton.addEventListener("click",()=>{if(!this.isConnected){alert("Please connect to the controller first.");return}this.sender&&(this.sendButton.disabled=!0,this.sendSingleCommandButton.disabled=!0,this.jogButtons.forEach(r=>{r.disabled=!0}),this.toolButtons.forEach(r=>{r.disabled=!0}),this.sender.sendCommand(this.singleCommandSender.value))}),this.stopButton=document.getElementById("stopButton"),this.stopButton.addEventListener("click",()=>this.sender.stop()),this.stopButton.style.display="none"}hide(){}handleStatusChange(){if(!this.sender)return;const e=this.sender.getStatus();if(e.isConnected===!1){this.sendButton.style.display="none",this.connectButton.innerText="Connect",this.isConnected=!1;return}else this.isConnected=!0,this.sendButton.style.display="inline-block",this.connectButton.innerText="Connected",this.connectButton.disabled=!0;const t=e.condition==="run";this.runProgress&&(this.runProgress.value=e.progress,this.runProgress.style.display=t?"block":"none",this.runProgressLabel.style.display=t?"block":"none",t||(this.sendButton.disabled=!1,this.sendSingleCommandButton.disabled=!1,this.jogButtons.forEach(r=>{r.disabled=!1}),this.toolButtons.forEach(r=>{r.disabled=!1}))),this.stopButton&&(this.stopButton.style.display=t?"inline-block":"none");const a=this.sender.getDisconnectingStatus();this.senderError&&!a&&(e.error?(this.senderError.style.display="block",this.senderError.innerText=e.error,this.showError(),this.appendLineToResponseEditor(e.error)):(this.hideError(),this.senderError.innerText=""))}appendLineToResponseEditor(e){var t=ue.getSession(),a=t.getLength(),r=new Date().toLocaleTimeString(),d=`[${r}] ${e}
`;t.insert({row:a,column:0},d)}showError(){this.senderError.style.display="block"}hideError(){this.senderError.style.display="none"}}const rn=`; This example shows a boring operation, then an internal grooving operation

G21 ; metric
G18 ; ZX plane
G90 ; absolute positioning
F200
X0 ; zero your tool X on centerline
Z0 ; zero your tool Z at the right edge of the stock
G91 ; relative positioning

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;1mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;2mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;3mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;4mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;5mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;6mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;7mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;8mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;9mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;10mm

Z-10

Z3.25 ; cut
X-5 ; cut

X-1.7 ; cut

X6.7 ; retract
Z-3.25 ; retract
`;function ln(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var cn=function(e,t){return Array.prototype.slice.call(e,t)},dn=typeof setImmediate=="function",St;dn?St=function(n){setImmediate(n)}:St=function(n){setTimeout(n,0)};var un=St,mn=un,fn=function(e,t,a){e&&mn(function(){e.apply(a||null,t||[])})},wt=cn,hn=fn,gn=function(e,t){var a=t||{},r={};return e===void 0&&(e={}),e.on=function(d,y){return r[d]?r[d].push(y):r[d]=[y],e},e.once=function(d,y){return y._once=!0,e.on(d,y),e},e.off=function(d,y){var I=arguments.length;if(I===1)delete r[d];else if(I===0)r={};else{var L=r[d];if(!L)return e;L.splice(L.indexOf(y),1)}return e},e.emit=function(){var d=wt(arguments);return e.emitterSnapshot(d.shift()).apply(this,d)},e.emitterSnapshot=function(d){var y=(r[d]||[]).slice(0);return function(){var I=wt(arguments),L=this||e;if(d==="error"&&a.throws!==!1&&!y.length)throw I.length===1?I[0]:I;return y.forEach(function(O){a.async?hn(O,I,L):O.apply(L,I),O._once&&e.off(d,O)}),e}},e},jt=window.CustomEvent;function pn(){try{var n=new jt("cat",{detail:{foo:"bar"}});return n.type==="cat"&&n.detail.foo==="bar"}catch{}return!1}var vn=pn()?jt:typeof document<"u"&&typeof document.createEvent=="function"?function(e,t){var a=document.createEvent("CustomEvent");return t?a.initCustomEvent(e,t.bubbles,t.cancelable,t.detail):a.initCustomEvent(e,!1,!1,void 0),a}:function(e,t){var a=document.createEventObject();return a.type=e,t?(a.bubbles=!!t.bubbles,a.cancelable=!!t.cancelable,a.detail=t.detail):(a.bubbles=!1,a.cancelable=!1,a.detail=void 0),a},zt=[],ut="",yn=/^on/;for(ut in window)yn.test(ut)&&zt.push(ut.slice(2));var bn=zt,kn=vn,Cn=bn,Qe=window.document,Gt=Bn,Vt=wn,Ge=[];window.addEventListener||(Gt=Sn,Vt=Tn);var En={add:Gt,remove:Vt,fabricate:In};function Bn(n,e,t,a){return n.addEventListener(e,t,a)}function Sn(n,e,t){return n.attachEvent("on"+e,Nn(n,e,t))}function wn(n,e,t,a){return n.removeEventListener(e,t,a)}function Tn(n,e,t){var a=Ht(n,e,t);if(a)return n.detachEvent("on"+e,a)}function In(n,e,t){var a=Cn.indexOf(e)===-1?d():r();n.dispatchEvent?n.dispatchEvent(a):n.fireEvent("on"+e,a);function r(){var y;return Qe.createEvent?(y=Qe.createEvent("Event"),y.initEvent(e,!0,!0)):Qe.createEventObject&&(y=Qe.createEventObject()),y}function d(){return new kn(e,{detail:t})}}function Ln(n,e,t){return function(r){var d=r||window.event;d.target=d.target||d.srcElement,d.preventDefault=d.preventDefault||function(){d.returnValue=!1},d.stopPropagation=d.stopPropagation||function(){d.cancelBubble=!0},d.which=d.which||d.keyCode,t.call(n,d)}}function Nn(n,e,t){var a=Ht(n,e,t)||Ln(n,e,t);return Ge.push({wrapper:a,element:n,type:e,fn:t}),a}function Ht(n,e,t){var a=xn(n,e,t);if(a){var r=Ge[a].wrapper;return Ge.splice(a,1),r}}function xn(n,e,t){var a,r;for(a=0;a<Ge.length;a++)if(r=Ge[a],r.element===n&&r.type===e&&r.fn===t)return a}var Tt={},On="(?:^|\\s)",_n="(?:\\s|$)";function qt(n){var e=Tt[n];return e?e.lastIndex=0:Tt[n]=e=new RegExp(On+n+_n,"g"),e}function Xn(n,e){var t=n.className;t.length?qt(e).test(t)||(n.className+=" "+e):n.className=e}function Mn(n,e){n.className=n.className.replace(qt(e)," ").trim()}var Pn={add:Xn,rm:Mn},Jn=gn,Xe=En,ye=Pn,Me=document,te=Me.documentElement;function Rn(n,e){var t=arguments.length;t===1&&Array.isArray(n)===!1&&(e=n,n=[]);var a,r,d,y,I,L,M,O,x,S,o,c=null,u,s=e||{};s.moves===void 0&&(s.moves=xt),s.accepts===void 0&&(s.accepts=xt),s.invalid===void 0&&(s.invalid=lt),s.containers===void 0&&(s.containers=n||[]),s.isContainer===void 0&&(s.isContainer=$n),s.copy===void 0&&(s.copy=!1),s.copySortSource===void 0&&(s.copySortSource=!1),s.revertOnSpill===void 0&&(s.revertOnSpill=!1),s.removeOnSpill===void 0&&(s.removeOnSpill=!1),s.direction===void 0&&(s.direction="vertical"),s.ignoreInputTextSelection===void 0&&(s.ignoreInputTextSelection=!0),s.mirrorContainer===void 0&&(s.mirrorContainer=Me.body);var i=Jn({containers:s.containers,start:rt,end:He,cancel:he,remove:fe,destroy:N,canMove:it,dragging:!1});return s.removeOnSpill===!0&&i.on("over",ct).on("out",Ee),g(),i;function b(l){return i.containers.indexOf(l)!==-1||s.isContainer(l)}function g(l){var f=l?"remove":"add";De(te,f,"mousedown",A),De(te,f,"mouseup",Pe)}function k(l){var f=l?"remove":"add";De(te,f,"mousemove",me)}function v(l){var f=l?"remove":"add";Xe[f](te,"selectstart",w),Xe[f](te,"click",w)}function N(){g(!0),Pe({})}function w(l){u&&l.preventDefault()}function A(l){L=l.clientX,M=l.clientY;var f=It(l)!==1||l.metaKey||l.ctrlKey;if(!f){var C=l.target,p=W(C);p&&(u=p,k(),l.type==="mousedown"&&(Xt(C)?C.focus():l.preventDefault()))}}function me(l){if(u){if(It(l)===0){Pe({});return}if(!(l.clientX!==void 0&&Math.abs(l.clientX-L)<=(s.slideFactorX||0)&&l.clientY!==void 0&&Math.abs(l.clientY-M)<=(s.slideFactorY||0))){if(s.ignoreInputTextSelection){var f=be("clientX",l)||0,C=be("clientY",l)||0,p=Me.elementFromPoint(f,C);if(Xt(p))return}var P=u;k(!0),v(),He(),Ve(P);var X=An(d);y=be("pageX",l)-X.left,I=be("pageY",l)-X.top,ye.add(S||d,"gu-transit"),Be(),Le(l)}}}function W(l){if(!(i.dragging&&a)&&!b(l)){for(var f=l;G(l)&&b(G(l))===!1;)if(s.invalid(l,f)||(l=G(l),!l))return;var C=G(l);if(C&&!s.invalid(l,f)){var p=s.moves(l,C,f,Ze(l));if(p)return{item:l,source:C}}}}function it(l){return!!W(l)}function rt(l){var f=W(l);f&&Ve(f)}function Ve(l){Je(l.item,l.source)&&(S=l.item.cloneNode(!0),i.emit("cloned",S,l.item,"copy")),r=l.source,d=l.item,O=x=Ze(l.item),i.dragging=!0,i.emit("drag",d,r)}function lt(){return!1}function He(){if(i.dragging){var l=S||d;Ue(l,G(l))}}function qe(){u=!1,k(!0),v(!0)}function Pe(l){if(qe(),!!i.dragging){var f=S||d,C=be("clientX",l)||0,p=be("clientY",l)||0,P=Nt(a,C,p),X=ge(P,C,p);X&&(S&&s.copySortSource||!S||X!==r)?Ue(f,X):s.removeOnSpill?fe():he()}}function Ue(l,f){var C=G(l);S&&s.copySortSource&&f===r&&C.removeChild(d),K(f)?i.emit("cancel",l,r,r):i.emit("drop",l,f,r,x),ne()}function fe(){if(i.dragging){var l=S||d,f=G(l);f&&f.removeChild(l),i.emit(S?"cancel":"remove",l,f,r),ne()}}function he(l){if(i.dragging){var f=arguments.length>0?l:s.revertOnSpill,C=S||d,p=G(C),P=K(p);P===!1&&f&&(S?p&&p.removeChild(S):r.insertBefore(C,O)),P||f?i.emit("cancel",C,r,r):i.emit("drop",C,p,r,x),ne()}}function ne(){var l=S||d;qe(),pe(),l&&ye.rm(l,"gu-transit"),o&&clearTimeout(o),i.dragging=!1,c&&i.emit("out",l,c,r),i.emit("dragend",l),r=d=S=O=x=o=c=null}function K(l,f){var C;return f!==void 0?C=f:a?C=x:C=Ze(S||d),l===r&&C===O}function ge(l,f,C){for(var p=l;p&&!P();)p=G(p);return p;function P(){var X=b(p);if(X===!1)return!1;var ve=oe(p,l),J=Ne(p,ve,f,C),H=K(p,J);return H?!0:s.accepts(d,p,r,J)}}function Le(l){if(!a)return;l.preventDefault();var f=be("clientX",l)||0,C=be("clientY",l)||0,p=f-y,P=C-I;a.style.left=p+"px",a.style.top=P+"px";var X=S||d,ve=Nt(a,f,C),J=ge(ve,f,C),H=J!==null&&J!==c;(H||J===null)&&(Ye(),c=J,dt());var $=G(X);if(J===r&&S&&!s.copySortSource){$&&$.removeChild(X);return}var F,se=oe(J,ve);if(se!==null)F=Ne(J,se,f,C);else if(s.revertOnSpill===!0&&!S)F=O,J=r;else{S&&$&&$.removeChild(X);return}(F===null&&H||F!==X&&F!==Ze(X))&&(x=F,J.insertBefore(X,F),i.emit("shadow",X,J,r));function Q(We){i.emit(We,X,c,r)}function dt(){H&&Q("over")}function Ye(){c&&Q("out")}}function ct(l){ye.rm(l,"gu-hide")}function Ee(l){i.dragging&&ye.add(l,"gu-hide")}function Be(){if(!a){var l=d.getBoundingClientRect();a=d.cloneNode(!0),a.style.width=Ot(l)+"px",a.style.height=_t(l)+"px",ye.rm(a,"gu-transit"),ye.add(a,"gu-mirror"),s.mirrorContainer.appendChild(a),De(te,"add","mousemove",Le),ye.add(s.mirrorContainer,"gu-unselectable"),i.emit("cloned",a,d,"mirror")}}function pe(){a&&(ye.rm(s.mirrorContainer,"gu-unselectable"),De(te,"remove","mousemove",Le),G(a).removeChild(a),a=null)}function oe(l,f){for(var C=f;C!==l&&G(C)!==l;)C=G(C);return C===te?null:C}function Ne(l,f,C,p){var P=s.direction==="horizontal",X=f!==l?J():ve();return X;function ve(){var $=l.children.length,F,se,Q;for(F=0;F<$;F++)if(se=l.children[F],Q=se.getBoundingClientRect(),P&&Q.left+Q.width/2>C||!P&&Q.top+Q.height/2>p)return se;return null}function J(){var $=f.getBoundingClientRect();return H(P?C>$.left+Ot($)/2:p>$.top+_t($)/2)}function H($){return $?Ze(f):f}}function Je(l,f){return typeof s.copy=="boolean"?s.copy:s.copy(l,f)}}function De(n,e,t,a){var r={mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"},d={mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"},y={mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"};window.navigator.pointerEnabled?Xe[e](n,d[t],a):window.navigator.msPointerEnabled?Xe[e](n,y[t],a):(Xe[e](n,r[t],a),Xe[e](n,t,a))}function It(n){if(n.touches!==void 0)return n.touches.length;if(n.which!==void 0&&n.which!==0)return n.which;if(n.buttons!==void 0)return n.buttons;var e=n.button;if(e!==void 0)return e&1?1:e&2?3:e&4?2:0}function An(n){var e=n.getBoundingClientRect();return{left:e.left+Lt("scrollLeft","pageXOffset"),top:e.top+Lt("scrollTop","pageYOffset")}}function Lt(n,e){return typeof window[e]<"u"?window[e]:te.clientHeight?te[n]:Me.body[n]}function Nt(n,e,t){n=n||{};var a=n.className||"",r;return n.className+=" gu-hide",r=Me.elementFromPoint(e,t),n.className=a,r}function $n(){return!1}function xt(){return!0}function Ot(n){return n.width||n.right-n.left}function _t(n){return n.height||n.bottom-n.top}function G(n){return n.parentNode===Me?null:n.parentNode}function Xt(n){return n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.tagName==="SELECT"||Ut(n)}function Ut(n){return!n||n.contentEditable==="false"?!1:n.contentEditable==="true"?!0:Ut(G(n))}function Ze(n){return n.nextElementSibling||e();function e(){var t=n;do t=t.nextSibling;while(t&&t.nodeType!==1);return t}}function Dn(n){return n.targetTouches&&n.targetTouches.length?n.targetTouches[0]:n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:n}function be(n,e){var t=Dn(e),a={pageX:"clientX",pageY:"clientY"};return n in a&&!(n in t)&&a[n]in t&&(n=a[n]),t[n]}var Zn=Rn;const Mt=ln(Zn);class Yt{static getButtonName(e){const t=this.buttons.find(a=>a.id===e);return t?t.name:""}static createKeyPressEvent(e,t){const a=this.buttons.find(d=>d.id===e);if(!a)throw new Error(`No button found with id: ${e}`);let r=a.number;return r&=127,t&&(r|=128),r}}B(Yt,"buttons",[{name:"arrow_left_alt",id:"B_LEFT",number:57},{name:"arrow_right_alt",id:"B_RIGHT",number:37},{name:"arrow_upward_alt",id:"B_UP",number:47},{name:"arrow_downward_alt",id:"B_DOWN",number:67},{name:"+",id:"B_MINUS",number:5},{name:"-",id:"B_PLUS",number:64},{name:"play_arrow",id:"B_ON",number:17},{name:"crop_square",id:"B_OFF",number:27},{name:"keyboard_tab_rtl",id:"B_STOPL",number:7},{name:"keyboard_tab",id:"B_STOPR",number:15},{name:"vertical_align_top",id:"B_STOPU",number:6},{name:"vertical_align_bottom",id:"B_STOPD",number:16},{name:"rotate_left",id:"B_DISPL",number:14},{name:"signal_cellular_alt",id:"B_STEP",number:24},{name:"settings",id:"B_SETTINGS",number:34},{name:"space_bar",id:"B_MEASURE",number:54},{name:"sync_alt",id:"B_REVERSE",number:44},{name:"1",id:"B_0",number:51},{name:"2",id:"B_1",number:41},{name:"3",id:"B_2",number:61},{name:"4",id:"B_3",number:31},{name:"5",id:"B_4",number:2},{name:"6",id:"B_5",number:21},{name:"7",id:"B_6",number:12},{name:"8",id:"B_7",number:11},{name:"9",id:"B_8",number:22},{name:"10",id:"B_9",number:1},{name:"backspace",id:"B_BACKSPACE",number:32},{name:"manufacturing",id:"B_MODE_GEARS",number:42},{name:"reply",id:"B_MODE_TURN",number:52},{name:"turn_slight_left",id:"B_MODE_FACE",number:62},{name:"arrow_forward_ios",id:"B_MODE_CONE",number:3},{name:"publish",id:"B_MODE_CUT",number:13},{name:"home_improvement_and_tools",id:"B_MODE_THREAD",number:23},{name:"M",id:"B_MODE_OTHER",number:33},{name:"X",id:"B_X",number:53},{name:"Z",id:"B_Z",number:43},{name:"A",id:"B_A",number:4},{name:"B",id:"B_B",number:63}]);let Fn=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");const ie=document.getElementById("availableTasks"),j=document.getElementById("tasksToExecute"),mt=document.getElementById("deleteTasks"),jn=document.getElementById("addNewTaskButton"),we=document.getElementById("newTaskModal"),zn=document.getElementById("closeNewTaskModal"),re=document.getElementById("newTaskType"),Oe=document.getElementById("gcodeTaskContainer"),V=document.getElementById("newTaskGcode"),_e=document.getElementById("emulationOuterContainer"),Gn=document.getElementById("saveNewTaskButton"),Fe=document.getElementById("newTaskName"),Pt=document.getElementById("taskTextTitle"),ft=document.getElementById("newTaskDescription");let z;const et=document.getElementById("plannerConnectButton"),Vn=document.getElementById("plannerContainer");let tt=!1,Jt=null;const Hn=document.getElementById("saveAvailableTaskCollection"),qn=document.getElementById("saveAvailableTaskCollectionButtonModal"),Un=document.getElementById("loadTaskCollection"),le=document.getElementById("availableTaskCollections"),Y=document.getElementById("collectionToSaveTo"),Rt=document.getElementById("newCollectionNameContainer"),ht=document.getElementById("newCollectionName"),Yn=document.getElementById("deleteTaskCollection"),gt=document.getElementById("saveCollectionModal"),ke=document.getElementById("saveCollectionModalToSaveTo"),Wn=document.getElementById("saveCollectionModalClose"),Kn=document.getElementById("newCollectionNameModal"),At=document.getElementById("newCollectionNameContainerModal"),Qn=document.getElementById("importAvailableTasks"),eo=document.getElementById("exportAvailableTasks"),pt=document.getElementById("saveJobModal"),to=document.getElementById("saveJobModalClose"),no=document.getElementById("executeJobButton"),oo=document.getElementById("saveJobButton"),vt=document.getElementById("saveJobNameInput"),ce=document.getElementById("saveJobNameSelect"),$t=document.getElementById("newJobNameContainer"),so=document.getElementById("saveJobSaveButton"),Ce=document.getElementById("jobLoadSelect"),ao=document.getElementById("loadJobButton"),io=document.getElementById("deleteJobButton"),ro=document.getElementById("importJobButton"),lo=document.getElementById("exportJobButton"),yt=document.getElementById("exportJobModal"),co=document.getElementById("exportJobModalClose"),uo=document.getElementById("exportJobSaveButton"),nt=document.getElementById("exportJobNameSelect"),je=[],bt=document.getElementById("manualTaskModal"),ot=document.getElementById("cncTaskModal"),mo=document.getElementById("cancelManualTask"),fo=document.getElementById("completeManualTask"),ho=document.getElementById("manualTaskInstructions"),Dt=document.getElementById("cncTaskGcode"),go=document.getElementById("cancelCncTask"),kt=document.getElementById("executeGcode"),ze=document.getElementById("completeCncTask"),po=document.getElementById("manualTaskName"),vo=document.getElementById("cncTaskName"),st=document.getElementById("cncTaskSenderProgressLabel"),Ct=document.getElementById("cncTaskSenderProgress"),Et=document.getElementById("jobCancelledModal"),yo=document.getElementById("jobCancelledCloseButton"),Zt=document.getElementById("completeTaskModal"),bo=document.getElementById("completeTaskCloseButton"),Ft=document.getElementById("notConnectedModal"),ko=document.getElementById("notConnectedCloseButton"),Co=document.getElementById("currentGcodeLineContainer"),Eo=document.getElementById("currentGcodeLine"),Bo=document.getElementById("currentFeedrateContainer"),So=document.getElementById("currentFeedrate"),wo=document.getElementById("emulationInnerContainer"),de=document.getElementById("emulationNewTasks"),Bt=document.getElementById("emulatedButtonListDelete"),To=document.getElementById("emulationTaskModal");document.addEventListener("DOMContentLoaded",()=>{z=at.getInstance(),z.addStatusChangeListener(()=>r()),z.addCurrentCommandListener(a),Vn.addEventListener("containerVisible",()=>{j.innerHTML="",t(),O(),L("currentJob"),x(),M(),e()}),ke.addEventListener("change",()=>{ke.value==="new"?At.style.display="block":At.style.display="none"}),Y.addEventListener("change",()=>{Y.value==="new"?Rt.style.display="block":Rt.style.display="none"}),ce.addEventListener("change",()=>{ce.value==="new"?$t.style.display="block":$t.style.display="none"}),Wn.onclick=function(){gt.style.display="none"},Hn.onclick=function(){gt.style.display="block"},qn.onclick=function(){let o="";if(ke.value==="new"){if(o=Kn.value,o===null||o===""){alert("Please enter a name for the collection");return}}else o=ke.value;const c=localStorage.getItem("selectedTaskCollection");let u;if(c){const i=localStorage.getItem(`taskCollection_${c}`);i&&(u=JSON.parse(i),o!==c&&(u.name=o,localStorage.setItem(`taskCollection_${o}`,JSON.stringify(u))))}const s=document.createElement("option");s.value=o,s.textContent=o,le.appendChild(s),gt.style.display="none",alert(`Collection ${o} saved`),t()},Un.onclick=function(){const o=le.value;localStorage.setItem("selectedTaskCollection",o),O()},Yn.onclick=function(){const o=le.value;if(o==="default"){alert("You cannot delete the default collection");return}confirm(`Are you sure you want to delete the collection ${o}?`)&&(localStorage.removeItem(`taskCollection_${o}`),t(),O())},Qn.onclick=function(){const o=document.createElement("input");o.type="file",o.accept=".json",o.multiple=!0,o.onchange=async function(c){const u=c.target.files;if(u)for(let s=0;s<u.length;s++){const i=u[s],b=new FileReader;b.onload=function(g){var v;const k=(v=g.target)==null?void 0:v.result;k&&(JSON.parse(k).forEach(w=>{const A=w.name;localStorage.getItem(`taskCollection_${A}`)?window.confirm(`Task collection ${A} already exists. Do you want to override it?`)&&localStorage.setItem(`taskCollection_${A}`,JSON.stringify(w)):localStorage.setItem(`taskCollection_${A}`,JSON.stringify(w))}),t())},b.readAsText(i)}},o.click()},eo.onclick=function(){const o=Object.keys(localStorage).filter(k=>k.includes("taskCollection_")),c=[];o.forEach(k=>{const v=localStorage.getItem(k);v&&c.push(JSON.parse(v))});const u=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),s=URL.createObjectURL(u),i=document.createElement("a");i.href=s;const g=new Date().toISOString().split("T")[0];i.download=`availableTasks_${g}.json`,i.click(),URL.revokeObjectURL(s)},wo.addEventListener("click",function(o){const c=o.target;if(c.tagName==="BUTTON"){const u=c.id;n(u)}});function n(o){const c=document.getElementById(o),u=c==null?void 0:c.cloneNode(!0);u.classList.add("emulated-button-list"),u.removeAttribute("id");const s="emulated-"+Date.now();u.setAttribute("data-emulated-id",s),de==null||de.appendChild(u)}function e(){Ce.innerHTML="",ce.innerHTML="",nt.innerHTML="",Object.keys(localStorage).filter(i=>i.includes("savedJob_")).sort().forEach(i=>{const b=i.replace("savedJob_",""),g=document.createElement("option");g.value=b,g.textContent=b,Ce.appendChild(g),ce.appendChild(g.cloneNode(!0)),nt.appendChild(g.cloneNode(!0))});const c=localStorage.getItem("loadedJobName");let u=!1;if(c){for(let i=0;i<Ce.options.length;i++)if(Ce.options[i].value===c){u=!0;break}}!c||!u?Ce.selectedIndex=0:Ce.value=c;const s=document.createElement("option");s.value="new",s.textContent="--new collection--",ce.appendChild(s.cloneNode(!0))}function t(){le.innerHTML="",Y.innerHTML="",ke.innerHTML="";const o=document.createElement("option");o.value="default",o.textContent="default",le.appendChild(o),Y.appendChild(o.cloneNode(!0)),ke.appendChild(o.cloneNode(!0)),Object.keys(localStorage).filter(i=>i.includes("taskCollection_")).sort().forEach(i=>{if(i==="taskCollection_default")return;const b=i.replace("taskCollection_",""),g=document.createElement("option");g.value=b,g.textContent=b,le.appendChild(g),Y.appendChild(g.cloneNode(!0)),ke.appendChild(g.cloneNode(!0))});const u=localStorage.getItem("selectedTaskCollection");u&&(le.value=u);const s=document.createElement("option");s.value="new",s.textContent="--new collection--",Y.appendChild(s.cloneNode(!0)),ke.appendChild(s.cloneNode(!0))}ko.onclick=function(){Ft.style.display="none"},et.addEventListener("click",()=>{!tt&&z&&z.connect()});function a(o){if(!z)return;const u=z.getStatus().condition==="run";if(u){if(u){const s=o.match(/F(\d+)/);s&&(Jt=parseInt(s[1],10),So.innerText=Jt.toString()),Eo.innerText=o,Bo.style.display="block",Co.style.display="block"}}}function r(){if(!z)return;const o=z.getStatus();if(o.isConnected===!1){et.innerText="Connect",tt=!1;return}else tt=!0,et.innerText="Connected",et.disabled=!0;const c=o.condition==="run";c?c&&(kt.disabled=!0,st.innerText="Task in progress",ze.style.display="none"):(ze.style.display="block",ze.disabled=!1,st.innerText="Task completed"),Ct.value=o.progress,Ct.style.display="block",st.style.display="block"}Mt([de,Bt],{copy:!1,accepts:(o,c)=>c===Bt||c===de,revertOnSpill:!0,removeOnSpill:!1}).on("drop",(o,c)=>{if(c===Bt){o.remove();const u=o.getAttribute("data-emulated-id"),s=de.querySelector(`[data-emulated-id="${u}"]`);s&&s.remove()}});const y=Mt([ie,j,mt],{copy:(o,c)=>c===ie,accepts:(o,c)=>c===j||c===mt,revertOnSpill:!0,removeOnSpill:!1});y.on("dragend",()=>{x(),M(),I()});function I(o="currentJob"){const c=j.querySelectorAll(".task-to-execute"),u=[];c.forEach(s=>{const i=s.getAttribute("data-task-id"),b=s.getAttribute("data-collection-name");u.push({id:i,collectionName:b})}),localStorage.setItem(o,JSON.stringify(u))}function L(o="currentJob"){const c=localStorage.getItem(o);let u=[];if(c){try{u=JSON.parse(c)}catch{console.warn("Error parsing job data, clearing job data..."),localStorage.setItem(o,JSON.stringify([])),localStorage.setItem("currentJob",JSON.stringify([]))}const s=[];u=u.filter(i=>localStorage.getItem(`taskCollection_${i.collectionName}`)?!0:(s.push(i),!1)),localStorage.setItem("currentJob",JSON.stringify(u)),localStorage.setItem(o,JSON.stringify(u)),j.innerHTML="",u.forEach(i=>{const b=localStorage.getItem(`taskCollection_${i.collectionName}`);if(b){const k=JSON.parse(b).tasks.find(v=>v.id===i.id);if(k){const v=document.createElement("div");v.classList.add(`task-${k.type}`),v.classList.add("task-to-execute"),v.setAttribute("data-task-id",k.id),v.setAttribute("data-task-name",k.name),v.setAttribute("data-collection-name",i.collectionName),v.textContent=k.name,j.appendChild(v)}}}),s.length>0&&alert(`The following tasks were removed because their collection does not exist: ${s.map(i=>i.id).join(", ")}`)}}y.on("drop",(o,c,u)=>{const s=o.getAttribute("data-task-id"),i=o.getAttribute("data-task-order");if(c===j)o.classList.remove("available-task"),o.classList.add("task-to-execute"),M();else if(c===mt){o.remove();let b=null;if(u===j)b=j.querySelector(`[data-task-order="${i}"]`);else if(u===ie&&(b=ie.querySelector(`[data-task-id="${s}"]`),b)){const g=b.getAttribute("data-collection-name"),k=localStorage.getItem(`taskCollection_${g}`);if(k){const v=JSON.parse(k);v.tasks=v.tasks.filter(N=>N.id!==s),localStorage.setItem(`taskCollection_${g}`,JSON.stringify(v))}}b&&b.remove()}});function M(){j.querySelectorAll(".task-to-execute").forEach(c=>{if(c.querySelector("i")){let u=c.querySelector("i");u&&(u.remove(),u=document.createElement("i"),c.classList.contains("task-manual")?(u.className="fas fa-users-cog icon-tooltip",u.setAttribute("data-tooltip","Manual Task")):c.classList.contains("task-gcode")?(u.className="fas fa-code icon-tooltip",u.setAttribute("data-tooltip","Gcode Task")):c.classList.contains("task-emulation")&&(u.className="far fa-keyboard icon-tooltip",u.setAttribute("data-tooltip","Emulation Task")),c.appendChild(u))}else{const u=document.createElement("i");c.classList.contains("task-manual")?(u.className="fas fa-users-cog icon-tooltip",u.setAttribute("data-tooltip","Manual Task")):c.classList.contains("task-gcode")?(u.className="fas fa-code icon-tooltip",u.setAttribute("data-tooltip","Gcode Task")):c.classList.contains("task-emulation")&&(u.className="far fa-keyboard icon-tooltip",u.setAttribute("data-tooltip","Emulation Task")),c.appendChild(u)}})}function O(){ie.innerHTML="";let o=localStorage.getItem("selectedTaskCollection");(o===null||o==="")&&(o=le.value,localStorage.setItem("selectedTaskCollection",o));const c=localStorage.getItem(`taskCollection_${o}`);c&&JSON.parse(c).tasks.forEach(s=>{s.id,s.name,s.type,s.description,s.gcode&&s.gcode,s.buttonKeys&&s.buttonKeys;const i=document.createElement("div");i.classList.add(`task-${s.type}`),i.classList.add("available-task"),i.setAttribute("data-task-id",s.id.toString()),i.setAttribute("data-task-name",s.name),i.setAttribute("data-collection-name",o||""),i.textContent=s.name;const b=document.createElement("i");b.classList.add("fas","fa-info-circle","fa-fw","show-info","icon-tooltip"),b.setAttribute("data-tooltip","Click for more info..."),i.appendChild(b),ie.appendChild(i)})}function x(){const o=document.getElementById("tasksToExecute");o&&o.querySelectorAll("div").forEach((u,s)=>{const i=u.getAttribute("data-task-name");u.setAttribute("data-task-order",(s+1).toString()),u.textContent=`Task ${s+1}: ${i}`})}re.addEventListener("change",()=>{re.value==="manual"?(V.disabled=!0,V.placeholder="Disabled for manual tasks",V.value="",Oe.style.display="none",_e.style.display="none"):re.value==="emulation"?(V.disabled=!0,V.placeholder="Disabled for emulation tasks",V.value="",Oe.style.display="none",_e.style.display="block"):(_e.style.display="none",Oe.style.display="block",V.placeholder="Enter gcode here...",V.disabled=!1)}),jn.addEventListener("click",()=>{we.style.display="block",Pt.textContent="Add a new task",Fe.value="",ft.value="",V.value="",ht.value="",we.removeAttribute("data-task-id"),Y.value=""}),Gn.addEventListener("click",()=>{if(Y.value===""){alert("Please select a collection.");return}if(Y.value==="new"&&ht.value===""){alert("Please enter a collection name");return}if(Fe.value===""||Fe.value===null){alert("Please enter a task name");return}const o=Fe.value,c=document.createElement("div");c.classList.add(`task-${re.value}`),c.classList.add("available-task");let u;const s=we.getAttribute("data-task-id");s?u=s:u=Fn(),c.setAttribute("data-task-id",u.toString()),c.setAttribute("data-task-name",o),c.textContent=o;const i=document.createElement("i");i.classList.add("fas","fa-info-circle","fa-fw","show-info","icon-tooltip"),i.setAttribute("data-tooltip","Click for more info..."),c.appendChild(i);const b=ie.querySelector(`[data-task-id="${u}"]`);b&&b.remove(),ie.appendChild(c),we.style.display="none";let g="";re.value==="emulation"&&(de.querySelectorAll(".emulated-button-list").forEach(N=>{const w=N.getAttribute("data-button-key");g+=w+","}),g.length>0&&(g=g.slice(0,-1)));const k={id:u,name:o,type:re.value,description:ft.value};if(re.value==="gcode"&&(k.gcode=V.value),re.value==="emulation"&&(k.buttonKeys=g),Y.value==="new"){const v=ht.value,N={name:v,tasks:[]};N.tasks.push(k),localStorage.setItem(`taskCollection_${v}`,JSON.stringify(N));const w=document.createElement("option");w.value=v,w.textContent=v,le.appendChild(w),t()}else{const v=Y.value,N=localStorage.getItem(`taskCollection_${v}`);if(N){const w=JSON.parse(N);w.tasks.find(me=>me.id===u)&&(w.tasks=w.tasks.filter(me=>me.id!==u)),w.tasks.push(k),localStorage.setItem(`taskCollection_${v}`,JSON.stringify(w))}else{const w={name:v,tasks:[]};w.tasks.push(k),localStorage.setItem(`taskCollection_${v}`,JSON.stringify(w))}}O()}),ie.addEventListener("click",o=>{const c=o.target;if(c.matches(".show-info")){const s=c.parentNode.getAttribute("data-task-id");let i=null;const b=localStorage.getItem("selectedTaskCollection"),g=localStorage.getItem(`taskCollection_${b}`);if(g){const v=JSON.parse(g).tasks.find(N=>N.id===s);v&&(i=v)}i&&(we.style.display="block",Fe.value=i.name,re.value=i.type,ft.value=i.description,V.value=i.gcode||"",Y.value=b||"default",Pt.textContent="Edit Task",i.type==="emulation"?(_e.style.display="block",Oe.style.display="none",de.innerHTML="",(i.buttonKeys??"").split(",").forEach(v=>{const N=document.createElement("button");N.classList.add("emulated-button-list"),N.classList.add("material-symbols-outlined"),N.setAttribute("data-button-key",v),N.textContent=Yt.getButtonName(v),N.textContent.length===1&&N.classList.add("standard-font"),de.appendChild(N)})):i.type==="gcode"?(_e.style.display="none",Oe.style.display="block",V.disabled=!1,V.placeholder="Enter gcode here..."):(_e.style.display="none",Oe.style.display="none"),s&&we.setAttribute("data-task-id",s.toString()))}}),zn.onclick=function(){we.style.display="none"},bo.onclick=function(){Zt.style.display="none"};function S(){if(je.length===0){Zt.style.display="block";return}kt.disabled=!1;const o=je.shift();if(o&&o.type==="manual")po.textContent=`Task ${o.order}: ${o.name}`,ho.value=o.description,bt.style.display="block";else if(o&&o.type==="gcode"){vo.textContent=`Task ${o.order}: ${o.name}`,Dt.value=o.gcode??"",ot.style.display="block";const c=ot.querySelector(".task-modal-content");c&&(c.style.backgroundColor=""),ze.disabled=!0,Ct.style.display="none",st.style.display="none"}else o&&o.type==="emulation"&&(To.style.display="block")}mo.onclick=function(){bt.style.display="none",je.length=0,Et.style.display="block"},go.onclick=function(){ot.style.display="none",je.length=0,Et.style.display="block",z==null||z.stop()},fo.onclick=function(){bt.style.display="none",S()},ze.onclick=function(){ot.style.display="none",S()},kt.onclick=function(){z&&z.start(Dt.value)},yo.onclick=function(){Et.style.display="none"},no.onclick=function(){if(!tt){Ft.style.display="block";return}j.querySelectorAll(".task-to-execute").forEach(c=>{const u=c.getAttribute("data-task-id"),s=c.getAttribute("data-task-order"),i=c.getAttribute("data-collection-name"),b=localStorage.getItem(`taskCollection_${i}`);let g=null;if(b){const v=JSON.parse(b).tasks.find(N=>N.id===u);v&&(g=v)}g&&(g.order=parseInt(s||"0"),je.push(g))}),S()},oo.onclick=function(){pt.style.display="block";const o=localStorage.getItem("loadedJobName");o&&(ce.value=o),ce.options.length===0&&(vt.style.display="block")},so.onclick=function(){let o=ce.value==="new"?vt.value:ce.value;if(o===""||o===null){alert("Please enter a name for the job");return}localStorage.getItem(`savedJob_${o}`)&&!confirm("A job with this name already exists. Do you want to overwrite it?")||(I(`savedJob_${o}`),e(),pt.style.display="none",vt.value="",alert(`${o} saved`))},to.onclick=function(){pt.style.display="none"},co.onclick=function(){yt.style.display="none"},ao.onclick=function(){j.innerHTML="";const o=Ce.value,c=localStorage.getItem(`savedJob_${o}`);c&&(JSON.parse(c).forEach(s=>{const i=localStorage.getItem(`taskCollection_${s.collectionName}`);if(i){const g=JSON.parse(i).tasks.find(k=>k.id===s.id);if(g){const k=document.createElement("div");k.classList.add(`task-${g.type}`),k.classList.add("task-to-execute"),k.setAttribute("data-task-id",g.id.toString()),k.setAttribute("data-task-name",g.name),k.setAttribute("data-collection-name",s.collectionName),k.textContent=g.name,j.appendChild(k)}}}),localStorage.setItem("currentJob",c)),localStorage.setItem("loadedJobName",o),x(),M()},io.onclick=function(){const o=Ce.value;localStorage.removeItem(`savedJob_${o}`),e(),M()},ro.onclick=function(){const o=document.createElement("input");o.type="file",o.accept=".json",o.multiple=!0,o.onchange=function(c){const u=c.target.files;if(u){j.innerHTML="";const s=Array.from(u).map(i=>new Promise((b,g)=>{const k=new FileReader;k.onload=function(v){var w;const N=(w=v.target)==null?void 0:w.result;if(N){const A=JSON.parse(N);localStorage.setItem("loadedJobName",A.name),localStorage.setItem(`savedJob_${A.name}`,JSON.stringify(A.tasks)),b(A.name)}else g(new Error("No contents"))},k.readAsText(i)}));Promise.all(s).then(i=>{L(`savedJob_${i[i.length-1]}`),x(),M(),O(),e()}).catch(i=>{console.error("Error reading files:",i)})}},o.click()},lo.onclick=function(){yt.style.display="block";const o=localStorage.getItem("loadedJobName");o&&(nt.value=o)},uo.onclick=function(){const o=nt.value,c=localStorage.getItem(`savedJob_${o}`);if(c){const u=JSON.parse(c),s={name:o,tasks:[]};u.forEach(k=>{const v=localStorage.getItem(`taskCollection_${k.collectionName}`);if(v){const w=JSON.parse(v).tasks.find(A=>A.id===k.id);w&&s.tasks.push({id:w.id,collectionName:k.collectionName})}});const i=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),b=URL.createObjectURL(i),g=document.createElement("a");g.href=b,g.download=`${s.name}.json`,g.click(),URL.revokeObjectURL(b),yt.style.display="none"}}});const R=ace.edit("gcodeEditor"),ue=ace.edit("gcodeResponseEditor"),D=ace.edit("gcodeSenderEditor");let Te={z:0,x:0};const Io="#DC143C",Lo="#6B8E23",No="#FFA500",xo="#242424";document.addEventListener("DOMContentLoaded",()=>{new an;const n=document.getElementById("gcodeCanvas"),e=document.getElementById("zoomCanvas");let t=null;const a=document.getElementById("fileInput"),r=document.getElementById("simulateButton"),d=document.getElementById("showCuts"),y=document.getElementById("showNonCuts"),I=document.getElementById("showCutsZoom"),L=document.getElementById("showNonCutsZoom"),M=document.getElementById("sliderLabel"),O=document.getElementById("zoomSliderLabel"),x=document.getElementById("progressSlider"),S=document.getElementById("zoomProgressSlider"),o=document.getElementById("sliderContainer"),c=document.getElementById("displayOptionsContainer"),u=document.getElementById("clearButton"),s=document.querySelector(".saveGCodeNameInput"),i=document.querySelector(".loadGCodeSelect"),b=document.querySelector(".loadGCodeButton"),g=document.querySelector(".saveGCodeButton"),k=document.querySelector(".deleteGCodeButton"),v=document.getElementById("gcodeSenderContainer"),N=document.getElementById("exampleCode"),w=document.getElementById("helpModal"),A=document.getElementById("helpButton"),me=document.getElementById("closeHelpModal"),W=document.getElementById("zoomModal"),it=document.getElementById("zoomButton"),rt=document.getElementById("closeZoomModal"),Ve=document.getElementById("zoomCloseButton"),lt=document.getElementById("simulationTab"),He=document.getElementById("controlTab"),qe=document.getElementById("macroTab"),Pe=document.getElementById("plannerTab"),Ue=document.getElementById("threadingTab"),fe=document.getElementById("simulationContainer"),he=document.getElementById("controlsContainer"),ne=document.getElementById("macroContainer"),K=document.getElementById("plannerContainer"),ge=document.getElementById("threadingContainer"),Le=document.querySelectorAll("#latheControls .increment-btn"),ct=document.getElementById("moveDistance");localStorage.getItem("helpModalShown")||(w.style.display="block",localStorage.setItem("helpModalShown","true")),Le.forEach(function(m){m.addEventListener("click",function(){Le.forEach(function(E){E.classList.remove("active")}),this.classList.add("active");var h=this.dataset.increment;ct.value=h,console.log("Jog increment set to:",h)})}),lt.addEventListener("click",()=>{fe.style.display="flex",he.style.display="none",ne.style.display="none",K.style.display="none",ge.style.display="none"}),He.addEventListener("click",()=>{fe.style.display="none",he.style.display="flex",ne.style.display="none",K.style.display="none",ge.style.display="none"}),qe.addEventListener("click",()=>{fe.style.display="none",he.style.display="none",ne.style.display="flex",K.style.display="none",ge.style.display="none"}),Pe.addEventListener("click",()=>{fe.style.display="none",he.style.display="none",ne.style.display="none",K.style.display="flex",ge.style.display="none";const m=new Event("containerVisible");K.dispatchEvent(m)}),Ue.addEventListener("click",()=>{fe.style.display="none",he.style.display="none",ne.style.display="none",K.style.display="none",ge.style.display="flex"}),e.width=window.visualViewport.width-100,e.height=window.visualViewport.height-150,window.addEventListener("resize",function(){e.width=window.visualViewport.width-100,e.height=window.visualViewport.height-150,S.value=S.min,P(e)}),it.onclick=function(){W.style.display="block",P(e)},rt.onclick=function(){W.style.display="none"},Ve.onclick=function(){W.style.display="none"},A.onclick=function(){w.style.display="block"},me.onclick=function(){w.style.display="none"},window.onclick=function(m){m.target==w&&(w.style.display="none"),m.target==W&&(W.style.display="none")},g.addEventListener("click",()=>X()),b.addEventListener("click",()=>ve()),k.addEventListener("click",()=>J()),H(),R.setTheme("ace/theme/github_dark"),R.session.setMode("ace/mode/plain_text"),R.setShowPrintMargin(!1),D.setTheme("ace/theme/github_dark"),D.session.setMode("ace/mode/plain_text"),D.setShowPrintMargin(!1),N.addEventListener("click",()=>Kt()),ue.setTheme("ace/theme/monokai"),ue.session.setMode("ace/mode/text"),ue.setReadOnly(!0),ue.setShowPrintMargin(!1),ue.getSession().on("change",()=>{setTimeout(()=>{var m=ue.getSession().getLength();ue.scrollToLine(m,!0,!0,function(){})},0)}),D.on("focus",()=>{D.getValue()==="Paste your gcode here or click choose file to upload"&&D.setValue("")}),$();let Ee=0,Be=0,pe=0,oe=0,Ne=0,Je=0,l=5,f=0,C=0,p=[];x.oninput=()=>{const m=Math.floor(parseInt(x.value));if(m<p.length){const h=p[m];let E=Re(p,n);Ae(n,p,E,m),F(h)}},S.oninput=()=>{const m=Math.floor(parseInt(S.value));if(m<p.length){const h=p[m];let E=Re(p,e);Ae(e,p,E,m),se(h)}},u.addEventListener("click",()=>{D.setValue(""),R.setValue(""),$();const m=n.getContext("2d");m&&(m.clearRect(0,0,n.width,n.height),a.value="",x.value="0",S.value="0",o.style.display="none",c.style.display="none")}),a.addEventListener("change",m=>{if(m.target instanceof HTMLInputElement&&m.target.files&&m.target.files.length>0){const h=m.target.files[0];h&&Q(h)}}),r.addEventListener("click",()=>{P(n)});function P(m){if(!m)return;const h=R.getValue();if(h){dt(h);let E=Re(p,m);Ae(m,p,E),o.style.display="block",c.style.display="block",d.addEventListener("change",Ye),y.addEventListener("change",Ye),I.addEventListener("change",We),L.addEventListener("change",We),x.max=(p.length-1).toString(),x.value=x.min,S.max=(p.length-1).toString(),S.value=S.min,v.style.display="block"}}function X(){const m=s.value.trim();if(!m)return;const h=`gCode-${m}`;localStorage.setItem(h,R.getValue()),H(h),s.value=""}function ve(){const m=i.value,h=localStorage.getItem(m);h&&(R.setValue(h),D.setValue(h))}function J(){const m=i.value;localStorage.removeItem(m),H()}function H(m){i.innerHTML="";let h=!1;for(let E=0;E<localStorage.length;E++){const T=localStorage.key(E);if(T&&T!=="latheCode"&&T.startsWith("gCode-")){h=!0;const _=document.createElement("option"),Z=T.replace("gCode-","");_.value=T,_.textContent=Z,i.appendChild(_),T===m&&(_.selected=!0)}}if(h){const E=Array.from(i.options).sort((T,_)=>T.text.localeCompare(_.text));i.innerHTML="",E.forEach(T=>{i.appendChild(T)})}else{const E=document.createElement("option");E.textContent="No items saved",E.disabled=!0,i.appendChild(E)}}function $(){const m=R.getValue(),h=D.getValue();m===""&&(R.setValue("Paste your gcode here or click choose file to upload"),R.gotoLine(1,0),R.on("focus",function(){R.getValue()==="Paste your gcode here or click choose file to upload"&&R.setValue("")})),h===""&&(D.setValue("Paste your gcode here or click choose file to upload"),D.gotoLine(1,0),D.on("focus",function(){D.getValue()==="Paste your gcode here or click choose file to upload"&&D.setValue("")}))}function F(m){var h,E,T;(m==null?void 0:m.lineNumber)!==void 0?(R.gotoLine(m.lineNumber,0,!0),M.innerHTML=`Line:${m.lineNumber}<br>${m==null?void 0:m.originalLine}<br>Abs: X${((h=m.absolutePosition)==null?void 0:h.x)??0} &lpar;Dia: ${(((E=m.absolutePosition)==null?void 0:E.x)??0)*2}&rpar; Z${(T=m.absolutePosition)==null?void 0:T.z}`||""):M.innerHTML=""}function se(m){var h,E,T;(m==null?void 0:m.lineNumber)!==void 0?(R.gotoLine(m.lineNumber,0,!0),O.innerHTML=`Line:${m.lineNumber}<br>${m==null?void 0:m.originalLine}<br>Abs: X${(h=m.absolutePosition)==null?void 0:h.x} &lpar;Dia: ${(((E=m.absolutePosition)==null?void 0:E.x)??0)*2}&rpar; Z${(T=m.absolutePosition)==null?void 0:T.z}`||""):O.innerHTML=""}function Q(m){const h=new FileReader;h.onload=E=>{const T=E.target.result;R.setValue(T),D.setValue(T)},h.readAsText(m)}function dt(m){const h=[];let E=!1;return p=[],m.split(`
`).forEach((_,Z)=>{const ae=_.includes("; cut")?0:_.includes("; retract")?2:1,q={isRelative:E,movementType:ae},Se=_.match(/([GXYZF])([0-9.-]+)/g);Se==null||Se.forEach(Ke=>{const ee=parseFloat(Ke.slice(1));switch(Ke[0]){case"G":ee===90&&(q.isRelative=!1,E=!1),ee===91&&(q.isRelative=!0,E=!0);break;case"X":q.x=parseFloat(ee.toFixed(3)),E?Te.x=parseFloat((Te.x+ee).toFixed(3)):Te.x=parseFloat(ee.toFixed(3));break;case"Z":q.z=parseFloat(ee.toFixed(3)),E?Te.z=parseFloat((Te.z+ee).toFixed(3)):Te.z=parseFloat(ee.toFixed(3));break}});const xe={...q,lineNumber:Z+1,originalLine:_,absolutePosition:{...Te}};(q.z!==void 0||q.x!==void 0)&&p.push(xe),h.push(xe)}),h}function Ye(){I.checked=d.checked,L.checked=y.checked,x.value="0";const m=Re(p,n);Ae(n,p,m,p.length)}function We(){d.checked=I.checked,y.checked=L.checked,S.value="0";const m=Re(p,e);Ae(e,p,m,p.length)}function Re(m,h){let E=0,T=0,_=m.find(U=>!U.isRelative),Z=_&&_.x?_.x:0,ae=_&&_.z?_.z:0;const q=5;m.forEach(U=>{U.x!==void 0&&(U.isRelative?(Z+=U.x,Z<T&&(T=Z)):U.x<T&&(T=U.x)),U.z!==void 0&&(U.isRelative?(ae+=U.z,ae>E&&(E=ae)):U.z>E&&(E=U.z))});const Se=Math.abs(T),xe=Math.abs(E),Ke=h.height/2-q,ee=h.width-q-l,Qt=Ke/Se,en=ee/xe;return Math.min(Qt,en)}function Ae(m,h,E,T){if(t=m.getContext("2d"),!t)return;t.clearRect(0,0,m.width,m.height),Ee=0,Be=0,Ne=0,Je=0,pe=0,oe=0,pe=m.height/2,oe=m.width-l;const _=T!==void 0?Math.min(T+1,h.length):h.length;for(let Z=0;Z<_;Z++)Wt(m,h[Z],E,Z===T)}function Wt(m,h,E,T){if(t=m.getContext("2d"),!t)return;let _=d.checked||I.checked,Z=y.checked||L.checked;t.lineWidth=2,h.isRelative?(Ee+=h.x??0,Be+=h.z??0):(Ee=h.x??Ne,Be=h.z??Je,Ne=Ee,Je=Be),f=m.height/2-Ee*E,C=m.width-Be*E-l;let ae="";if((h.movementType==0&&_||h.movementType==1&&Z||h.movementType==2&&Z)&&(t.beginPath(),ae=h.movementType==0?Io:h.movementType==1?Lo:No,t.moveTo(oe,pe),t.lineTo(C,f),T?(t.strokeStyle=ae,t.setLineDash([5,5]),t.lineDashOffset=0,t.stroke(),t.strokeStyle=xo,t.setLineDash([5,5]),t.lineDashOffset=-5,t.stroke()):(t.strokeStyle=ae,t.setLineDash([]),t.stroke()),T)){let q=C-oe,Se=f-pe,xe=Math.atan2(Se,q);t.save(),t.translate(oe,pe),t.rotate(xe+Math.PI/2),t.beginPath(),t.moveTo(0,-5),t.lineTo(-5,5),t.lineTo(5,5),t.closePath(),t.fillStyle="green",t.fill(),t.restore(),t.beginPath(),t.rect(C-3,f-3,6,6),t.fillStyle="red",t.fill()}pe=f,oe=C}function Kt(){R.setValue(rn)}});

</script>
  <style>
:root{font-family:Inter,system-ui,Avenir,Helvetica,Arial,sans-serif;line-height:1.5;font-weight:400;color-scheme:light dark;color:#ffffffde;background-color:#202124;font-synthesis:none;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}a{font-weight:500;color:#646cff;text-decoration:inherit}a:hover{color:#535bf2}h1{font-size:3.2em;line-height:1.1}#app{max-width:1280px;margin:0 auto;padding:2rem;text-align:center}.logo{height:6em;padding:1.5em;will-change:filter;transition:filter .3s}.logo:hover{filter:drop-shadow(0 0 2em #646cffaa)}.logo.vanilla:hover{filter:drop-shadow(0 0 2em #3178c6aa)}.card{padding:2em}.read-the-docs{color:#888}button{border-radius:3px;padding:.6em 1.2em;font-size:1em;font-weight:500;font-family:inherit;background-color:#1a1a1a;cursor:pointer;transition:background-color .25s;border:2px solid white;color:#fff}button:hover{background-color:#646cff}button:focus,button:focus-visible{outline:4px auto -webkit-focus-ring-color}#simulationContainer{display:flex;flex-direction:column;width:800px;max-width:1280px;text-align:center}.main-container{display:flex;width:100%}#controlsContainer{display:flex;flex-direction:column;width:800px;max-width:1280px;text-align:center}.controls-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;border:1px solid #ccc}.canvas-container{display:flex;flex-direction:column;align-items:center;margin:5px;border:1px solid #ccc}.canvas-wrapper{display:flex;flex-direction:column;align-items:center}.innerContainer{margin:5px;align-items:center;width:auto}.modal-pad{padding-top:10px}.modal-pad-bottom{padding-bottom:10px}.emulation-modal-pad-border{padding:10px;border:2px dashed green;min-height:40px}.innerContainer.toolbar{display:flex;align-items:center;gap:5px;padding:2px}.saveGCodeNameInput,.loadGCodeSelect{flex-grow:1}#gcodeCanvas{border-bottom:1px solid #ccc;background-color:#242424}#gcodeInput{position:relative;background:transparent;width:100%;height:240px;font-family:monospace;font-size:13px;line-height:1.5;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}#gcodeContainer{position:relative;width:100%}#gcodeSenderContainer{display:block}.save-group,.load-group,.import-export-group{display:flex;flex-direction:row;align-items:center;gap:10px}.toolbar input[type=text],.toolbar select{max-width:200px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem;font-size:1rem;line-height:1.5}input[type=file]::file-selector-button{border:2px solid #6c5ce7;padding:.2em .4em;border-radius:.2em;background-color:#1a1a1a;transition:.25s}input[type=file]::-ms-browse:hover{background-color:#646cff}input[type=file]::-webkit-file-upload-button:hover{background-color:#646cff}input[type=file]::file-selector-button:hover{background-color:#646cff}.bottom-container{margin:5px}#gcodeResponseContainer{border:1px solid #ccc;width:100%;display:flex;flex-direction:column;align-items:center;margin-top:5px}.senderError{display:none;color:#fff;background-color:red;padding:10px;border-radius:5px;animation:flashError 1s infinite}@keyframes flashError{0%,to{opacity:1}50%{opacity:0}}#helpText li{margin-bottom:10px}#helpText a{color:#f95959}.help-modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.help-modal-content{position:relative;background-color:#242424;margin:15% auto;padding:20px;border:2px solid #6c5ce7;width:30%}.zoom-modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#242424}.zoom-modal-content{display:flex;flex-direction:column;align-items:center;margin:10px auto;padding:20px;border:1px solid #888}.close-modal{position:absolute;top:0;right:0;padding-right:10px;cursor:pointer;font-size:35px}#sliderAndButtonContainer{display:flex;justify-content:center;align-items:center;gap:10px;flex-direction:column}.text-red{color:#dc143c}.text-green{color:#6b8e23}.text-orange{color:orange}.line{display:inline-block;vertical-align:middle;width:20px;height:2px;margin-right:5px}.red-line{border-top:2px solid #DC143C}.green-line{border-top:2px solid #6B8E23}.orange-line{border-top:2px solid #FFA500}#latheControls #jogControls{display:grid;grid-template-columns:repeat(10,60px);grid-template-rows:repeat(6,60px);justify-content:center;align-items:center;place-items:center}#latheControls .jog-btn,#latheControls .tool-btn{width:50px;height:50px;border-radius:5px;cursor:pointer;background-color:#f0ad4e;display:flex;justify-content:center;align-items:center;text-align:center;line-height:50px;font-size:24px;padding:0}#latheControls .tool{background-color:#f0ad4e;border:none}#latheControls .tool-selected{background-color:#6c5ce7;border:2px solid white}#latheControls .fast{background-color:#f0ad4e}#latheControls .slow{background-color:#5bc0de}#latheControls .jog-btn:hover{background-color:#6c5ce7}#jogText{grid-column:6;grid-row:1}#fastForward{grid-column:6;grid-row:2}#fastText{grid-column:5;grid-row:2}#slowText{grid-column:5;grid-row:3}#fastLeft{grid-column:4;grid-row:4}#fastBackward{grid-column:6;grid-row:6}#fastRight{grid-column:8;grid-row:4}#slowForward{grid-column:6;grid-row:3}#slowLeft{grid-column:5;grid-row:4}#slowBackward{grid-column:6;grid-row:5}#slowRight{grid-column:7;grid-row:4}#toolText{grid-column:1;grid-row:1}#tool0{grid-column:1;grid-row:2}#tool1{grid-column:1;grid-row:3}#tool2{grid-column:1;grid-row:4}#tool3{grid-column:1;grid-row:5}#tool4{grid-column:1;grid-row:6}#tool5{grid-column:2;grid-row:2}#tool6{grid-column:2;grid-row:3}#tool7{grid-column:2;grid-row:4}#tool8{grid-column:2;grid-row:5}#tool9{grid-column:2;grid-row:6}.menu ul{list-style-type:none;padding:0}.menu li{cursor:pointer;padding:10px;background-color:#242424;border-bottom:1px solid #6c5ce7}.menu li:hover{background-color:#6c5ce7}.content{margin-left:200px;padding:20px}#senderProgressContainer{display:flex;justify-content:center;align-items:center}#senderProgressLabel{margin-right:10px}.innerContentCentre{display:flex;justify-content:center;align-items:center;margin:10px}#gcodeSenderContainer{position:relative;width:100%}#latheControls #incrementControls{display:flex;justify-content:center;gap:10px;margin:20px 0}#latheControls .increment-btn{padding:5px 10px;border:1px solid #ccc;background-color:#f0ad4e;border-radius:5px;cursor:pointer;transition:background-color .3s}#latheControls .increment-btn:hover,#latheControls .increment-btn.active{background-color:#6c5ce7}.control-inputs input[type=text]{max-width:200px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem}.control-inputs label{display:block;margin-right:5px}.sender-inputs input[type=text]{max-width:350px;min-width:350px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem}#latheControls label{white-space:nowrap;margin-right:10px;display:inline-block;min-width:120px}.planner-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;width:800px;max-width:1280px;text-align:center;border:1px solid #ccc}.planner-container h1{margin:10px 0}.planner-guidance{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:10px;text-align:center}.planner-guidance span{display:block;margin:10px 0;text-align:left}#taskContainer{display:flex;justify-content:space-between;align-items:start;padding:20px}.container-wrapper{padding:10px}.container-wrapper-inner{padding:5px 0}.container-wrapper-outer{border:1px solid #ccc;border-radius:5px;margin:10px;background-color:#333}.container-wrapper-delete{min-height:50px;display:flex;justify-content:center;align-items:center;border:2px dashed red}#availableTasks{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;align-items:start;min-width:450px}#availableTasks .span-2-rows{grid-row:span 3;height:100%}#availableTasks div{box-sizing:border-box;padding:5px}#tasksToExecute{min-height:50px;padding:5px;border:2px dashed green}#tasksToExecute div{margin:5px}.task-to-execute{text-align:left}.task-to-execute i{text-align:left;margin-left:5px;cursor:help}.available-task{width:150px;-webkit-user-select:none;user-select:none}.available-task i{margin-left:5px;cursor:help}.task-manual{background-color:#4c956c}.task-gcode{background-color:#386e97}.task-emulation{background-color:#e74c3c}.emulate-noselect{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#emulationInnerContainer{display:flex;flex-direction:row;justify-content:center;align-items:center;height:100%}#emulationNewTasksMovement{display:grid;grid-template-columns:repeat(9,40px);grid-template-rows:repeat(3,40px);gap:3px;align-items:center;justify-items:center}#emulationNewTasksNumbers,#emulationNewTasksOther{display:grid;grid-template-columns:repeat(2,40px);grid-template-rows:repeat(6,40px);gap:3px;align-items:center;justify-items:center}#emulationNewTasksMode{display:grid;grid-template-columns:repeat(8,40px);grid-template-rows:repeat(1,40px);gap:3px;align-items:center;justify-items:center}#movementContainer,#modeContainer{width:100%;display:flex;justify-content:center;align-items:center;margin:5px;padding:5px}#emulateKeyUp{grid-area:1 / 2}#emulateKeyDown{grid-area:3 / 2}#emulateKeyLeft{grid-area:2 / 1}#emulateKeyRight{grid-area:2 / 3}#emulateKeyPlay{grid-area:1 / 5}#emulateKeyStop{grid-area:3 / 5}#emulateKeyStopUp{grid-area:1 / 8}#emulateKeyStopDown{grid-area:3 / 8}#emulateKeyStopLeft{grid-area:2 / 7}#emulateKeyStopRight{grid-area:2 / 9}#emulationNewTasksMode button.material-symbols-outlined{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksMode button:hover{background-color:#18a79b}#emulationNewTasksMode button:focus,#emulationNewTasksMode button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksMovement button.material-symbols-outlined{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksMovement button:hover{background-color:#18a79b}#emulationNewTasksMovement button:focus,#emulationNewTasksMovement button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksNumbers button{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700;font-family:monospace}#emulationNewTasksNumbers button:hover{background-color:#18a79b}#emulationNewTasksNumbers button:focus,#emulationNewTasksNumbers button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}#emulationNewTasksOther button{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700}#emulationNewTasksOther button:hover{background-color:#18a79b}#emulationNewTasksOther button:focus,#emulationNewTasksOther button:focus-visible{outline:4px auto -webkit-focus-ring-color;background-color:#18a79b}.emulated-button-list{background-color:#ff0;border-radius:50%;border:none;width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#000;padding:0;font-weight:700!important}.standard-font{font-family:monospace!important}#emulationNewTasks{list-style-type:none;display:grid;grid-template-columns:repeat(11,1fr);grid-auto-rows:auto;gap:10px;padding:0;margin:0}#emulateKeySteps{transform:scaleX(-1)}.flexCol{display:flex;flex-direction:column;align-items:center;justify-content:center}.outerCol{padding-top:15px}.middleCol{align-self:flex-start}.task-container{margin:5px}.task-container>div,.gu-mirror{transition:opacity .4s ease-in-out}.task-container>div{padding:5px;cursor:move;cursor:grab;cursor:-moz-grab;cursor:-webkit-grab;display:flex;align-items:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.gu-mirror{padding:5px;text-align:center;cursor:grabbing;cursor:-moz-grabbing;cursor:-webkit-grabbing}.task-container .ex-moved{background-color:#e74c3c}.task-container.ex-over{background-color:#ffffff4d}.planner-save-text{max-width:none!important}.planner-save-button{flex:auto}.planner-load-select{max-width:none!important}.planner-load-delete-buttons{width:50%}.planner-saving-label{text-wrap:nowrap}.no-marge{margin:0}.task-modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.task-modal-content{position:relative;background-color:#242424;margin:15% auto;padding:20px;border:2px solid #6c5ce7;max-width:600px;min-width:600px}.center-modal{text-align:center}.icon-tooltip{position:relative;cursor:pointer}.icon-tooltip:after{content:attr(data-tooltip);position:absolute;bottom:100%;left:50%;transform:translate(-50%);white-space:nowrap;z-index:1;background-color:#000;color:#fff;padding:5px;border-radius:4px;opacity:0;visibility:hidden;transition:opacity .2s,visibility .2s}.icon-tooltip:hover:after{opacity:1;visibility:visible}.threading-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;width:800px;max-width:1280px;text-align:center;border:1px solid #ccc}.gu-mirror{position:fixed!important;margin:0!important;z-index:9999!important;opacity:.8}.gu-hide{display:none!important}.gu-unselectable{-webkit-user-select:none!important;-moz-user-select:none!important;-ms-user-select:none!important;user-select:none!important}.gu-transit{opacity:.2}

</style>
</head>

<body>

    <div id="mainContainer" class="main-container">
        <div class="menu">
            <ul>
                <li id="simulationTab">Simulation</li>
                <li id="controlTab">Control</li>
                <li id="macroTab">Macros</li>
                <li id="plannerTab">Planner</li>
                <li id="threadingTab">Threading</li>
            </ul>
        </div>

        <div id="simulationContainer" class="main-container">
            <div id="simulationContent" class="controls-container">
                <div id="gcodeContainer" style="position: relative;">
                    <div id="gcodeEditor" style="height: 200px; width: 100%;"></div>
                </div>
                <div class="innerContainer">
                    <input type="file" id="fileInput" accept=".txt,.gcode">
                </div>
                <div class="innerContainer">
                    <button id="simulateButton">Simulate</button>
                    <button id="clearButton">Clear</button>
                    <button id="helpButton">How to use</button>
                </div>


                <div class="innerContainer" id="loadAndSave">


                    <hr>
                    <div class="innerContainer toolbar">
                        <input type="text" class="saveGCodeNameInput" placeholder="name of save"></input>
                        <button class="saveGCodeButton" title="Save GCode to local browser storage">Save local</button>
                    </div>
                    <div class="innerContainer toolbar">
                        <select class="loadGCodeSelect"></select>
                        <button class="loadGCodeButton" title="Load GCode from local browser storage">Load</button>
                        <button class="deleteGCodeButton" title="Delete GCode from local browser storage">Delete</button>
                    </div>
                    <hr>
                </div>
            </div>

            <div class="canvas-container">
                <canvas id="gcodeCanvas" width="785" height="600"></canvas>
                <div id="sliderContainer" class="innerContainer" style="display: none; width: 400px;">
                    <input type="range" id="progressSlider" min="0" max="100" value="0" style="width: 100%;">
                    <div id="sliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                </div>
                <div id="displayOptionsContainer" class="innerContainer" style="display: none;">
                    <input type="checkbox" id="showCuts" checked> Show Cut Moves
                    </label>
                    <label>
                        <input type="checkbox" id="showNonCuts" checked>
                        Show Non-Cut Moves
                    </label>
                </div>
                <div id="sliderContainer" class="innerContainer" style="display: none; width: 400px;">
                    <input type="range" id="progressSlider" min="0" max="100" value="0" style="width: 100%;">
                    <div id="sliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                </div>
                <div class="innerContainer"><button id="zoomButton" title="Zoom in">Zoom In</button></div>
            </div>

        </div>
        <div id="controlsContainer" class="main-container" style="display: none;">
            <div id="controlsContent" class="controls-container">
                <div id="gcodeSenderContainer" class="innerContainer">

                    <span>Send GCode to Nano ELS H4</span>

                    <div class="innerContainer">
                        <button id="connectButton" title="Connect to Nano ELS H4">Connect</button>
                    </div>
                </div>

                <div id="latheControls">
                    <div id="jogControls">
                        <span id="fastText">Fast</span>
                        <span id="slowText">Slow</span>
                        <span id="toolText">Tool</span>

                        <!-- Tools -->
                        <button class="tool-btn tool-selected" id="tool0">T0</button>
                        <button class="tool-btn" id="tool1">T1</button>
                        <button class="tool-btn" id="tool2">T2</button>
                        <button class="tool-btn" id="tool3">T3</button>
                        <button class="tool-btn" id="tool4">T4</button>
                        <button class="tool-btn" id="tool5">T5</button>
                        <button class="tool-btn" id="tool6">T6</button>
                        <button class="tool-btn" id="tool7">T7</button>
                        <button class="tool-btn" id="tool8">T8</button>
                        <button class="tool-btn" id="tool9">T9</button>

                        <span id="jogText">Move</span>
                        <!-- Fast arrows -->
                        <button class="arrow fast jog-btn" id="fastForward"><i class="fas fa-arrow-up"></i></button>
                        <button class="arrow fast jog-btn" id="fastBackward"><i class="fas fa-arrow-down"></i></button>
                        <button class="arrow fast jog-btn" id="fastLeft"><i class="fas fa-arrow-left"></i></button>
                        <button class="arrow fast jog-btn" id="fastRight"><i class="fas fa-arrow-right"></i></button>
                        <!-- Slow arrows -->
                        <button class="arrow slow jog-btn" id="slowForward"><i class="fas fa-arrow-up"></i></button>
                        <button class="arrow slow jog-btn" id="slowBackward"><i class="fas fa-arrow-down"></i></button>
                        <button class="arrow slow jog-btn" id="slowLeft"><i class="fas fa-arrow-left"></i></button>
                        <button class="arrow slow jog-btn" id="slowRight"><i class="fas fa-arrow-right"></i></button>
                    </div>
                    <div id="incrementControls">
                        <button class="increment-btn" data-increment="0.01">0.01</button>
                        <button class="increment-btn" data-increment="0.1">0.1</button>
                        <button class="increment-btn active" data-increment="1">1</button>
                        <button class="increment-btn" data-increment="10">10</button>
                    </div>
                    <div id="feedrateControls" class="innerContentCentre control-inputs">
                        <label for="fastFeedrate">Fast Feedrate:</label>
                        <input type="text" id="fastFeedrate" name="fastFeedrate" value="200">
                        <label for="slowFeedrate">Slow Feedrate:</label>
                        <input type="text" id="slowFeedrate" name="slowFeedrate" value="50">
                    </div>
                    <div id="distanceControl" class="innerContentCentre control-inputs">
                        <label for="moveDistance">Move Distance (mm):</label>
                        <input type="text" id="moveDistance" name="moveDistance" value="1">
                    </div>
                </div>

                <div id="gcodeResponseContainer" style="display: none;">
                    <div id="gcodeResponseHeader">GCode Responses</div>
                    <div id="gcodeResponseEditor" style="height: 200px; width: 100%;"></div>
                    <div class="senderError" style="display: none;"></div>
                    <div id="senderProgressContainer">
                        <span id="senderProgressLabel" style="display: none;">Progress...</span>
                        <progress id="senderProgress" max="1" style="display: none;"></progress>
                    </div>
                </div>
            </div>
            <div class="controls-container">
                <div class="innerContainer control-inputs">
                    <div class="innerContentCentre control-inputs">
                        <span>Send single command</span>
                    </div>
                    <div class="innerContentCentre sender-inputs">
                        <input id="singleCommandSender" type="text" name="singleCommandSender"></input>
                    </div>
                    <div class="innerContentCentre control-inputs">
                        <button id="gcodeSendSingleCommandButton" title="Send GCode to CNC">Send</button>
                    </div>
                </div>
            </div>
            <div class="controls-container">
                <div id="gcodeSenderContainer" style="position: relative;">
                    <span>Send multi line commands</span>
                    <div id="gcodeSenderEditor" style="height: 200px; width: 100%;"></div>
                </div>
                <div class="innerContainer">
                    <button id="gcodeSenderButton" title="Send GCode to CNC">Send</button>
                    <button id="stopButton" style="display: none;">Stop</button>
                </div>
            </div>
        </div>
        <div id="macroContainer" class="main-container" style="display: none;">
            <div id="macroContent" class="controls-container">
                <div class="innerContainer">
                    <h1>Macros</h1>
                    <div>Coming soon. Use macros to define commmon tasks. For example profile 10mm from current position</div>
                </div>
            </div>
        </div>

        <div id="plannerContainer" class="main-container" style="display: none;">
            <div id="plannerContent" class="planner-container">
                <div class="innerContainer">
                    <h1>Planner</h1>
                    <div class="planner-guidance">
                        <span>Use this tool to create a job of tasks to execute. This can be manual, gcode, button press
                            emulation or a
                            combination
                            of them.
                            When you click execute the job wizard will execute the tasks one after another. Each task
                            with require confirmation to start.</span>
                    </div>
                </div>
                <div class="innerContainer">
                    <h1>Device status</h1>
                    <button id="plannerConnectButton">Connect</button>
                </div>
                <div id="taskContainer">
                    <div class="container-wrapper-outer">
                        <div class="container-wrapper">
                            <h2>Current Job</h2>
                            <span>Drag an available task to below</span>
                            <div id="tasksToExecute" class="task-container">
                            </div>
                        </div>
                        <div class="container-wrapper">
                            <button id="executeJobButton">Execute Job</button>
                        </div>
                        <hr>
                        <div class="container-wrapper">
                            <div class="innerContainer" id="loadAndSaveJob">
                                <div class="innerContainer toolbar">
                                    <button id="saveJobButton" class="planner-save-button" title="Save Job to local browser storage">Save
                                        Job</button>
                                </div>
                                <div class="innerContainer toolbar">
                                    <button id="loadJobButton" class="planner-load-delete-buttons" title="Load Job from local browser storage">Load</button>
                                    <button id="deleteJobButton" class="planner-load-delete-buttons" title="Delete Job from local browser storage">Delete</button>
                                </div>
                                <div class="innerContainer toolbar">
                                    <select id="jobLoadSelect" class="planner-load-select">
                                    </select>
                                </div>
                                <div class="container-wrapper-inner">
                                    <hr>
                                </div>
                                <span class="planner-saving-label">Import and export Job to JSON</span>
                                <div class="innerContainer toolbar">
                                    <button id="importJobButton" class="planner-load-delete-buttons" title="Import Job from JSON file">Import</button>
                                    <button id="exportJobButton" class="planner-load-delete-buttons" title="Export Job to JSON">Export</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="container-wrapper-outer">
                        <div class="container-wrapper">
                            <h2>Available Tasks</h2>
                            <div id="availableTasks" class="task-container">
                            </div>
                        </div>
                        <div class="container-wrapper">
                            <div class="container-wrapper-inner">
                                <span>Drag here to delete</span>
                            </div>
                            <div id="deleteTasks" class="container-wrapper-delete">
                            </div>
                        </div>
                        <div class="container-wrapper">
                            <button id="addNewTaskButton">Add New Task</button>
                        </div>
                        <div class="container-wrapper-inner">
                            <hr class="no-marge">
                        </div>
                        <div class="container-wrapper">
                            <div class="innerContainer" id="loadAndSaveAvailableTasks">
                                <div><span>Task Collections</span></div>
                                <div class="innerContainer toolbar">
                                    <button id='saveAvailableTaskCollection' class="planner-save-button" title="Save Task to local browser storage">Save tasks to a collection
                                        <i class="far fa-save show-info icon-tooltip"
                                            data-tooltip="Save to local machine"></i>
                                    </button>
                                </div>
                                <div class="innerContainer toolbar">
                                    <select id="availableTaskCollections" class="planner-load-select">
                                        <option value="" disabled>Select your option</option>
                                    </select>
                                </div>
                                <div class="innerContainer toolbar">
                                    <button id="loadTaskCollection" class="planner-load-delete-buttons" title="Load selected collection">Load collection</button>
                                    <button id="deleteTaskCollection" class="planner-load-delete-buttons" title="Delete selected collection">Delete collection</button>
                                </div>
                                <div class="container-wrapper-inner">
                                    <hr>
                                </div>
                                <span class="planner-saving-label">Import and export tasks via JSON</span>
                                <div class="innerContainer toolbar">
                                    <button id="importAvailableTasks" class="planner-load-delete-buttons" title="Import tasks from JSON file">Import</button>
                                    <button id="exportAvailableTasks" class="planner-load-delete-buttons" title="Export tasks to JSON">Export</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="threadingContainer" class="main-container" style="display: none;">
            <div id="threadingContent" class="threading-container">Coming soon.</div>
        </div>
        <!-- Not Connected warning -->
        <div id="notConnectedModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Not Connected</h2>
                <div class="modal-pad-bottom">
                    <span>Please connect to the controller before executing jobs</span>
                </div>
                <div class="modal-pad">
                    <button id="notConnectedCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Manual Task Modal -->
        <div id="manualTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>Manual Task Instructions</h2>
                <hr>
                <div>
                    <span id="manualTaskName"></span>
                </div>
                <div class="modal-pad">
                    <textarea id="manualTaskInstructions" name="manualTaskInstructions" rows="4" cols="50" disabled></textarea>
                </div>
                <div class="modal-pad">
                    <button id="cancelManualTask">Cancel</button>
                    <button id="completeManualTask">Next Task --></button>
                </div>
            </div>
        </div>
        <!-- Gcode Task Modal -->
        <div id="cncTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>CNC Task Gcode</h2>
                <hr>
                <div>
                    <span id="cncTaskName"></span>
                </div>
                <div class="modal-pad">
                    <textarea id="cncTaskGcode" name="cncTaskGcode" rows="4" cols="50" disabled></textarea>
                </div>
                <div class="modal-pad">
                    <button id="cancelCncTask">Cancel</button>
                    <button id="executeGcode">Execute Gcode</button>
                </div>
                <div class="modal-pad">
                    <button id="completeCncTask" disabled>Next Task --></button>
                </div>
                <div id="currentGcodeLineContainer" class="modal-pad">
                    <span id="currentGcodeLineLabel">Current Gcode Line:</span>
                    <span id="currentGcodeLine"></span>
                </div>
                <div id="currentFeedrateContainer" class="modal-pad">
                    <span id="currentFeedrateLabel">Current Feedrate:</span>
                    <span id="currentFeedrate"></span>
                </div>
                <div id="cncTaskSenderProgressContainer" class="modal-pad">
                    <span id="cncTaskSenderProgressLabel">Execution in progress...</span>
                    <progress id="cncTaskSenderProgress" max="1"></progress>
                </div>
            </div>
        </div>
        <!-- key Emulation Task Modal -->
        <div id="emulationTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>Key Emulation Task</h2>
                <hr>
                <div>
                    <span id="emulationTaskName"></span>
                </div>
                <div class="modal-pad">
                    <ul id="emulationExecutionTasks">
                        <!-- List items will be added here -->
                    </ul>
                    <div class="modal-pad">
                        <button id="completeEmulationTask" disabled>Mark Complete</button>
                    </div>
                    <div id="emulationTaskSenderProgressContainer" class="modal-pad">
                        <span id="emulationTaskSenderProgressLabel">Execution in progress...</span>
                        <progress id="emulationTaskSenderProgress" max="1"></progress>
                    </div>
                </div>
            </div>
        </div>
        <!-- All tasks Complete Modal -->
        <div id="completeTaskModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>All Tasks Complete</h2>
                <div class="modal-pad">
                    <button id="completeTaskCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Job Cancelled Modal -->
        <div id="jobCancelledModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Job Cancelled</h2>
                <div>
                    <button id="jobCancelledCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Save Job Modal -->
        <div id="saveJobModal" class="task-modal">
            <div class="task-modal-content">
                <span id="saveJobModalClose" class="close-modal">&times;</span>
                <h2>Save Job</h2>
                <hr>
                <div class="modal-pad">Pick a name:</div>
                <div>
                    <select id="saveJobNameSelect">
                    </select>
                </div>
                <div id="newJobNameContainer" style="display: none;">
                    <div class="modal-pad">New Job name:</div>
                    <div>
                        <input id="saveJobNameInput" type="text" class="planner-save-text" placeholder="Name of Job"></input>
                    </div>
                </div>
                <div class="modal-pad">
                    <button id="saveJobSaveButton">Save</button>
                </div>
            </div>
        </div>
        <!-- export Job Modal -->
        <div id="exportJobModal" class="task-modal">
            <div class="task-modal-content">
                <span id="exportJobModalClose" class="close-modal">&times;</span>
                <h2>Export Job</h2>
                <hr>
                <div class="modal-pad">Select Job To Export:</div>
                <div>
                    <select id="exportJobNameSelect">
                    </select>
                </div>
                <div class="modal-pad">
                    <button id="exportJobSaveButton">Save</button>
                </div>
            </div>
        </div>
        <!-- Save Collection -->
        <div id="saveCollectionModal" class="task-modal">
            <div class="task-modal-content">
                <span id="saveCollectionModalClose" class="close-modal">&times;</span>
                <div>
                    <div>Which collection would you like to save the tasks to?</div>
                    <div class="modal-pad">
                        <select id="saveCollectionModalToSaveTo" name="collectionToSaveToModal">
                        </select>
                    </div>
                    <div id="newCollectionNameContainerModal" style="display: none;">
                        <div class="modal-pad">New Collection Name:</div>
                        <div>
                            <input type="text" id="newCollectionNameModal" name="newCollectionNameModal" placeholder="Enter collection name...">
                        </div>
                    </div>

                    <div class="modal-pad">
                        <button id="saveAvailableTaskCollectionButtonModal">Save</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- new task modal-->
        <div id="newTaskModal" class="task-modal">
            <div class="task-modal-content">
                <span id="closeNewTaskModal" class="close-modal">&times;</span>
                <div id="newTaskHelpText">
                    <h2 id="taskTextTitle">Add a new task</h2>
                    <hr>
                    <div class="modal-pad">Task Name:</div>
                    <div>
                        <input type="text" id="newTaskName" name="newTaskName" placeholder="Enter task name...">
                    </div>
                    <div class="modal-pad">Task Type:</div>
                    <div>
                        <select id="newTaskType" name="newTaskType">
                            <option value="manual">Manual</option>
                            <option value="gcode">GCode</option>
                            <option value="emulation" disabled>Key Emulation</option>
                        </select>
                    </div>
                    <div class="modal-pad">Task Description:</div>
                    <div>
                        <textarea id="newTaskDescription" name="newTaskDescription" rows="4" cols="50" placeholder="Enter Description..."></textarea>
                    </div>
                    <div id="gcodeTaskContainer" style="display:none">
                        <div class="modal-pad">Task GCode:</div>
                        <div>
                            <textarea id="newTaskGcode" name="newTaskGcode" rows="4" cols="50" placeholder="Disabled for manual tasks" disabled></textarea>
                        </div>
                    </div>
                    <div id="emulationOuterContainer" class="emulate-noselect" style="display:none">
                        <div>
                            <span>Use built in controller functions by emulating button presses
                                Simply click the buttons you want to emulate to build up a sequence which will be
                                displayed at the bottom. Each emulated press will have a 500ms delay between them.
                                <br>
                                <br>
                                <i>Tip: Hover over the buttons for a description.</i>
                            </span>
                        </div>
                        <div id="emulationInnerContainer">
                            <div class="flexCol outerCol">
                                <div id="numberContainer">
                                    <div id="emulationNewTasksNumbers">
                                        <button id="emulateKey9" data-button-key="B_9" class="standard-font material-symbols-outlined">
                                            9
                                        </button>
                                        <button id="emulateKey8" data-button-key="B_8" class="standard-font material-symbols-outlined">
                                            8
                                        </button>
                                        <button id="emulateKey7" data-button-key="B_7" class="standard-font material-symbols-outlined">
                                            7
                                        </button>
                                        <button id="emulateKey6" data-button-key="B_6" class="standard-font material-symbols-outlined">
                                            6
                                        </button>
                                        <button id="emulateKey5" data-button-key="B_5" class="standard-font material-symbols-outlined">
                                            5
                                        </button>
                                        <button id="emulateKey4" data-button-key="B_4" class="standard-font material-symbols-outlined">
                                            4
                                        </button>
                                        <button id="emulateKey3" data-button-key="B_3" class="standard-font material-symbols-outlined">
                                            3
                                        </button>
                                        <button id="emulateKey2" data-button-key="B_2" class="standard-font material-symbols-outlined">
                                            2
                                        </button>
                                        <button id="emulateKey1" data-button-key="B_1" class="standard-font material-symbols-outlined">
                                            1
                                        </button>
                                        <button id="emulateKey0" data-button-key="B_0" class="standard-font material-symbols-outlined">
                                            0
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="flexCol middleCol">
                                <div id="modeContainer">
                                    <div id="emulationNewTasksMode">
                                        <button id="emulateKeyBack" data-button-key="B_BACKSPACE" class="material-symbols-outlined">
                                            backspace
                                        </button>
                                        <button id="emulateKeyGearbox" data-button-key="B_MODE_GEARS" class="material-symbols-outlined">
                                            manufacturing
                                        </button>
                                        <button id="emulateKeyTurning" data-button-key="B_MODE_TURN" class="material-symbols-outlined">
                                            reply
                                        </button>
                                        <button id="emulateKeyFacing" data-button-key="B_MODE_FACE" class="material-symbols-outlined">
                                            turn_slight_left
                                        </button>
                                        <button id="emulateKeyCone" data-button-key="B_MODE_CONE" class="material-symbols-outlined">
                                            arrow_forward_ios
                                        </button>
                                        <button id="emulateKeyParting" data-button-key="B_MODE_CUT" class="material-symbols-outlined">
                                            publish
                                        </button>
                                        <button id="emulateKeyThreading" data-button-key="B_MODE_THREAD" class="material-symbols-outlined">
                                            home_improvement_and_tools
                                        </button>
                                        <button id="emulateKeyMode" data-button-key="B_MODE_OTHER" class="standard-font material-symbols-outlined">
                                            M
                                        </button>
                                    </div>
                                </div>
                                <div id="movementContainer">
                                    <div id="emulationNewTasksMovement">
                                        <button id="emulateKeyLeft" data-button-key="B_LEFT" class="material-symbols-outlined">
                                            arrow_left_alt
                                        </button>
                                        <button id="emulateKeyRight" data-button-key="B_RIGHT" class="material-symbols-outlined">
                                            arrow_right_alt
                                        </button>
                                        <button id="emulateKeyUp" data-button-key="B_UP" class="material-symbols-outlined">
                                            arrow_upward_alt
                                        </button>
                                        <button id="emulateKeyDown" data-button-key="B_DOWN" class="material-symbols-outlined">
                                            arrow_downward_alt
                                        </button>
                                        <button id="emulateKeyPlay" data-button-key="B_ON" class="material-symbols-outlined">
                                            play_arrow
                                        </button>
                                        <button id="emulateKeyStop" data-button-key="B_OFF" class="material-symbols-outlined">
                                            crop_square
                                        </button>
                                        <button id="emulateKeyStopLeft" data-button-key="B_STOPL" class="material-symbols-outlined">
                                            keyboard_tab_rtl
                                        </button>
                                        <button id="emulateKeyStopRight" data-button-key="B_STOPR" class="material-symbols-outlined">
                                            keyboard_tab
                                        </button>
                                        <button id="emulateKeyStopUp" data-button-key="B_STOPU" class="material-symbols-outlined">
                                            vertical_align_top
                                        </button>
                                        <button id="emulateKeyStopDown" data-button-key="B_STOPD" class="material-symbols-outlined">
                                            vertical_align_bottom
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="flexCol outerCol">
                                <div id="otherContainer">
                                    <div id="emulationNewTasksOther">
                                        <button id="emulateKeyZ" data-button-key="B_Z" class="standard-font material-symbols-outlined">
                                            Z
                                        </button>
                                        <button id="emulateKeyX" data-button-key="B_X" class="standard-font material-symbols-outlined">
                                            X
                                        </button>
                                        <button id="emulateKeyB" data-button-key="B_B" class="standard-font material-symbols-outlined">
                                            B
                                        </button>
                                        <button id="emulateKeyA" data-button-key="B_A" class="standard-font material-symbols-outlined">
                                            A
                                        </button>
                                        <button id="emulateKeyAngle" data-button-key="B_DISPL" class="material-symbols-outlined" title="Angle/Taco">
                                            rotate_left
                                        </button>
                                        <button id="emulateKeySteps" data-button-key="B_STEPZ" class="material-symbols-outlined">
                                            signal_cellular_alt
                                        </button>
                                        <button id="emulateKeySettings" data-button-key="B_SETTINGS" class="material-symbols-outlined">
                                            settings
                                        </button>
                                        <button id="emulateKeyReverse" data-button-key="B_REVERSE" class="material-symbols-outlined">
                                            sync_alt
                                        </button>
                                        <button id="emulateKeyMeasure" data-button-key="B_MEASURE" class="material-symbols-outlined">
                                            space_bar
                                        </button>
                                        <button id="emulateKeyPlus" data-button-key="B_PLUS" class="standard-font material-symbols-outlined">
                                            +
                                        </button>
                                        <button id="emulateKeyMinus" data-button-key="B_MINUS" class="standard-font material-symbols-outlined">
                                            -
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <span>
                                Emulated sequence: <i>Tip: Drag to reorder or delete</i>
                            </span>
                        </div>
                        <div class="emulation-modal-pad-border">
                            <div id="emulationNewTasks">
                            </div>
                        </div>
                        <div class="modal-pad-bottom">
                            <div id="emulatedTasksDelete" class="container-wrapper-inner">
                                <span>
                                    Drag here to delete
                                </span>
                            </div>
                            <div id="emulatedButtonListDelete" class="container-wrapper-delete">

                            </div>
                        </div>
                    </div>
                    <div class="modal-pad">Collection to save to:</div>
                    <div>
                        <select id="collectionToSaveTo" name="collectionToSaveTo">
                        </select>
                    </div>
                    <div id="newCollectionNameContainer" style="display: none;">
                        <div class="modal-pad">New Collection Name:</div>
                        <div>
                            <input type="text" id="newCollectionName" name="newCollectionName" placeholder="Enter collection name...">
                        </div>
                    </div>
                    <div class="modal-pad">
                        <button id="saveNewTaskButton">Save</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="helpModal" class="help-modal">
            <div class="help-modal-content">
                <span id="closeHelpModal" class="close-modal">&times;</span>
                <div id="helpText">
                    <div>This tool is designed to be used in conjunction with LatheCode:</div>
                    <div><a href="https://kachurovskiy.github.io/lathecode/ " target="_blank ">https://kachurovskiy.github.io/lathecode/</a></div>
                    <div><strong>Please note that this tool is to be used at your own risk and I cannot gaurentee that
                            it will work. This tool targets my custom fork of the H4 firmware which you can find
                            here:</strong> <a href="https://github.com/Festivejelly/nanoels" target="_blank ">https://github.com/Festivejelly/nanoels</a></div>
                    <hr>
                    <div>How to use:</div>
                    <ul style="list-style-type: disc; padding-left: 20px; ">
                        <li>Use LatheCode to generate the G-code, then paste it into this tool.</li>
                        <li>You can also write the G-code by hand for simple operations such as boring or grooving.
                            <a href="# " id="exampleCode">Click here</a> to load an example.
                        </li>
                        <li>Click "Simulate" to plot the moves onto the canvas.</li>
                        <li>movement lines marked with "; cut" will show in <span class="line red-line"></span><span class="text-red">red</span>.</li>
                        <li>movement lines marked with "; travel" will show in <span class="line green-line"></span><span class="text-green">green</span>.</li>
                        <li>movement lines marked with "; retract" will show in <span class="line orange-line"></span><span class="text-orange">orange</span>.</li>
                        <li>movement lines not marked will default to <span class="line green-line"></span><span class="text-green">green</span>.</li>
                        <li>All other moves will be considered travel moves and will show in green.</li>
                        <li>Any G-code you paste or write can be saved into the browser's local storage. This is useful for saving common operations.</li>
                        <li>When you're ready, you can send the G-code to the Nano ELS H4 by clicking "Send."
                        </li>
                        <li>More functionality to come soon! Version 0.2</li>
                        <li>Please provide feedback, raise issues or make suggestions here: <a href="https://github.com/Festivejelly/LatheGcodeVisualiser " target="_blank ">https://github.com/Festivejelly/LatheGcodeVisualiser</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="zoomModal" class="zoom-modal">
            <div class="zoom-modal-content" style="background-color: #242424;">
                <span id="closeZoomModal" class="close-modal">&times;</span>
                <canvas id="zoomCanvas" width="1600 " height="1200 "></canvas>
                <div id="sliderAndButtonContainer">
                    <div id="zoomSliderContainer" class="innerContainer" style="width: 400px;">
                        <input type="range" id="zoomProgressSlider" min="0" max="100" value="0" style="width: 100%;">
                        <div id="zoomSliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                    </div>
                    <div id="displayOptionsContainerZoom" class="innerContainer">
                        <input type="checkbox" id="showCutsZoom" checked> Show Cut Moves
                        </label>
                        <label>
                            <input type="checkbox" id="showNonCutsZoom" checked>
                            Show Non-Cut Moves
                        </label>
                    </div>
                    <button id="zoomCloseButton">Close</button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>