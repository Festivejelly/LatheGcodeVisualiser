<!DOCTYPE html>
<html>

<head>
    <title>G-Code Visualizer</title>
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/ace.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <script type="module" crossorigin>
var Dt=Object.defineProperty;var Zt=(t,e,n)=>e in t?Dt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var S=(t,e,n)=>(Zt(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const m of a.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&o(m)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();class Pt{constructor(e,n,o,i,a,m,C,b){this.isConnected=e,this.condition=n,this.error=o,this.progress=i,this.z=a,this.x=m,this.feed=C,this.rpm=b}}const me=class me{constructor(){S(this,"listeners",[]);S(this,"port",null);S(this,"readTimeout",0);S(this,"reader",null);S(this,"writer",null);S(this,"isOn",!1);S(this,"waitForOkOrError",!1);S(this,"lines",[]);S(this,"lineIndex",0);S(this,"unparsedResponse","");S(this,"error","");S(this,"statusReceived",!1);S(this,"z",0);S(this,"x",0);S(this,"feed",0);S(this,"rpm",0);S(this,"isDisconnecting",!1);S(this,"lastStatus",null)}static getInstance(){return me.instance||(me.instance=new me),me.instance}getStatus(){return this.lastStatus=new Pt(this.port!==null,this.isOn?"run":"idle",this.error,this.lines.length?this.lineIndex/this.lines.length:0,this.z,this.x,this.feed,this.rpm),this.lastStatus}addStatusChangeListener(e){this.listeners.push(e)}notifyStatusChange(){this.listeners.forEach(e=>e())}setStatus(e){e.startsWith("<")&&(e=e.substring(1)),e.endsWith(">")&&(e=e.slice(0,-1));const n=e.split("|");if(n.length>=3){if(this.statusReceived=!0,n[1].startsWith("WPos:")){const o=n[1].substring(5).split(",");this.z=Number(o[2]),this.x=Number(o[0])}if(n[2].startsWith("FS:")){const o=n[2].substring(3).split(",");this.feed=Number(o[0]),this.rpm=Number(o[1])}}this.notifyStatusChange()}setError(e){this.error=e,We(e),this.notifyStatusChange()}isConnected(){return this.lastStatus!==null&&this.lastStatus.isConnected}async connect(){try{if(this.port)this.closePort();else{if(await this.selectPort(),await this.askForStatus(),!await Rt(()=>this.statusReceived)){this.setError("Device is not reponding, is it in GCODE mode?");return}this.isDisconnecting=!1,this.isOn=!1,this.setError(""),this.waitForOkOrError=!1,this.unparsedResponse=""}}catch(e){console.log(e)}this.notifyStatusChange()}async disconnect(){this.isDisconnecting=!0,this.port&&this.closePort()}getDisconnectingStatus(){return this.isDisconnecting}async start(e){e&&(this.isOn=!0,this.lines=e.split(`
`),this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange())}async sendCommand(e){this.isOn=!0;let n=new Array(3);n[0]="G91",n[1]=e,n[2]="G90",this.lines=n,this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange()}async sendCommands(e){this.isOn=!0,this.lines=e,this.lineIndex=0,this.waitForOkOrError=!1,this.write("~"),this.writeCurrentLine(),this.notifyStatusChange()}async stop(){await this.write("!"),this.isOn&&(this.isOn=!1,this.askForStatus(),this.notifyStatusChange())}async write(e){if(this.port){if(We(`command: ${e}`),console.log("command: ",e),!this.port.writable){e!="?"&&this.setError("Port is not writable, try reconnecting the USB and switching to GCODE mode.");return}if(!this.writer)try{const n=new TextEncoderStream;n.readable.pipeTo(this.port.writable),this.writer=n.writable.getWriter()}catch(n){this.setError("Failed to write: "+n);return}await this.writer.write(e)}}async writeCurrentLine(){if(!this.isOn||this.waitForOkOrError)return;if(this.lineIndex>=this.lines.length){this.stop();return}const e=this.lines[this.lineIndex].split(";")[0].trim();if(!e){this.lineIndex++,this.writeCurrentLine();return}this.waitForOkOrError=!0,await this.write(e+`
`),await this.readFromPort()}async processResponse(e){this.unparsedResponse=(this.unparsedResponse+e).trimStart(),We(`command: ${e}`),console.log(`response: "${e}"`);const n=this.unparsedResponse.match(/(<[^>]+>)/);if(n&&n.length>1){n.shift();for(const o of n)this.unparsedResponse=this.unparsedResponse.replace(o,"");this.setStatus(n.pop())}this.unparsedResponse.startsWith("error:")?(this.setError(this.unparsedResponse),this.unparsedResponse="",this.stop()):this.unparsedResponse.startsWith("ok")&&(this.unparsedResponse="",this.waitForOkOrError=!1,this.lineIndex++,this.notifyStatusChange(),this.isOn&&await this.writeCurrentLine())}async selectPort(){if(this.port&&this.closePort(),navigator.serial?this.port=await navigator.serial.requestPort():(this.error="This browser does not support Serial API, try Chrome or Edge",this.notifyStatusChange()),this.port)try{await this.port.open({baudRate:115200}),this.notifyStatusChange(),this.readSoon()}catch(e){this.setError(`Unable to open port - likely some other app is using it - try closing Arduino IDE.
${e}`),this.closePort()}}async askForStatus(){try{await this.write("?")}catch(e){this.setError(`Device disconnected? ${e}`),this.closePort()}}readSoon(){clearTimeout(this.readTimeout),this.readTimeout=window.setTimeout(()=>this.readFromPort(),200)}async readFromPort(){if(this.port)try{if(!this.port.readable){this.readSoon();return}if(!this.reader){const n=new TextDecoderStream;this.port.readable.pipeTo(n.writable),this.reader=n.readable.getReader()}const{value:e}=await this.reader.read();if(!e){this.readSoon();return}await this.processResponse(e),this.readSoon()}catch(e){this.setError(e.message||String(e)),this.closePort()}}async closePort(){if(this.port){if(clearTimeout(this.readTimeout),this.reader){try{await this.reader.cancel(),this.reader.releaseLock()}catch(e){console.error("Error cancelling reader: ",e)}this.reader=null}if(this.writer){try{await this.writer.close(),this.writer.releaseLock()}catch(e){console.error("Error closing writer: ",e)}this.writer=null}await new Promise(e=>setTimeout(e,500));try{await this.port.close()}catch(e){console.error("Error closing port: ",e)}this.port=null,this.statusReceived=!1,this.z=0,this.x=0,this.feed=0,this.rpm=0}}};S(me,"instance",null);let ze=me;function We(t){var e=Q.getSession(),n=e.getLength(),o=new Date().toLocaleTimeString(),i=`[${o}] ${t}
`;e.insert({row:n,column:0},i)}function Rt(t){return new Promise(e=>{let n=0;function o(){t()?e(!0):n>=10?e(!1):(n++,setTimeout(o,100))}o()})}class At{constructor(){S(this,"sendButton");S(this,"stopButton");S(this,"senderError");S(this,"runProgress");S(this,"runProgressLabel");S(this,"connectButton");S(this,"isConnected",!1);S(this,"gcodeResponseContainer");S(this,"jogButtons");S(this,"toolButtons");S(this,"sender");let e,n,o;this.senderError=document.querySelector(".senderError"),this.runProgress=document.getElementById("senderProgress"),this.runProgressLabel=document.getElementById("senderProgressLabel"),this.connectButton=document.getElementById("connectButton"),this.gcodeResponseContainer=document.getElementById("gcodeResponseContainer"),o=document.getElementById("moveDistance"),e=document.getElementById("fastFeedrate"),n=document.getElementById("slowFeedrate"),this.jogButtons=document.querySelectorAll("#latheControls .jog-btn"),this.toolButtons=document.querySelectorAll("#latheControls .tool-btn"),this.sendButton=document.getElementById("gcodeSenderButton"),this.sender=ze.getInstance(),this.sender.addStatusChangeListener(()=>this.handleStatusChange()),this.jogButtons.forEach(i=>{i.addEventListener("click",()=>{let a="",m="",C="",b=!0;i.id=="fastForward"?(a=e.value,m="X",C=o.value,b=!0):i.id=="slowForward"?(a=n.value,m="X",C=o.value,b=!0):i.id=="fastBackward"?(a=e.value,m="X",C=o.value,b=!1):i.id=="slowBackward"?(a=n.value,m="X",C=o.value,b=!1):i.id=="fastLeft"?(a=e.value,m="Z",C=o.value,b=!0):i.id=="slowLeft"?(a=n.value,m="Z",C=o.value,b=!0):i.id=="fastRight"?(a=e.value,m="Z",C=o.value,b=!1):i.id=="slowRight"&&(a=n.value,m="Z",C=o.value,b=!1);let r=`${m}${b===!0?"":"-"}${C} F${a}`;this.sender&&this.sender.sendCommand(r)})}),this.toolButtons.forEach(i=>{i.addEventListener("click",()=>{let a=i.id,m="T";a=="tool0"?m+="0":a=="tool1"?m+="1":a=="tool2"?m+="2":a=="tool3"&&(m+="3"),document.querySelectorAll("#latheControls .tool-btn").forEach(function(x){x.id!=a?x.classList.remove("tool-selected"):x.classList.add("tool-selected")});let b=new Array(2);b[0]="G91",b[1]=m,this.sender&&this.sender.sendCommands(b)})}),this.connectButton.addEventListener("click",()=>{this.gcodeResponseContainer.style.display="block",!this.isConnected&&this.sender&&this.sender.connect()}),this.sendButton.addEventListener("click",()=>{this.sender&&this.sender.start(F.getValue())}),this.stopButton=document.getElementById("stopButton"),this.stopButton.addEventListener("click",()=>this.sender.stop()),this.stopButton.style.display="none"}hide(){}handleStatusChange(){if(!this.sender)return;const e=this.sender.getStatus();if(e.isConnected===!1){this.sendButton.style.display="none",this.connectButton.innerText="Connect",this.isConnected=!1;return}else this.isConnected=!0,this.sendButton.style.display="inline-block",this.connectButton.innerText="Connected",this.connectButton.disabled=!0;const n=e.condition==="run";this.runProgress&&(this.runProgress.value=e.progress,this.runProgress.style.display=n?"block":"none",this.runProgressLabel.style.display=n?"block":"none"),this.stopButton&&(this.stopButton.style.display=n?"inline-block":"none");const o=this.sender.getDisconnectingStatus();this.senderError&&!o&&(e.error?(this.senderError.style.display="block",this.senderError.innerText=e.error,this.showError(),this.appendLineToResponseEditor(e.error)):(this.hideError(),this.senderError.innerText=""))}appendLineToResponseEditor(e){var n=Q.getSession(),o=n.getLength(),i=new Date().toLocaleTimeString(),a=`[${i}] ${e}
`;n.insert({row:o,column:0},a)}showError(){this.senderError.style.display="block"}hideError(){this.senderError.style.display="none"}}const _t=`; This example shows a boring operation, then an internal grooving operation

G21 ; metric
G18 ; ZX plane
G90 ; absolute positioning
F200
X0 ; zero your tool X on centerline
Z0 ; zero your tool Z at the right edge of the stock
G91 ; relative positioning

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;1mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;2mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;3mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;4mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;5mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;6mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;7mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;8mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;9mm

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

Z0.25 ; cut
X-5 ; cut

X5 ; retract

;10mm

Z-10

Z3.25 ; cut
X-5 ; cut

X-1.7 ; cut

X6.7 ; retract
Z-3.25 ; retract
`;function Jt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ft=function(e,n){return Array.prototype.slice.call(e,n)},jt=typeof setImmediate=="function",at;jt?at=function(t){setImmediate(t)}:at=function(t){setTimeout(t,0)};var Gt=at,zt=Gt,Vt=function(e,n,o){e&&zt(function(){e.apply(o||null,n||[])})},lt=Ft,Ht=Vt,qt=function(e,n){var o=n||{},i={};return e===void 0&&(e={}),e.on=function(a,m){return i[a]?i[a].push(m):i[a]=[m],e},e.once=function(a,m){return m._once=!0,e.on(a,m),e},e.off=function(a,m){var C=arguments.length;if(C===1)delete i[a];else if(C===0)i={};else{var b=i[a];if(!b)return e;b.splice(b.indexOf(m),1)}return e},e.emit=function(){var a=lt(arguments);return e.emitterSnapshot(a.shift()).apply(this,a)},e.emitterSnapshot=function(a){var m=(i[a]||[]).slice(0);return function(){var C=lt(arguments),b=this||e;if(a==="error"&&o.throws!==!1&&!m.length)throw C.length===1?C[0]:C;return m.forEach(function(r){o.async?Ht(r,C,b):r.apply(b,C),r._once&&e.off(a,r)}),e}},e},Ct=window.CustomEvent;function Yt(){try{var t=new Ct("cat",{detail:{foo:"bar"}});return t.type==="cat"&&t.detail.foo==="bar"}catch{}return!1}var Wt=Yt()?Ct:typeof document<"u"&&typeof document.createEvent=="function"?function(e,n){var o=document.createEvent("CustomEvent");return n?o.initCustomEvent(e,n.bubbles,n.cancelable,n.detail):o.initCustomEvent(e,!1,!1,void 0),o}:function(e,n){var o=document.createEventObject();return o.type=e,n?(o.bubbles=!!n.bubbles,o.cancelable=!!n.cancelable,o.detail=n.detail):(o.bubbles=!1,o.cancelable=!1,o.detail=void 0),o},It=[],Ue="",Ut=/^on/;for(Ue in window)Ut.test(Ue)&&It.push(Ue.slice(2));var Kt=It,Qt=Wt,en=Kt,Re=window.document,St=nn,Bt=sn,Me=[];window.addEventListener||(St=on,Bt=an);var tn={add:St,remove:Bt,fabricate:rn};function nn(t,e,n,o){return t.addEventListener(e,n,o)}function on(t,e,n){return t.attachEvent("on"+e,ln(t,e,n))}function sn(t,e,n,o){return t.removeEventListener(e,n,o)}function an(t,e,n){var o=xt(t,e,n);if(o)return t.detachEvent("on"+e,o)}function rn(t,e,n){var o=en.indexOf(e)===-1?a():i();t.dispatchEvent?t.dispatchEvent(o):t.fireEvent("on"+e,o);function i(){var m;return Re.createEvent?(m=Re.createEvent("Event"),m.initEvent(e,!0,!0)):Re.createEventObject&&(m=Re.createEventObject()),m}function a(){return new Qt(e,{detail:n})}}function cn(t,e,n){return function(i){var a=i||window.event;a.target=a.target||a.srcElement,a.preventDefault=a.preventDefault||function(){a.returnValue=!1},a.stopPropagation=a.stopPropagation||function(){a.cancelBubble=!0},a.which=a.which||a.keyCode,n.call(t,a)}}function ln(t,e,n){var o=xt(t,e,n)||cn(t,e,n);return Me.push({wrapper:o,element:t,type:e,fn:n}),o}function xt(t,e,n){var o=dn(t,e,n);if(o){var i=Me[o].wrapper;return Me.splice(o,1),i}}function dn(t,e,n){var o,i;for(o=0;o<Me.length;o++)if(i=Me[o],i.element===t&&i.type===e&&i.fn===n)return o}var dt={},un="(?:^|\\s)",fn="(?:\\s|$)";function Lt(t){var e=dt[t];return e?e.lastIndex=0:dt[t]=e=new RegExp(un+t+fn,"g"),e}function mn(t,e){var n=t.className;n.length?Lt(e).test(n)||(t.className+=" "+e):t.className=e}function pn(t,e){t.className=t.className.replace(Lt(e)," ").trim()}var hn={add:mn,rm:pn},gn=qt,Ee=tn,se=hn,be=document,q=be.documentElement;function vn(t,e){var n=arguments.length;n===1&&Array.isArray(t)===!1&&(e=t,t=[]);var o,i,a,m,C,b,x,r,u,c,g,h=null,f,l=e||{};l.moves===void 0&&(l.moves=pt),l.accepts===void 0&&(l.accepts=pt),l.invalid===void 0&&(l.invalid=qe),l.containers===void 0&&(l.containers=t||[]),l.isContainer===void 0&&(l.isContainer=kn),l.copy===void 0&&(l.copy=!1),l.copySortSource===void 0&&(l.copySortSource=!1),l.revertOnSpill===void 0&&(l.revertOnSpill=!1),l.removeOnSpill===void 0&&(l.removeOnSpill=!1),l.direction===void 0&&(l.direction="vertical"),l.ignoreInputTextSelection===void 0&&(l.ignoreInputTextSelection=!0),l.mirrorContainer===void 0&&(l.mirrorContainer=be.body);var E=gn({containers:l.containers,start:He,end:pe,cancel:te,remove:De,destroy:N,canMove:Ve,dragging:!1});return l.removeOnSpill===!0&&E.on("over",Ce).on("out",Ze),re(),E;function ee(s){return E.containers.indexOf(s)!==-1||l.isContainer(s)}function re(s){var p=s?"remove":"add";xe(q,p,"mousedown",R),xe(q,p,"mouseup",ce)}function j(s){var p=s?"remove":"add";xe(q,p,"mousemove",Y)}function y(s){var p=s?"remove":"add";Ee[p](q,"selectstart",w),Ee[p](q,"click",w)}function N(){re(!0),ce({})}function w(s){f&&s.preventDefault()}function R(s){b=s.clientX,x=s.clientY;var p=ut(s)!==1||s.metaKey||s.ctrlKey;if(!p){var k=s.target,I=we(k);I&&(f=I,j(),s.type==="mousedown"&&(vt(k)?k.focus():s.preventDefault()))}}function Y(s){if(f){if(ut(s)===0){ce({});return}if(!(s.clientX!==void 0&&Math.abs(s.clientX-b)<=(l.slideFactorX||0)&&s.clientY!==void 0&&Math.abs(s.clientY-x)<=(l.slideFactorY||0))){if(l.ignoreInputTextSelection){var p=ie("clientX",s)||0,k=ie("clientY",s)||0,I=be.elementFromPoint(p,k);if(vt(I))return}var A=f;j(!0),y(),pe(),$e(A);var B=yn(a);m=ie("pageX",s)-B.left,C=ie("pageY",s)-B.top,se.add(c||a,"gu-transit"),Ie(),de(s)}}}function we(s){if(!(E.dragging&&o)&&!ee(s)){for(var p=s;_(s)&&ee(_(s))===!1;)if(l.invalid(s,p)||(s=_(s),!s))return;var k=_(s);if(k&&!l.invalid(s,p)){var I=l.moves(s,k,p,Le(s));if(I)return{item:s,source:k}}}}function Ve(s){return!!we(s)}function He(s){var p=we(s);p&&$e(p)}function $e(s){Ye(s.item,s.source)&&(c=s.item.cloneNode(!0),E.emit("cloned",c,s.item,"copy")),i=s.source,a=s.item,r=u=Le(s.item),E.dragging=!0,E.emit("drag",a,i)}function qe(){return!1}function pe(){if(E.dragging){var s=c||a;Te(s,_(s))}}function he(){f=!1,j(!0),y(!0)}function ce(s){if(he(),!!E.dragging){var p=c||a,k=ie("clientX",s)||0,I=ie("clientY",s)||0,A=mt(o,k,I),B=le(A,k,I);B&&(c&&l.copySortSource||!c||B!==i)?Te(p,B):l.removeOnSpill?De():te()}}function Te(s,p){var k=_(s);c&&l.copySortSource&&p===i&&k.removeChild(a),ne(p)?E.emit("cancel",s,i,i):E.emit("drop",s,p,i,u),W()}function De(){if(E.dragging){var s=c||a,p=_(s);p&&p.removeChild(s),E.emit(c?"cancel":"remove",s,p,i),W()}}function te(s){if(E.dragging){var p=arguments.length>0?s:l.revertOnSpill,k=c||a,I=_(k),A=ne(I);A===!1&&p&&(c?I&&I.removeChild(c):i.insertBefore(k,r)),A||p?E.emit("cancel",k,i,i):E.emit("drop",k,I,i,u),W()}}function W(){var s=c||a;he(),Se(),s&&se.rm(s,"gu-transit"),g&&clearTimeout(g),E.dragging=!1,h&&E.emit("out",s,h,i),E.emit("dragend",s),i=a=c=r=u=g=h=null}function ne(s,p){var k;return p!==void 0?k=p:o?k=u:k=Le(c||a),s===i&&k===r}function le(s,p,k){for(var I=s;I&&!A();)I=_(I);return I;function A(){var B=ee(I);if(B===!1)return!1;var oe=L(I,s),D=ge(I,oe,p,k),G=ne(I,D);return G?!0:l.accepts(a,I,i,D)}}function de(s){if(!o)return;s.preventDefault();var p=ie("clientX",s)||0,k=ie("clientY",s)||0,I=p-m,A=k-C;o.style.left=I+"px",o.style.top=A+"px";var B=c||a,oe=mt(o,p,k),D=le(oe,p,k),G=D!==null&&D!==h;(G||D===null)&&(v(),h=D,d());var M=_(B);if(D===i&&c&&!l.copySortSource){M&&M.removeChild(B);return}var Z,U=L(D,oe);if(U!==null)Z=ge(D,U,p,k);else if(l.revertOnSpill===!0&&!c)Z=r,D=i;else{c&&M&&M.removeChild(B);return}(Z===null&&G||Z!==B&&Z!==Le(B))&&(u=Z,D.insertBefore(B,Z),E.emit("shadow",B,D,i));function V(T){E.emit(T,B,h,i)}function d(){G&&V("over")}function v(){h&&V("out")}}function Ce(s){se.rm(s,"gu-hide")}function Ze(s){E.dragging&&se.add(s,"gu-hide")}function Ie(){if(!o){var s=a.getBoundingClientRect();o=a.cloneNode(!0),o.style.width=ht(s)+"px",o.style.height=gt(s)+"px",se.rm(o,"gu-transit"),se.add(o,"gu-mirror"),l.mirrorContainer.appendChild(o),xe(q,"add","mousemove",de),se.add(l.mirrorContainer,"gu-unselectable"),E.emit("cloned",o,a,"mirror")}}function Se(){o&&(se.rm(l.mirrorContainer,"gu-unselectable"),xe(q,"remove","mousemove",de),_(o).removeChild(o),o=null)}function L(s,p){for(var k=p;k!==s&&_(k)!==s;)k=_(k);return k===q?null:k}function ge(s,p,k,I){var A=l.direction==="horizontal",B=p!==s?D():oe();return B;function oe(){var M=s.children.length,Z,U,V;for(Z=0;Z<M;Z++)if(U=s.children[Z],V=U.getBoundingClientRect(),A&&V.left+V.width/2>k||!A&&V.top+V.height/2>I)return U;return null}function D(){var M=p.getBoundingClientRect();return G(A?k>M.left+ht(M)/2:I>M.top+gt(M)/2)}function G(M){return M?Le(p):p}}function Ye(s,p){return typeof l.copy=="boolean"?l.copy:l.copy(s,p)}}function xe(t,e,n,o){var i={mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"},a={mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"},m={mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"};window.navigator.pointerEnabled?Ee[e](t,a[n],o):window.navigator.msPointerEnabled?Ee[e](t,m[n],o):(Ee[e](t,i[n],o),Ee[e](t,n,o))}function ut(t){if(t.touches!==void 0)return t.touches.length;if(t.which!==void 0&&t.which!==0)return t.which;if(t.buttons!==void 0)return t.buttons;var e=t.button;if(e!==void 0)return e&1?1:e&2?3:e&4?2:0}function yn(t){var e=t.getBoundingClientRect();return{left:e.left+ft("scrollLeft","pageXOffset"),top:e.top+ft("scrollTop","pageYOffset")}}function ft(t,e){return typeof window[e]<"u"?window[e]:q.clientHeight?q[t]:be.body[t]}function mt(t,e,n){t=t||{};var o=t.className||"",i;return t.className+=" gu-hide",i=be.elementFromPoint(e,n),t.className=o,i}function kn(){return!1}function pt(){return!0}function ht(t){return t.width||t.right-t.left}function gt(t){return t.height||t.bottom-t.top}function _(t){return t.parentNode===be?null:t.parentNode}function vt(t){return t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.tagName==="SELECT"||Xt(t)}function Xt(t){return!t||t.contentEditable==="false"?!1:t.contentEditable==="true"?!0:Xt(_(t))}function Le(t){return t.nextElementSibling||e();function e(){var n=t;do n=n.nextSibling;while(n&&n.nodeType!==1);return n}}function En(t){return t.targetTouches&&t.targetTouches.length?t.targetTouches[0]:t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t}function ie(t,e){var n=En(e),o={pageX:"clientX",pageY:"clientY"};return t in o&&!(t in n)&&o[t]in n&&(t=o[t]),n[t]}var bn=vn;const wn=Jt(bn),H=document.getElementById("availableTasks"),P=document.getElementById("tasksToExecute"),Ke=document.getElementById("deleteTasks"),Tn=document.getElementById("addNewTaskButton"),Qe=document.getElementById("newTaskModal"),Cn=document.getElementById("closeNewTaskModal"),Ae=document.getElementById("newTaskType"),ke=document.getElementById("newTaskGcode"),In=document.getElementById("saveNewTaskButton"),Sn=document.getElementById("newTaskName"),Bn=document.getElementById("newTaskDescription"),xn=document.getElementById("executeJobButton"),Xe=document.getElementById("taskInfoModal"),Ln=document.getElementById("closeTaskInfoModal"),et=document.getElementById("taskInfoName"),Oe=document.getElementById("taskInfoType"),yt=document.getElementById("taskInfoDescription"),fe=document.getElementById("taskInfoGcode"),Xn=document.getElementById("overideExistingTask"),On=document.getElementById("saveJobButton"),Nn=document.getElementById("saveJobNameInput"),_e=document.getElementById("jobLoadSelect"),Mn=document.getElementById("loadJobToExecute"),$n=document.getElementById("deleteJobToExecute"),Dn=document.getElementById("importJobToExecute"),Zn=document.getElementById("exportJobToExecute"),Je=document.getElementById("overideOrCreateNewModal"),kt=document.getElementById("taskConflictText"),Pn=document.getElementById("overideTaskOnImport"),Rn=document.getElementById("createNewTaskOnImport"),An=document.getElementById("cancelTaskImport");let ae;const Fe=document.getElementById("plannerConnectButton");let je=!1,tt=!1;const Ne=[],nt=document.getElementById("manualTaskModal"),ot=document.getElementById("cncTaskModal"),_n=document.getElementById("cancelManualTask"),Jn=document.getElementById("completeManualTask"),Fn=document.getElementById("manualTaskInstructions"),Et=document.getElementById("cncTaskGcode"),jn=document.getElementById("cancelCncTask"),Gn=document.getElementById("executeGcode"),Ge=document.getElementById("completeCncTask"),zn=document.getElementById("manualTaskName"),Vn=document.getElementById("cncTaskName"),bt=document.getElementById("cncTaskSenderProgressLabel"),st=document.getElementById("cncTaskSenderProgress"),it=document.getElementById("jobCancelledModal"),Hn=document.getElementById("jobCancelledCloseButton"),wt=document.getElementById("completeTaskModal"),qn=document.getElementById("completeTaskCloseButton"),Tt=document.getElementById("notConnectedModal"),Yn=document.getElementById("notConnectedCloseButton");document.addEventListener("DOMContentLoaded",()=>{ae=ze.getInstance(),ae.addStatusChangeListener(()=>e()),n(1,"Insert Stock","manual","Insert stock into chuck",""),n(2,"Mount Tool 0","manual","Insert tool 0 into tool holder",""),n(3,"Select Tool 0","gcode","Run Gcode to select T0","T0"),a(),b(),m(),C(),t();function t(r=!1){r&&(_e.innerHTML=""),Object.keys(localStorage).filter(c=>c.includes("savedJob_")).forEach(c=>{const g=c.replace("savedJob_",""),h=document.createElement("option");h.value=g,h.textContent=g,_e.appendChild(h)})}Yn.onclick=function(){Tt.style.display="none"},Fe.addEventListener("click",()=>{!je&&ae&&ae.connect()});function e(){if(!ae)return;const r=ae.getStatus();if(r.isConnected===!1){Fe.innerText="Connect",je=!1;return}else je=!0,Fe.innerText="Connected",Fe.disabled=!0;const u=r.condition==="run";!u&&tt?(Ge.style.display="block",Ge.disabled=!1,tt=!1):u&&(tt=!0),st.value=r.progress,console.log(`Progress: ${r.progress}`),st.style.display="block",bt.style.display="block"}function n(r,u,c,g,h){const f={id:r,name:u,type:c,description:g,gcode:h},l=document.createElement("div");l.classList.add(`task-${c}`),l.classList.add("available-task"),l.setAttribute("data-task-id",r.toString()),l.setAttribute("data-task-name",u),l.textContent=u;const E=document.createElement("i");E.classList.add("fas","fa-info-circle","fa-fw","show-info","icon-tooltip"),E.setAttribute("data-tooltip","Click for more info..."),l.appendChild(E),H.appendChild(l),localStorage.setItem(`task_${r}`,JSON.stringify(f))}const o=wn([H,P,Ke],{copy:(r,u)=>u===H,accepts:(r,u)=>u===P||u===Ke,revertOnSpill:!0,removeOnSpill:!1});o.on("dragend",()=>{b(),m(),i()});function i(r="currentJob"){const u=P.querySelectorAll(".task-to-execute"),c=[];u.forEach(g=>{const h=g.getAttribute("data-task-id");c.push(h)}),localStorage.setItem(r,c.join(","))}function a(){const r=localStorage.getItem("currentJob");r&&r.split(",").forEach(c=>{const g=localStorage.getItem(`task_${c}`);if(g){const h=JSON.parse(g),f=document.createElement("div");f.classList.add(`task-${h.type}`),f.classList.add("task-to-execute"),f.setAttribute("data-task-id",h.id),f.textContent=h.name,P.appendChild(f)}})}o.on("drop",(r,u,c)=>{const g=r.getAttribute("data-task-id"),h=r.getAttribute("data-task-order");if(u===P)r.classList.remove("available-task"),r.classList.add("task-to-execute"),m();else if(u===Ke){r.remove();let f=null;c===P?f=P.querySelector(`[data-task-order="${h}"]`):c===H&&(f=H.querySelector(`[data-task-id="${g}"]`)),f&&(f.remove(),localStorage.removeItem(`task_${g}`))}});function m(){P.querySelectorAll(".task-to-execute").forEach(u=>{if(u.querySelector("i")){let c=u.querySelector("i");c&&(c.remove(),c=document.createElement("i"),u.classList.contains("task-manual")?(c.className="fas fa-users-cog icon-tooltip",c.setAttribute("data-tooltip","Manual Task")):u.classList.contains("task-gcode")&&(c.className="fas fa-code icon-tooltip",c.setAttribute("data-tooltip","Gcode Task")),u.appendChild(c))}else{const c=document.createElement("i");u.classList.contains("task-manual")?(c.className="fas fa-users-cog icon-tooltip",c.setAttribute("data-tooltip","Manual Task")):u.classList.contains("task-gcode")&&(c.className="fas fa-code icon-tooltip",c.setAttribute("data-tooltip","Gcode Task")),u.appendChild(c)}})}function C(){H.innerHTML="";const r=Object.keys(localStorage).filter(u=>u.includes("task_"));r.sort((u,c)=>{const g=parseInt(u.replace("task_","")),h=parseInt(c.replace("task_",""));return g-h}),r.forEach(u=>{const c=u.replace("task_",""),g=localStorage.getItem(`task_${c}`);if(g){const h=JSON.parse(g),f=document.createElement("div");f.classList.add(`task-${h.type}`),f.classList.add("available-task"),f.setAttribute("data-task-id",h.id),f.textContent=h.name;const l=document.createElement("i");l.classList.add("fas","fa-info-circle","fa-fw","show-info","icon-tooltip"),l.setAttribute("data-tooltip","Click for more info..."),f.appendChild(l),H.appendChild(f)}})}function b(){const r=document.getElementById("tasksToExecute");r&&r.querySelectorAll("div").forEach((c,g)=>{const h=c.getAttribute("data-task-id"),f=localStorage.getItem(`task_${h}`),l=f?JSON.parse(f).name:"";c.setAttribute("data-task-order",(g+1).toString()),c.textContent=`Task ${g+1}: ${l}`})}Ae.addEventListener("change",()=>{Ae.value==="manual"?(ke.disabled=!0,ke.placeholder="Disabled for manual tasks",ke.value=""):(ke.placeholder="Enter gcode here...",ke.disabled=!1)}),Oe.addEventListener("change",()=>{Oe.value==="manual"?(fe.disabled=!0,fe.placeholder="Disabled for manual tasks",fe.value=""):(fe.placeholder="Enter gcode here...",fe.disabled=!1)}),Tn.addEventListener("click",()=>{Qe.style.display="block"}),In.addEventListener("click",()=>{const r=Sn.value,u=document.createElement("div");u.classList.add(`task-${Ae.value}`),u.classList.add("available-task");let c=0;Object.keys(localStorage).filter(l=>l.includes("task_")).forEach(l=>{const E=parseInt(l.replace("task_",""));E>c&&(c=E)}),c=c+1,u.setAttribute("data-task-id",c.toString()),u.setAttribute("data-task-name",r),u.textContent=r;const h=document.createElement("i");h.classList.add("fas","fa-info-circle","fa-fw","show-info","icon-tooltip"),h.setAttribute("data-tooltip","Click for more info..."),u.appendChild(h),H.appendChild(u),Qe.style.display="none";const f={id:c,name:r,type:Ae.value,description:Bn.value,gcode:ke.value};localStorage.setItem(`task_${c}`,JSON.stringify(f))}),Xn.addEventListener("click",()=>{const r=Xe.getAttribute("data-task-id"),u=localStorage.getItem(`task_${r}`);if(u){const g=JSON.parse(u);g.name=et.value,g.type=Oe.value,g.description=yt.value,g.gcode=fe.value,localStorage.setItem(`task_${r}`,JSON.stringify(g))}const c=H.querySelector(`[data-task-id="${r}"]`);if(c){c.textContent=et.value,c.classList.remove("task-manual"),c.classList.remove("task-gcode"),c.classList.add(`task-${Oe.value}`);const g=document.createElement("i");g.classList.add("fas","fa-info-circle","fa-fw","show-info","icon-tooltip"),g.setAttribute("data-tooltip","Click for more info..."),c.appendChild(g)}Xe.style.display="none"}),H.addEventListener("click",r=>{const u=r.target;if(u.matches(".show-info")){const g=u.parentNode.getAttribute("data-task-id"),h=localStorage.getItem(`task_${g}`);if(h){const f=JSON.parse(h);Xe.style.display="block",et.value=f.name,Oe.value=f.type,yt.value=f.description,fe.value=f.gcode,g&&Xe.setAttribute("data-task-id",g.toString())}}}),Cn.onclick=function(){Qe.style.display="none"},Ln.onclick=function(){Xe.style.display="none"},qn.onclick=function(){wt.style.display="none"};function x(){if(Ne.length===0){console.log("All tasks completed"),wt.style.display="block";return}const r=Ne.shift();r&&r.type==="manual"?(zn.textContent=`Task ${r.order}: ${r.name}`,Fn.value=r.description,nt.style.display="block"):r&&r.type==="gcode"&&(Vn.textContent=`Task ${r.order}: ${r.name}`,Et.value=r.gcode,ot.style.display="block",Ge.disabled=!0,st.style.display="none",bt.style.display="none")}_n.onclick=function(){nt.style.display="none",Ne.length=0,it.style.display="block"},jn.onclick=function(){ot.style.display="none",Ne.length=0,it.style.display="block"},Jn.onclick=function(){nt.style.display="none",x()},Ge.onclick=function(){ot.style.display="none",x()},Gn.onclick=function(){ae&&ae.start(Et.value)},Hn.onclick=function(){it.style.display="none"},xn.onclick=function(){if(!je){Tt.style.display="block";return}P.querySelectorAll(".task-to-execute").forEach(u=>{const c=u.getAttribute("data-task-id"),g=u.getAttribute("data-task-order"),h=localStorage.getItem(`task_${c}`);if(h){const f=JSON.parse(h);f.order=parseInt(g||"0"),Ne.push(f)}}),x()},On.onclick=function(){i(`savedJob_${Nn.value}`),t(!0)},Mn.onclick=function(){P.innerHTML="";const r=_e.value,u=localStorage.getItem(`savedJob_${r}`);u&&u.split(",").forEach(g=>{const h=localStorage.getItem(`task_${g}`);if(h){const f=JSON.parse(h),l=document.createElement("div");l.classList.add(`task-${f.type}`),l.classList.add("task-to-execute"),l.setAttribute("data-task-id",f.id),l.textContent=f.name,P.appendChild(l)}}),b(),m()},$n.onclick=function(){const r=_e.value;localStorage.removeItem(`savedJob_${r}`),t(!0)},Dn.onclick=function(){const r=document.createElement("input");r.type="file",r.accept=".json",r.onchange=function(u){var g;const c=(g=u.target.files)==null?void 0:g[0];if(c){const h=new FileReader;h.onload=function(f){var E;const l=(E=f.target)==null?void 0:E.result;if(l){const re=JSON.parse(l).tasks,j=[];re.forEach(y=>{const N=localStorage.getItem(`task_${y.id}`);if(N){const w=JSON.parse(N);(y.name!==w.name||y.type!==w.type||y.description!==w.description||y.gcode!==w.gcode)&&j.push({importId:y.id,importName:y.name,importType:y.type,importDescription:y.description,importGcode:y.gcode,existingId:w.id,existingName:w.name,existingType:w.type,existingDescription:w.description,exisitingGcode:w.gcode})}}),j.length>0?(Je.style.display="block",kt.textContent=`The following tasks already exist in the current job. Please select an action for each task.

`,j.forEach(y=>{kt.textContent+=`Import Task ${y.importId} already exists.

                Import Task Name: ${y.importName} | Existing Task Name: ${y.existingName}

                Import Task Type: ${y.importType} | Existing Task Type: ${y.existingType}

                Import Task Description: ${y.importDescription} | Existing Task Description: ${y.existingDescription}

`}),Pn.onclick=function(){P.innerHTML="",j.forEach(y=>{const N={id:y.importId,name:y.importName,type:y.importType,description:y.importDescription,gcode:y.importGcode};if(localStorage.setItem(`task_${y.importId}`,JSON.stringify(N)),N){const w=document.createElement("div");w.classList.add(`task-${N.type}`),w.classList.add("task-to-execute"),w.setAttribute("data-task-id",N.id.toString()),w.textContent=N.name,P.appendChild(w)}}),Je.style.display="none",b(),m(),i(),C()},Rn.onclick=function(){let y=0;Object.keys(localStorage).filter(w=>w.includes("task_")).forEach(w=>{const R=parseInt(w.replace("task_",""));R>y&&(y=R)}),P.innerHTML="",j.forEach(w=>{y=y+1;const R={id:y,name:w.importName,type:w.importType,description:w.importDescription,gcode:w.importGcode};if(localStorage.setItem(`task_${y}`,JSON.stringify(R)),R){const Y=document.createElement("div");Y.classList.add(`task-${R.type}`),Y.classList.add("task-to-execute"),Y.setAttribute("data-task-id",R.id.toString()),Y.textContent=R.name,P.appendChild(Y)}}),Je.style.display="none",b(),m(),i(),C()},An.onclick=function(){Je.style.display="none"}):(P.innerHTML="",re.forEach(y=>{const N={id:y.id,name:y.name,type:y.type,description:y.description,gcode:y.gcode};localStorage.setItem(`task_${y.id}`,JSON.stringify(N));const w=document.createElement("div");w.classList.add(`task-${N.type}`),w.classList.add("task-to-execute"),w.setAttribute("data-task-id",N.id.toString()),w.textContent=N.name,P.appendChild(w)}),b(),m(),i(),C())}},h.readAsText(c)}},r.click()},Zn.onclick=function(){const r=localStorage.getItem("currentJob");if(r){const u=r.split(","),c={tasks:[]};u.forEach(l=>{const E=localStorage.getItem(`task_${l}`);if(E){const ee=JSON.parse(E);c.tasks.push(ee)}});const g=new Blob([JSON.stringify(c)],{type:"application/json"}),h=URL.createObjectURL(g),f=document.createElement("a");f.href=h,f.download="currentJob.json",f.click(),URL.revokeObjectURL(h)}}});const O=ace.edit("gcodeEditor"),Q=ace.edit("gcodeResponseEditor"),F=ace.edit("gcodeSenderEditor"),Wn="#DC143C",Un="#6B8E23",Kn="#FFA500";document.addEventListener("DOMContentLoaded",()=>{new At;const t=document.getElementById("gcodeCanvas"),e=document.getElementById("zoomCanvas");let n=null;const o=document.getElementById("fileInput"),i=document.getElementById("simulateButton"),a=document.getElementById("showCuts"),m=document.getElementById("showNonCuts"),C=document.getElementById("sliderLabel"),b=document.getElementById("zoomSliderLabel"),x=document.getElementById("progressSlider"),r=document.getElementById("zoomProgressSlider"),u=document.getElementById("sliderContainer"),c=document.getElementById("displayOptionsContainer"),g=document.getElementById("clearButton"),h=document.querySelector(".saveGCodeNameInput"),f=document.querySelector(".loadGCodeSelect"),l=document.querySelector(".loadGCodeButton"),E=document.querySelector(".saveGCodeButton"),ee=document.querySelector(".deleteGCodeButton"),re=document.getElementById("gcodeSenderContainer"),j=document.getElementById("exampleCode"),y=document.getElementById("helpModal"),N=document.getElementById("helpButton"),w=document.getElementById("closeHelpModal"),R=document.getElementById("zoomModal"),Y=document.getElementById("zoomButton"),we=document.getElementById("closeZoomModal"),Ve=document.getElementById("zoomCloseButton"),He=document.getElementById("simulationTab"),$e=document.getElementById("controlTab"),qe=document.getElementById("plannerTab"),pe=document.getElementById("simulationContainer"),he=document.getElementById("controlsContainer"),ce=document.getElementById("plannerContainer"),Te=document.querySelectorAll("#latheControls .increment-btn"),De=document.getElementById("moveDistance");Te.forEach(function(d){d.addEventListener("click",function(){Te.forEach(function(T){T.classList.remove("active")}),this.classList.add("active");var v=this.dataset.increment;De.value=v,console.log("Jog increment set to:",v)})}),He.addEventListener("click",()=>{pe.style.display="flex",he.style.display="none",ce.style.display="none",O.setValue(F.getValue())}),$e.addEventListener("click",()=>{pe.style.display="none",he.style.display="flex",ce.style.display="none",F.setValue(O.getValue())}),qe.addEventListener("click",()=>{pe.style.display="none",he.style.display="none",ce.style.display="flex"}),e.width=window.visualViewport.width-100,e.height=window.visualViewport.height-150,window.addEventListener("resize",function(){e.width=window.visualViewport.width-100,e.height=window.visualViewport.height-150,r.value=r.min,ge(e)}),Y.onclick=function(){R.style.display="block",ge(e)},we.onclick=function(){R.style.display="none"},Ve.onclick=function(){R.style.display="none"},N.onclick=function(){y.style.display="block"},w.onclick=function(){y.style.display="none"},window.onclick=function(d){d.target==y&&(y.style.display="none"),d.target==R&&(R.style.display="none")},E.addEventListener("click",()=>Ye()),l.addEventListener("click",()=>s()),ee.addEventListener("click",()=>p()),k(),O.setTheme("ace/theme/github_dark"),O.session.setMode("ace/mode/plain_text"),O.setShowPrintMargin(!1),F.setTheme("ace/theme/github_dark"),F.session.setMode("ace/mode/plain_text"),F.setShowPrintMargin(!1),j.addEventListener("click",()=>V()),Q.setTheme("ace/theme/monokai"),Q.session.setMode("ace/mode/text"),Q.setReadOnly(!0),Q.setShowPrintMargin(!1),Q.getSession().on("change",()=>{setTimeout(()=>{var d=Q.getSession().getLength();Q.scrollToLine(d,!0,!0,function(){})},0)}),F.on("focus",()=>{F.getValue()==="Paste your gcode here or click choose file to upload"&&F.setValue("")}),I();let te=0,W=0,ne=0,le=0,de=0,Ce=0,Ze=5,Ie=0,Se=0,L=[];x.oninput=()=>{const d=Math.floor(parseInt(x.value));if(d<L.length){const v=L[d];let T=M(L,t);Z(t,L,T,d),A(v)}},r.oninput=()=>{const d=Math.floor(parseInt(r.value));if(d<L.length){const v=L[d];let T=M(L,e);Z(e,L,T,d),B(v)}},g.addEventListener("click",()=>{F.setValue(""),O.setValue(""),I();const d=t.getContext("2d");d&&(d.clearRect(0,0,t.width,t.height),o.value="",x.value="0",r.value="0",u.style.display="none",c.style.display="none")}),o.addEventListener("change",d=>{if(d.target instanceof HTMLInputElement&&d.target.files&&d.target.files.length>0){const v=d.target.files[0];v&&oe(v)}}),i.addEventListener("click",()=>{ge(t)});function ge(d){if(!d)return;const v=O.getValue();if(v){D(v);let T=M(L,d);Z(d,L,T),u.style.display="block",c.style.display="block",a.addEventListener("change",G),m.addEventListener("change",G),x.max=(L.length-1).toString(),x.value=x.min,r.max=(L.length-1).toString(),r.value=r.min,re.style.display="block"}}function Ye(){const d=h.value.trim();if(!d)return;const v=`gCode-${d}`;localStorage.setItem(v,O.getValue()),k(v),h.value=""}function s(){const d=f.value,v=localStorage.getItem(d);v&&(O.setValue(v),F.setValue(v))}function p(){const d=f.value;localStorage.removeItem(d),k()}function k(d){f.innerHTML="";let v=!1;for(let T=0;T<localStorage.length;T++){const X=localStorage.key(T);if(X&&X!=="latheCode"&&X.startsWith("gCode-")){v=!0;const $=document.createElement("option"),J=X.replace("gCode-","");$.value=X,$.textContent=J,f.appendChild($),X===d&&($.selected=!0)}}if(v){const T=Array.from(f.options).sort((X,$)=>X.text.localeCompare($.text));f.innerHTML="",T.forEach(X=>{f.appendChild(X)})}else{const T=document.createElement("option");T.textContent="No items saved",T.disabled=!0,f.appendChild(T)}}function I(){O.getValue()===""&&(O.setValue("Paste your gcode here or click choose file to upload"),O.gotoLine(1,0),O.on("focus",function(){O.getValue()==="Paste your gcode here or click choose file to upload"&&O.setValue("")}))}function A(d){(d==null?void 0:d.lineNumber)!==void 0?(O.gotoLine(d.lineNumber,0,!0),C.innerHTML=`Line:${d.lineNumber}<br>${d==null?void 0:d.originalLine}`||""):C.innerHTML=""}function B(d){(d==null?void 0:d.lineNumber)!==void 0?(O.gotoLine(d.lineNumber,0,!0),b.innerHTML=`Line:${d.lineNumber}<br>${d==null?void 0:d.originalLine}`||""):b.innerHTML=""}function oe(d){const v=new FileReader;v.onload=T=>{const X=T.target.result;O.setValue(X),F.setValue(X)},v.readAsText(d)}function D(d){const v=[];let T=!1;return L=[],d.split(`
`).forEach(($,J)=>{const Be=$.includes("; cut")?0:$.includes("; retract")?2:1,z={isRelative:T,movementType:Be},ue=$.match(/([GXYZF])([0-9.-]+)/g);ue==null||ue.forEach(Pe=>{const ye=parseFloat(Pe.slice(1));switch(Pe[0]){case"G":ye===90&&(z.isRelative=!1,T=!1),ye===91&&(z.isRelative=!0,T=!0);break;case"X":z.x=ye;break;case"Z":z.z=ye;break}});const ve={...z,lineNumber:J+1,originalLine:$};(z.z!==void 0||z.x!==void 0)&&L.push(ve),v.push(ve)}),v}function G(){x.value="0";const d=M(L,t);Z(t,L,d,L.length)}function M(d,v){let T=0,X=0,$=0,J=0,Be=0,z=0,ue=0,ve=0;v.id==="zoomCanvas"?ve=80:ve=40,d.forEach(K=>{K.isRelative?(K.x!==void 0&&(T+=K.x),K.z!==void 0&&(X+=K.z)):(K.x!==void 0&&($=Math.min($,K.x)),K.z!==void 0&&(J=Math.max(J,K.z)));const $t=T+=$,ct=X+=J;$=0,J=0,Be=Math.max(Be,Math.abs($t)),z=Math.max(z,Math.abs(ct)),ue=Math.min(ue,ct)});const Pe=Be,ye=z-ue,Ot=v.height/2,rt=1,Nt=Ot/Pe-rt,Mt=v.width/ye-rt;return Math.min(Nt,Mt,ve)}function Z(d,v,T,X){if(n=d.getContext("2d"),!n)return;n.clearRect(0,0,d.width,d.height),te=0,W=0,de=0,Ce=0,ne=0,le=0,ne=d.height/2,le=d.width-Ze;const $=X!==void 0?Math.min(X+1,v.length):v.length;for(let J=0;J<$;J++)U(d,v[J],T)}function U(d,v,T){n=d.getContext("2d"),n&&(n.lineWidth=2,v.isRelative?(te+=v.x??0,W+=v.z??0):(te=v.x??de,W=v.z??Ce,de=te,Ce=W),Ie=d.height/2-te*T,Se=d.width-W*T-Ze,(v.movementType==0&&a.checked||v.movementType==1&&m.checked||v.movementType==2&&m.checked)&&(n.beginPath(),n.strokeStyle=v.movementType==0?Wn:v.movementType==1?Un:Kn,n.moveTo(le,ne),n.lineTo(Se,Ie),n.stroke()),ne=Ie,le=Se)}function V(){O.setValue(_t)}});

</script>
  <style>
:root{font-family:Inter,system-ui,Avenir,Helvetica,Arial,sans-serif;line-height:1.5;font-weight:400;color-scheme:light dark;color:#ffffffde;background-color:#242424;font-synthesis:none;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}a{font-weight:500;color:#646cff;text-decoration:inherit}a:hover{color:#535bf2}h1{font-size:3.2em;line-height:1.1}#app{max-width:1280px;margin:0 auto;padding:2rem;text-align:center}.logo{height:6em;padding:1.5em;will-change:filter;transition:filter .3s}.logo:hover{filter:drop-shadow(0 0 2em #646cffaa)}.logo.vanilla:hover{filter:drop-shadow(0 0 2em #3178c6aa)}.card{padding:2em}.read-the-docs{color:#888}button{border-radius:3px;border:1px solid transparent;padding:.6em 1.2em;font-size:1em;font-weight:500;font-family:inherit;background-color:#1a1a1a;cursor:pointer;transition:background-color .25s;border:2px solid white}button:hover{background-color:#646cff}button:focus,button:focus-visible{outline:4px auto -webkit-focus-ring-color}@media (prefers-color-scheme: light){:root{color:#213547;background-color:#fff}a:hover{color:#747bff}button{background-color:#f9f9f9}}.main-container{display:flex;align-items:start}.controls-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;width:800px;max-width:1280px;text-align:center;border:1px solid #ccc}.canvas-container{display:flex;flex-direction:column;align-items:center;margin:5px;border:1px solid #ccc}.canvas-wrapper{display:flex;flex-direction:column;align-items:center}.innerContainer{margin:5px;align-items:center;width:auto}.modal-pad{padding-top:10px}.modal-pad-bottom{padding-bottom:10px}.innerContainer.toolbar{display:flex;align-items:center;gap:5px;padding:2px}.saveGCodeNameInput,.loadGCodeSelect{flex-grow:1}#gcodeCanvas{border-bottom:1px solid #ccc;background-color:#242424}#gcodeInput{position:relative;background:transparent;width:100%;height:240px;font-family:monospace;font-size:13px;line-height:1.5;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}#gcodeContainer{position:relative;width:100%}#gcodeSenderContainer{display:block}.save-group,.load-group,.import-export-group{display:flex;flex-direction:row;align-items:center;gap:10px}.toolbar input[type=text],.toolbar select{max-width:200px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem;font-size:1rem;line-height:1.5}input[type=file]::file-selector-button{border:2px solid #6c5ce7;padding:.2em .4em;border-radius:.2em;background-color:#1a1a1a;transition:.25s}input[type=file]::-ms-browse:hover{background-color:#646cff}input[type=file]::-webkit-file-upload-button:hover{background-color:#646cff}input[type=file]::file-selector-button:hover{background-color:#646cff}.bottom-container{margin:5px}#gcodeResponseContainer{border:1px solid #ccc;width:100%;display:flex;flex-direction:column;align-items:center;margin-top:5px}.senderError{display:none;color:#fff;background-color:red;padding:10px;border-radius:5px;animation:flashError 1s infinite}@keyframes flashError{0%,to{opacity:1}50%{opacity:0}}#helpText li{margin-bottom:10px}#helpText a{color:#f95959}.help-modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.help-modal-content{position:relative;background-color:#242424;margin:15% auto;padding:20px;border:2px solid #6c5ce7;width:30%}.zoom-modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#242424}.zoom-modal-content{display:flex;flex-direction:column;align-items:center;margin:10px auto;padding:20px;border:1px solid #888}.close-modal{position:absolute;top:0;right:0;padding-right:10px;cursor:pointer;font-size:35px}#sliderAndButtonContainer{display:flex;justify-content:center;align-items:center;gap:10px}.text-red{color:#dc143c}.text-green{color:#6b8e23}.text-orange{color:orange}.line{display:inline-block;vertical-align:middle;width:20px;height:2px;margin-right:5px}.red-line{border-top:2px solid #DC143C}.green-line{border-top:2px solid #6B8E23}.orange-line{border-top:2px solid #FFA500}#latheControls #jogControls{display:grid;grid-template-columns:repeat(9,60px);grid-template-rows:repeat(5,60px);justify-content:center;align-items:center;place-items:center}#latheControls .jog-btn,#latheControls .tool-btn{width:50px;height:50px;border-radius:5px;cursor:pointer;background-color:#f0ad4e;display:flex;justify-content:center;align-items:center;text-align:center;line-height:50px;font-size:24px;padding:0}#latheControls .tool{background-color:#f0ad4e;border:none}#latheControls .tool-selected{background-color:#6c5ce7;border:2px solid white}#latheControls .fast{background-color:#f0ad4e}#latheControls .slow{background-color:#5bc0de}#latheControls .jog-btn:hover{background-color:#6c5ce7}#fastForward{grid-column:5;grid-row:1}#fastText{grid-column:4;grid-row:1}#slowText{grid-column:4;grid-row:2}#fastLeft{grid-column:3;grid-row:3}#fastBackward{grid-column:5;grid-row:5}#fastRight{grid-column:7;grid-row:3}#slowForward{grid-column:5;grid-row:2}#slowLeft{grid-column:4;grid-row:3}#slowBackward{grid-column:5;grid-row:4}#slowRight{grid-column:6;grid-row:3}#toolText{grid-column:1;grid-row:1}#tool0{grid-column:1;grid-row:2}#tool1{grid-column:1;grid-row:3}#tool2{grid-column:1;grid-row:4}#tool3{grid-column:1;grid-row:5}.menu ul{list-style-type:none;padding:0}.menu li{cursor:pointer;padding:10px;background-color:#242424;border-bottom:1px solid #6c5ce7}.menu li:hover{background-color:#6c5ce7}.content{margin-left:200px;padding:20px}#senderProgressContainer{display:flex;justify-content:center;align-items:center}#senderProgressLabel{margin-right:10px}.innerContentCentre{display:flex;justify-content:center;align-items:center;margin:10px}#gcodeSenderContainer{position:relative;width:100%}#gcodeSenderEditor{border-bottom:1px solid #ccc;background-color:#242424}#latheControls #incrementControls{display:flex;justify-content:center;gap:10px;margin:10px 0 20px}#latheControls .increment-btn{padding:5px 10px;border:1px solid #ccc;background-color:#f0ad4e;border-radius:5px;cursor:pointer;transition:background-color .3s}#latheControls .increment-btn:hover,#latheControls .increment-btn.active{background-color:#6c5ce7}.control-inputs input[type=text]{max-width:200px;width:100%;box-sizing:border-box;border:1px solid #ccc;margin:0;padding:.375rem .75rem}.control-inputs label{display:block;margin-right:5px}#latheControls label{white-space:nowrap;margin-right:10px;display:inline-block;min-width:120px}.planner-container{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:5px;width:800px;max-width:1280px;text-align:center;border:1px solid #ccc}.planner-container h1{margin:10px 0}.planner-guidance{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:10px;text-align:center}.planner-guidance span{display:block;margin:10px 0;text-align:left}#taskContainer{display:flex;justify-content:space-between;align-items:start;padding:20px}.container-wrapper{padding:10px}.container-wrapper-inner{padding:5px 0}.container-wrapper-outer{border:1px solid #ccc;border-radius:5px;margin:10px;background-color:#333}.container-wrapper-delete{min-height:50px;display:flex;justify-content:center;align-items:center;border:2px dashed red}#availableTasks{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;align-items:start;min-width:450px}#availableTasks .span-2-rows{grid-row:span 3;height:100%}#availableTasks div{box-sizing:border-box;padding:5px}#tasksToExecute{min-height:50px;padding:5px;border:2px dashed green}#tasksToExecute div{margin:5px}.task-to-execute{text-align:left}.task-to-execute i{text-align:left;margin-left:5px;cursor:help}.available-task{width:150px;-webkit-user-select:none;user-select:none}.available-task i{margin-left:5px;cursor:help}.task-manual{background-color:#4c956c}.task-gcode{background-color:#386e97}.task-container{margin:5px}.task-container>div,.gu-mirror{transition:opacity .4s ease-in-out}.task-container>div{padding:5px;cursor:move;cursor:grab;cursor:-moz-grab;cursor:-webkit-grab;display:flex;align-items:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.gu-mirror{padding:5px;text-align:center;cursor:grabbing;cursor:-moz-grabbing;cursor:-webkit-grabbing}.task-container .ex-moved{background-color:#e74c3c}.task-container.ex-over{background-color:#ffffff4d}.planner-save-text{max-width:none!important}.planner-save-button{flex:auto}.planner-load-select{max-width:none!important}.planner-load-delete-buttons{width:50%}.planner-saving-label{text-wrap:nowrap}.no-marge{margin:0}.task-modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0006}.task-modal-content{position:relative;background-color:#242424;margin:15% auto;padding:20px;border:2px solid #6c5ce7;max-width:600px;min-width:600px}.center-modal{text-align:center}.icon-tooltip{position:relative;cursor:pointer}.icon-tooltip:after{content:attr(data-tooltip);position:absolute;bottom:100%;left:50%;transform:translate(-50%);white-space:nowrap;z-index:1;background-color:#000;color:#fff;padding:5px;border-radius:4px;opacity:0;visibility:hidden;transition:opacity .2s,visibility .2s}.icon-tooltip:hover:after{opacity:1;visibility:visible}.gu-mirror{position:fixed!important;margin:0!important;z-index:9999!important;opacity:.8}.gu-hide{display:none!important}.gu-unselectable{-webkit-user-select:none!important;-moz-user-select:none!important;-ms-user-select:none!important;user-select:none!important}.gu-transit{opacity:.2}

</style>
</head>

<body>

    <div id="mainContainer" class="main-container">
        <div class="menu">
            <ul>
                <li id="simulationTab">Simulation</li>
                <li id="controlTab">Control</li>
                <li id="plannerTab">Planner</li>
            </ul>
        </div>

        <div id="simulationContainer" class="main-container">
            <div id="simulationContent" class="controls-container">
                <div id="gcodeContainer" style="position: relative;">
                    <div id="gcodeEditor" style="height: 200px; width: 100%;"></div>
                </div>
                <div class="innerContainer">
                    <input type="file" id="fileInput" accept=".txt,.gcode">
                </div>
                <div class="innerContainer">
                    <button id="simulateButton">Simulate</button>
                    <button id="clearButton">Clear</button>
                    <button id="helpButton">How to use</button>
                </div>

                <div class="innerContainer" id="loadAndSave">

                    <hr>
                    <div class="innerContainer toolbar">
                        <input type="text" class="saveGCodeNameInput" placeholder="name of save"></input>
                        <button class="saveGCodeButton" title="Save GCode to local browser storage">Save local</button>
                    </div>
                    <div class="innerContainer toolbar">
                        <select class="loadGCodeSelect"></select>
                        <button class="loadGCodeButton" title="Load GCode from local browser storage">Load</button>
                        <button class="deleteGCodeButton" title="Delete GCode from local browser storage">Delete</button>
                    </div>
                    <hr>
                </div>
            </div>

            <div class="canvas-container">
                <canvas id="gcodeCanvas" width="800" height="600"></canvas>
                <div id="sliderContainer" class="innerContainer" style="display: none; width: 400px;">
                    <input type="range" id="progressSlider" min="0" max="100" value="0" style="width: 100%;">
                    <div id="sliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                </div>
                <div id="displayOptionsContainer" class="innerContainer" style="display: none;">
                    <input type="checkbox" id="showCuts" checked> Show Cut Moves
                    </label>
                    <label>
                        <input type="checkbox" id="showNonCuts" checked>
                        Show Non-Cut Moves
                    </label>
                </div>
                <div class="innerContainer"><button id="zoomButton" title="Zoom in">Zoom In</button></div>
            </div>

        </div>
        <div id="controlsContainer" class="main-container" style="display: none;">
            <div id="controlsContent" class="controls-container">
                <div id="gcodeSenderContainer" class="innerContainer">

                    <span>Send GCode to Nano ELS H4</span>

                    <div class="innerContainer">
                        <button id="connectButton" title="Connect to Nano ELS H4">Connect</button>
                        <button id="gcodeSenderButton" title="Send GCode to CNC" style="display: none;">Send</button>
                        <button id="stopButton" style="display: none;">Stop</button>
                    </div>
                </div>

                <div id="latheControls">
                    <div id="jogControls">
                        <span id="fastText">Fast</span>
                        <span id="slowText">Slow</span>
                        <span id="toolText">Tool</span>

                        <!-- Tools -->
                        <button class="tool-btn tool-selected" id="tool0">T0</button>
                        <button class="tool-btn" id="tool1">T1</button>
                        <button class="tool-btn" id="tool2">T2</button>
                        <button class="tool-btn" id="tool3">T3</button>
                        <!-- Fast arrows -->
                        <button class="arrow fast jog-btn" id="fastForward"><i class="fas fa-arrow-up"></i></button>
                        <button class="arrow fast jog-btn" id="fastBackward"><i class="fas fa-arrow-down"></i></button>
                        <button class="arrow fast jog-btn" id="fastLeft"><i class="fas fa-arrow-left"></i></button>
                        <button class="arrow fast jog-btn" id="fastRight"><i class="fas fa-arrow-right"></i></button>
                        <!-- Slow arrows -->
                        <button class="arrow slow jog-btn" id="slowForward"><i class="fas fa-arrow-up"></i></button>
                        <button class="arrow slow jog-btn" id="slowBackward"><i class="fas fa-arrow-down"></i></button>
                        <button class="arrow slow jog-btn" id="slowLeft"><i class="fas fa-arrow-left"></i></button>
                        <button class="arrow slow jog-btn" id="slowRight"><i class="fas fa-arrow-right"></i></button>
                    </div>
                    <div id="incrementControls">
                        <button class="increment-btn" data-increment="0.01">0.01</button>
                        <button class="increment-btn" data-increment="0.1">0.1</button>
                        <button class="increment-btn active" data-increment="1">1</button>
                        <button class="increment-btn" data-increment="10">10</button>
                    </div>
                    <div id="feedrateControls" class="innerContentCentre control-inputs">
                        <label for="fastFeedrate">Fast Feedrate:</label>
                        <input type="text" id="fastFeedrate" name="fastFeedrate" value="200">
                        <label for="slowFeedrate">Slow Feedrate:</label>
                        <input type="text" id="slowFeedrate" name="slowFeedrate" value="50">
                    </div>
                    <div id="distanceControl" class="innerContentCentre control-inputs">
                        <label for="moveDistance">Move Distance (mm):</label>
                        <input type="text" id="moveDistance" name="moveDistance" value="1">
                    </div>
                </div>

                <div id="gcodeResponseContainer" style="display: none;">
                    <div id="gcodeResponseHeader">GCode Responses</div>
                    <div id="gcodeResponseEditor" style="height: 200px; width: 100%;"></div>
                    <div class="senderError" style="display: none;"></div>
                    <div id="senderProgressContainer">
                        <span id="senderProgressLabel" style="display: none;">Progress...</span>
                        <progress id="senderProgress" max="1" style="display: none;"></progress>
                    </div>
                </div>
            </div>
            <div class="controls-container">
                <div id="gcodeSenderContainer" style="position: relative;">
                    <span>GCode to Send</span>
                    <div id="gcodeSenderEditor" style="height: 200px; width: 100%;"></div>
                </div>
            </div>
        </div>
        <div id="plannerContainer" class="main-container" style="display: none;">
            <div id="plannerContent" class="planner-container">
                <div class="innerContainer">
                    <h1>Planner</h1>
                    <div class="planner-guidance">
                        <span>Use this tool to create a job of tasks to execute. This can be manual, gcode or a
                            combination
                            of the two.
                            When you click execute the job wizard will execute the tasks one after another. Each task
                            with require confirmation to start.</span>
                    </div>
                </div>
                <div class="innerContainer">
                    <h1>Device status</h1>
                    <button id="plannerConnectButton">Connect</button>
                </div>
                <div id="taskContainer">
                    <div class="container-wrapper-outer">
                        <div class="container-wrapper">
                            <h2>Current Job</h2>
                            <div id="tasksToExecute" class="task-container">
                            </div>
                        </div>
                        <div class="container-wrapper">
                            <button id="executeJobButton">Execute Job</button>
                        </div>
                        <hr>
                        <div class="container-wrapper">
                            <div class="innerContainer" id="loadAndSaveJob">
                                <span class="planner-saving-label">Load and save jobs</span>
                                <div class="innerContainer toolbar">
                                    <input id="saveJobNameInput" type="text" class="planner-save-text" placeholder="Name of Job"></input>
                                </div>
                                <div class="innerContainer toolbar">
                                    <button id="saveJobButton" class="planner-save-button" title="Save Job to local browser storage">Save
                                        local</button>
                                </div>
                                <div class="innerContainer toolbar">
                                    <select id="jobLoadSelect" class="planner-load-select">
                                    </select>
                                </div>
                                <div class="innerContainer toolbar">
                                    <button id="loadJobToExecute" class="planner-load-delete-buttons" title="Load Job from local browser storage">Load</button>
                                    <button id="deleteJobToExecute" class="planner-load-delete-buttons" title="Delete Job from local browser storage">Delete</button>
                                </div>
                                <div class="container-wrapper-inner">
                                    <hr>
                                </div>
                                <span class="planner-saving-label">Import and export Job to JSON</span>
                                <div class="innerContainer toolbar">
                                    <button id="importJobToExecute" class="planner-load-delete-buttons" title="Import Job from JSON file">Import</button>
                                    <button id="exportJobToExecute" class="planner-load-delete-buttons" title="Export Job to JSON">Export</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="container-wrapper-outer">
                        <div class="container-wrapper">
                            <h2>Available Tasks</h2>
                            <div id="availableTasks" class="task-container">
                            </div>
                        </div>
                        <div class="container-wrapper">
                            <div class="container-wrapper-inner">
                                <span>Drag here to delete</span>
                            </div>
                            <div id="deleteTasks" class="container-wrapper-delete">
                            </div>
                        </div>
                        <div class="container-wrapper">
                            <button id="addNewTaskButton">Add New Task</button>
                        </div>
                        <div class="container-wrapper-inner">
                            <hr class="no-marge">
                        </div>
                        <div class="container-wrapper">
                            <div class="innerContainer" id="loadAndSaveAvailableTasks">
                                <div class="container-wrapper-inner">
                                    <span class="planner-saving-label">Load and save task collections</span>
                                </div>
                                <div class="innerContainer toolbar">
                                    <input type="text" class="planner-save-text" placeholder="Task collection name"></input>
                                </div>
                                <div class="innerContainer toolbar">
                                    <button class="planner-save-button" title="Save Task to local browser storage">Save
                                        local</button>
                                </div>
                                <div class="innerContainer toolbar">
                                    <select class="planner-load-select">
                                        <option value="" disabled selected>Select your option</option>
                                    </select>
                                </div>
                                <div class="innerContainer toolbar">
                                    <button id="loadTaskCollection" class="planner-load-delete-buttons" title="Load selected collection">Load collection</button>
                                    <button id="deletetaskCollection" class="planner-load-delete-buttons" title="Delete selected collection">Delete collection</button>
                                </div>
                                <div class="container-wrapper-inner">
                                    <hr>
                                </div>
                                <span class="planner-saving-label">Import and export tasks via JSON</span>
                                <div class="innerContainer toolbar">
                                    <button id="importAvailableTasks" class="planner-load-delete-buttons" title="Import tasks from JSON file">Import</button>
                                    <button id="exportAvailableTask" class="planner-load-delete-buttons" title="Export tasks to JSON">Export</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Not Connected warning -->
        <div id="notConnectedModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Not Connected</h2>
                <div class="modal-pad-bottom">
                    <span>Please connect to the controller before executing jobs</span>
                </div>
                <div class="modal-pad">
                    <button id="notConnectedCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Manual Task Modal -->
        <div id="manualTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>Manual Task Instructions</h2>
                <hr>
                <div>
                    <span id="manualTaskName"></span>
                </div>
                <div class="modal-pad">
                    <textarea id="manualTaskInstructions" name="manualTaskInstructions" rows="4" cols="50" disabled></textarea>
                </div>
                <div class="modal-pad">
                    <button id="cancelManualTask">Cancel</button>
                    <button id="completeManualTask">Mark Complete</button>
                </div>
            </div>
        </div>
        <!-- Gcode Task Modal -->
        <div id="cncTaskModal" class="task-modal">
            <div class="task-modal-content">
                <h2>CNC Task Gcode</h2>
                <hr>
                <div>
                    <span id="cncTaskName"></span>
                </div>
                <div class="modal-pad">
                    <textarea id="cncTaskGcode" name="cncTaskGcode" rows="4" cols="50" disabled></textarea>
                </div>
                <div class="modal-pad">
                    <button id="cancelCncTask">Cancel</button>
                    <button id="executeGcode">Execute Gcode</button>
                </div>
                <div class="modal-pad">
                    <button id="completeCncTask" disabled>Mark Complete</button>
                </div>
                <div id="cncTaskSenderProgressContainer" class="modal-pad">
                    <span id="cncTaskSenderProgressLabel">Execution in progress...</span>
                    <progress id="cncTaskSenderProgress" max="1"></progress>
                </div>
            </div>
        </div>
        <!-- All tasks Complete Modal -->
        <div id="completeTaskModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>All Tasks Complete</h2>
                <div class="modal-pad">
                    <button id="completeTaskCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- Job Cancelled Modal -->
        <div id="jobCancelledModal" class="task-modal">
            <div class="task-modal-content center-modal">
                <h2>Job Cancelled</h2>
                <div>
                    <button id="jobCancelledCloseButton">Close</button>
                </div>
            </div>
        </div>
        <!-- overide modal-->
        <div id="overideOrCreateNewModal" class="task-modal">
            <div class="task-modal-content">
                <span id="closeOverideOrCreateNewModal" class="close-modal">&times;</span>
                <div>
                    <div>This job has tasks that conflict with the available tasks</div>
                    <div class="modal-pad">
                        <textarea id="taskConflictText" name="taskConflictText" rows="4" cols="50" disabled></textarea>
                    </div>
                    <div>Would you like to overide the tasks or create new ones?</div>
                    <div class="modal-pad">
                        <button id="overideTaskOnImport">Overide Tasks</button>
                        <button id="createNewTaskOnImport">Create New Tasks</button>
                        <button id="cancelTaskImport">Cancel Import</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="newTaskModal" class="task-modal">
            <div class="task-modal-content">
                <span id="closeNewTaskModal" class="close-modal">&times;</span>
                <div id="newTaskHelpText">
                    <h2>Add a new task</h2>
                    <hr>
                    <div class="modal-pad">Task Name:</div>
                    <div>
                        <input type="text" id="newTaskName" name="newTaskName" placeholder="Enter task name...">
                    </div>
                    <div class="modal-pad">Task Type:</div>
                    <div>
                        <select id="newTaskType" name="newTaskType">
                            <option value="manual">Manual</option>
                            <option value="gcode">GCode</option>
                        </select>
                    </div>
                    <div class="modal-pad">Task Description:</div>
                    <div>
                        <textarea id="newTaskDescription" name="newTaskDescription" rows="4" cols="50" placeholder="Enter Description..."></textarea>
                    </div>
                    <div class="modal-pad">Task GCode:</div>
                    <div>
                        <textarea id="newTaskGcode" name="newTaskGcode" rows="4" cols="50" placeholder="Disabled for manual tasks" disabled></textarea>
                    </div>
                    <div class="modal-pad">
                        <button id="saveNewTaskButton">Save</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="taskInfoModal" class="task-modal">
            <div class="task-modal-content">
                <span id="closeTaskInfoModal" class="close-modal">&times;</span>
                <div id="newTaskHelpText">
                    <h2>Task Info</h2>
                    <hr>
                    <div class="modal-pad">Task Name:</div>
                    <div>
                        <input type="text" id="taskInfoName" name="newTaskName" placeholder="Enter task name...">
                    </div>
                    <div class="modal-pad">Task Type:</div>
                    <div>
                        <select id="taskInfoType" name="newTaskType">
                            <option value="manual">Manual</option>
                            <option value="gcode">GCode</option>
                        </select>
                    </div>
                    <div class="modal-pad">Task Description:</div>
                    <div>
                        <textarea id="taskInfoDescription" name="newTaskDescription" rows="4" cols="50" placeholder="Enter Description..."></textarea>
                    </div>
                    <div class="modal-pad">Task GCode:</div>
                    <div>
                        <textarea id="taskInfoGcode" name="newTaskGcode" rows="4" cols="50" placeholder="Disabled for manual tasks" disabled></textarea>
                    </div>

                    <div class="modal-pad">
                        <button id="overideExistingTask">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="helpModal" class="help-modal">
            <div class="help-modal-content">
                <span id="closeHelpModal" class="close-modal">&times;</span>
                <div id="helpText">
                    <div>This tool is designed to be used in cunjunction with LatheCode:</div>
                    <div><a href="https://kachurovskiy.github.io/lathecode/ " target="_blank ">https://kachurovskiy.github.io/lathecode/</a></div>
                    <ul style="list-style-type: disc; padding-left: 20px; ">
                        <li>Use LatheCode to generate the G-code, then paste it into this tool.</li>
                        <li>You can also write the G-code by hand for simple operations such as boring or grooving. <a href="# " id="exampleCode">Click here</a> to load an example.</li>
                        <li>Click "Simulate" to plot the moves onto the canvas.</li>
                        <li>movement lines marked with "; cut" will show in <span class="line red-line"></span><span class="text-red">red</span>.</li>
                        <li>movement lines marked with "; travel" will show in <span class="line green-line"></span><span class="text-green">green</span>.</li>
                        <li>movement lines marked with "; retract" will show in <span class="line orange-line"></span><span class="text-orange">orange</span>.</li>
                        <li>movement lines not marked will default to <span class="line green-line"></span><span class="text-green">green</span>.</li>
                        <li>All other moves will be considered travel moves and will show in green.</li>
                        <li>Any G-code you paste or write can be saved into the browser's local storage. This is useful for saving common operations.</li>
                        <li>When you're ready, you can send the G-code to the Nano ELS H4 by clicking "Send."</li>
                        <li>More functionality to come soon! Version 0.2</li>
                        <li>Please provide feedback, raise issues or make suggestions here: <a href="https://github.com/Festivejelly/LatheGcodeVisualiser " target="_blank ">https://github.com/Festivejelly/LatheGcodeVisualiser</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="zoomModal" class="zoom-modal">
            <div class="zoom-modal-content" style="background-color: #242424;">
                <span id="closeZoomModal" class="close-modal">&times;</span>
                <canvas id="zoomCanvas" width="1600 " height="1200 "></canvas>
                <div id="sliderAndButtonContainer">
                    <div id="zoomSliderContainer" class="innerContainer" style="width: 400px;">
                        <input type="range" id="zoomProgressSlider" min="0" max="100" value="0" style="width: 100%;">
                        <div id="zoomSliderLabel" style="text-align: center;"><br>Drag to see moves</div>
                    </div>
                    <button id="zoomCloseButton">Close</button>
                </div>
            </div>
        </div>
</body>

</html>